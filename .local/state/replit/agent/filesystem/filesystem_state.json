{"file_contents":{"src/components/RestaurantProfile/ChangeLogoModal.jsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport Image from 'next/image'\nimport { X, Upload } from 'lucide-react'\n\nexport default function ChangeLogoModal({ currentLogo, onSave, onCancel }) {\n  const [logoPreview, setLogoPreview] = useState(currentLogo || '')\n  const [uploading, setUploading] = useState(false)\n  const [message, setMessage] = useState('')\n\n  const handleFileChange = async (e) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setUploading(true)\n    setMessage('⏳ Uploading image...')\n    try {\n      const data = new FormData()\n      data.append('file', file)\n      data.append('upload_preset', 'Restaurant')\n\n      const res = await fetch('https://api.cloudinary.com/v1_1/duugxwfu3/image/upload', {\n        method: 'POST',\n        body: data\n      })\n      const json = await res.json()\n\n      if (json.secure_url) {\n        setLogoPreview(json.secure_url)\n        setMessage('✅ Image uploaded!')\n      } else {\n        console.error('Cloudinary response error:', json)\n        setMessage('❌ Failed to upload image')\n      }\n    } catch (err) {\n      console.error('Upload error:', err)\n      setMessage('❌ Upload failed')\n    } finally {\n      setUploading(false)\n      setTimeout(() => setMessage(''), 2500)\n    }\n  }\n\n  const handleSave = () => {\n    if (logoPreview) {\n      onSave(logoPreview)\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      <div className=\"absolute inset-0 bg-black/30\" onClick={onCancel}></div>\n      <div className=\"relative z-10 w-full max-w-lg rounded-xl border border-neutral-200 bg-white p-4 sm:p-5 shadow-xl\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight\">Change Logo</h3>\n          <button className=\"rounded-md p-1 hover:bg-neutral-100\" onClick={onCancel}>\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n        <div className=\"mt-4\">\n          <div className=\"rounded-xl border border-dashed border-neutral-300 bg-neutral-50 p-4 sm:p-5 text-center\">\n            <input\n              id=\"logoInput\"\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleFileChange}\n              className=\"hidden\"\n            />\n            {logoPreview ? (\n              <div className=\"mx-auto h-16 w-16 rounded-lg overflow-hidden relative\">\n                <Image\n                  src={logoPreview}\n                  alt=\"Logo preview\"\n                  fill\n                  className=\"object-cover\"\n                />\n              </div>\n            ) : (\n              <div className=\"mx-auto h-16 w-16 rounded-lg bg-neutral-200 flex items-center justify-center\">\n                <span className=\"text-neutral-400 text-xs\">No Logo</span>\n              </div>\n            )}\n            <p className=\"mt-3 text-sm text-neutral-600\">PNG or JPG, 256x256 recommended.</p>\n            {message && <p className=\"mt-2 text-xs text-neutral-500\">{message}</p>}\n            <div className=\"mt-4 flex flex-col sm:flex-row items-stretch sm:items-center justify-center gap-2\">\n              <label\n                htmlFor=\"logoInput\"\n                className=\"inline-flex items-center justify-center gap-2 rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm font-medium text-neutral-800 hover:bg-neutral-50 cursor-pointer\"\n              >\n                <Upload className=\"h-4 w-4\" />\n                {uploading ? 'Uploading...' : 'Upload'}\n              </label>\n              <button\n                onClick={handleSave}\n                disabled={!logoPreview || uploading}\n                className=\"inline-flex items-center justify-center gap-2 rounded-lg bg-neutral-900 px-3 py-2 text-sm font-medium text-white hover:bg-neutral-800 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                Save\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n","size_bytes":4014},"src/components/Customer/LocationContact.jsx":{"content":"import { MapPin, Phone, Clock, Bike, Navigation } from 'lucide-react';\nimport { colors, iconBackgrounds } from '@/constants/colors';\n\nexport default function LocationContact() {\n  return (\n    <section id=\"location\" className=\"mx-auto mt-20 max-w-7xl px-6\">\n      <div className=\"grid gap-8 lg:grid-cols-2\">\n        <div className=\"overflow-hidden rounded-2xl border\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgPrimary }}>\n          <iframe\n            title=\"Baltit Wok Location\"\n            src=\"https://maps.google.com/maps?q=33.644683,72.9593064(Baltit%20Wok)&t=&z=17&ie=UTF8&iwloc=&output=embed\"\n            className=\"h-[360px] w-full\"\n            loading=\"lazy\"\n            referrerPolicy=\"no-referrer-when-downgrade\"\n          ></iframe>\n        </div>\n        <div id=\"contact\" className=\"rounded-2xl border p-6\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgSec }}>\n          <h2 className=\"text-3xl tracking-tight\" style={{ fontFamily: 'Poppins', fontWeight: 600, color: colors.textDark }}>Get In Touch</h2>\n          <div className=\"mt-4 space-y-4\">\n            <div className=\"flex items-start gap-3\">\n              <span className=\"inline-flex h-9 w-9 items-center justify-center rounded-full\" style={{ background: iconBackgrounds.primary }}>\n                <MapPin className=\"h-4 w-4\" style={{ color: colors.primary }} />\n              </span>\n              <div>\n                <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>Address</p>\n                <p className=\"text-sm\" style={{ color: colors.textMuted }}>Near Punjab Cash & Carry, G-13/1 Islamabad</p>\n              </div>\n            </div>\n            <div className=\"flex items-start gap-3\">\n              <span className=\"inline-flex h-9 w-9 items-center justify-center rounded-full\" style={{ background: iconBackgrounds.accent }}>\n                <Phone className=\"h-4 w-4\" style={{ color: colors.accent }} />\n              </span>\n              <div>\n                <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>Phone</p>\n                <a href=\"tel:+923001234567\" className=\"text-sm hover:text-[#06D6A0]\" style={{ color: colors.textMuted }}>+92 300 123 4567</a>\n              </div>\n            </div>\n            <div className=\"flex items-start gap-3\">\n              <span className=\"inline-flex h-9 w-9 items-center justify-center rounded-full\" style={{ background: iconBackgrounds.secondary }}>\n                <Clock className=\"h-4 w-4\" style={{ color: colors.secondary }} />\n              </span>\n              <div>\n                <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>Timings</p>\n                <p className=\"text-sm\" style={{ color: colors.textMuted }}>12 PM – 11 PM</p>\n              </div>\n            </div>\n            <div className=\"flex items-start gap-3\">\n              <span className=\"inline-flex h-9 w-9 items-center justify-center rounded-full\" style={{ background: iconBackgrounds.primary }}>\n                <Bike className=\"h-4 w-4\" style={{ color: colors.primary }} />\n              </span>\n              <div>\n                <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>Delivery</p>\n                <p className=\"text-sm\" style={{ color: colors.textMuted }}>Takeaway & Home Delivery available</p>\n              </div>\n            </div>\n          </div>\n          <div className=\"mt-6 flex flex-wrap gap-3\">\n            <a\n              href=\"https://maps.google.com/?q=G-13/1%20Islamabad%20Punjab%20Cash%20%26%20Carry\"\n              target=\"_blank\"\n              className=\"inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm font-semibold transition hover:border-[#E63946] hover:text-[#E63946]\"\n              style={{ borderColor: colors.border, backgroundColor: colors.bgPrimary, color: colors.textDark }}\n            >\n              <Navigation className=\"h-4 w-4\" /> Get Directions\n            </a>\n            <a\n              href=\"tel:+923001234567\"\n              className=\"inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold text-white\"\n              style={{ backgroundColor: colors.primary }}\n            >\n              <Phone className=\"h-4 w-4\" /> Call to Order\n            </a>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}","size_bytes":4375},"src/components/RestaurantProfile/EditProfileModal.jsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { X } from 'lucide-react'\n\nexport default function EditProfileModal({ restaurant, onSave, onCancel }) {\n  const [name, setName] = useState('')\n  const [description, setDescription] = useState('')\n  const [cuisine, setCuisine] = useState('')\n  const [owner, setOwner] = useState('')\n  const [contactEmail, setContactEmail] = useState('')\n  const [contactPhone, setContactPhone] = useState('')\n  const [isLive, setIsLive] = useState(false)\n\n  useEffect(() => {\n    if (restaurant) {\n      setName(restaurant.name || '')\n      setDescription(restaurant.description || '')\n      setCuisine(restaurant.cuisine || '')\n      setOwner(restaurant.owner || '')\n      setContactEmail(restaurant.contactEmail || '')\n      setContactPhone(restaurant.contactPhone || '')\n      setIsLive(restaurant.isLive || false)\n    }\n  }, [restaurant])\n\n  const handleSubmit = (e) => {\n    e.preventDefault()\n    onSave({\n      ...restaurant,\n      name,\n      description,\n      cuisine,\n      owner,\n      contactEmail,\n      contactPhone,\n      isLive\n    })\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      <div className=\"absolute inset-0 bg-black/30\" onClick={onCancel}></div>\n      <div className=\"relative z-10 w-full max-w-lg rounded-xl border border-neutral-200 bg-white p-4 sm:p-5 shadow-xl\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight\">Edit Restaurant</h3>\n          <button className=\"rounded-md p-1 hover:bg-neutral-100\" onClick={onCancel}>\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n        <form onSubmit={handleSubmit} className=\"mt-4 space-y-4\">\n          <div>\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Name</label>\n            <input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              required\n              className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <div>\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Tagline / Description</label>\n            <input\n              type=\"text\"\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <div>\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Cuisine</label>\n            <input\n              type=\"text\"\n              value={cuisine}\n              onChange={(e) => setCuisine(e.target.value)}\n              className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <div>\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Owner</label>\n            <input\n              type=\"text\"\n              value={owner}\n              onChange={(e) => setOwner(e.target.value)}\n              className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <div>\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Contact Email</label>\n            <input\n              type=\"email\"\n              value={contactEmail}\n              onChange={(e) => setContactEmail(e.target.value)}\n              className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <div>\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Contact Phone</label>\n            <input\n              type=\"tel\"\n              value={contactPhone}\n              onChange={(e) => setContactPhone(e.target.value)}\n              className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <div>\n            <label className=\"mb-1 flex items-center gap-2\">\n              <input\n                type=\"checkbox\"\n                checked={isLive}\n                onChange={(e) => setIsLive(e.target.checked)}\n                className=\"rounded border-neutral-200\"\n              />\n              <span className=\"text-sm font-medium text-neutral-700\">Restaurant is Live</span>\n            </label>\n          </div>\n          <div className=\"flex items-center justify-end gap-2 pt-2\">\n            <button\n              type=\"button\"\n              className=\"rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm font-medium text-neutral-800 hover:bg-neutral-50\"\n              onClick={onCancel}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"rounded-lg bg-neutral-900 px-3 py-2 text-sm font-medium text-white hover:bg-neutral-800\"\n            >\n              Save\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}\n\n","size_bytes":5486},"src/app/api/menu/route.js":{"content":"import { getMenu, connectToDB } from '../../../services/db'\nimport { getOrCreateDefaultRestaurant } from '../../../utils/getRestaurantId'\n\nexport async function GET() {\n  try {\n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.',\n        timestamp: new Date().toISOString()\n      }, { status: 404 })\n    }\n    \n    await connectToDB()\n    const menu = await getMenu(restaurantId)\n    \n    return Response.json({ \n      success: true,\n      data: menu,\n      timestamp: new Date().toISOString()\n    })\n  } catch (error) {\n    console.error('Menu fetch error:', error)\n    return Response.json({ \n      success: false, \n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 500 })\n  }\n}\n","size_bytes":880},"src/components/Checkout/CartSummary.jsx":{"content":"// components/CartSummary.jsx\n'use client'\n\nimport Image from 'next/image'\nimport { Minus, Plus } from 'lucide-react'\n\nexport default function CartSummary({ cart, onUpdateQuantity }) {\n  return (\n    <div className=\"bg-white rounded-xl border border-neutral-200 divide-y divide-neutral-200\">\n      {cart.map((item, index) => (\n        <div key={item.id} className=\"p-5 flex items-center gap-4\">\n          <div className=\"w-20 h-20 relative rounded-lg overflow-hidden bg-neutral-100\">\n            <Image\n              src={item.imageUrl || 'https://placehold.co/80x80/png?text=' + encodeURIComponent(item.name.charAt(0))}\n              width={80}\n              height={80}\n              className=\"w-full h-full object-cover\"\n              alt={item.name}\n              onError={(e) => {\n                e.target.src = 'https://placehold.co/80x80/png?text=' + encodeURIComponent(item.name.charAt(0));\n              }}\n            />\n          </div>\n          <div className=\"flex-1\">\n            <h3 className=\"font-semibold mb-1\">{item.name}</h3>\n            <p className=\"text-sm text-neutral-500 mb-1\">{item.description}</p>\n            {/* Show variant if present */}\n            {item.variant && (\n              <p className=\"text-xs text-neutral-600 mb-1\">\n                Variant: <span className=\"font-medium\">{item.variant}</span>\n              </p>\n            )}\n            {/* Show sides if present */}\n            {item.selectedSides && item.selectedSides.length > 0 && (\n              <p className=\"text-xs text-neutral-600 mb-2\">\n                Sides: <span className=\"font-medium\">{item.selectedSides.map(s => s.sideName || s.name || s).join(', ')}</span>\n              </p>\n            )}\n            <div className=\"flex items-center gap-3\">\n              <button\n                onClick={() => onUpdateQuantity(index, -1)}\n                className=\"w-8 h-8 rounded-lg border border-neutral-200 flex items-center justify-center hover:bg-neutral-50 transition-all\"\n              >\n                <Minus className=\"w-4 h-4\" />\n              </button>\n              <span className=\"font-medium\">{item.quantity}</span>\n              <button\n                onClick={() => onUpdateQuantity(index, 1)}\n                className=\"w-8 h-8 rounded-lg border border-neutral-200 flex items-center justify-center hover:bg-neutral-50 transition-all\"\n              >\n                <Plus className=\"w-4 h-4\" />\n              </button>\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <p className=\"font-semibold text-lg\">Rs {(item.price * item.quantity).toFixed(0)}</p>\n          </div>\n        </div>\n      ))}\n    </div>\n  )\n}","size_bytes":2676},"src/components/Customer/WhatsAppWidget.jsx":{"content":"import { MessageCircle, X } from 'lucide-react';\nimport { colors } from '@/constants/colors';\n\nexport default function WhatsAppWidget({ isWaPanelOpen, toggleWaPanel, handleOutsideClick }) {\n  return (\n    <div id=\"waWidget\" className=\"fixed bottom-25 right-5 z-[60] flex flex-col items-end\">\n      {/* WhatsApp Panel - Positioned absolutely above button */}\n      <div \n        id=\"waPanel\" \n        className={`absolute bottom-full mb-3 w-72 rounded-2xl border p-4 shadow-2xl transition-all duration-300 ${\n          isWaPanelOpen ? 'opacity-100 translate-y-0 pointer-events-auto' : 'opacity-0 translate-y-2 pointer-events-none invisible'\n        }`} \n        style={{ \n          borderColor: colors.borderLight, \n          backgroundColor: colors.bgPrimary \n        }}\n      >\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <span \n              className=\"inline-flex h-10 w-10 items-center justify-center rounded-full\" \n              style={{ background: `${colors.primary}20` }}\n            >\n              <MessageCircle className=\"h-5 w-5\" style={{ color: colors.primary }} />\n            </span>\n            <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>\n              Chat with Baltit Wok\n            </p>\n          </div>\n          <button \n            id=\"waClose\" \n            aria-label=\"Close chat\" \n            className=\"inline-flex h-8 w-8 items-center justify-center rounded-full border transition-colors hover:bg-white/10\" \n            style={{ \n              borderColor: colors.borderLight,\n              color: colors.textDark\n            }} \n            onClick={toggleWaPanel}\n          >\n            <X className=\"h-4 w-4\" style={{ color: colors.textDark }} />\n          </button>\n        </div>\n        <div className=\"mt-4 space-y-2\">\n          <a \n            href=\"https://wa.me/923236300813?text=Hi%20Baltit%20Wok%21%20I%27d%20like%20to%20order.\" \n            target=\"_blank\" \n            rel=\"noopener noreferrer\"\n            className=\"block rounded-lg border px-4 py-2.5 text-sm font-medium transition-all duration-200 hover:scale-[1.02]\" \n            style={{ \n              borderColor: colors.borderLight,\n              backgroundColor: colors.bgPrimary,\n              color: colors.textDark\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.borderColor = colors.primary;\n              e.currentTarget.style.color = colors.primary;\n              e.currentTarget.style.backgroundColor = `${colors.primary}20`;\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.borderColor = colors.borderLight;\n              e.currentTarget.style.color = colors.textDark;\n              e.currentTarget.style.backgroundColor = colors.bgPrimary;\n            }}\n          >\n            Hi! I'd like to order.\n          </a>\n          <a \n            href=\"https://wa.me/923236300813?text=Can%20you%20share%20the%20menu%20please%3F\" \n            target=\"_blank\" \n            rel=\"noopener noreferrer\"\n            className=\"block rounded-lg border px-4 py-2.5 text-sm font-medium transition-all duration-200 hover:scale-[1.02]\" \n            style={{ \n              borderColor: colors.borderLight,\n              backgroundColor: colors.bgPrimary,\n              color: colors.textDark\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.borderColor = colors.primary;\n              e.currentTarget.style.color = colors.primary;\n              e.currentTarget.style.backgroundColor = `${colors.primary}20`;\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.borderColor = colors.borderLight;\n              e.currentTarget.style.color = colors.textDark;\n              e.currentTarget.style.backgroundColor = colors.bgPrimary;\n            }}\n          >\n            Send me the menu.\n          </a>\n          <a \n            href=\"https://wa.me/923236300813?text=Can%20you%20send%20your%20location%3F\" \n            target=\"_blank\" \n            rel=\"noopener noreferrer\"\n            className=\"block rounded-lg border px-4 py-2.5 text-sm font-medium transition-all duration-200 hover:scale-[1.02]\" \n            style={{ \n              borderColor: colors.borderLight,\n              backgroundColor: colors.bgPrimary,\n              color: colors.textDark\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.borderColor = colors.primary;\n              e.currentTarget.style.color = colors.primary;\n              e.currentTarget.style.backgroundColor = `${colors.primary}20`;\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.borderColor = colors.borderLight;\n              e.currentTarget.style.color = colors.textDark;\n              e.currentTarget.style.backgroundColor = colors.bgPrimary;\n            }}\n          >\n            Where are you located?\n          </a>\n        </div>\n      </div>\n      \n      {/* WhatsApp Button - Fixed position, doesn't move */}\n      <button \n        id=\"waBtn\" \n        aria-label=\"Open WhatsApp chat\" \n        className=\"relative inline-flex h-14 w-14 items-center justify-center rounded-full shadow-lg transition-transform duration-200 hover:scale-110 active:scale-95 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/70\" \n        style={{ \n          background: 'linear-gradient(135deg, #25D366 0%, #128C7E 100%)',\n          boxShadow: '0 4px 14px 0 rgba(37, 211, 102, 0.4)'\n        }} \n        onClick={toggleWaPanel}\n      >\n        <span className=\"absolute -top-1 -right-1 inline-flex h-3.5 w-3.5 animate-ping rounded-full bg-white/80\"></span>\n        <MessageCircle className=\"h-6 w-6 text-white\" />\n      </button>\n    </div>\n  );\n}","size_bytes":5812},"src/components/RestaurantProfile/BranchFormModal.jsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { X, Phone, MapPin, ChevronDown } from 'lucide-react'\n\nexport default function BranchFormModal({ branch, onSave, onCancel }) {\n  const [name, setName] = useState('')\n  const [address, setAddress] = useState('')\n  const [phone, setPhone] = useState('')\n  const [city, setCity] = useState('')\n  const [lat, setLat] = useState('')\n  const [lng, setLng] = useState('')\n  const [status, setStatus] = useState('Open')\n\n  useEffect(() => {\n    if (branch) {\n      setName(branch.name || '')\n      setAddress(branch.address || '')\n      setPhone(branch.phone || '')\n      setCity(branch.city || '')\n      setLat(branch.coordinates?.lat?.toString() || '')\n      setLng(branch.coordinates?.lng?.toString() || '')\n      setStatus(branch.status || 'Open')\n    } else {\n      // Reset form for new branch\n      setName('')\n      setAddress('')\n      setPhone('')\n      setCity('')\n      setLat('')\n      setLng('')\n      setStatus('Open')\n    }\n  }, [branch])\n\n  const handleSubmit = (e) => {\n    e.preventDefault()\n    \n    // Validate required fields\n    if (!name.trim()) {\n      alert('Branch name is required')\n      return\n    }\n    if (!address.trim()) {\n      alert('Address is required')\n      return\n    }\n    if (!city.trim()) {\n      alert('City is required')\n      return\n    }\n    \n    const branchData = {\n      name: name.trim(),\n      address: address.trim(),\n      phone: phone.trim() || undefined,\n      city: city.trim(),\n      coordinates: {\n        lat: lat && lat.trim() ? parseFloat(lat) : undefined,\n        lng: lng && lng.trim() ? parseFloat(lng) : undefined\n      },\n      status: status || 'Open'\n    }\n\n    // Remove undefined values\n    if (!branchData.coordinates.lat && !branchData.coordinates.lng) {\n      branchData.coordinates = undefined\n    }\n    if (!branchData.phone) {\n      delete branchData.phone\n    }\n\n    onSave(branchData)\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      <div className=\"absolute inset-0 bg-black/30\" onClick={onCancel}></div>\n      <div className=\"relative z-10 w-full max-w-2xl rounded-xl border border-neutral-200 bg-white p-4 sm:p-5 shadow-xl max-h-[90vh] overflow-y-auto\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight\">\n            {branch ? 'Edit Branch' : 'New Branch'}\n          </h3>\n          <button className=\"rounded-md p-1 hover:bg-neutral-100\" onClick={onCancel}>\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n        <form onSubmit={handleSubmit} className=\"mt-4 grid gap-4 sm:grid-cols-2\">\n          <div className=\"sm:col-span-2\">\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Branch name</label>\n            <input\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              required\n              className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <div>\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Phone</label>\n            <div className=\"relative\">\n              <Phone className=\"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-400\" />\n              <input\n                type=\"tel\"\n                value={phone}\n                onChange={(e) => setPhone(e.target.value)}\n                className=\"w-full rounded-lg border border-neutral-200 bg-white pl-9 pr-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n              />\n            </div>\n          </div>\n          <div>\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">City</label>\n            <input\n              type=\"text\"\n              value={city}\n              onChange={(e) => setCity(e.target.value)}\n              required\n              className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <div className=\"sm:col-span-2\">\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Address</label>\n            <div className=\"relative\">\n              <MapPin className=\"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-400\" />\n              <input\n                type=\"text\"\n                value={address}\n                onChange={(e) => setAddress(e.target.value)}\n                required\n                className=\"w-full rounded-lg border border-neutral-200 bg-white pl-9 pr-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n              />\n            </div>\n          </div>\n          <div className=\"sm:col-span-2 grid grid-cols-2 gap-3\">\n            <div>\n              <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Latitude</label>\n              <input\n                type=\"number\"\n                step=\"any\"\n                value={lat}\n                onChange={(e) => setLat(e.target.value)}\n                placeholder=\"e.g., 33.6844\"\n                className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n              />\n            </div>\n            <div>\n              <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Longitude</label>\n              <input\n                type=\"number\"\n                step=\"any\"\n                value={lng}\n                onChange={(e) => setLng(e.target.value)}\n                placeholder=\"e.g., 73.0479\"\n                className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n              />\n            </div>\n          </div>\n          <div className=\"sm:col-span-2\">\n            <label className=\"mb-1 block text-sm font-medium text-neutral-700\">Status</label>\n            <div className=\"relative\">\n              <select\n                value={status}\n                onChange={(e) => setStatus(e.target.value)}\n                className=\"w-full appearance-none rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n              >\n                <option value=\"Open\">Open</option>\n                <option value=\"Closed\">Closed</option>\n                <option value=\"Temporarily Closed\">Temporarily Closed</option>\n              </select>\n              <ChevronDown className=\"pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-400\" />\n            </div>\n          </div>\n          <div className=\"sm:col-span-2 flex flex-col-reverse sm:flex-row items-stretch sm:items-center justify-end gap-2 pt-2\">\n            <button\n              type=\"button\"\n              className=\"rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm font-medium text-neutral-800 hover:bg-neutral-50\"\n              onClick={onCancel}\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              className=\"rounded-lg bg-neutral-900 px-3 py-2 text-sm font-medium text-white hover:bg-neutral-800\"\n            >\n              Save Branch\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}\n\n","size_bytes":7579},"next.config.ts":{"content":"import type { NextConfig } from \"next\";\n\nconst nextConfig: NextConfig = {\n  /* config options here */\n};\n\nexport default nextConfig;\n","size_bytes":133},"src/components/Customer/Deals.jsx":{"content":"import { MessageCircle } from 'lucide-react';\nimport { colors } from '@/constants/colors';\nimport ProductCard from '@/components/Menu/ProductCard';\nimport { useEffect, useState } from 'react';\n\nexport default function Deals() {\n  const [products, setProducts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const fetchProductsByCategory = async () => {\n      try {\n        const res = await fetch('/api/menu-items/by-category?category=Pizzas');\n        const json = await res.json();\n        if (!res.ok || !json.success) throw new Error(json.error || 'Failed to fetch products');\n        setProducts(json.data || []);\n      } catch (err) {\n        console.error('fetchProductsByCategory error', err);\n        setError('Failed to load products');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchProductsByCategory();\n  }, []);\n\n  return (\n    <section id=\"deals\" className=\"mx-4 mt-20 rounded-3xl border p-6 sm:p-10 lg:mx-8\" style={{ borderColor: colors.borderLight, backgroundColor: '#111111ff' }}>\n      <div className=\"mx-auto max-w-7xl\">\n        <div className=\"flex items-end justify-between gap-4\">\n          <h2 className=\"text-3xl sm:text-4xl tracking-tight\" style={{ fontFamily: 'Poppins', fontWeight: 600, color: colors.textDark }}>Pizza</h2>\n        </div>\n        {loading ? (\n          <div className=\"mt-6 text-center text-gray-500\">Loading products...</div>\n        ) : error ? (\n          <div className=\"mt-6 text-center text-red-500\">{error}</div>\n        ) : products.length === 0 ? (\n          <div className=\"mt-6 text-center text-gray-500\">No products found in this category</div>\n        ) : (\n          <div className=\"mt-6 grid gap-5 sm:grid-cols-2 lg:grid-cols-4\">\n            {products.map((product) => (\n              <ProductCard key={product._id} product={product} />\n            ))}\n          </div>\n        )}\n      </div>\n    </section>\n  );\n}","size_bytes":1984},"src/utils/getRestaurantId.js":{"content":"import { connectToDB } from '../services/db'\nimport { Restaurant } from '../models/Restaurant'\n\n/**\n * Get restaurant ID from various sources or default\n * Priority: \n * 1. Request header 'x-restaurant-id'\n * 2. Query parameter 'restaurant'\n * 3. Environment variable DEFAULT_RESTAURANT_ID\n * 4. First restaurant found in database\n */\nexport async function getRestaurantId(request = null) {\n  // Try header first\n  if (request) {\n    const headerId = request.headers.get('x-restaurant-id')\n    if (headerId) return headerId\n\n    // Try query parameter\n    try {\n      const url = new URL(request.url)\n      const queryId = url.searchParams.get('restaurant')\n      if (queryId) return queryId\n    } catch (e) {\n      // Not a valid URL, skip\n    }\n  }\n\n  // Try environment variable\n  if (process.env.DEFAULT_RESTAURANT_ID) {\n    return process.env.DEFAULT_RESTAURANT_ID\n  }\n\n  // Get first restaurant from database\n  try {\n    await connectToDB()\n    const restaurant = await Restaurant.findOne().select('_id').lean()\n    if (restaurant) {\n      return restaurant._id.toString()\n    }\n  } catch (e) {\n    console.error('Error getting default restaurant:', e)\n  }\n\n  // Return null if no restaurant found\n  return null\n}\n\nlet cachedDefaultRestaurantId = null;\nlet restaurantPromise = null;\n\n/**\n * Get or create default restaurant (for initial setup)\n * Priority:\n * 1. Environment variable 'Restaurant' from .env.local\n * 2. First existing restaurant in database\n * 3. Create new default restaurant if none found\n */\nexport async function getOrCreateDefaultRestaurant() {\n  // Return cached ID if available\n  if (cachedDefaultRestaurantId) {\n    return cachedDefaultRestaurantId;\n  }\n\n  // Ensure only one concurrent initialization\n  if (restaurantPromise) {\n    return restaurantPromise;\n  }\n\n  // Create initialization promise\n  restaurantPromise = (async () => {\n    try {\n      // Ensure database connection is fully established\n      await connectToDB();\n      \n      // Wait for connection to be ready with timeout\n      const mongoose = (await import('mongoose')).default;\n      if (mongoose.connection.readyState !== 1) {\n        await new Promise((resolve, reject) => {\n          const timeout = setTimeout(() => reject(new Error('Connection timeout')), 10000);\n          mongoose.connection.once('open', () => {\n            clearTimeout(timeout);\n            resolve();\n          });\n        });\n      }\n      \n      // First, try to get restaurant ID from .env.local\n      if (process.env.Restaurant) {\n        try {\n          const restaurant = await Restaurant.findById(process.env.Restaurant).lean()\n          if (restaurant) {\n            cachedDefaultRestaurantId = restaurant._id.toString();\n            return cachedDefaultRestaurantId;\n          } else {\n            console.warn(`Restaurant ID from .env.local (${process.env.Restaurant}) not found in database.`)\n          }\n        } catch (error) {\n          console.error('Error finding restaurant by ID from .env.local:', error)\n        }\n      }\n      \n      // Try to find any existing restaurant first\n      const existingRestaurant = await Restaurant.findOne().lean();\n      if (existingRestaurant) {\n        console.log(`Using existing restaurant with ID: ${existingRestaurant._id}`);\n        cachedDefaultRestaurantId = existingRestaurant._id.toString();\n        return cachedDefaultRestaurantId;\n      }\n      \n      // Create default restaurant only if none exists\n      const restaurant = await Restaurant.create({\n        name: process.env.DEFAULT_RESTAURANT_NAME || 'My Restaurant',\n        branches: []\n      })\n      console.log(`Created default restaurant with ID: ${restaurant._id}`)\n      cachedDefaultRestaurantId = restaurant._id.toString();\n      \n      return cachedDefaultRestaurantId;\n    } catch (error) {\n      console.error('Failed to get or create default restaurant:', error);\n      restaurantPromise = null; // Reset promise to allow retry\n      throw error;\n    }\n  })();\n\n  return restaurantPromise;\n}\n\n","size_bytes":4007},"src/app/admin/Customers/page.jsx":{"content":"'use client'\n\nimport { useState, useEffect, useMemo } from 'react'\nimport Image from 'next/image'\nimport { useRouter } from 'next/navigation'\nimport { ArrowLeft, Search, Users, Mail, Phone, Download } from 'lucide-react'\nimport { useRestaurant } from '@/hooks/useRestaurant'\n\nexport default function CustomersPage() {\n  const [orders, setOrders] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [searchQuery, setSearchQuery] = useState('')\n  const { restaurant, loading: restaurantLoading } = useRestaurant()\n  const router = useRouter()\n\n  useEffect(() => {\n    let mounted = true\n    async function loadOrders() {\n      setLoading(true)\n      try {\n        const res = await fetch('/api/orders')\n        if (!res.ok) throw new Error('Failed to fetch orders')\n        const data = await res.json()\n        if (mounted) setOrders(Array.isArray(data) ? data : [])\n      } catch (e) {\n        console.error('Failed to load orders', e)\n        if (mounted) setOrders([])\n      } finally {\n        if (mounted) setLoading(false)\n      }\n    }\n    loadOrders()\n    return () => { mounted = false }\n  }, [])\n\n  // Extract unique customers from orders\n  const customers = useMemo(() => {\n    const customerMap = new Map()\n    \n    orders.forEach(order => {\n      // Support both order.customer object and top-level fields (for backward compatibility)\n      const customerData = order.customer || {}\n      const name = customerData.name || order.name || 'Unknown'\n      const email = customerData.email || order.email || ''\n      const phone = customerData.phone || order.phone || ''\n      \n      // Skip if no identifying information\n      if (!email && !phone && name === 'Unknown') return\n      \n      // Use email or phone as the unique identifier\n      const identifier = email?.trim().toLowerCase() || phone?.trim() || `order-${order._id}`\n      \n      if (!customerMap.has(identifier)) {\n        customerMap.set(identifier, {\n          name: name || 'Unknown',\n          email: email || '',\n          phone: phone || '',\n          orderCount: 0,\n          totalSpent: 0,\n          lastOrderDate: null\n        })\n      }\n      \n      const customer = customerMap.get(identifier)\n      customer.orderCount += 1\n      customer.totalSpent += (order.total || 0)\n      \n      const orderDate = order.createdAt ? new Date(order.createdAt) : null\n      if (orderDate && (!customer.lastOrderDate || orderDate > customer.lastOrderDate)) {\n        customer.lastOrderDate = orderDate\n      }\n    })\n    \n    return Array.from(customerMap.values()).sort((a, b) => {\n      // Sort by last order date (most recent first)\n      if (a.lastOrderDate && b.lastOrderDate) {\n        return b.lastOrderDate - a.lastOrderDate\n      }\n      if (a.lastOrderDate) return -1\n      if (b.lastOrderDate) return 1\n      return 0\n    })\n  }, [orders])\n\n  // Filter customers based on search query\n  const filteredCustomers = useMemo(() => {\n    if (!searchQuery.trim()) return customers\n    \n    const query = searchQuery.toLowerCase().trim()\n    return customers.filter(customer => {\n      const nameMatch = customer.name?.toLowerCase().includes(query)\n      const emailMatch = customer.email?.toLowerCase().includes(query)\n      const phoneMatch = customer.phone?.includes(query)\n      return nameMatch || emailMatch || phoneMatch\n    })\n  }, [customers, searchQuery])\n\n  // Export customers to CSV\n  const handleExportCSV = () => {\n    if (filteredCustomers.length === 0) {\n      alert('No customers to export')\n      return\n    }\n\n    // CSV header\n    const headers = ['Name', 'Email', 'Phone', 'Order Count', 'Total Spent (Rs)', 'Last Order Date']\n    \n    // Helper function to escape CSV fields\n    const escapeCSV = (field) => {\n      if (field === null || field === undefined) return ''\n      const str = String(field)\n      // If field contains comma, quote, or newline, wrap in quotes and escape quotes\n      if (str.includes(',') || str.includes('\"') || str.includes('\\n')) {\n        return `\"${str.replace(/\"/g, '\"\"')}\"`\n      }\n      return str\n    }\n\n    // CSV rows\n    const rows = filteredCustomers.map(customer => {\n      const lastOrderDate = customer.lastOrderDate \n        ? customer.lastOrderDate.toLocaleDateString() \n        : ''\n      \n      return [\n        escapeCSV(customer.name),\n        escapeCSV(customer.email),\n        escapeCSV(customer.phone),\n        escapeCSV(customer.orderCount),\n        escapeCSV(customer.totalSpent.toFixed(2)),\n        escapeCSV(lastOrderDate)\n      ].join(',')\n    })\n\n    // Combine headers and rows\n    const csvContent = [\n      headers.join(','),\n      ...rows\n    ].join('\\n')\n\n    // Create blob and download\n    try {\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' })\n      const url = URL.createObjectURL(blob)\n      const link = document.createElement('a')\n      link.href = url\n      const timestamp = new Date().toISOString().split('T')[0] // YYYY-MM-DD format\n      link.download = `customers-${timestamp}.csv`\n      document.body.appendChild(link)\n      link.click()\n      document.body.removeChild(link)\n      URL.revokeObjectURL(url)\n    } catch (error) {\n      console.error('Failed to export CSV:', error)\n      alert('Failed to export CSV. Please try again.')\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50\">\n      <header className=\"sticky top-0 z-30 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b border-neutral-200/80\">\n        <div className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-3\">\n              <button\n                onClick={() => router.push('/admin')}\n                className=\"inline-flex items-center justify-center w-8 h-8 rounded-lg border border-neutral-200 bg-white hover:bg-neutral-50 transition-colors\"\n                aria-label=\"Back to admin\"\n              >\n                <ArrowLeft className=\"w-4 h-4\" />\n              </button>\n              {restaurant?.logo ? (\n                <div className=\"relative h-8 w-8 rounded-lg overflow-hidden flex-shrink-0\">\n                  <Image\n                    src={restaurant.logo}\n                    alt={restaurant.name || 'Restaurant Logo'}\n                    fill\n                    className=\"object-contain\"\n                    onError={(e) => {\n                      e.target.style.display = 'none'\n                      e.target.nextSibling.style.display = 'flex'\n                    }}\n                  />\n                  <div className=\"hidden h-8 w-8 rounded-lg bg-neutral-900 text-white items-center justify-center tracking-tight text-sm font-medium select-none\">CS</div>\n                </div>\n              ) : (\n                <div className=\"h-8 w-8 rounded-lg bg-neutral-900 text-white flex items-center justify-center tracking-tight text-sm font-medium select-none\">CS</div>\n              )}\n              <div className=\"flex flex-col\">\n                <h1 className=\"text-[22px] leading-6 tracking-tight font-semibold\">Customers</h1>\n                <p className=\"text-xs text-neutral-500\">View and manage customer information</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"py-3\">\n            <div className=\"flex flex-col lg:flex-row lg:items-center gap-3\">\n              <div className=\"flex-1\">\n                <label className=\"relative block\">\n                  <span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-neutral-400\">\n                    <Search className=\"w-4 h-4\" />\n                  </span>\n                  <input\n                    type=\"text\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    placeholder=\"Search by name, email, or phone...\"\n                    className=\"block w-full rounded-lg border border-neutral-200 bg-white py-2 pl-9 pr-3 placeholder:text-neutral-400 hover:border-neutral-300 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-neutral-900/10 text-sm\"\n                  />\n                </label>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6\">\n        <div className=\"mb-6 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2 text-sm text-neutral-500\">\n            <Users className=\"w-4 h-4\" />\n            <span>{filteredCustomers.length} {filteredCustomers.length === 1 ? 'customer' : 'customers'}</span>\n          </div>\n          {filteredCustomers.length > 0 && (\n            <button\n              onClick={handleExportCSV}\n              className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"\n            >\n              <Download className=\"w-4 h-4\" />\n              Export CSV\n            </button>\n          )}\n        </div>\n\n        {loading ? (\n          <div className=\"text-center py-12 text-neutral-500\">\n            Loading customers...\n          </div>\n        ) : filteredCustomers.length === 0 ? (\n          <div className=\"text-center py-12\">\n            <Users className=\"w-12 h-12 mx-auto text-neutral-300 mb-4\" />\n            <p className=\"text-neutral-500\">\n              {searchQuery ? 'No customers found matching your search.' : 'No customers found.'}\n            </p>\n          </div>\n        ) : (\n          <div className=\"bg-white border border-neutral-200 rounded-xl overflow-hidden\">\n            {/* Desktop Header */}\n            <div className=\"hidden md:grid grid-cols-12 gap-3 px-4 py-3 text-xs text-neutral-500 bg-neutral-50 border-b border-neutral-200\">\n              <div className=\"col-span-3\">Customer</div>\n              <div className=\"col-span-3\">Email</div>\n              <div className=\"col-span-2\">Phone</div>\n              <div className=\"col-span-2\">Orders</div>\n              <div className=\"col-span-2\">Total Spent</div>\n            </div>\n\n            {/* Customer List */}\n            <div className=\"divide-y divide-neutral-200\">\n              {filteredCustomers.map((customer, index) => (\n                <div\n                  key={`${customer.email || customer.phone || index}`}\n                  className=\"grid grid-cols-1 md:grid-cols-12 gap-3 px-4 py-4 hover:bg-neutral-50 transition-colors\"\n                >\n                  <div className=\"col-span-1 md:col-span-3 flex items-center gap-3\">\n                    <div className=\"h-10 w-10 rounded-lg bg-neutral-900 text-white flex items-center justify-center text-sm font-medium flex-shrink-0\">\n                      {(customer.name || 'U').charAt(0).toUpperCase()}\n                    </div>\n                    <div className=\"min-w-0\">\n                      <div className=\"text-sm font-medium text-neutral-900 truncate\">\n                        {customer.name}\n                      </div>\n                      {customer.lastOrderDate && (\n                        <div className=\"text-xs text-neutral-500\">\n                          Last order: {customer.lastOrderDate.toLocaleDateString()}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"col-span-1 md:col-span-3 flex items-center gap-2\">\n                    {customer.email ? (\n                      <div className=\"flex items-center gap-2 min-w-0\">\n                        <Mail className=\"w-4 h-4 text-neutral-400 flex-shrink-0\" />\n                        <span className=\"text-sm text-neutral-700 truncate\">{customer.email}</span>\n                      </div>\n                    ) : (\n                      <span className=\"text-sm text-neutral-400\">—</span>\n                    )}\n                  </div>\n\n                  <div className=\"col-span-1 md:col-span-2 flex items-center gap-2\">\n                    {customer.phone ? (\n                      <div className=\"flex items-center gap-2 min-w-0\">\n                        <Phone className=\"w-4 h-4 text-neutral-400 flex-shrink-0\" />\n                        <span className=\"text-sm text-neutral-700\">{customer.phone}</span>\n                      </div>\n                    ) : (\n                      <span className=\"text-sm text-neutral-400\">—</span>\n                    )}\n                  </div>\n\n                  <div className=\"col-span-1 md:col-span-2 flex items-center\">\n                    <span className=\"text-sm text-neutral-700 font-medium\">{customer.orderCount}</span>\n                  </div>\n\n                  <div className=\"col-span-1 md:col-span-2 flex items-center\">\n                    <span className=\"text-sm text-neutral-900 font-semibold\">\n                      Rs {customer.totalSpent.toFixed(0)}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        <div className=\"mt-8 border-t border-neutral-200/80 pt-4 text-xs text-neutral-500\">\n          Tip: Customers are extracted from orders. Search by name, email, or phone number.\n        </div>\n      </main>\n    </div>\n  )\n}\n\n","size_bytes":13290},"ws-server.js":{"content":"const { createServer } = require('http')\nconst WebSocket = require('ws')\nconst { parse } = require('url')\n\nconst PORT = parseInt(process.env.WS_PORT, 10) || 3002\nconst PING_INTERVAL = 30000 // 30 seconds\n\nconst clients = new Set()\n\nfunction heartbeat() {\n  this.isAlive = true\n}\n\nfunction broadcastToAll(message, exclude = null) {\n  const messageStr = JSON.stringify(message)\n  clients.forEach(client => {\n    if (client !== exclude && client.readyState === WebSocket.OPEN) {\n      try {\n        client.send(messageStr)\n      } catch (e) {\n        console.warn('Failed to send to client:', e)\n      }\n    }\n  })\n}\n\nconst server = createServer((req, res) => {\n  if (req.method === 'OPTIONS') {\n    res.setHeader('Access-Control-Allow-Origin', '*')\n    res.setHeader('Access-Control-Allow-Methods', 'POST, GET, OPTIONS')\n    res.setHeader('Access-Control-Allow-Headers', 'Content-Type')\n    res.writeHead(200)\n    res.end()\n    return\n  }\n\n  if (req.url === '/internal/ws/broadcast' && req.method === 'POST') {\n    console.log('HTTP /internal/ws/broadcast POST received from', req.socket.remoteAddress)\n    let body = ''\n    req.on('data', chunk => {\n      body += chunk.toString()\n    })\n    req.on('end', () => {\n      try {\n        console.log('Broadcast body:', body)\n        const msg = JSON.parse(body)\n        console.log('Broadcasting message to clients:', msg)\n        broadcastToAll(msg)\n        res.writeHead(200, {\n          'Content-Type': 'application/json',\n          'Access-Control-Allow-Origin': '*'\n        })\n        res.end(JSON.stringify({ ok: true }))\n      } catch (e) {\n        res.writeHead(400, { 'Content-Type': 'application/json' })\n        res.end(JSON.stringify({ error: 'Invalid JSON' }))\n      }\n    })\n    return\n  }\n\n  res.writeHead(404)\n  res.end('Not Found')\n})\n\nconst wss = new WebSocket.Server({ \n  server,\n  perMessageDeflate: false, // Disable per-message deflate to reduce latency\n  clientTracking: true // Enable built-in client tracking\n})\n\n// Ping all clients periodically\nconst interval = setInterval(() => {\n  wss.clients.forEach(ws => {\n    if (ws.isAlive === false) {\n      clients.delete(ws)\n      return ws.terminate()\n    }\n    ws.isAlive = false\n    try {\n      ws.ping()\n    } catch (e) {\n      console.warn('Failed to ping client:', e)\n    }\n  })\n}, PING_INTERVAL)\n\nwss.on('connection', (ws, req) => {\n  const ip = req.socket.remoteAddress\n  console.log(`New connection from ${ip}`)\n  console.log('Connection req.url=', req.url)\n  console.log('Connection headers:', req.headers)\n  \n  ws.isAlive = true\n  ws.on('pong', heartbeat)\n  clients.add(ws)\n  // Send immediate welcome message\n  try {\n    ws.send(JSON.stringify({ type: 'connected' }))\n  } catch (e) {\n    console.warn('Failed to send welcome message:', e)\n  }\n\n  // log when we receive messages from clients\n  ws.on('message', (data) => {\n    try {\n      const text = typeof data === 'string' ? data : data.toString()\n      console.log(`Received message from ${ip}: ${text}`)\n      const message = JSON.parse(text)\n      if (message && message.type) {\n        broadcastToAll(message, ws)\n      }\n    } catch (e) {\n      console.warn('Failed to parse/broadcast message:', e)\n      try {\n        ws.send(JSON.stringify({ error: 'Invalid message format' }))\n      } catch (e) {\n        console.warn('Failed to send error response:', e)\n      }\n    }\n  })\n\n  // log close with code/reason\n  ws.on('close', (code, reason) => {\n    clients.delete(ws)\n    console.log(`Client ${ip} disconnected (code=${code}, reason=${reason && reason.toString ? reason.toString() : reason})`)\n  })\n\n  ws.on('close', () => {\n    // kept for safety if previous close handler isn't used\n    clients.delete(ws)\n    console.log(`Client ${ip} disconnected (close event)`) \n  })\n\n  ws.on('error', (error) => {\n    console.error(`WebSocket error from ${ip}:`, error)\n    clients.delete(ws)\n  })\n})\n\nwss.on('error', (error) => {\n  console.error('WebSocket server error:', error)\n})\n\nserver.on('error', (error) => {\n  console.error('HTTP server error:', error)\n})\n\n// Cleanup on server shutdown\nprocess.on('SIGTERM', () => {\n  clearInterval(interval)\n  wss.close(() => {\n    server.close()\n  })\n})\n\n// Log HTTP Upgrade attempts (handshake)\nserver.on('upgrade', (req, socket, head) => {\n  try {\n    console.log('Received upgrade request:', { url: req.url, headers: req.headers })\n  } catch (e) {}\n})\n\n// Bind to 0.0.0.0 explicitly to accept IPv4 and IPv6 loopback connections\nserver.listen(PORT, '0.0.0.0', () => {\n  console.log(`WebSocket server listening on ws://0.0.0.0:${PORT}`)\n})","size_bytes":4562},"src/app/globals.css":{"content":"@import \"tailwindcss\";\n\n:root {\n  --background: #ffffff;\n  --foreground: #171717;\n}\n\n@theme inline {\n  --color-background: var(--background);\n  --color-foreground: var(--foreground);\n  --font-sans: var(--font-geist-sans);\n  --font-mono: var(--font-geist-mono);\n}\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    --background: #0a0a0a;\n    --foreground: #ededed;\n  }\n}\n\nbody {\n  background: var(--background);\n  color: var(--foreground);\n  font-family: Arial, Helvetica, sans-serif;\n}\n\n/* Utility to hide scrollbars but keep scrolling functional */\n.no-scrollbar {\n  -ms-overflow-style: none; /* IE and Edge */\n  scrollbar-width: none; /* Firefox */\n}\n.no-scrollbar::-webkit-scrollbar {\n  display: none; /* Chrome, Safari and Opera */\n}\n","size_bytes":740},"src/app/84588878l00o00g00i00n76580982/page.jsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\n\nexport default function LoginPage() {\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [error, setError] = useState('')\n  const router = useRouter()\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    setError('')\n\n    try {\n      console.log('Attempting login with:', { email, password })\n      const response = await fetch('/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ email, password }),\n        credentials: 'same-origin'\n      })\n\n      const data = await response.json()\n      console.log('Login response:', data)\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Login failed')\n      }\n\n      // Store user info in localStorage\n      localStorage.setItem('userRole', data.role)\n      localStorage.setItem('userName', `${data.firstName} ${data.lastName}`)\n\n  // Force a hard navigation to the admin page\n  window.location.href = '/admin'\n    } catch (err) {\n      console.error('Login error:', err)\n      setError(err.message || 'Login failed. Please try again.')\n    }\n  }\n\n  return (\n    <div className=\"relative flex min-h-screen\">\n      {/* Right visual panel */}\n      <aside className=\"hidden lg:flex w-1/2 items-center justify-center bg-white/70\">\n        <div className=\"relative h-full w-full\">\n          <img\n            src=\"https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1974&auto=format&fit=crop\"\n            alt=\"Restaurant interior ambience\"\n            className=\"h-full w-full object-cover\"\n          />\n          <div className=\"pointer-events-none absolute inset-0 bg-gradient-to-l from-white via-white/70 to-transparent\"></div>\n        </div>\n      </aside>\n\n      {/* Left auth panel */}\n      <main className=\"flex w-full lg:w-1/2 items-center justify-center px-6 py-10\">\n        <div className=\"w-full max-w-md\">\n          {/* Brand */}\n          <div className=\"mb-8 flex items-center gap-3\">\n            <div className=\"flex h-9 w-9 items-center justify-center rounded-md bg-neutral-900 text-white shadow-sm ring-1 ring-neutral-900/10\">\n              <span className=\"text-[13px] font-semibold tracking-tight\" style={{ letterSpacing: '-0.02em' }}>RS</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm font-medium text-neutral-900\">Restaurant Staff</span>\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" className=\"text-neutral-700\" style={{ stroke: 'currentColor', strokeWidth: 1.5, strokeLinecap: 'round', strokeLinejoin: 'round' }}>\n                <path d=\"M4 3v7\" />\n                <path d=\"M6 3v7\" />\n                <path d=\"M4 7h2\" />\n                <path d=\"M8 3v7a3 3 0 0 1-3 3\" />\n                <path d=\"M12 3v18\" />\n                <path d=\"M16 3h3a2 2 0 0 1 2 2v4a3 3 0 0 1-3 3h-2V3z\" />\n              </svg>\n            </div>\n          </div>\n\n          {/* Card */}\n          <div className=\"rounded-xl border border-neutral-200 bg-white/90 shadow-sm backdrop-blur-sm\">\n            <div className=\"px-6 pt-6 pb-2\">\n              <h1 className=\"text-[26px] font-semibold tracking-tight text-neutral-900\" style={{ letterSpacing: '-0.02em' }}>Employee Login</h1>\n              <p className=\"mt-1.5 text-sm text-neutral-600\">Access your staff portal using your work credentials.</p>\n            </div>\n\n            <div className=\"px-6 pb-6\">\n              {error && (\n                <div className=\"mb-4 p-2 text-sm text-red-600 bg-red-50 rounded-lg\">\n                  {error}\n                </div>\n              )}\n              \n              <form method=\"POST\" onSubmit={handleSubmit} className=\"space-y-4\">\n                {/* Email */}\n                <div className=\"space-y-1.5\">\n                  <label htmlFor=\"email\" className=\"block text-sm font-medium text-neutral-800\">Work Email</label>\n                  <div className=\"relative\">\n                    <div className=\"pointer-events-none absolute inset-y-0 left-3 flex items-center text-neutral-500\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" style={{ stroke: 'currentColor', strokeWidth: 1.5, strokeLinecap: 'round', strokeLinejoin: 'round' }}>\n                        <rect x=\"2\" y=\"4\" width=\"20\" height=\"16\" rx=\"2\" />\n                        <path d=\"M22 6 12 13 2 6\" />\n                      </svg>\n                    </div>\n                    <input\n                      id=\"email\"\n                      name=\"email\"\n                      type=\"email\"\n                      required\n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                      autoComplete=\"username\"\n                      placeholder=\"you@company.com\"\n                      className=\"w-full rounded-lg border border-neutral-300 bg-white px-10 py-2.5 text-[15px] text-neutral-900 placeholder:text-neutral-400 outline-none transition focus:border-neutral-900 focus:ring-4 focus:ring-neutral-900/5 hover:border-neutral-400\"\n                    />\n                  </div>\n                </div>\n\n                {/* Password */}\n                <div className=\"space-y-1.5\">\n                  <label htmlFor=\"password\" className=\"block text-sm font-medium text-neutral-800\">Password</label>\n                  <div className=\"relative\">\n                    <div className=\"pointer-events-none absolute inset-y-0 left-3 flex items-center text-neutral-500\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" style={{ stroke: 'currentColor', strokeWidth: 1.5, strokeLinecap: 'round', strokeLinejoin: 'round' }}>\n                        <rect x=\"3\" y=\"11\" width=\"18\" height=\"10\" rx=\"2\" />\n                        <path d=\"M7 11V7a5 5 0 0 1 10 0v4\" />\n                      </svg>\n                    </div>\n                    <input\n                      id=\"password\"\n                      name=\"password\"\n                      type=\"password\"\n                      required\n                      value={password}\n                      onChange={(e) => setPassword(e.target.value)}\n                      autoComplete=\"current-password\"\n                      placeholder=\"Enter your password\"\n                      className=\"w-full rounded-lg border border-neutral-300 bg-white px-10 py-2.5 text-[15px] text-neutral-900 placeholder:text-neutral-400 outline-none transition focus:border-neutral-900 focus:ring-4 focus:ring-neutral-900/5 hover:border-neutral-400\"\n                    />\n                  </div>\n                </div>\n\n                {/* Submit */}\n                <div className=\"pt-2\">\n                  <button\n                    type=\"submit\"\n                    className=\"inline-flex w-full items-center justify-center rounded-lg bg-neutral-900 px-4 py-2.5 text-[15px] font-medium text-white shadow-sm ring-1 ring-neutral-900/10 transition hover:bg-neutral-800 hover:shadow-md focus:outline-none focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-neutral-900 active:bg-neutral-900/90\"\n                  >\n                    Sign in\n                  </button>\n                </div>\n              </form>\n\n              {/* Footnote */}\n              <div className=\"mt-6 flex items-center justify-between border-t border-neutral-200 pt-4\">\n                <p className=\"text-[13px] text-neutral-600\">Staff-only access. Contact your manager if you need help.</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </main>\n    </div>\n  )\n}","size_bytes":7850},"src/components/Customer/Footer.jsx":{"content":"import Link from 'next/link';\nimport { Flame, Instagram, Facebook, MessageCircle, Phone } from 'lucide-react';\nimport { colors } from '@/constants/colors';\n\nexport default function Footer({ handleSmoothScroll }) {\n  return (\n    <footer className=\"mt-20\" style={{ backgroundColor: colors.bgSec, color: colors.textDark }}>\n      <div className=\"mx-auto max-w-7xl px-6 py-10\">\n        <div className=\"grid gap-8 sm:grid-cols-3\">\n          <div className=\"space-y-3\">\n            <div className=\"inline-flex items-center gap-2\">\n              <span className=\"text-xl tracking-tight\" style={{ fontFamily: 'Pacifico', color: colors.textDark }}>Baltit Wok</span>\n              <Flame className=\"h-4 w-4\" style={{ color: colors.primary }} />\n            </div>\n            <p className=\"text-sm\" style={{ color: colors.textMuted }}>Sizzling Asian fusion, burgers, and more. Takeaway & delivery in G-13/1 Islamabad.</p>\n          </div>\n          <div>\n            <p className=\"text-sm font-semibold\" style={{ color: colors.bgPrimary }}>Quick Links</p>\n            <div className=\"mt-3 flex flex-col space-y-2 text-sm\">\n              <Link href=\"#home\" className=\"hover:text-[#FFB703]\" style={{ color: colors.textMuted }} onClick={(e) => handleSmoothScroll(e, '#home')}>Home</Link>\n              <Link href=\"#menu\" className=\"hover:text-[#FFB703]\" style={{ color: colors.textMuted }} onClick={(e) => handleSmoothScroll(e, '#menu')}>Menu</Link>\n              <Link href=\"#deals\" className=\"hover:text-[#FFB703]\" style={{ color: colors.textMuted }} onClick={(e) => handleSmoothScroll(e, '#deals')}>Deals</Link>\n              <Link href=\"#contact\" className=\"hover:text-[#FFB703]\" style={{ color: colors.textMuted }} onClick={(e) => handleSmoothScroll(e, '#contact')}>Contact</Link>\n            </div>\n          </div>\n          <div>\n            <p className=\"text-sm font-semibold\" style={{ color: colors.bgPrimary }}>Follow Us</p>\n            <div className=\"mt-3 flex items-center gap-3\">\n              <a href=\"#\" className=\"inline-flex h-9 w-9 items-center justify-center rounded-full border hover:border-[#FFB703] hover:text-[#FFB703]\" style={{ borderColor: colors.borderLight, color: colors.textMuted }}>\n                <Instagram className=\"h-4 w-4\" />\n              </a>\n              <a href=\"#\" className=\"inline-flex h-9 w-9 items-center justify-center rounded-full border hover:border-[#FFB703] hover:text-[#FFB703]\" style={{ borderColor: colors.borderLight, color: colors.textMuted }}>\n                <Facebook className=\"h-4 w-4\" />\n              </a>\n              <a href=\"https://wa.me/923236300813\" target=\"_blank\" className=\"inline-flex h-9 w-9 items-center justify-center rounded-full border hover:border-[#06D6A0] hover:text-[#06D6A0]\" style={{ borderColor: colors.borderLight, color: colors.textMuted }}>\n                <MessageCircle className=\"h-4 w-4\" />\n              </a>\n            </div>\n          </div>\n        </div>\n        <div className=\"mt-8 flex flex-col items-center justify-between gap-4 border-t pt-6\" style={{ borderColor: colors.borderLight }}>\n          <p className=\"text-xs\" style={{ color: colors.textMuted }}>© 2025 Baltit Wok. All Rights Reserved.</p>\n          <a href=\"tel:+923001234567\" className=\"inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold text-white\" style={{ backgroundColor: colors.primary }}>\n            <Phone className=\"h-4 w-4\" /> Call to Order or Visit Us Today!\n          </a>\n        </div>\n      </div>\n    </footer>\n  );\n}","size_bytes":3518},"src/components/Checkout/DeliveryForm.jsx":{"content":"// components/DeliveryForm.jsx\n'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Bike, ShoppingBag, Phone, MapPin, Crosshair, Banknote, Mail, Loader2 } from 'lucide-react'\nimport Map from './Map'\n\nexport default function DeliveryForm({ formData, onChange }) {\n  const [selectedPickupDetails, setSelectedPickupDetails] = useState({ name: '', address: '' })\n  const [branches, setBranches] = useState([])\n  const [loadingLocations, setLoadingLocations] = useState(true)\n  const [locationsError, setLocationsError] = useState(null)\n\n  // Fetch restaurant branches dynamically\n  useEffect(() => {\n    async function fetchBranches() {\n      try {\n        setLoadingLocations(true)\n        setLocationsError(null)\n        \n        const response = await fetch('/api/restaurants')\n        if (!response.ok) {\n          throw new Error('Failed to fetch restaurant data')\n        }\n        \n        const result = await response.json()\n        if (result.success && result.data) {\n          // Get branches array from restaurant data\n          const restaurantBranches = Array.isArray(result.data.branches) ? result.data.branches : []\n          \n          // Filter to only show open branches\n          const openBranches = restaurantBranches.filter(branch => branch.status === 'Open')\n          \n          setBranches(openBranches)\n          \n          // If pickup location is already selected, update details\n          if (formData.pickupLocation) {\n            const branch = openBranches.find(b => b.name === formData.pickupLocation || b._id === formData.pickupLocation)\n            if (branch) {\n              setSelectedPickupDetails({\n                name: branch.name || '',\n                address: branch.address || ''\n              })\n            }\n          }\n        } else {\n          throw new Error('Invalid restaurant data')\n        }\n      } catch (error) {\n        console.error('Error fetching branches:', error)\n        setLocationsError(error.message)\n      } finally {\n        setLoadingLocations(false)\n      }\n    }\n\n    fetchBranches()\n  }, [formData.pickupLocation])\n\n  const handlePickupChange = (value) => {\n    onChange('pickupLocation', value)\n    const branch = branches.find(b => b.name === value || b._id === value)\n    if (branch) {\n      setSelectedPickupDetails({\n        name: branch.name || '',\n        address: branch.address || ''\n      })\n    } else {\n      setSelectedPickupDetails({ name: '', address: '' })\n    }\n  }\n\n  const useCurrentLocation = () => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition((position) => {\n        const lat = position.coords.latitude.toFixed(4)\n        const lng = position.coords.longitude.toFixed(4)\n        onChange('address', `${lat}, ${lng}`)\n      })\n    }\n  }\n\n  return (\n    <div className=\"bg-white rounded-xl border border-neutral-200 p-6 space-y-5\">\n      <div>\n        <label className=\"block text-sm font-medium text-neutral-700 mb-2\">Name</label>\n        <input\n          type=\"text\"\n          value={formData.name}\n          onChange={(e) => onChange('name', e.target.value)}\n          placeholder=\"Enter your name\"\n          className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent\"\n        />\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-neutral-700 mb-2\">Phone Number</label>\n        <div className=\"relative\">\n          <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n            <Phone className=\"w-5 h-5 text-neutral-400\" />\n          </div>\n          <input\n            type=\"tel\"\n            value={formData.phone}\n            onChange={(e) => onChange('phone', e.target.value)}\n            placeholder=\"+92 3** *******\"\n            className=\"w-full pl-12 pr-4 py-3 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent\"\n          />\n        </div>\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-neutral-700 mb-2\">Email</label>\n        <div className=\"relative\">\n          <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n            <Mail className=\"w-5 h-5 text-neutral-400\" />\n          </div>\n          <input\n            type=\"email\"\n            value={formData.email}\n            onChange={(e) => onChange('email', e.target.value)}\n            placeholder=\"you@example.com\"\n            className=\"w-full pl-12 pr-4 py-3 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent\"\n          />\n        </div>\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-neutral-700 mb-3\">Order Type</label>\n        <div className=\"grid grid-cols-2 gap-3 mb-5\">\n          <button\n            onClick={() => onChange('orderType', 'delivery')}\n            className={`order-type-btn py-4 px-4 rounded-lg font-medium transition-all flex flex-col items-center gap-2 ${formData.orderType === 'delivery' ? 'bg-neutral-900 text-white' : 'bg-white border-2 border-neutral-200 text-neutral-700 hover:bg-neutral-50'}`}\n          >\n            <Bike className=\"w-6 h-6\" />\n            <span>Delivery</span>\n          </button>\n          <button\n            onClick={() => onChange('orderType', 'pickup')}\n            className={`order-type-btn py-4 px-4 rounded-lg font-medium transition-all flex flex-col items-center gap-2 ${formData.orderType === 'pickup' ? 'bg-neutral-900 text-white' : 'bg-white border-2 border-neutral-200 text-neutral-700 hover:bg-neutral-50'}`}\n          >\n            <ShoppingBag className=\"w-6 h-6\" />\n            <span>Pickup</span>\n          </button>\n        </div>\n        {formData.orderType === 'delivery' && (\n          <div className=\"space-y-5\">\n            <div>\n              <label className=\"block text-sm font-medium text-neutral-700 mb-2\">Delivery Address</label>\n              <div className=\"relative mb-3\">\n                <div className=\"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none\">\n                  <MapPin className=\"w-5 h-5 text-neutral-400\" />\n                </div>\n                <input\n                  type=\"text\"\n                  value={formData.address}\n                  onChange={(e) => onChange('address', e.target.value)}\n                  placeholder=\"Enter your address\"\n                  className=\"w-full pl-12 pr-4 py-3 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent\"\n                />\n              </div>\n              <Map onLocationChange={(addr) => onChange('address', addr)} />\n              <button\n                onClick={useCurrentLocation}\n                className=\"text-sm text-neutral-900 font-medium hover:underline flex items-center gap-2\"\n              >\n                <Crosshair className=\"w-4 h-4\" />\n                Use current location\n              </button>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-neutral-700 mb-2\">Apartment/Suite (Optional)</label>\n              <input\n                type=\"text\"\n                value={formData.apartment}\n                onChange={(e) => onChange('apartment', e.target.value)}\n                placeholder=\"Apt 4B\"\n                className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-neutral-700 mb-2\">Delivery Instructions (Optional)</label>\n              <textarea\n                value={formData.instructions}\n                onChange={(e) => onChange('instructions', e.target.value)}\n                placeholder=\"Ring the doorbell twice...\"\n                rows={3}\n                className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent resize-none\"\n              />\n            </div>\n          </div>\n        )}\n        {formData.orderType === 'pickup' && (\n          <div>\n            <label className=\"block text-sm font-medium text-neutral-700 mb-2\">Select Pickup Location</label>\n            {loadingLocations ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <Loader2 className=\"w-5 h-5 text-neutral-400 animate-spin mr-2\" />\n                <span className=\"text-sm text-neutral-500\">Loading locations...</span>\n              </div>\n            ) : locationsError ? (\n              <div className=\"p-4 bg-red-50 border border-red-200 rounded-lg\">\n                <p className=\"text-sm text-red-600\">\n                  Failed to load branches: {locationsError}\n                </p>\n              </div>\n            ) : branches.length === 0 ? (\n              <div className=\"p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                <p className=\"text-sm text-yellow-600\">\n                  No pickup branches available. Please contact support.\n                </p>\n              </div>\n            ) : (\n              <>\n                <select\n                  value={formData.pickupLocation}\n                  onChange={(e) => handlePickupChange(e.target.value)}\n                  className=\"w-full px-4 py-3 border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent\"\n                >\n                  <option value=\"\">Choose a branch...</option>\n                  {branches.map((branch) => (\n                    <option key={branch._id || branch.name} value={branch.name}>\n                      {`${branch.name} - ${branch.address || ''}`}\n                    </option>\n                  ))}\n                </select>\n                {formData.pickupLocation && selectedPickupDetails.name && (\n                  <div className=\"mt-4 p-4 bg-neutral-50 border border-neutral-200 rounded-lg\">\n                    <div className=\"flex items-start gap-3\">\n                      <MapPin className=\"w-5 h-5 text-neutral-600 mt-0.5 flex-shrink-0\" />\n                      <div>\n                        <p className=\"font-medium text-neutral-900 mb-1\">{selectedPickupDetails.name}</p>\n                        <p className=\"text-sm text-neutral-600\">{selectedPickupDetails.address}</p>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </>\n            )}\n          </div>\n        )}\n      </div>\n      <div>\n        <label className=\"block text-sm font-medium text-neutral-700 mb-2\">Payment Method</label>\n        <div className=\"bg-neutral-50 border-2 border-neutral-900 rounded-lg p-4 flex items-center gap-3\">\n          <div className=\"w-10 h-10 bg-neutral-900 rounded-lg flex items-center justify-center flex-shrink-0\">\n            <Banknote className=\"w-5 h-5 text-white\" />\n          </div>\n          <div>\n            <p className=\"font-medium text-neutral-900\">Cash on Delivery</p>\n            <p className=\"text-sm text-neutral-600\">Pay when you receive your order</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","size_bytes":11324},"src/components/AdminDashboard/Sidebar.jsx":{"content":" 'use client'\n\nimport Link from 'next/link'\nimport Image from 'next/image'\nimport { useRouter } from 'next/navigation'\nimport { useRestaurant } from '@/hooks/useRestaurant'\n\nexport default function Sidebar({ onClose, isOpen = false, isDesktop = true }) {\n  const router = useRouter()\n  const { restaurant, loading } = useRestaurant()\n\n  async function handleLogout(e) {\n    e.preventDefault()\n    try {\n      await fetch('/api/auth/logout', { method: 'POST', credentials: 'same-origin' })\n    } catch (err) {\n      console.error('Logout failed', err)\n    } finally {\n      router.push('/84588878l00o00g00i00n76580982')\n    }\n  }\n\n  // When viewport width is >870px behave as desktop (always visible). Otherwise act as drawer.\n  const mobileTransform = isDesktop ? 'translate-x-0' : (isOpen ? 'translate-x-0' : '-translate-x-full')\n\n  return (\n    <aside className={`fixed z-40 inset-y-0 left-0 w-72 transform ${mobileTransform} transition-transform`}>\n      <div className=\"h-full flex flex-col bg-white border-r border-neutral-200 shadow-sm\">\n        <div className=\"h-16 flex items-center gap-3 px-5 border-b border-neutral-200\">\n          {restaurant?.logo ? (\n            <div className=\"relative h-9 w-9 rounded-md overflow-hidden flex-shrink-0\">\n              <Image\n                src={restaurant.logo}\n                alt={restaurant.name || 'Restaurant Logo'}\n                fill\n                className=\"object-contain\"\n                onError={(e) => {\n                  e.target.style.display = 'none'\n                  e.target.nextSibling.style.display = 'flex'\n                }}\n              />\n              <div className=\"hidden h-9 w-9 rounded-md bg-neutral-900 text-white items-center justify-center text-sm tracking-tight font-medium\">SL</div>\n            </div>\n          ) : (\n            <div className=\"h-9 w-9 rounded-md bg-neutral-900 text-white flex items-center justify-center text-sm tracking-tight font-medium\">SL</div>\n          )}\n          <div className=\"flex flex-col\">\n            <span className=\"text-base font-semibold tracking-tight text-neutral-900\">Admin</span>\n            <span className=\"text-[11px] text-neutral-500\">Dashboard</span>\n          </div>\n          {!isDesktop && (\n            <button onClick={onClose} className=\"ml-auto inline-flex items-center justify-center h-8 w-8 rounded-md hover:bg-neutral-50 text-neutral-700 transition-colors\" aria-label=\"Close sidebar\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>\n            </button>\n          )}\n        </div>\n\n        <nav className=\"flex-1 overflow-y-auto pt-4 pb-4 px-3\">\n          <div className=\"text-[11px] uppercase tracking-[0.08em] text-neutral-500 px-2 mb-2 font-medium\">Overview</div>\n          <Link href=\"/admin\" onClick={() => onClose?.()} className=\"group flex items-center gap-3 px-2 py-2 rounded-md bg-neutral-900 text-white border border-neutral-900\">\n            <span className=\"text-sm font-medium\">Dashboard</span>\n            <span className=\"ml-auto text-[10px] px-1.5 py-0.5 rounded bg-white/20 text-white border border-white/30\">Live</span>\n          </Link>\n          <Link href=\"/admin/Orders\" onClick={() => onClose?.()} className=\"group flex items-center gap-3 mt-1 px-2 py-2 rounded-md text-neutral-700 hover:text-neutral-900 hover:bg-neutral-50 transition-colors\">Orders</Link>\n          <Link href=\"/admin/MenuManagement\" onClick={() => onClose?.()} className=\"group flex items-center gap-3 mt-1 px-2 py-2 rounded-md text-neutral-700 hover:text-neutral-900 hover:bg-neutral-50 transition-colors\">Products</Link>\n          <Link href=\"/admin/Customers\" onClick={() => onClose?.()} className=\"group flex items-center gap-3 mt-1 px-2 py-2 rounded-md text-neutral-700 hover:text-neutral-900 hover:bg-neutral-50 transition-colors\">Customers</Link>\n\n          <div className=\"mt-6 text-[11px] uppercase tracking-[0.08em] text-neutral-500 px-2 mb-2 font-medium\">Insights</div>\n          <Link href=\"#\" className=\"group flex items-center gap-3 px-2 py-2 rounded-md text-neutral-700 hover:text-neutral-900 hover:bg-neutral-50 transition-colors\">Reports</Link>\n\n          <div className=\"mt-6 text-[11px] uppercase tracking-[0.08em] text-neutral-500 px-2 mb-2 font-medium\">Manage</div>\n          <Link href=\"/admin/profile\" onClick={() => onClose?.()} className=\"group flex items-center gap-3 px-2 py-2 rounded-md text-neutral-700 hover:text-neutral-900 hover:bg-neutral-50 transition-colors\">Restaurant Profile</Link>\n          <button onClick={handleLogout} className=\"w-full text-left px-2 py-2 rounded-md text-neutral-700 hover:text-neutral-900 hover:bg-neutral-50 transition-colors\">Logout</button>\n        </nav>\n      </div>\n    </aside>\n  )\n}\n","size_bytes":4840},"src/app/api/categories/route.js":{"content":"import { getCategories, createCategory, updateCategory, deleteCategory, connectToDB } from '../../../services/db'\nimport { getOrCreateDefaultRestaurant } from '../../../utils/getRestaurantId'\n\nexport async function GET(request) {\n  try {\n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.',\n        timestamp: new Date().toISOString()\n      }, { status: 404 })\n    }\n    \n    await connectToDB()\n    const categories = await getCategories(restaurantId)\n    \n    return Response.json({ \n      success: true,\n      data: categories,\n      timestamp: new Date().toISOString()\n    })\n  } catch (error) {\n    console.error('Categories fetch error:', error)\n    return Response.json({ \n      success: false, \n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 500 })\n  }\n}\n\nexport async function POST(request) {\n  try {\n    const body = await request.json()\n    if (!body || !body.name) {\n      return Response.json({ success: false, error: 'name is required' }, { status: 400 })\n    }\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.'\n      }, { status: 404 })\n    }\n    \n    await connectToDB()\n    const created = await createCategory(restaurantId, body)\n    \n    return Response.json({ success: true, data: created }, { status: 201 })\n  } catch (error) {\n    console.error('Category create error:', error)\n    return Response.json({ success: false, error: error.message }, { status: 500 })\n  }\n}\n\nexport async function PUT(request) {\n  try {\n    const body = await request.json()\n    // Support both _id (name) and name for backward compatibility\n    const categoryName = body._id || body.name\n    if (!categoryName) {\n      return Response.json({ success: false, error: 'Missing category name (_id or name) for update' }, { status: 400 })\n    }\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.'\n      }, { status: 404 })\n    }\n    \n    await connectToDB()\n    const updated = await updateCategory(restaurantId, categoryName, body)\n    \n    return Response.json({ success: true, data: updated })\n  } catch (error) {\n    console.error('Category update error:', error)\n    return Response.json({ success: false, error: error.message }, { status: 500 })\n  }\n}\n\nexport async function DELETE(request) {\n  try {\n    const body = await request.json()\n    // Support both _id (name) and name for backward compatibility\n    const categoryName = body._id || body.name\n    if (!categoryName) {\n      return Response.json({ success: false, error: 'Missing category name (_id or name) for delete' }, { status: 400 })\n    }\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.'\n      }, { status: 404 })\n    }\n    \n    await connectToDB()\n    const deleted = await deleteCategory(restaurantId, categoryName)\n    \n    return Response.json({ success: true, data: deleted })\n  } catch (error) {\n    console.error('Category delete error:', error)\n    return Response.json({ success: false, error: error.message }, { status: 500 })\n  }\n}","size_bytes":3617},"src/components/AdminDashboard/TopItems.jsx":{"content":"'use client'\n\nfunction fmtCurrency(v) {\n  return v.toLocaleString(undefined, { style: 'currency', currency: 'PKR', maximumFractionDigits: 2 })\n}\n\nexport default function TopItems({ topItems = [] }) {\n  return (\n    <div className=\"p-2\">\n      {topItems.length === 0 ? (\n        <div className=\"p-4 text-sm text-neutral-500\">No data</div>\n      ) : (\n        topItems.map(([name, v], idx) => (\n          <div key={name} className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-neutral-50 transition-colors\">\n            <div className=\"h-8 w-8 rounded-md bg-neutral-900 text-white flex items-center justify-center text-xs font-medium\">{idx+1}</div>\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"truncate text-neutral-900 font-medium\">{name}</div>\n              <div className=\"text-xs text-neutral-500\">{String(v.qty)} sold</div>\n            </div>\n            <div className=\"text-sm text-neutral-900 font-medium\">{fmtCurrency(v.revenue)}</div>\n          </div>\n        ))\n      )}\n    </div>\n  )\n}\n\n","size_bytes":1031},"src/components/Orders/OrderCard.jsx":{"content":"'use client'\n\nimport { useState } from 'react'\nimport { Clock, MapPin, ShoppingBag, Home } from 'lucide-react'\nimport { STATUS_STYLES } from '@/constants/orderStyles'\n\n\nexport default function OrderCard({ order, onAction, menuItems = [] }) {\n  const [loading, setLoading] = useState(false)\n  // Defensive: ensure we always have a style object even for unknown statuses\n  const style = STATUS_STYLES[order.status] || { dot: 'bg-neutral-400 ring-neutral-300' }\n\n  const formatTime = (dateStr) => {\n    const date = new Date(dateStr)\n    return date.toLocaleTimeString('en-US', {\n      hour: 'numeric',\n      minute: '2-digit',\n      hour12: true\n    })\n  }\n\n  const formatPrice = (price) => {\n    return `Rs ${Number(price).toFixed(0)}`\n  }\n\n  const handleAction = async (action) => {\n    if (loading) return\n    setLoading(true)\n    try {\n      await onAction(order._id, action)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const formatReceiptText = (order) => {\n    const lines = []\n    const id = order._id?.$oid || order._id || ''\n    const created = order.createdAt ? new Date(order.createdAt).toLocaleString() : ''\n\n    lines.push('   *** My Restaurant ***')\n    lines.push('')\n    lines.push(`Order ID: ${id}`)\n    lines.push(`Date: ${created}`)\n    lines.push('')\n    lines.push(`Name: ${order.name || ''}`)\n    lines.push(`Phone: ${order.phone || ''}`)\n    if (order.address) lines.push(`Address: ${order.address}`)\n    lines.push(`Type: ${order.type || order.orderType || 'delivery'}`)\n    lines.push('')\n  lines.push('-------------------------------');\n\n  ;(order.items || []).forEach(item => {\n      const qty = item.quantity?.$numberInt || item.quantity || 1\n      const price = item.price?.$numberInt || item.price || 0\n      const name = item.menuItem || getMenuItemName(item.menuItemId)\n      const variant = item.variant || ''\n      const line = variant \n        ? `${name} (${variant}) x${qty}  ${formatPrice(price * qty)}`\n        : `${name} x${qty}  ${formatPrice(price * qty)}`\n      lines.push(line)\n      // sides (if any)\n      if (item.selectedSides && item.selectedSides.length) {\n        item.selectedSides.forEach(s => {\n          const sideName = s.sideName || s.name || s\n          lines.push(`  - ${sideName}`)\n        })\n      }\n    })\n\n    lines.push('-------------------------------')\n    lines.push(`TOTAL: ${formatPrice(order.total)}`)\n    lines.push(`Status: ${order.status || ''}`)\n    lines.push('')\n    lines.push('Thank you for your order!')\n    lines.push('')\n    return lines.join('\\n')\n  }\n\n  // Try to send the order to a local Node print server (recommended for direct printing).\n  // If the local print server is not available, fall back to opening a print-friendly window\n  // and calling window.print() (this will show the print dialog).\n  const handlePrint = async () => {\n    // Ensure menu items are loaded for proper name lookup\n    let itemsToUse = menuItems\n    if (!itemsToUse || itemsToUse.length === 0) {\n      try {\n        const response = await fetch('/api/menu-items?admin=true')\n        if (response.ok) {\n          const result = await response.json()\n          if (result.success && result.data) {\n            itemsToUse = result.data\n          }\n        }\n      } catch (err) {\n        console.error('Failed to fetch menu items for print:', err)\n      }\n    }\n\n    const payload = order\n    // First attempt: POST to local print server at port 4000\n    try {\n      const res = await fetch('http://localhost:4000/print', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      })\n\n      if (res.ok) {\n        // optionally show some UI feedback\n        return\n      }\n      // if server responded with error, fall through to print window\n    } catch (err) {\n      // network error or server not running — fall back\n    }\n\n  // Fallback: try to open a minimal print window with monospace receipt and call window.print()\n  // Create a temporary getMenuItemName function that uses the loaded menuItems\n  const getMenuItemNameForPrint = (menuItemId) => {\n    if (!menuItemId) return 'Unknown Item'\n    \n    // Normalize menuItemId to string for comparison\n    let normalizedMenuItemId = menuItemId\n    if (typeof menuItemId === 'object') {\n      if (menuItemId.$oid) {\n        normalizedMenuItemId = menuItemId.$oid\n      } else {\n        normalizedMenuItemId = menuItemId.toString?.() || String(menuItemId)\n      }\n    } else {\n      normalizedMenuItemId = String(menuItemId)\n    }\n    \n    // If it's not a 24-character hex string (ObjectId format), assume it's already a name\n    if (!normalizedMenuItemId.match(/^[0-9a-fA-F]{24}$/i)) {\n      return normalizedMenuItemId\n    }\n    \n    // Look up in menuItems array\n    const menuItem = itemsToUse.find(item => {\n      if (!item) return false\n      const itemId = item._id\n      if (!itemId) return false\n      \n      let normalizedItemId = itemId\n      if (typeof itemId === 'object') {\n        if (itemId.$oid) {\n          normalizedItemId = itemId.$oid\n        } else {\n          normalizedItemId = itemId.toString?.() || String(itemId)\n        }\n      } else {\n        normalizedItemId = String(itemId)\n      }\n      \n      return normalizedItemId.toLowerCase() === normalizedMenuItemId.toLowerCase()\n    })\n    \n    return menuItem?.name || 'Unknown Item'\n  }\n\n  // Create a version of formatReceiptText that uses the loaded menu items\n  const formatReceiptTextForPrint = (orderToPrint) => {\n    const lines = []\n    const id = orderToPrint._id?.$oid || orderToPrint._id || ''\n    const created = orderToPrint.createdAt ? new Date(orderToPrint.createdAt).toLocaleString() : ''\n\n    lines.push('   *** My Restaurant ***')\n    lines.push('')\n    lines.push(`Order ID: ${id}`)\n    lines.push(`Date: ${created}`)\n    lines.push('')\n    lines.push(`Name: ${orderToPrint.name || ''}`)\n    lines.push(`Phone: ${orderToPrint.phone || ''}`)\n    if (orderToPrint.address) lines.push(`Address: ${orderToPrint.address}`)\n    lines.push(`Type: ${orderToPrint.type || orderToPrint.orderType || 'delivery'}`)\n    lines.push('')\n    lines.push('-------------------------------')\n\n    ;(orderToPrint.items || []).forEach(item => {\n      const qty = item.quantity?.$numberInt || item.quantity || 1\n      const price = item.price?.$numberInt || item.price || 0\n      const name = item.menuItem || getMenuItemNameForPrint(item.menuItemId)\n      const variant = item.variant || ''\n      const line = variant \n        ? `${name} (${variant}) x${qty}  ${formatPrice(price * qty)}`\n        : `${name} x${qty}  ${formatPrice(price * qty)}`\n      lines.push(line)\n      // sides (if any)\n      if (item.selectedSides && item.selectedSides.length) {\n        item.selectedSides.forEach(s => {\n          const sideName = s.sideName || s.name || s\n          lines.push(`  - ${sideName}`)\n        })\n      }\n    })\n\n    lines.push('-------------------------------')\n    lines.push(`TOTAL: ${formatPrice(orderToPrint.total)}`)\n    lines.push(`Status: ${orderToPrint.status || ''}`)\n    lines.push('')\n    lines.push('Thank you for your order!')\n    lines.push('')\n    return lines.join('\\n')\n  }\n\n  const receipt = formatReceiptTextForPrint(order)\n    const html = `\n      <html>\n        <head>\n          <title>Receipt</title>\n          <style>\n            body { font-family: monospace; white-space: pre-wrap; margin: 10px; }\n            @media print {\n              @page { margin: 5mm; }\n              body { font-size: 12px; }\n            }\n            /* Width hints for 58mm (~203px) and 80mm (~283px) printers */\n            .receipt { width: 210px; max-width: 360px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"receipt\">${receipt.replace(/\\n/g, '<br/>')}</div>\n          <script>\n            window.onload = function() {\n              setTimeout(() => { window.print(); window.close(); }, 300);\n            }\n          </script>\n        </body>\n      </html>\n    `\n\n    const w = window.open('', '_blank', 'noopener')\n    if (!w) {\n      // If popup blocked or not allowed, offer automatic download of the receipt as a text file\n      try {\n        const blob = new Blob([receipt], { type: 'text/plain;charset=utf-8' })\n        const url = URL.createObjectURL(blob)\n        const a = document.createElement('a')\n        a.href = url\n        const id = order._id?.$oid || order._id || Date.now()\n        a.download = `receipt-${id}.txt`\n        document.body.appendChild(a)\n        a.click()\n        a.remove()\n        URL.revokeObjectURL(url)\n      } catch (e) {\n        console.error('Failed to download receipt', e)\n      }\n      return\n    }\n    w.document.open()\n    w.document.write(html)\n    w.document.close()\n  }\n\n  // Helper to get menu item name from menuItemId\n  const getMenuItemName = (menuItemId) => {\n    if (!menuItemId) return 'Unknown Item'\n    \n    // Normalize menuItemId to string for comparison\n    let normalizedMenuItemId = menuItemId\n    if (typeof menuItemId === 'object') {\n      // Handle MongoDB extended JSON format { $oid: \"...\" }\n      if (menuItemId.$oid) {\n        normalizedMenuItemId = menuItemId.$oid\n      } else {\n        // Try to convert to string\n        normalizedMenuItemId = menuItemId.toString?.() || String(menuItemId)\n      }\n    } else {\n      normalizedMenuItemId = String(menuItemId)\n    }\n    \n    // If it's not a 24-character hex string (ObjectId format), assume it's already a name\n    if (!normalizedMenuItemId.match(/^[0-9a-fA-F]{24}$/i)) {\n      return normalizedMenuItemId\n    }\n    \n    // Look up in menuItems array - try multiple comparison methods\n    const menuItem = menuItems.find(item => {\n      if (!item) return false\n      \n      // Try different ID formats\n      const itemId = item._id\n      if (!itemId) return false\n      \n      // Normalize item ID\n      let normalizedItemId = itemId\n      if (typeof itemId === 'object') {\n        if (itemId.$oid) {\n          normalizedItemId = itemId.$oid\n        } else {\n          normalizedItemId = itemId.toString?.() || String(itemId)\n        }\n      } else {\n        normalizedItemId = String(itemId)\n      }\n      \n      // Compare normalized IDs (case-insensitive for ObjectId)\n      return normalizedItemId.toLowerCase() === normalizedMenuItemId.toLowerCase()\n    })\n    \n    return menuItem?.name || 'Unknown Item'\n  }\n\n  const getItemsSummary = (items) => {\n    return items.map(item => {\n      const qty = item.quantity?.$numberInt || item.quantity || 1\n      const menuItemName = item.menuItem || getMenuItemName(item.menuItemId)\n      const mainItem = `${menuItemName}      x${qty}`\n      const sides = (item.selectedSides || [])\n        .map(side => {\n          const sideName = side.sideName || side.name || side\n          return `    - ${sideName}`\n        })\n        .join('\\n')\n      return sides ? `${mainItem}\\n${sides}` : mainItem\n    }).join('\\n')\n  }\n\n  return (\n    <article className=\"order-card rounded-xl border border-neutral-200 bg-white p-4 shadow-sm hover:shadow-md transition\" data-status={order.status} data-id={order._id}>\n      <div className=\"flex items-start justify-between\">\n        <div className=\"flex items-center gap-2\">\n          <span className={`inline-flex h-2 w-2 rounded-full ring-1 mt-1 ${style.dot || 'bg-neutral-400 ring-neutral-300'}`} />\n          <div>\n            <p className=\"font-medium\">Order #{String(order._id || '').slice(-4)}</p>\n            <p className=\"text-xs text-neutral-500\">{order.name}</p>\n          </div>\n        </div>\n        <p className=\"text-xs text-neutral-500\">{formatTime(order.createdAt)}</p>\n      </div>\n\n      <div className=\"mt-3 space-y-2\">\n        <div className=\"space-y-2\">\n          {(order.items || []).map((item, idx) => {\n            const qty = item.quantity?.$numberInt || item.quantity || 1\n            // Use item.name (denormalized) as primary, fallback to lookup\n            const menuItemName = item.name || item.menuItem || getMenuItemName(item.menuItemId) || 'Unknown Item'\n            const variant = item.variant || ''\n            const selectedSides = item.selectedSides || []\n            const itemPrice = item.price?.$numberInt || item.price || 0\n            \n            return (\n              <div key={idx} className=\"flex items-start justify-between text-sm\">\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 flex-wrap\">\n                    <span className=\"font-medium text-neutral-900\">{menuItemName}</span>\n                    {variant && (\n                      <span className=\"inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-neutral-900 text-white\">\n                        {variant}\n                      </span>\n                    )}\n                    <span className=\"text-neutral-500\">x{qty}</span>\n                  </div>\n                  {selectedSides.length > 0 && (\n                    <div className=\"mt-1 flex flex-wrap gap-1\">\n                      {selectedSides.map((side, sideIdx) => {\n                        const sideName = side.sideName || side.name || side\n                        return (\n                          <span\n                            key={sideIdx}\n                            className=\"inline-flex items-center rounded px-1.5 py-0.5 text-xs font-medium bg-neutral-100 text-neutral-700 border border-neutral-200\"\n                          >\n                            {sideName}\n                          </span>\n                        )\n                      })}\n                    </div>\n                  )}\n                </div>\n                <p className=\"font-medium text-neutral-900 ml-2\">\n                  {formatPrice(itemPrice * qty)}\n                </p>\n              </div>\n            )\n          })}\n        </div>\n        <div className=\"flex items-center justify-between pt-2 border-t border-neutral-200\">\n          <p className=\"font-semibold text-neutral-900\">Total</p>\n          <p className=\"font-semibold text-lg text-neutral-900\">{formatPrice(order.total)}</p>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <span className=\"inline-flex items-center gap-1.5 rounded-full px-2 py-1 text-[11px] border border-neutral-200 bg-neutral-50 text-neutral-700\">\n            <Clock className=\"w-3 h-3\" />\n            {order.status.charAt(0).toUpperCase() + order.status.slice(1)}\n          </span>\n          {/* Order type badge: pickup | delivery | dinein */}\n          <span className=\"inline-flex items-center gap-1.5 rounded-lg px-2.5 py-1.5 text-xs text-neutral-700 bg-white border border-neutral-200\">\n            {((order.type || order.orderType) || 'delivery') === 'pickup' ? (\n              <>\n                <ShoppingBag className=\"w-3.5 h-3.5\" />\n                Pickup\n              </>\n            ) : ((order.type || order.orderType) === 'dinein') ? (\n              <>\n                <Home className=\"w-3.5 h-3.5\" />\n                Dine-in\n              </>\n            ) : (\n              <>\n                <MapPin className=\"w-3.5 h-3.5\" />\n                Delivery\n              </>\n            )}\n          </span>\n        </div>\n      </div>\n\n      <div className=\"mt-4 flex justify-end gap-2\">\n        {style.buttons ? (\n          style.buttons.map((btn, i) => (\n            <button\n              key={i}\n              onClick={() => handleAction(btn.action)}\n              disabled={loading}\n              className={`inline-flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-xs font-medium transition ${btn.class}`}\n            >\n              <btn.icon className=\"w-3.5 h-3.5\" />\n              {btn.label}\n            </button>\n          ))\n        ) : style.button ? (\n          <button\n            onClick={() => handleAction(style.button.action)}\n            disabled={loading}\n            className={`inline-flex items-center gap-1.5 rounded-lg px-4 py-2 text-sm font-medium transition ${style.button.class}`}\n          >\n            <style.button.icon className=\"w-4 h-4\" />\n            {style.button.label}\n          </button>\n        ) : style.completedBadge ? (\n          <div className=\"inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium text-emerald-700 bg-emerald-50 border border-emerald-300\">\n            <style.completedBadge.icon className=\"w-4 h-4\" />\n            {style.completedBadge.label}\n          </div>\n        ) : null}\n        {/* Print receipt button */}\n        <button\n          onClick={handlePrint}\n          disabled={loading}\n          className={`inline-flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-xs font-medium transition border border-neutral-200 bg-white text-neutral-800 hover:bg-neutral-50`}\n        >\n          Print Receipt\n        </button>\n      </div>\n    </article>\n  )\n}","size_bytes":16791},"src/app/api/ws/route.js":{"content":"// This API route used to contain in-process WebSocket server logic.\n// In this project we use a custom Node.js server (`server.js`) to handle\n// WebSocket upgrade requests on /api/ws. Keeping an API route that\n// attempts to upgrade websockets inside Next.js' App Router can be\n// brittle and mixes runtimes. To avoid syntax/runtime errors in the\n// editor and during development we provide a simple, safe handler here.\n\nexport async function GET() {\n  return new Response('WebSocket endpoint handled by custom server (see server.js)', {\n    status: 200,\n    headers: { 'Content-Type': 'text/plain' },\n  })\n}\n\nexport const config = {\n  api: {\n    bodyParser: false,\n  },\n}","size_bytes":673},"tailwind.config.js":{"content":"/** @type {import('tailwindcss').Config} */\nmodule.exports = {\n  content: [\n    './app/**/*.{js,ts,jsx,tsx,mdx}',\n    './pages/**/*.{js,ts,jsx,tsx,mdx}',\n    './components/**/*.{js,ts,jsx,tsx,mdx}',\n    './src/**/*.{js,ts,jsx,tsx,mdx}',\n  ],\n  theme: {\n    extend: {\n      colors: {\n        primary: {\n          DEFAULT: '#E63946',\n        },\n        secondary: {\n          yellow: '#FFB703',\n          green: '#06D6A0',\n        },\n        text: {\n          dark: '#1D1D1D',\n        },\n        bg: {\n          light: '#FFF8F0',\n          'icon-peach': '#FFE4D9',\n          'icon-yellow': '#FFF1C7',\n          'icon-green': '#E7FFF7',\n          testimonials: '#FFF3E7',\n        },\n      },\n      fontFamily: {\n        poppins: ['Poppins', 'ui-sans-serif'],\n        pacifico: ['Pacifico', 'cursive'],\n        lato: ['Lato', 'ui-sans-serif', 'system-ui', '-apple-system', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'Apple Color Emoji', 'Segoe UI Emoji'],\n      },\n    },\n  },\n  plugins: [],\n};","size_bytes":991},"src/components/Menu/CartOverlay.jsx":{"content":"\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { colors, iconBackgrounds } from '@/constants/colors';\n\nexport default function CartOverlay({ products = [], onCartUpdated } = {}) {\n  const [open, setOpen] = useState(false);\n  const [cartItems, setCartItems] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [updatingIds, setUpdatingIds] = useState([]);\n\n  const markUpdating = (id, v) => {\n    setUpdatingIds((prev) => {\n      if (v) return prev.includes(id) ? prev : [...prev, id];\n      return prev.filter((x) => x !== id);\n    });\n  };\n\n  // Local-only cart loader\n  const loadCart = async () => {\n    setLoading(true);\n    try {\n      console.debug('[CartOverlay] loadCart called');\n      const local = JSON.parse(localStorage.getItem(\"localCart\") || \"[]\");\n      console.debug('[CartOverlay] localCart contents:', local);\n      setCartItems(\n        local.map((i) => ({\n          cartItemId: i.menuItemId || i.id,\n          menuItem: i.product ?? i.menuItemId ?? i.id,\n          quantity: i.quantity ?? 1,\n          _localItem: i,\n          raw: i,\n        }))\n      );\n    } catch (err) {\n      console.error(\"Failed to load local cart\", err);\n      setCartItems([]);\n    } finally {\n      setLoading(false);\n      onCartUpdated?.();\n    }\n  };\n\n  useEffect(() => {\n    loadCart();\n    window.addEventListener(\"storage\", loadCart);\n    window.addEventListener(\"cartUpdated\", loadCart);\n    const openHandler = () => setOpen(true);\n    window.addEventListener(\"openCart\", openHandler);\n\n    return () => {\n      window.removeEventListener(\"storage\", loadCart);\n      window.removeEventListener(\"cartUpdated\", loadCart);\n      window.removeEventListener(\"openCart\", openHandler);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n\n  const displayItems = useMemo(() => {\n    return cartItems.map((it) => {\n      const menuItemObj = it.menuItem && typeof it.menuItem === \"object\" ? it.menuItem : null;\n      const menuItemId = menuItemObj ? (menuItemObj._id || menuItemObj.id) : (it.menuItem || it._localItem?.menuItemId);\n      const productFromList = products.find((p) => p._id === menuItemId);\n      const name = menuItemObj?.name || productFromList?.name || it._localItem?.product?.name || \"Item\";\n      // Use price from cart item if available (includes variant/sides pricing), otherwise use base price\n      const basePrice = Number(it._localItem?.price ?? menuItemObj?.price ?? productFromList?.price ?? it._localItem?.product?.price ?? 0);\n      const price = basePrice;\n      const image = menuItemObj?.image || productFromList?.image || it._localItem?.product?.image || \"/shopping-cart.svg\";\n      \n      // Extract variant and selectedSides from raw cart item\n      const variant = it._localItem?.variant || it.raw?.variant || '';\n      const selectedSides = it._localItem?.selectedSides || it.raw?.selectedSides || [];\n\n      return {\n        id: it.cartItemId ?? menuItemId,\n        cartItemId: it.cartItemId,\n        menuItemId,\n        name,\n        price,\n        quantity: it.quantity ?? 1,\n        image,\n        variant,\n        selectedSides,\n        raw: it.raw ?? it,\n      };\n    });\n  }, [cartItems, products]);\n\n  const subtotal = useMemo(\n    () => displayItems.reduce((s, it) => s + (Number(it.price) || 0) * (Number(it.quantity) || 1), 0),\n    [displayItems]\n  );\n\n  const tax = subtotal * 0.08;\n  const deliveryFee = 500;\n  const total = subtotal + tax + deliveryFee;\n\n  const itemCount = useMemo(\n    () => displayItems.reduce((s, it) => s + (Number(it.quantity) || 0), 0),\n    [displayItems]\n  );\n\n  const removeItem = async (cartItemId) => {\n    try {\n      const local = JSON.parse(localStorage.getItem(\"localCart\") || \"[]\");\n      const filtered = local.filter((i) => (i.menuItemId || i.id) !== cartItemId);\n      localStorage.setItem(\"localCart\", JSON.stringify(filtered));\n      await loadCart();\n      window.dispatchEvent(new Event(\"cartUpdated\"));\n    } catch (err) {\n      console.error(\"Failed to remove item from local cart\", err);\n    }\n  };\n\n  const clearCart = async () => {\n    if (!confirm(\"Are you sure you want to clear your cart?\")) return;\n    try {\n      localStorage.removeItem(\"localCart\");\n      await loadCart();\n      window.dispatchEvent(new Event(\"cartUpdated\"));\n    } catch (err) {\n      console.error(\"Failed to clear local cart\", err);\n    }\n  };\n\n  // update quantity in local cart only\n  const updateQuantity = async (cartItemId, menuItemId, currentQty, delta) => {\n    const idForLock = cartItemId ?? menuItemId;\n    const newQty = Math.max(0, (Number(currentQty) || 0) + delta);\n    if (updatingIds.includes(idForLock)) return;\n    markUpdating(idForLock, true);\n    try {\n      const local = JSON.parse(localStorage.getItem(\"localCart\") || \"[]\");\n      const idx = local.findIndex((i) => (i.menuItemId || i.id) === menuItemId);\n      if (idx >= 0) {\n        if (newQty === 0) local.splice(idx, 1);\n        else local[idx].quantity = newQty;\n      } else if (newQty > 0) {\n        local.push({ menuItemId, quantity: newQty, product: products.find((p) => p._id === menuItemId) });\n      }\n      localStorage.setItem(\"localCart\", JSON.stringify(local));\n      await loadCart();\n      window.dispatchEvent(new Event(\"cartUpdated\"));\n    } catch (err) {\n      console.error(\"Failed to update local cart quantity\", err);\n    } finally {\n      markUpdating(idForLock, false);\n    }\n  };\n\n  const goToCheckout = () => {\n    try {\n      // Prepare a lightweight cart payload for the checkout page\n      const cartForCheckout = displayItems.map((it) => ({\n        id: it.menuItemId || it.id,\n        menuItemId: it.menuItemId || it.id, // Preserve menuItemId for order creation\n        name: it.name,\n        description: it.raw?.product?.description || it.raw?.description || '',\n        imageUrl: it.image,\n        price: it.price,\n        quantity: it.quantity,\n        variant: it.raw?.variant || '', // Preserve variant selection\n        selectedSides: it.raw?.selectedSides || [], // Preserve sides selection\n      }));\n\n      // Save to localStorage so the Checkout page can read it client-side\n      localStorage.setItem('checkoutCart', JSON.stringify(cartForCheckout));\n\n      // Navigate to checkout page (app router page at /Checkout)\n      window.location.href = '/Checkout';\n    } catch (err) {\n      console.error('goToCheckout error', err);\n      alert('Failed to proceed to checkout');\n    }\n  };\n\n  return (\n    <div style={{ backgroundColor: colors.bgPrimary, color: colors.textDark}}>\n      {/* Mobile Fixed Cart Bar */}\n      {itemCount > 0 && (\n        <div className=\"lg:hidden fixed bottom-0 left-0 right-0 bg-white p-4 shadow-[0_-4px_12px_rgba(0,0,0,0.1)] z-50\">\n          <button\n            onClick={() => setOpen(true)}\n            className=\"w-full bg-neutral-900 text-white rounded-xl py-4 px-6 flex items-center justify-between hover:bg-neutral-800 transition-all\"\n          >\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-8 h-8 bg-white text-neutral-900 rounded-full flex items-center justify-center font-semibold text-sm\">\n                {itemCount}\n              </div>\n              <span className=\"font-semibold\">View Cart</span>\n            </div>\n            <span className=\"font-semibold text-lg\">Rs {total.toFixed(0)}</span>\n          </button>\n        </div>\n      )}\n\n      {/* Mobile Cart Modal */}\n      {open && (\n        <div className=\"lg:hidden fixed inset-0 bg-black bg-opacity-50 z-50\" style={{ backgroundColor: colors.bgPrimary, color: colors.textDark}}>\n          <div className=\"absolute inset-x-0 bottom-0 rounded-t-2xl max-h-[85vh] overflow-y-auto animate-[slideUp_0.3s_ease-out]\" style={{ backgroundColor: colors.bgSec }}>\n            <div className=\"sticky top-0 border-b border-neutral-200 p-4 flex items-center justify-between z-10\" style={{ backgroundColor: colors.bgSec }}>\n              <h2 className=\"text-xl font-semibold tracking-tight\">Your Cart</h2>\n              <button\n                onClick={() => setOpen(false)}\n                className=\"w-8 h-8 rounded-full bg-neutral-100 flex items-center justify-center hover:bg-neutral-200 transition-all\"\n              >\n                <span className=\"text-neutral-600 text-xl\">×</span>\n              </button>\n            </div>\n\n            <div className=\"p-4\">\n              {loading ? (\n                <div className=\"text-center py-8 text-neutral-500\">Loading...</div>\n              ) : displayItems.length === 0 ? (\n                <div className=\"text-center py-8 text-neutral-500\">\n                  <div className=\"w-12 h-12 mx-auto mb-2 text-neutral-300\">🛒</div>\n                  <p>Your cart is empty</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4 mb-6\">\n                  {displayItems.map((it) => (\n                    <div key={it.id} className=\"flex gap-3 p-3 rounded-lg\" style={{ backgroundColor: colors.bgPrimary }}>\n                      <img\n                        src={it.image || \"/shopping-cart.svg\"}\n                        alt={it.name}\n                        className=\"w-16 h-16 object-cover rounded-lg flex-shrink-0\"\n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <h4 className=\"font-semibold text-sm mb-1\">{it.name}</h4>\n                        {it.variant && (\n                          <p className=\"text-xs text-neutral-600 mb-1\">Variant: {it.variant}</p>\n                        )}\n                        {it.selectedSides && it.selectedSides.length > 0 && (\n                          <p className=\"text-xs text-neutral-600 mb-1\">\n                            Sides: {it.selectedSides.map(s => s.sideName || s.name || s).join(', ')}\n                          </p>\n                        )}\n                        <div className=\"flex items-center justify-between mt-2\">\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              onClick={() => updateQuantity(it.cartItemId ?? it.id, it.menuItemId, it.quantity, -1)}\n                              className=\"w-7 h-7 rounded border border-neutral-200 bg-white flex items-center justify-center hover:bg-neutral-50\"\n                              disabled={updatingIds.includes(it.cartItemId ?? it.id)}\n                            >\n                              <span className=\"text-sm\">−</span>\n                            </button>\n                            <span className=\"text-sm font-medium w-6 text-center\">{it.quantity}</span>\n                            <button\n                              onClick={() => updateQuantity(it.cartItemId ?? it.id, it.menuItemId, it.quantity, 1)}\n                              className=\"w-7 h-7 rounded border border-neutral-200 bg-white flex items-center justify-center text-neutral-700 hover:bg-neutral-50\"\n                              disabled={updatingIds.includes(it.cartItemId ?? it.id)}\n                            >\n                              <span className=\"text-sm text-neutral-700\">+</span>\n                            </button>\n                          </div>\n                          <span className=\"font-semibold text-sm\">Rs {(it.price * it.quantity).toFixed(0)}</span>\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => removeItem(it.id)}\n                        className=\"flex-shrink-0 text-red-500 hover:text-red-600\"\n                      >\n                        <span className=\"text-lg\">🗑️</span>\n                      </button>\n                    </div>\n                  ))}\n                </div>\n              )}\n\n              {displayItems.length > 0 && (\n                <>\n                  <div className=\"border-t border-neutral-200 pt-4 space-y-3 mb-6\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-neutral-600\">Subtotal</span>\n                      <span className=\"font-medium\">Rs {subtotal.toFixed(0)}</span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-neutral-600\">Delivery Fee</span>\n                      <span className=\"font-medium\">Rs {deliveryFee.toFixed(0)}</span>\n                    </div>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-neutral-600\">Tax</span>\n                      <span className=\"font-medium\">Rs {tax.toFixed(0)}</span>\n                    </div>\n                    <div className=\"border-t border-neutral-200 pt-3 flex justify-between\">\n                      <span className=\"font-semibold text-lg\">Total</span>\n                      <span className=\"font-semibold text-lg\">Rs {total.toFixed(0)}</span>\n                    </div>\n                  </div>\n\n                  <button\n                    onClick={goToCheckout}\n                    className=\"w-full py-4 bg-neutral-900 text-white rounded-xl font-semibold hover:bg-neutral-800 transition-all flex items-center justify-center gap-2\"\n                  >\n                    Continue to Checkout\n                    <span>→</span>\n                  </button>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Desktop Cart Sidebar */}\n      {itemCount > 0 && (\n        <aside className=\"hidden lg:block w-96 border-l border-neutral-200 sticky lg:top-16 lg:h-[calc(100vh-4rem)] overflow-y-auto\" style={{ backgroundColor: colors.bgSec }}>\n          <div className=\"p-6 flex flex-col h-full\" style={{ backgroundColor: colors.bgSec }}>\n            <div className=\"flex items-center justify-between mb-6\">\n              <h2 className=\"text-xl font-semibold tracking-tight\">Your Cart</h2>\n              <button\n                onClick={clearCart}\n                className=\"text-sm text-red-600 hover:underline font-medium\"\n              >\n                Clear\n              </button>\n            </div>\n\n            {loading ? (\n              <div className=\"text-center py-8 text-neutral-500\">Loading...</div>\n            ) : displayItems.length === 0 ? (\n              <div className=\"text-center py-8 text-neutral-500\">\n                <div className=\"w-12 h-12 mx-auto mb-2 text-neutral-300\">🛒</div>\n                <p>Your cart is empty</p>\n              </div>\n            ) : (\n              <>\n                <div className=\"space-y-4 mb-6 overflow-auto flex-1 pr-2\">\n                  {displayItems.map((it) => (\n                    <div key={it.id} className=\"flex gap-3 p-3 rounded-lg\" style={{ backgroundColor: colors.bgPrimary }}>\n                      <img\n                        src={it.image || \"/shopping-cart.svg\"}\n                        alt={it.name}\n                        className=\"w-16 h-16 object-cover rounded-lg flex-shrink-0\"\n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <h4 className=\"font-semibold text-sm mb-1\">{it.name}</h4>\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              onClick={() => updateQuantity(it.cartItemId ?? it.id, it.menuItemId, it.quantity, -1)}\n                              className=\"w-7 h-7 rounded border border-neutral-200 bg-white flex items-center justify-center hover:bg-neutral-50\"\n                              disabled={updatingIds.includes(it.cartItemId ?? it.id)}\n                            >\n                              <span className=\"text-sm\">−</span>\n                            </button>\n                            <span className=\"text-sm font-medium w-6 text-center\">{it.quantity}</span>\n                            <button\n                              onClick={() => updateQuantity(it.cartItemId ?? it.id, it.menuItemId, it.quantity, 1)}\n                              className=\"w-7 h-7 rounded border border-neutral-200 bg-white flex items-center justify-center hover:bg-neutral-50\"\n                              disabled={updatingIds.includes(it.cartItemId ?? it.id)}\n                            >\n                              <span className=\"text-sm\">+</span>\n                            </button>\n                          </div>\n                          <span className=\"font-semibold text-sm\">Rs {(it.price * it.quantity).toFixed(0)}</span>\n                        </div>\n                      </div>\n                      <button\n                        onClick={() => removeItem(it.id)}\n                        className=\"flex-shrink-0 text-red-500 hover:text-red-600\"\n                      >\n                        <span className=\"text-lg\">🗑️</span>\n                      </button>\n                    </div>\n                  ))}\n                </div>\n\n                <div className=\"border-t border-neutral-200 pt-4 space-y-3 mb-6\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-neutral-600\">Subtotal</span>\n                    <span className=\"font-medium\">Rs {subtotal.toFixed(0)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-neutral-600\">Delivery Fee</span>\n                    <span className=\"font-medium\">Rs {deliveryFee.toFixed(0)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-neutral-600\">Tax</span>\n                    <span className=\"font-medium\">Rs {tax.toFixed(0)}</span>\n                  </div>\n                  <div className=\"border-t border-neutral-200 pt-3 flex justify-between\">\n                    <span className=\"font-semibold text-lg\">Total</span>\n                    <span className=\"font-semibold text-lg\">Rs {total.toFixed(0)}</span>\n                  </div>\n                </div>\n\n                <button\n                  onClick={goToCheckout}\n                  className=\"w-full py-4 bg-neutral-900 text-white rounded-xl font-semibold hover:bg-neutral-800 transition-all flex items-center justify-center gap-2\"\n                >\n                  Continue to Checkout\n                  <span>→</span>\n                </button>\n              </>\n            )}\n          </div>\n        </aside>\n      )}\n    </div>\n  );\n}","size_bytes":18537},"src/components/RestaurantProfile/BranchesTable.jsx":{"content":"'use client'\n\nimport { useState, useMemo } from 'react'\nimport { Search, Plus, Pencil, Trash2, Store } from 'lucide-react'\n\nexport default function BranchesTable({ branches = [], onAddBranch, onEditBranch, onDeleteBranch }) {\n  const [searchQuery, setSearchQuery] = useState('')\n\n  const filteredBranches = useMemo(() => {\n    if (!searchQuery.trim()) return branches\n\n    const query = searchQuery.toLowerCase().trim()\n    return branches.filter((branch) => {\n      const name = (branch.name || '').toLowerCase()\n      const address = (branch.address || '').toLowerCase()\n      const phone = (branch.phone || '').toLowerCase()\n      const city = (branch.city || '').toLowerCase()\n      const status = (branch.status || '').toLowerCase()\n\n      return (\n        name.includes(query) ||\n        address.includes(query) ||\n        phone.includes(query) ||\n        city.includes(query) ||\n        status.includes(query)\n      )\n    })\n  }, [branches, searchQuery])\n\n  const getStatusColor = (status) => {\n    switch (status) {\n      case 'Open':\n        return 'border-emerald-200 text-emerald-700 bg-emerald-50'\n      case 'Temporarily Closed':\n        return 'border-amber-200 text-amber-700 bg-amber-50'\n      case 'Closed':\n        return 'border-neutral-200 text-neutral-700 bg-neutral-50'\n      default:\n        return 'border-neutral-200 text-neutral-700 bg-neutral-50'\n    }\n  }\n\n  return (\n    <div className=\"mt-6 sm:mt-8 rounded-xl border border-neutral-200 bg-white\">\n      <div className=\"flex flex-col gap-3 border-b border-neutral-200 p-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight\">Locations / Branches</h3>\n          <p className=\"mt-0.5 text-sm text-neutral-500\">Create, edit, and remove branches.</p>\n        </div>\n        <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2\">\n          <div className=\"relative\">\n            <Search className=\"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-400\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search branches…\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"w-full sm:w-56 rounded-lg border border-neutral-200 bg-white pl-9 pr-3 py-2 text-sm placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-900/10\"\n            />\n          </div>\n          <button\n            onClick={onAddBranch}\n            className=\"inline-flex items-center justify-center gap-2 rounded-lg bg-neutral-900 px-3 py-2 text-sm font-medium text-white hover:bg-neutral-800\"\n          >\n            <Plus className=\"h-4 w-4\" />\n            New Branch\n          </button>\n        </div>\n      </div>\n\n      {filteredBranches.length === 0 ? (\n        <div className=\"border-t border-neutral-200 p-6 sm:p-8 text-center\">\n          <div className=\"mx-auto w-full max-w-sm\">\n            <Store className=\"mx-auto h-20 w-20 sm:h-24 sm:w-24 text-neutral-300\" />\n            <h4 className=\"mt-4 text-base sm:text-lg font-semibold tracking-tight\">\n              {searchQuery ? 'No branches found' : 'No branches yet'}\n            </h4>\n            <p className=\"mt-1 text-sm text-neutral-500\">\n              {searchQuery\n                ? 'Try a different search term.'\n                : 'Create your first location to start receiving orders.'}\n            </p>\n            {!searchQuery && (\n              <button\n                onClick={onAddBranch}\n                className=\"mt-4 inline-flex items-center gap-2 rounded-lg bg-neutral-900 px-3 py-2 text-sm font-medium text-white hover:bg-neutral-800\"\n              >\n                <Plus className=\"h-4 w-4\" />\n                Add Branch\n              </button>\n            )}\n          </div>\n        </div>\n      ) : (\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full border-separate border-spacing-0\">\n            <thead>\n              <tr className=\"text-left text-xs text-neutral-500\">\n                <th className=\"sticky left-0 bg-white px-4 py-3\">Branch</th>\n                <th className=\"px-4 py-3 whitespace-nowrap\">Address</th>\n                <th className=\"px-4 py-3 whitespace-nowrap\">Phone</th>\n                <th className=\"px-4 py-3 whitespace-nowrap\">City</th>\n                <th className=\"px-4 py-3 whitespace-nowrap\">Status</th>\n                <th className=\"px-4 py-3 text-right whitespace-nowrap\">Actions</th>\n              </tr>\n            </thead>\n            <tbody className=\"text-sm\">\n              {filteredBranches.map((branch, index) => (\n                <tr key={index} className=\"border-t border-neutral-200\">\n                  <td className=\"sticky left-0 bg-white/95 backdrop-blur px-4 py-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"h-8 w-8 rounded-md bg-neutral-100 flex items-center justify-center\">\n                        <Store className=\"h-4 w-4 text-neutral-700\" />\n                      </div>\n                      <div className=\"min-w-0\">\n                        <div className=\"truncate font-medium text-neutral-900\">{branch.name || 'Unnamed'}</div>\n                        <div className=\"truncate text-xs text-neutral-500\">#{index + 1}</div>\n                      </div>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-3 text-neutral-700\">{branch.address || '—'}</td>\n                  <td className=\"px-4 py-3 text-neutral-700\">{branch.phone || '—'}</td>\n                  <td className=\"px-4 py-3 text-neutral-700\">{branch.city || '—'}</td>\n                  <td className=\"px-4 py-3\">\n                    <span\n                      className={`inline-flex items-center rounded-full border px-2 py-0.5 text-xs ${getStatusColor(\n                        branch.status\n                      )}`}\n                    >\n                      {branch.status || '—'}\n                    </span>\n                  </td>\n                  <td className=\"px-4 py-3\">\n                    <div className=\"flex items-center justify-end gap-1\">\n                      <button\n                        onClick={() => onEditBranch(index)}\n                        className=\"rounded-md border border-neutral-200 bg-white p-1.5 hover:bg-neutral-50\"\n                        title=\"Edit\"\n                      >\n                        <Pencil className=\"h-4 w-4\" />\n                      </button>\n                      <button\n                        onClick={() => onDeleteBranch(index)}\n                        className=\"rounded-md border border-neutral-200 bg-white p-1.5 hover:bg-neutral-50 text-red-600\"\n                        title=\"Delete\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </button>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  )\n}\n\n","size_bytes":7087},"src/app/api/menu-items/route.js":{"content":"import { getAllMenuItems, getAllMenuItemsAdmin, createMenuItem, updateMenuItem, deleteMenuItem, connectToDB } from '../../../services/db'\nimport { getOrCreateDefaultRestaurant } from '../../../utils/getRestaurantId'\n\nexport async function GET(request) {\n  try {\n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.',\n        timestamp: new Date().toISOString()\n      }, { status: 404 })\n    }\n    \n    const url = new URL(request.url)\n    const admin = url.searchParams.get('admin')\n    \n    await connectToDB()\n    const menuItems = admin ? await getAllMenuItemsAdmin(restaurantId) : await getAllMenuItems(restaurantId)\n    \n    return Response.json({ \n      success: true,\n      data: menuItems,\n      timestamp: new Date().toISOString()\n    })\n  } catch (error) {\n    console.error('Menu items fetch error:', error)\n    return Response.json({ \n      success: false, \n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 500 })\n  }\n}\n\nexport async function POST(request) {\n  try {\n    const body = await request.json()\n    \n    // Support both category (old) and categoryName (new)\n    const categoryName = body.categoryName || body.category\n    if (!body || !body.name || body.price == null || !categoryName) {\n      return Response.json({ \n        success: false, \n        error: 'name, price and categoryName (or category) are required' \n      }, { status: 400 })\n    }\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.'\n      }, { status: 404 })\n    }\n    \n    await connectToDB()\n    \n    // Prepare menu item data with variants and sides\n    const menuItemData = {\n      name: body.name,\n      description: body.description || '',\n      image: body.image || '',\n      price: Number(body.price),\n      isAvailable: body.isAvailable !== undefined ? Boolean(body.isAvailable) : true,\n      variants: Array.isArray(body.variants) ? body.variants.map(v => ({\n        variant: v.variant || v.name || '',\n        price: Number(v.price || 0),\n        img: v.img || v.image || ''\n      })) : [],\n      sides: Array.isArray(body.sides) ? body.sides.map(s => ({\n        name: s.name || '',\n        extraPrice: Number(s.extraPrice || 0),\n        img: s.img || s.image || ''\n      })) : []\n    }\n    \n    const created = await createMenuItem(restaurantId, categoryName, menuItemData)\n    \n    return Response.json({ success: true, data: created }, { status: 201 })\n  } catch (error) {\n    console.error('MenuItem create error:', error)\n    return Response.json({ success: false, error: error.message }, { status: 500 })\n  }\n}\n\nexport async function PUT(request) {\n  try {\n    const body = await request.json()\n    if (!body || !body._id) {\n      return Response.json({ success: false, error: 'Missing _id for update' }, { status: 400 })\n    }\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.'\n      }, { status: 404 })\n    }\n    \n    await connectToDB()\n    \n    // Prepare updates\n    const updates = {}\n    if (body.name !== undefined) updates.name = body.name\n    if (body.description !== undefined) updates.description = body.description\n    if (body.image !== undefined) updates.image = body.image\n    if (body.price !== undefined) updates.price = Number(body.price)\n    if (body.isAvailable !== undefined) updates.isAvailable = Boolean(body.isAvailable)\n    if (body.variants !== undefined) {\n      updates.variants = Array.isArray(body.variants) ? body.variants.map(v => ({\n        variant: v.variant || v.name || '',\n        price: Number(v.price || 0),\n        img: v.img || v.image || ''\n      })) : []\n    }\n    if (body.sides !== undefined) {\n      updates.sides = Array.isArray(body.sides) ? body.sides.map(s => ({\n        name: s.name || '',\n        extraPrice: Number(s.extraPrice || 0),\n        img: s.img || s.image || ''\n      })) : []\n    }\n    // Handle category change\n    if (body.categoryName || body.category) {\n      updates.categoryName = body.categoryName || body.category\n    }\n    \n    const updated = await updateMenuItem(restaurantId, body._id, updates)\n    \n    return Response.json({ success: true, data: updated })\n  } catch (error) {\n    console.error('MenuItem update error:', error)\n    return Response.json({ success: false, error: error.message }, { status: 500 })\n  }\n}\n\nexport async function DELETE(request) {\n  try {\n    const body = await request.json()\n    if (!body || !body._id) {\n      return Response.json({ success: false, error: 'Missing _id for delete' }, { status: 400 })\n    }\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.'\n      }, { status: 404 })\n    }\n    \n    await connectToDB()\n    const deleted = await deleteMenuItem(restaurantId, body._id)\n    \n    return Response.json({ success: true, data: deleted })\n  } catch (error) {\n    console.error('MenuItem delete error:', error)\n    return Response.json({ success: false, error: error.message }, { status: 500 })\n  }\n}","size_bytes":5525},"src/constants/orderStyles.js":{"content":"import { Check, X, Phone, Clock, MapPin, ShoppingBag } from 'lucide-react'\n\nexport const STATUS_STYLES = {\n  pending: {\n    dot: 'bg-neutral-400 ring-neutral-300',\n    text: 'text-neutral-700',\n    buttons: [\n      {\n        label: 'Call',\n        icon: Phone,\n        class: 'text-neutral-700 bg-white border border-neutral-300 hover:bg-neutral-50',\n        action: 'call'\n      },\n      {\n        label: 'Accept',\n        icon: Check,\n        class: 'text-white bg-emerald-600 hover:bg-emerald-700',\n        action: 'accept'\n      },\n      {\n        label: 'Decline',\n        icon: X,\n        class: 'text-white bg-red-600 hover:bg-red-700',\n        action: 'decline'\n      }\n    ]\n  },\n  accepted: {\n    dot: 'bg-blue-500 ring-blue-300',\n    text: 'text-blue-700',\n    button: {\n      label: 'Start Preparing',\n      icon: ShoppingBag,\n      class: 'text-white bg-amber-600 hover:bg-amber-700',\n      action: 'prepare'\n    }\n  },\n  preparing: {\n    dot: 'bg-amber-500 ring-amber-300',\n    text: 'text-amber-700',\n    button: {\n      label: 'Mark Prepared',\n      icon: Check,\n      class: 'text-white bg-indigo-600 hover:bg-indigo-700',\n      action: 'prepared'\n    }\n  },\n  prepared: {\n    dot: 'bg-indigo-500 ring-indigo-300',\n    text: 'text-indigo-700',\n    button: {\n      label: 'Start Delivery',\n      icon: MapPin,\n      class: 'text-white bg-sky-600 hover:bg-sky-700',\n      action: 'deliver'\n    }\n  },\n  delivering: {\n    dot: 'bg-sky-500 ring-sky-300',\n    text: 'text-sky-700',\n    button: {\n      label: 'Mark Delivered',\n      icon: Check,\n      class: 'text-white bg-emerald-600 hover:bg-emerald-700',\n      action: 'delivered'\n    }\n  },\n  delivered: {\n    dot: 'bg-emerald-500 ring-emerald-300',\n    text: 'text-emerald-700',\n    completedBadge: {\n      label: 'Completed',\n      icon: Check\n    }\n  }\n}","size_bytes":1824},"src/components/RestaurantProfile/RestaurantProfileClient.jsx":{"content":"'use client'\n\nimport { useEffect, useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { ArrowLeft } from 'lucide-react'\nimport { useRestaurant } from '@/hooks/useRestaurant'\nimport ProfileCard from './ProfileCard'\nimport BranchesTable from './BranchesTable'\nimport EditProfileModal from './EditProfileModal'\nimport ChangeLogoModal from './ChangeLogoModal'\nimport BranchFormModal from './BranchFormModal'\nimport DeleteBranchModal from './DeleteBranchModal'\n\nexport default function RestaurantProfileClient() {\n  const router = useRouter()\n  const { restaurant, loading: restaurantLoading } = useRestaurant()\n  const [restaurantData, setRestaurantData] = useState(null)\n  const [showEditModal, setShowEditModal] = useState(false)\n  const [showLogoModal, setShowLogoModal] = useState(false)\n  const [showBranchModal, setShowBranchModal] = useState(false)\n  const [showDeleteModal, setShowDeleteModal] = useState(false)\n  const [editingBranch, setEditingBranch] = useState(null)\n  const [deletingBranch, setDeletingBranch] = useState(null)\n\n  useEffect(() => {\n    if (restaurant) {\n      setRestaurantData(restaurant)\n    }\n  }, [restaurant])\n\n  const handleSaveProfile = async (data) => {\n    try {\n      // Validate required field\n      if (!data.name || !data.name.trim()) {\n        alert('Restaurant name is required')\n        return\n      }\n      \n      // Extract only updatable fields\n      const updateData = {\n        name: data.name.trim(),\n        description: data.description?.trim() || '',\n        cuisine: data.cuisine?.trim() || '',\n        owner: data.owner?.trim() || '',\n        contactEmail: data.contactEmail?.trim() || '',\n        contactPhone: data.contactPhone?.trim() || '',\n        isLive: data.isLive || false,\n        logo: data.logo || restaurantData?.logo || '',\n        branches: data.branches || restaurantData?.branches || []\n      }\n      \n      console.log('Updating restaurant with data:', updateData)\n      \n      const response = await fetch('/api/restaurants', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updateData)\n      })\n      \n      const result = await response.json()\n      console.log('Update response:', result)\n      \n      if (!response.ok || !result.success) {\n        throw new Error(result.error || 'Failed to update restaurant')\n      }\n      \n      setRestaurantData(result.data)\n      setShowEditModal(false)\n      // Refresh the page to reload restaurant data from API\n      window.location.reload()\n    } catch (error) {\n      console.error('Failed to update restaurant:', error)\n      alert(`Failed to update restaurant: ${error.message}`)\n    }\n  }\n\n  const handleSaveLogo = async (logoUrl) => {\n    try {\n      const updateData = {\n        name: restaurantData?.name,\n        description: restaurantData?.description,\n        cuisine: restaurantData?.cuisine,\n        owner: restaurantData?.owner,\n        contactEmail: restaurantData?.contactEmail,\n        contactPhone: restaurantData?.contactPhone,\n        isLive: restaurantData?.isLive,\n        logo: logoUrl,\n        branches: restaurantData?.branches || []\n      }\n      \n      const response = await fetch('/api/restaurants', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updateData)\n      })\n      \n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.error || 'Failed to update logo')\n      }\n      \n      const result = await response.json()\n      if (result.success) {\n        setRestaurantData(result.data)\n        setShowLogoModal(false)\n        window.location.reload()\n      } else {\n        throw new Error(result.error || 'Failed to update logo')\n      }\n    } catch (error) {\n      console.error('Failed to update logo:', error)\n      alert(`Failed to update logo: ${error.message}`)\n    }\n  }\n\n  const handleSaveBranch = async (branchData) => {\n    try {\n      // Validate required fields\n      if (!branchData.name || !branchData.name.trim()) {\n        alert('Branch name is required')\n        return\n      }\n      if (!branchData.address || !branchData.address.trim()) {\n        alert('Address is required')\n        return\n      }\n      if (!branchData.city || !branchData.city.trim()) {\n        alert('City is required')\n        return\n      }\n      \n      const branches = [...(restaurantData?.branches || [])]\n      \n      if (editingBranch !== null) {\n        // Update existing branch\n        const index = editingBranch\n        if (index >= 0 && index < branches.length) {\n          branches[index] = { \n            ...branches[index], \n            ...branchData,\n            createdAt: branches[index].createdAt || new Date()\n          }\n        } else {\n          alert('Invalid branch index')\n          return\n        }\n      } else {\n        // Add new branch\n        branches.push({\n          ...branchData,\n          createdAt: new Date()\n        })\n      }\n\n      const updateData = {\n        name: restaurantData?.name,\n        description: restaurantData?.description,\n        cuisine: restaurantData?.cuisine,\n        owner: restaurantData?.owner,\n        contactEmail: restaurantData?.contactEmail,\n        contactPhone: restaurantData?.contactPhone,\n        isLive: restaurantData?.isLive,\n        logo: restaurantData?.logo,\n        branches\n      }\n\n      console.log('Saving branch, update data:', updateData)\n\n      const response = await fetch('/api/restaurants', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updateData)\n      })\n      \n      const result = await response.json()\n      console.log('Branch save response:', result)\n      \n      if (!response.ok || !result.success) {\n        throw new Error(result.error || 'Failed to save branch')\n      }\n      \n      setRestaurantData(result.data)\n      setShowBranchModal(false)\n      setEditingBranch(null)\n      window.location.reload()\n    } catch (error) {\n      console.error('Failed to save branch:', error)\n      alert(`Failed to save branch: ${error.message}`)\n    }\n  }\n\n  const handleDeleteBranch = async () => {\n    if (deletingBranch === null) return\n\n    try {\n      const branches = [...(restaurantData?.branches || [])]\n      branches.splice(deletingBranch, 1)\n\n      const updateData = {\n        name: restaurantData?.name,\n        description: restaurantData?.description,\n        cuisine: restaurantData?.cuisine,\n        owner: restaurantData?.owner,\n        contactEmail: restaurantData?.contactEmail,\n        contactPhone: restaurantData?.contactPhone,\n        isLive: restaurantData?.isLive,\n        logo: restaurantData?.logo,\n        branches\n      }\n\n      const response = await fetch('/api/restaurants', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(updateData)\n      })\n      \n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.error || 'Failed to delete branch')\n      }\n      \n      const result = await response.json()\n      if (result.success) {\n        setRestaurantData(result.data)\n        setShowDeleteModal(false)\n        setDeletingBranch(null)\n        window.location.reload()\n      } else {\n        throw new Error(result.error || 'Failed to delete branch')\n      }\n    } catch (error) {\n      console.error('Failed to delete branch:', error)\n      alert(`Failed to delete branch: ${error.message}`)\n    }\n  }\n\n  const handleEditBranch = (index) => {\n    setEditingBranch(index)\n    setShowBranchModal(true)\n  }\n\n  const handleDeleteBranchClick = (index) => {\n    setDeletingBranch(index)\n    setShowDeleteModal(true)\n  }\n\n  if (restaurantLoading || !restaurantData) {\n    return (\n      <div className=\"min-h-screen bg-neutral-50 p-6\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center py-12 text-neutral-500\">Loading restaurant profile...</div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50\">\n      <section className=\"mx-auto w-full max-w-7xl px-4 py-6 sm:px-6 lg:px-8\">\n        <div className=\"mb-4\">\n          <button\n            onClick={() => router.push('/admin')}\n            className=\"inline-flex items-center justify-center w-8 h-8 rounded-lg border border-neutral-200 bg-white hover:bg-neutral-50 transition-colors\"\n            aria-label=\"Back to admin\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n          </button>\n        </div>\n        <ProfileCard\n          restaurant={restaurantData}\n          onEditProfile={() => setShowEditModal(true)}\n          onChangeLogo={() => setShowLogoModal(true)}\n        />\n\n        <BranchesTable\n          branches={restaurantData.branches || []}\n          onAddBranch={() => {\n            setEditingBranch(null)\n            setShowBranchModal(true)\n          }}\n          onEditBranch={handleEditBranch}\n          onDeleteBranch={handleDeleteBranchClick}\n        />\n\n        {showEditModal && (\n          <EditProfileModal\n            restaurant={restaurantData}\n            onSave={handleSaveProfile}\n            onCancel={() => setShowEditModal(false)}\n          />\n        )}\n\n        {showLogoModal && (\n          <ChangeLogoModal\n            currentLogo={restaurantData.logo}\n            onSave={handleSaveLogo}\n            onCancel={() => setShowLogoModal(false)}\n          />\n        )}\n\n        {showBranchModal && (\n          <BranchFormModal\n            branch={editingBranch !== null ? restaurantData.branches[editingBranch] : null}\n            onSave={handleSaveBranch}\n            onCancel={() => {\n              setShowBranchModal(false)\n              setEditingBranch(null)\n            }}\n          />\n        )}\n\n        {showDeleteModal && (\n          <DeleteBranchModal\n            branchName={deletingBranch !== null ? restaurantData.branches[deletingBranch]?.name : ''}\n            onConfirm={handleDeleteBranch}\n            onCancel={() => {\n              setShowDeleteModal(false)\n              setDeletingBranch(null)\n            }}\n          />\n        )}\n      </section>\n    </div>\n  )\n}\n\n","size_bytes":10196},"src/components/Checkout/PaymentSummary.jsx":{"content":"// components/PaymentSummary.jsx\n\nexport default function PaymentSummary({ subtotal, deliveryFee, tax, total }) {\n  return (\n    <div className=\"bg-white rounded-xl border border-neutral-200 p-5 space-y-3\">\n      <div className=\"flex justify-between text-sm\">\n        <span className=\"text-neutral-600\">Subtotal</span>\n        <span className=\"font-medium\">${subtotal.toFixed(2)}</span>\n      </div>\n      <div className=\"flex justify-between text-sm\">\n        <span className=\"text-neutral-600\">Delivery Fee</span>\n        <span className=\"font-medium\">${deliveryFee.toFixed(2)}</span>\n      </div>\n      <div className=\"flex justify-between text-sm\">\n        <span className=\"text-neutral-600\">Tax</span>\n        <span className=\"font-medium\">${tax.toFixed(2)}</span>\n      </div>\n      <div className=\"border-t border-neutral-200 pt-3 flex justify-between\">\n        <span className=\"font-semibold text-lg\">Total</span>\n        <span className=\"font-semibold text-lg\">${total.toFixed(2)}</span>\n      </div>\n    </div>\n  )\n}","size_bytes":1026},"src/app/84588878l00o00g00i00n76580982/layout.js":{"content":"import '@/app/globals.css'\n\nexport const metadata = {\n  title: 'Employee Login — Restaurant Portal',\n}\n\nexport default function RootLayout({ children }) {\n  return (\n    <html lang=\"en\">\n      <head>\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\" />\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"true\" />\n        <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap\" rel=\"stylesheet\" />\n      </head>\n      <body>{children}</body>\n    </html>\n  )\n}","size_bytes":541},"src/components/MenuManagement/CategoryForm.jsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\n\nexport default function CategoryForm({ initial = null, onCancel, onSave }) {\n  const [name, setName] = useState('')\n  const [description, setDescription] = useState('')\n  const [headerImage, setHeaderImage] = useState('')\n  const [uploading, setUploading] = useState(false)\n  const [message, setMessage] = useState('')\n\n  useEffect(() => {\n    if (initial) {\n      setName(initial.name || '')\n      setDescription(initial.description || '')\n      setHeaderImage(initial.headerImage || initial.image || '')\n    }\n  }, [initial])\n\n  const handleSubmit = (e) => {\n    e.preventDefault()\n    onSave?.({ _id: initial?._id, name, description, headerImage })\n  }\n\n  const handleFileChange = async (e) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setUploading(true)\n    setMessage('⏳ Uploading image...')\n    try {\n      const data = new FormData()\n      data.append('file', file)\n      data.append('upload_preset', 'Restaurant')\n\n      const res = await fetch('https://api.cloudinary.com/v1_1/duugxwfu3/image/upload', { method: 'POST', body: data })\n      const json = await res.json()\n\n      if (json.secure_url) {\n        setHeaderImage(json.secure_url)\n        setMessage('✅ Image uploaded!')\n      } else {\n        console.error('Cloudinary response error:', json)\n        setMessage('❌ Failed to upload image')\n      }\n    } catch (err) {\n      console.error('Upload error:', err)\n      setMessage('❌ Upload failed')\n    } finally {\n      setUploading(false)\n      setTimeout(() => setMessage(''), 2500)\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"px-4 sm:px-5 py-4 space-y-4\">\n      <div>\n        <label className=\"text-sm text-neutral-700\">Name</label>\n        <input value={name} onChange={e=>setName(e.target.value)} required className=\"mt-1 w-full px-3 py-2 text-sm rounded-lg border border-neutral-200\" />\n      </div>\n      <div>\n        <label className=\"text-sm text-neutral-700\">Description</label>\n        <textarea value={description} onChange={e=>setDescription(e.target.value)} rows={3} className=\"mt-1 w-full px-3 py-2 text-sm rounded-lg border border-neutral-200\" />\n      </div>\n      <div>\n        <label className=\"text-sm text-neutral-700\">Header Image URL</label>\n        <input value={headerImage} onChange={e=>setHeaderImage(e.target.value)} type=\"url\" className=\"mt-1 w-full px-3 py-2 text-sm rounded-lg border border-neutral-200\" />\n        <div className=\"mt-2\">\n          <label className=\"text-sm text-neutral-700\">Upload Image</label>\n          <input type=\"file\" accept=\"image/*\" onChange={handleFileChange} className=\"mt-1 w-full text-sm\" />\n          <div className=\"mt-1 text-xs text-neutral-500\">{uploading ? 'Uploading…' : message}</div>\n        </div>\n      </div>\n      <div className=\"flex items-center justify-end gap-2 pt-1\">\n        <button type=\"button\" onClick={onCancel} className=\"text-sm px-3 py-2 rounded-lg border border-neutral-200 bg-white\">Cancel</button>\n        <button type=\"submit\" className=\"inline-flex items-center gap-2 text-sm px-3 py-2 rounded-lg border border-neutral-900 bg-neutral-900 text-white\">Save</button>\n      </div>\n    </form>\n  )\n}\n","size_bytes":3220},"src/components/Customer/About.jsx":{"content":"import Image from 'next/image';\nimport { Hamburger, Soup, Bike, Package } from 'lucide-react';\nimport { colors, iconBackgrounds } from '@/constants/colors';\n\nexport default function About() {\n  return (\n    <section className=\"mx-auto mt-16 max-w-7xl px-6\">\n      <div className=\"grid items-center gap-10 lg:grid-cols-2\">\n        <div className=\"relative\">\n          <Image\n            src=\"https://images.unsplash.com/photo-1606491956689-2ea866880c84?q=80&w=1200&auto=format&fit=crop\"\n            alt=\"Fresh wok stir-fry served hot\"\n            width={1200}\n            height={420}\n            className=\"h-[420px] w-full rounded-3xl object-cover shadow-sm\"\n            style={{ border: `1px solid ${colors.borderLight}`, backgroundColor: colors.bgSec }}\n          />\n        </div>\n        <div>\n          <h2 className=\"text-3xl sm:text-4xl tracking-tight\" style={{ fontFamily: 'Poppins, ui-sans-serif', fontWeight: 600, color: colors.textDark }}>\n            Our Story\n          </h2>\n          <p className=\"mt-4 text-[15px] leading-7\" style={{ color: colors.textMuted }}>\n            At Baltit Wok, we blend Asian street-food energy with local tastes. From fiery woks to juicy burgers, enjoy fast service, family-friendly vibes, and reliable home delivery—fresh, hot, and made to order.\n          </p>\n          <div className=\"mt-6 grid grid-cols-2 gap-4 sm:grid-cols-4\">\n            <div className=\"group rounded-xl border p-4 transition hover:shadow-sm\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgSec }}>\n              <div className=\"relative inline-flex\">\n                <span className=\"absolute inset-0 -m-1 rounded-full\" style={{ background: iconBackgrounds.primary }}></span>\n                <Hamburger className=\"relative h-6 w-6\" style={{ color: colors.primary }} />\n              </div>\n              <p className=\"mt-3 text-sm font-medium\" style={{ color: colors.textDark }}>Fast Food</p>\n            </div>\n            <div className=\"group rounded-xl border p-4 transition hover:shadow-sm\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgSec }}>\n              <div className=\"relative inline-flex\">\n                <span className=\"absolute inset-0 -m-1 rounded-full\" style={{ background: iconBackgrounds.secondary }}></span>\n                <Soup className=\"relative h-6 w-6\" style={{ color: colors.secondary }} />\n              </div>\n              <p className=\"mt-3 text-sm font-medium\" style={{ color: colors.textDark }}>Asian Fusion</p>\n            </div>\n            <div className=\"group rounded-xl border p-4 transition hover:shadow-sm\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgSec }}>\n              <div className=\"relative inline-flex\">\n                <span className=\"absolute inset-0 -m-1 rounded-full\" style={{ background: iconBackgrounds.accent }}></span>\n                <Bike className=\"relative h-6 w-6\" style={{ color: colors.accent }} />\n              </div>\n              <p className=\"mt-3 text-sm font-medium\" style={{ color: colors.textDark }}>Fast Delivery</p>\n            </div>\n            <div className=\"group rounded-xl border p-4 transition hover:shadow-sm\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgSec }}>\n              <div className=\"relative inline-flex\">\n                <span className=\"absolute inset-0 -m-1 rounded-full\" style={{ background: iconBackgrounds.primary }}></span>\n                <Package className=\"relative h-6 w-6\" style={{ color: colors.primary }} />\n              </div>\n              <p className=\"mt-3 text-sm font-medium\" style={{ color: colors.textDark }}>Takeaway Friendly</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}","size_bytes":3749},"src/app/api/auth/logout/route.js":{"content":"export async function POST(request) {\n  try {\n    // Clear token cookie by setting it to expired\n    const expired = new Date(0).toUTCString()\n\n    return new Response(JSON.stringify({ ok: true }), {\n      status: 200,\n      headers: {\n        'Content-Type': 'application/json',\n        'Set-Cookie': `token=; Path=/; HttpOnly; Secure=${process.env.NODE_ENV === 'production'}; SameSite=Lax; Expires=${expired}`\n      }\n    })\n  } catch (err) {\n    console.error('Logout error', err)\n    return new Response(JSON.stringify({ ok: false, error: err.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' }\n    })\n  }\n}\n","size_bytes":647},"next.config.js":{"content":"/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  images: {\n    remotePatterns: [\n      {\n        protocol: 'https',\n        hostname: 'images.unsplash.com',\n        pathname: '/**',\n      },\n      {\n        protocol: 'https',\n        hostname: 'res.cloudinary.com',\n        pathname: '/**',\n      },\n      {\n        protocol: 'https',\n        hostname: 'picsum.photos',\n        pathname: '/**',\n      },\n      {\n        protocol: 'https',\n        hostname: 'placehold.co',\n        pathname: '/**',\n      },\n    ],\n  },\n  webpack: (config, { isServer }) => {\n    if (isServer) {\n      config.externals = [...(config.externals || []), 'ws']\n    }\n    return config\n  },\n  async rewrites() {\n    return [\n      {\n        source: '/api/ws',\n        destination: '/api/ws',\n      },\n    ]\n  },\n};\n\nmodule.exports = nextConfig;\n","size_bytes":837},"src/app/api/orders/[orderId]/route.js":{"content":"import { updateOrderStatus } from '@/services/db'\n\nexport async function PATCH(request, { params }) {\n  try {\n    const { orderId } = params\n    const { status } = await request.json()\n    \n    // Get restaurantId for the update\n    const { getOrCreateDefaultRestaurant } = await import('../../../../utils/getRestaurantId')\n    const restaurantId = await getOrCreateDefaultRestaurant()\n    \n    if (!restaurantId) {\n      return new Response(JSON.stringify({ error: 'No restaurant found' }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json' }\n      })\n    }\n    \n    await updateOrderStatus(restaurantId, orderId, status)\n    \n    return new Response(JSON.stringify({ success: true }), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' }\n    })\n  } catch (error) {\n    return new Response(JSON.stringify({ error: error.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' }\n    })\n  }\n}","size_bytes":969},"src/components/MenuManagement/ItemForm.jsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Plus, X, Trash2 } from 'lucide-react'\n\nexport default function ItemForm({ initial = null, categories = [], onCancel, onSave }) {\n  const [name, setName] = useState('')\n  const [price, setPrice] = useState('')\n  const [categoryName, setCategoryName] = useState('') // Changed from category (ObjectId) to categoryName (string)\n  const [description, setDescription] = useState('')\n  const [image, setImage] = useState('')\n  const [uploading, setUploading] = useState(false)\n  const [message, setMessage] = useState('')\n  const [isAvailable, setIsAvailable] = useState(true)\n  \n  // Variants state\n  const [variants, setVariants] = useState([])\n  \n  // Sides state\n  const [sides, setSides] = useState([])\n\n  useEffect(() => {\n    if (initial) {\n      setName(initial.name || '')\n      setPrice(initial.price ?? '')\n      // Support both categoryName and category (for backward compatibility)\n      setCategoryName(initial.categoryName || initial.category?.name || initial.category || '')\n      setDescription(initial.description || '')\n      setImage(initial.image || '')\n      setIsAvailable(initial.isAvailable !== undefined ? initial.isAvailable : true)\n      // Load variants if they exist\n      setVariants(Array.isArray(initial.variants) ? initial.variants.map(v => ({\n        variant: v.variant || v.name || '',\n        price: v.price || 0,\n        img: v.img || v.image || ''\n      })) : [])\n      // Load sides if they exist\n      setSides(Array.isArray(initial.sides) ? initial.sides.map(s => ({\n        name: s.name || '',\n        extraPrice: s.extraPrice || 0,\n        img: s.img || s.image || ''\n      })) : [])\n    }\n  }, [initial])\n\n  const handleSubmit = async (e) => {\n    e.preventDefault()\n    const payload = {\n      _id: initial?._id,\n      name,\n      price: Number(price || 0),\n      categoryName, // Use categoryName (string) instead of category (ObjectId)\n      description,\n      image,\n      isAvailable,\n      variants: variants.filter(v => v.variant && v.variant.trim() !== ''), // Only include valid variants\n      sides: sides.filter(s => s.name && s.name.trim() !== '') // Only include valid sides\n    }\n    onSave?.(payload)\n  }\n\n  const handleFileChange = async (e) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setUploading(true)\n    setMessage('⏳ Uploading image...')\n    try {\n      const data = new FormData()\n      data.append('file', file)\n      data.append('upload_preset', 'Restaurant')\n\n      const res = await fetch('https://api.cloudinary.com/v1_1/duugxwfu3/image/upload', { method: 'POST', body: data })\n      const json = await res.json()\n\n      if (json.secure_url) {\n        setImage(json.secure_url)\n        setMessage('✅ Image uploaded!')\n      } else {\n        console.error('Cloudinary response error:', json)\n        setMessage('❌ Failed to upload image')\n      }\n    } catch (err) {\n      console.error('Upload error:', err)\n      setMessage('❌ Upload failed')\n    } finally {\n      setUploading(false)\n      setTimeout(() => setMessage(''), 2500)\n    }\n  }\n\n  // Variant management functions\n  const addVariant = () => {\n    setVariants([...variants, { variant: '', price: 0, img: '' }])\n  }\n\n  const updateVariant = (index, field, value) => {\n    const newVariants = [...variants]\n    newVariants[index] = { ...newVariants[index], [field]: value }\n    setVariants(newVariants)\n  }\n\n  const removeVariant = (index) => {\n    setVariants(variants.filter((_, i) => i !== index))\n  }\n\n  const uploadVariantImage = async (index, file) => {\n    if (!file) return\n    \n    setUploading(true)\n    setMessage('⏳ Uploading variant image...')\n    try {\n      const data = new FormData()\n      data.append('file', file)\n      data.append('upload_preset', 'Restaurant')\n\n      const res = await fetch('https://api.cloudinary.com/v1_1/duugxwfu3/image/upload', { method: 'POST', body: data })\n      const json = await res.json()\n\n      if (json.secure_url) {\n        updateVariant(index, 'img', json.secure_url)\n        setMessage('✅ Variant image uploaded!')\n      } else {\n        setMessage('❌ Failed to upload variant image')\n      }\n    } catch (err) {\n      console.error('Upload error:', err)\n      setMessage('❌ Upload failed')\n    } finally {\n      setUploading(false)\n      setTimeout(() => setMessage(''), 2500)\n    }\n  }\n\n  // Side management functions\n  const addSide = () => {\n    setSides([...sides, { name: '', extraPrice: 0, img: '' }])\n  }\n\n  const updateSide = (index, field, value) => {\n    const newSides = [...sides]\n    newSides[index] = { ...newSides[index], [field]: field === 'extraPrice' ? Number(value) : value }\n    setSides(newSides)\n  }\n\n  const removeSide = (index) => {\n    setSides(sides.filter((_, i) => i !== index))\n  }\n\n  const uploadSideImage = async (index, file) => {\n    if (!file) return\n    \n    setUploading(true)\n    setMessage('⏳ Uploading side image...')\n    try {\n      const data = new FormData()\n      data.append('file', file)\n      data.append('upload_preset', 'Restaurant')\n\n      const res = await fetch('https://api.cloudinary.com/v1_1/duugxwfu3/image/upload', { method: 'POST', body: data })\n      const json = await res.json()\n\n      if (json.secure_url) {\n        updateSide(index, 'img', json.secure_url)\n        setMessage('✅ Side image uploaded!')\n      } else {\n        setMessage('❌ Failed to upload side image')\n      }\n    } catch (err) {\n      console.error('Upload error:', err)\n      setMessage('❌ Upload failed')\n    } finally {\n      setUploading(false)\n      setTimeout(() => setMessage(''), 2500)\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"px-4 sm:px-5 py-4 space-y-4\">\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n        <div>\n          <label className=\"text-sm text-neutral-700\">Name</label>\n          <input value={name} onChange={e=>setName(e.target.value)} required className=\"mt-1 w-full px-3 py-2 text-sm rounded-lg border border-neutral-200\" />\n        </div>\n        <div>\n          <label className=\"text-sm text-neutral-700\">Base Price</label>\n          <div className=\"relative mt-1\">\n            <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 text-xs\">Rs</span>\n            <input value={price} onChange={e=>setPrice(e.target.value)} type=\"number\" step=\"0.01\" min=\"0\" required className=\"w-full pl-6 pr-3 py-2 text-sm rounded-lg border border-neutral-200\" />\n          </div>\n        </div>\n      </div>\n\n      <div>\n        <label className=\"text-sm text-neutral-700\">Category</label>\n        <select required value={categoryName} onChange={e=>setCategoryName(e.target.value)} className=\"mt-1 w-full text-sm px-3 py-2 rounded-lg border border-neutral-200 bg-white\">\n          <option value=\"\">Select category</option>\n          {categories.map(c => <option key={c._id || c.name} value={c.name}>{c.name}</option>)}\n        </select>\n      </div>\n\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\n        <div className=\"sm:col-span-2\">\n          <label className=\"text-sm text-neutral-700\">Image URL</label>\n          <input value={image} onChange={e=>setImage(e.target.value)} className=\"mt-1 w-full px-3 py-2 text-sm rounded-lg border border-neutral-200\" />\n        </div>\n        <div>\n          <label className=\"text-sm text-neutral-700\">Upload Image</label>\n          <input type=\"file\" accept=\"image/*\" onChange={handleFileChange} className=\"mt-1 w-full text-sm\" />\n          <div className=\"mt-1 text-xs text-neutral-500\">{uploading ? 'Uploading…' : message}</div>\n        </div>\n        <div>\n          <label className=\"text-sm text-neutral-700\">Availability</label>\n          <div className=\"mt-1\">\n            <label className=\"inline-flex items-center gap-2\">\n              <input type=\"checkbox\" checked={isAvailable} onChange={e=>setIsAvailable(e.target.checked)} />\n              <span className=\"text-sm\">Available</span>\n            </label>\n          </div>\n        </div>\n      </div>\n\n      <div>\n        <label className=\"text-sm text-neutral-700\">Description</label>\n        <textarea value={description} onChange={e=>setDescription(e.target.value)} rows={3} className=\"mt-1 w-full px-3 py-2 text-sm rounded-lg border border-neutral-200\" />\n      </div>\n\n      {/* Variants Section */}\n      <div className=\"border-t border-neutral-200 pt-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <label className=\"text-sm font-medium text-neutral-700\">Variants</label>\n          <button \n            type=\"button\"\n            onClick={addVariant}\n            className=\"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border border-neutral-200 bg-white hover:bg-neutral-50\"\n          >\n            <Plus className=\"w-3 h-3\" />\n            Add Variant\n          </button>\n        </div>\n        {variants.length === 0 ? (\n          <p className=\"text-xs text-neutral-500\">No variants added. Click \"Add Variant\" to add size/type options.</p>\n        ) : (\n          <div className=\"space-y-2\">\n            {variants.map((variant, index) => (\n              <div key={index} className=\"grid grid-cols-1 sm:grid-cols-12 gap-2 p-2 border border-neutral-200 rounded-lg\">\n                <div className=\"sm:col-span-4\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Variant name (e.g., Small)\"\n                    value={variant.variant}\n                    onChange={(e) => updateVariant(index, 'variant', e.target.value)}\n                    className=\"w-full px-2 py-1.5 text-sm rounded border border-neutral-200\"\n                  />\n                </div>\n                <div className=\"sm:col-span-3\">\n                  <div className=\"relative\">\n                    <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-neutral-400 text-xs\">Rs</span>\n                    <input\n                      type=\"number\"\n                      step=\"0.01\"\n                      placeholder=\"Price\"\n                      value={variant.price || ''}\n                      onChange={(e) => updateVariant(index, 'price', Number(e.target.value))}\n                      className=\"w-full pl-5 pr-2 py-1.5 text-sm rounded border border-neutral-200\"\n                    />\n                  </div>\n                </div>\n                <div className=\"sm:col-span-4\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Image URL (optional)\"\n                    value={variant.img || ''}\n                    onChange={(e) => updateVariant(index, 'img', e.target.value)}\n                    className=\"w-full px-2 py-1.5 text-sm rounded border border-neutral-200\"\n                  />\n                </div>\n                <div className=\"sm:col-span-1 flex items-center gap-1\">\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={(e) => e.target.files?.[0] && uploadVariantImage(index, e.target.files[0])}\n                    className=\"hidden\"\n                    id={`variant-upload-${index}`}\n                  />\n                  <label htmlFor={`variant-upload-${index}`} className=\"cursor-pointer text-xs text-neutral-600 hover:text-neutral-900\" title=\"Upload image\">\n                    📷\n                  </label>\n                  <button\n                    type=\"button\"\n                    onClick={() => removeVariant(index)}\n                    className=\"text-red-600 hover:text-red-800\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Sides Section */}\n      <div className=\"border-t border-neutral-200 pt-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <label className=\"text-sm font-medium text-neutral-700\">Sides / Add-ons</label>\n          <button \n            type=\"button\"\n            onClick={addSide}\n            className=\"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border border-neutral-200 bg-white hover:bg-neutral-50\"\n          >\n            <Plus className=\"w-3 h-3\" />\n            Add Side\n          </button>\n        </div>\n        {sides.length === 0 ? (\n          <p className=\"text-xs text-neutral-500\">No sides added. Click \"Add Side\" to add optional extras.</p>\n        ) : (\n          <div className=\"space-y-2\">\n            {sides.map((side, index) => (\n              <div key={index} className=\"grid grid-cols-1 sm:grid-cols-12 gap-2 p-2 border border-neutral-200 rounded-lg\">\n                <div className=\"sm:col-span-4\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Side name (e.g., Extra Cheese)\"\n                    value={side.name}\n                    onChange={(e) => updateSide(index, 'name', e.target.value)}\n                    className=\"w-full px-2 py-1.5 text-sm rounded border border-neutral-200\"\n                  />\n                </div>\n                <div className=\"sm:col-span-3\">\n                  <div className=\"relative\">\n                    <span className=\"absolute left-2 top-1/2 -translate-y-1/2 text-neutral-400 text-xs\">Rs</span>\n                    <input\n                      type=\"number\"\n                      step=\"0.01\"\n                      placeholder=\"Extra price\"\n                      value={side.extraPrice || ''}\n                      onChange={(e) => updateSide(index, 'extraPrice', Number(e.target.value))}\n                      className=\"w-full pl-5 pr-2 py-1.5 text-sm rounded border border-neutral-200\"\n                    />\n                  </div>\n                </div>\n                <div className=\"sm:col-span-4\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Image URL (optional)\"\n                    value={side.img || ''}\n                    onChange={(e) => updateSide(index, 'img', e.target.value)}\n                    className=\"w-full px-2 py-1.5 text-sm rounded border border-neutral-200\"\n                  />\n                </div>\n                <div className=\"sm:col-span-1 flex items-center gap-1\">\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={(e) => e.target.files?.[0] && uploadSideImage(index, e.target.files[0])}\n                    className=\"hidden\"\n                    id={`side-upload-${index}`}\n                  />\n                  <label htmlFor={`side-upload-${index}`} className=\"cursor-pointer text-xs text-neutral-600 hover:text-neutral-900\" title=\"Upload image\">\n                    📷\n                  </label>\n                  <button\n                    type=\"button\"\n                    onClick={() => removeSide(index)}\n                    className=\"text-red-600 hover:text-red-800\"\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      <div className=\"flex items-center justify-end gap-2 pt-1\">\n        <button type=\"button\" onClick={onCancel} className=\"text-sm px-3 py-2 rounded-lg border border-neutral-200 bg-white\">Cancel</button>\n        <button type=\"submit\" className=\"inline-flex items-center gap-2 text-sm px-3 py-2 rounded-lg border border-neutral-900 bg-neutral-900 text-white\">Save</button>\n      </div>\n    </form>\n  )\n}\n","size_bytes":15546},"src/utils/cartUtils.jsx":{"content":"export const calculateCartTotals = (cart) => {\n  const itemCount = cart.reduce((sum, item) => sum + item.quantity, 0);\n  const subtotal = cart.reduce((sum, item) => {\n    const itemPrice = item.finalPrice || item.price;\n    return sum + itemPrice * item.quantity;\n  }, 0);\n  const tax = subtotal * 0.08;\n  const deliveryFee = 5.00;\n  const total = subtotal + tax + deliveryFee;\n\n  return { subtotal, tax, deliveryFee, total, itemCount };\n};\n\nexport const getItemTotal = (item) => {\n  const itemPrice = item.finalPrice || item.price;\n  return itemPrice * item.quantity;\n};\n\nexport const formatPrice = (price) => {\n  return `$${price.toFixed(2)}`;\n};","size_bytes":648},"src/models/MenuItem.js":{"content":"import mongoose from 'mongoose'\n\n// Side Schema\nconst sideSchema = new mongoose.Schema({\n  name: { type: String, required: true },\n  extraPrice: { type: Number, default: 0 },\n  img: { type: String, default: '' }\n}, { _id: true })\n\n// Variant Schema\nconst variantSchema = new mongoose.Schema({\n  variant: { type: String, required: true }, // e.g., \"Small\", \"Medium\", \"Large\"\n  price: { type: Number, required: true },\n  img: { type: String, default: '' }\n}, { _id: true })\n\nconst menuItemSchema = new mongoose.Schema({\n  restaurantId: {\n    type: mongoose.Schema.Types.ObjectId,\n    required: true,\n    ref: 'Restaurant',\n    index: true\n  },\n  categoryId: {\n    type: mongoose.Schema.Types.ObjectId,\n    required: true,\n    ref: 'Category',\n    index: true\n  },\n  name: {\n    type: String,\n    required: true\n  },\n  description: {\n    type: String,\n    default: ''\n  },\n  image: {\n    type: String,\n    default: ''\n  },\n  price: {\n    type: Number,\n    required: true\n  },\n  isAvailable: {\n    type: Boolean,\n    default: true\n  },\n  variants: [variantSchema],\n  sides: [sideSchema],\n  createdAt: {\n    type: Date,\n    default: Date.now\n  }\n})\n\n// Indexes for efficient querying\nmenuItemSchema.index({ restaurantId: 1, isAvailable: 1 }) // Compound index for filtering available items\nmenuItemSchema.index({ categoryId: 1 }) // For queries by category\n\nexport const MenuItem = mongoose.models.MenuItem || mongoose.model('MenuItem', menuItemSchema)\n\n","size_bytes":1449},"src/app/api/auth/verify/route.js":{"content":"import { verify } from 'jsonwebtoken'\n\nexport async function POST(request) {\n  try {\n    const { token } = await request.json()\n    \n    if (!token) {\n      return Response.json({ valid: false, error: 'No token provided' }, { status: 401 })\n    }\n\n    const decoded = verify(token, process.env.JWT_SECRET)\n    return Response.json({ valid: true, user: decoded })\n  } catch (error) {\n    return Response.json({ valid: false, error: error.message }, { status: 401 })\n  }\n}","size_bytes":470},"src/components/AdminDashboard/DashboardStats.jsx":{"content":"'use client'\n\nfunction fmtCurrency(v) {\n  return v.toLocaleString(undefined, { style: 'currency', currency: 'PKR', maximumFractionDigits: 2 })\n}\n\nexport default function DashboardStats({ revenue, orders, aov, deliveredRate, estimatedProfit, isDesktop }) {\n  return (\n    <section className={isDesktop ? 'grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-6' : 'grid grid-cols-1 gap-4 mb-6'}>\n      <div className=\"rounded-xl bg-white border border-neutral-200 p-4 shadow-sm\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-sm text-neutral-500 uppercase tracking-wide\">Total Earned</div>\n        </div>\n        <div className=\"mt-2 text-2xl sm:text-3xl font-semibold text-neutral-900\">{fmtCurrency(revenue || 0)}</div>\n        <div className=\"mt-1 text-xs text-neutral-500\">Estimated profit {fmtCurrency(estimatedProfit || 0)}</div>\n      </div>\n\n      <div className=\"rounded-xl bg-white border border-neutral-200 p-4 shadow-sm\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-sm text-neutral-500 uppercase tracking-wide\">Orders</div>\n        </div>\n        <div className=\"mt-2 text-2xl sm:text-3xl font-semibold text-neutral-900\">{orders || 0}</div>\n        <div className=\"mt-1 text-xs text-neutral-500\">Total orders in selected period</div>\n      </div>\n\n      <div className=\"rounded-xl bg-white border border-neutral-200 p-4 shadow-sm\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-sm text-neutral-500 uppercase tracking-wide\">Avg Order Value</div>\n        </div>\n        <div className=\"mt-2 text-2xl sm:text-3xl font-semibold text-neutral-900\">{fmtCurrency(aov || 0)}</div>\n        <div className=\"mt-1 text-xs text-neutral-500\">Avg in selected period</div>\n      </div>\n\n      <div className=\"rounded-xl bg-white border border-neutral-200 p-4 shadow-sm\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"text-sm text-neutral-500 uppercase tracking-wide\">Delivered Rate</div>\n        </div>\n        <div className=\"mt-2 text-2xl sm:text-3xl font-semibold text-neutral-900\">{Math.round(deliveredRate) || 0}%</div>\n        <div className=\"mt-1 text-xs text-neutral-500\">Completed orders / total</div>\n      </div>\n    </section>\n  )\n}\n\n","size_bytes":2318},"src/app/api/orders/debug/route.js":{"content":"import { connectToDB, OrderNew } from '@/services/db';\n\nexport async function GET(req) {\n  try {\n    await connectToDB();\n\n    // fetch a few recent docs from the active 'order' collection\n    const [newOrders] = await Promise.all([\n      OrderNew.find().sort({ createdAt: -1 }).limit(5).lean().exec(),\n    ]);\n\n    const newCount = await OrderNew.countDocuments();\n\n    return new Response(JSON.stringify({\n      ok: true,\n      orderCollection: { count: newCount, sample: newOrders }\n    }), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json' }\n    });\n  } catch (err) {\n    console.error('orders debug error', err);\n    return new Response(JSON.stringify({ ok: false, error: err.message }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' }\n    });\n  }\n}\n","size_bytes":805},"src/components/Customer/Hero.jsx":{"content":"import Image from 'next/image';\nimport Link from 'next/link';\nimport { UtensilsCrossed, Phone } from 'lucide-react';\nimport { colors, buttons } from '@/constants/colors';\n\nexport default function Hero({ handleSmoothScroll }) {\n  // Fallback colors in case import fails\n  const fallbackColors = {\n    primary: '#E63946',\n    borderLight: 'rgba(0,0,0,0.06)',\n    tintAccent: 'rgba(6, 214, 160, 0.1)',\n    bgPrimary: '#FFFFFF',\n  };\n\n  const fallbackButtons = {\n    primary: {\n      text: '#FFFFFF',\n    },\n  };\n\n  // Use imported colors/buttons or fallback\n  const activeColors = colors || fallbackColors;\n  const activeButtons = buttons || fallbackButtons;\n\n  return (\n    <section className=\"relative px-4 sm:px-6 lg:px-8\">\n      <div \n        className=\"relative w-full overflow-hidden rounded-3xl border\" \n        style={{ \n          borderColor: activeColors.borderLight, \n          backgroundColor: activeColors.bgPrimary,\n          height: 'clamp(400px, 50vh, 600px)',\n          minHeight: '400px'\n        }}\n      >\n        <Image\n          src=\"https://images.unsplash.com/photo-1544145945-f90425340c7e?q=80&w=1600&auto=format&fit=crop\"\n          alt=\"Baltit Wok banner: burger, fries and wok rice\"\n          fill\n          className=\"object-cover object-center\"\n          priority\n          sizes=\"(max-width: 640px) 100vw, (max-width: 1024px) 100vw, 1200px\"\n        />\n        <div className=\"absolute inset-0 bg-gradient-to-b from-black/35 via-black/45 to-black/55\"></div>\n        <div className=\"relative z-10 mx-auto flex h-full max-w-7xl items-center px-4 sm:px-6 lg:px-8 box-border\">\n          <div className=\"max-w-2xl text-white\">\n            <h1 className=\"text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold tracking-tight font-poppins\">\n              Welcome to Baltit Wok\n            </h1>\n            <p className=\"mt-3 text-sm sm:text-base md:text-lg lg:text-xl xl:text-2xl text-white/90\">\n              Serving sizzling Asian flavors in the heart of Islamabad!\n            </p>\n            <div className=\"mt-4 sm:mt-6 flex flex-wrap gap-2 sm:gap-3\">\n              <Link\n                href=\"/menu\"\n                style={{ backgroundColor: activeColors.primary, color: activeButtons.primary.text }}\n                className=\"inline-flex items-center gap-2 rounded-full px-4 py-2.5 sm:px-5 sm:py-3 text-xs sm:text-sm md:text-base lg:text-lg font-semibold shadow-sm transition hover:opacity-90 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2\"\n              >\n                <UtensilsCrossed className=\"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6\" />\n                View Menu\n              </Link>\n              <a\n                href=\"https://wa.me/923236300813?text=Hi%20Baltit%20Wok%2C%20I%27d%20like%20to%20order.\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"inline-flex items-center gap-2 rounded-full border px-4 py-2.5 sm:px-5 sm:py-3 text-xs sm:text-sm md:text-base lg:text-lg font-semibold text-white backdrop-blur-sm transition hover:bg-white/20 hover:border-white focus:outline-none focus-visible:ring-2\"\n                style={{ borderColor: activeColors.borderLight, backgroundColor: activeColors.tintAccent }}\n              >\n                <Phone className=\"h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6\" />\n                Order Now\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}","size_bytes":3454},"server.js":{"content":"const { createServer } = require('http')\nconst { parse } = require('url')\nconst next = require('next')\nconst WebSocket = require('ws')\n\nconst dev = process.env.NODE_ENV !== 'production'\nconst app = next({ dev })\nconst handle = app.getRequestHandler()\n\nconst clients = new Set()\n\nfunction broadcastToAll(message, exclude = null) {\n  const messageStr = JSON.stringify(message)\n  clients.forEach(client => {\n    if (client !== exclude && client.readyState === WebSocket.OPEN) {\n      client.send(messageStr)\n    }\n  })\n}\n\n  app.prepare().then(() => {\n  const server = createServer(async (req, res) => {\n    try {\n      const parsedUrl = parse(req.url, true)\n\n      // Internal broadcast endpoint used by server-side API routes to\n      // notify connected WebSocket clients. This avoids importing the\n      // WebSocket server instance into Next.js route modules.\n      if (parsedUrl.pathname === '/internal/ws/broadcast' && req.method === 'POST') {\n        let body = ''\n        for await (const chunk of req) body += chunk\n        try {\n          const msg = JSON.parse(body || '{}')\n          broadcastToAll(msg, null)\n          res.writeHead(200, { 'Content-Type': 'application/json' })\n          res.end(JSON.stringify({ ok: true }))\n        } catch (e) {\n          res.writeHead(400, { 'Content-Type': 'application/json' })\n          res.end(JSON.stringify({ error: 'invalid json' }))\n        }\n        return\n      }\n\n      await handle(req, res, parsedUrl)\n    } catch (err) {\n      console.error('Error occurred handling', req.url, err)\n      res.statusCode = 500\n      res.end('internal server error')\n    }\n  })\n\n  // Create WebSocket server\n  const wss = new WebSocket.Server({ noServer: true })\n\n  wss.on('connection', (ws, request) => {\n    // Add new client to our set\n    clients.add(ws)\n\n    // Remove client from set when they disconnect\n    ws.on('close', () => {\n      clients.delete(ws)\n    })\n\n    // Handle messages from client\n    ws.on('message', async (message) => {\n      try {\n        const data = JSON.parse(message.toString())\n        \n        // Validate message format and authentication\n        if (!data.type || !data.token) {\n          ws.send(JSON.stringify({ error: 'Invalid message format' }))\n          return\n        }\n\n        // Broadcast to all other clients\n        switch (data.type) {\n          case 'order:status-changed':\n            broadcastToAll({\n              type: 'order:status-changed',\n              orderId: data.orderId,\n              status: data.status,\n              timestamp: Date.now()\n            }, ws) // Exclude sender\n            break\n            \n          default:\n            ws.send(JSON.stringify({ error: 'Unknown message type' }))\n        }\n      } catch (e) {\n        console.error('WebSocket message error:', e)\n        ws.send(JSON.stringify({ error: 'Invalid message' }))\n      }\n    })\n\n    // Send initial connection success\n    ws.send(JSON.stringify({ type: 'connected' }))\n  })\n\n  // Handle upgrade requests\n  server.on('upgrade', (request, socket, head) => {\n    const { pathname } = parse(request.url)\n\n    if (pathname === '/api/ws') {\n      wss.handleUpgrade(request, socket, head, ws => {\n        wss.emit('connection', ws, request)\n      })\n    } else {\n      socket.destroy()\n    }\n  })\n\n  const port = parseInt(process.env.PORT, 10) || 5000\n  const host = '0.0.0.0'\n  server.listen(port, host, (err) => {\n    if (err) throw err\n    console.log(`> Ready on http://${host}:${port}`)\n  })\n})","size_bytes":3480},"src/components/Checkout/OTPVerification.jsx":{"content":"// components/OTPVerification.jsx\n'use client'\nimport { useRef } from 'react'\n\nexport default function OTPVerification({ otp, onChange, onResend }) {\n  const inputRefs = useRef([])\n\n  const handleKeyDown = (index, e) => {\n    if (e.key === 'Backspace' && !otp[index] && index > 0) {\n      // If current input is empty and backspace is pressed, focus previous input\n      inputRefs.current[index - 1].focus()\n    }\n  }\n\n  const handleChange = (index, value) => {\n    // Only allow digits\n    if (!/^\\d*$/.test(value)) return\n\n    onChange(index, value)\n\n    if (value && index < 5) {\n      // If digit entered and not last input, focus next input\n      inputRefs.current[index + 1].focus()\n    }\n  }\n\n  // Handle pasted content\n  const handlePaste = (e) => {\n    e.preventDefault()\n    const pastedData = e.clipboardData.getData('text/plain')\n    const digits = pastedData.match(/\\d/g)\n    \n    if (digits) {\n      // Fill inputs with pasted digits\n      digits.slice(0, 6).forEach((digit, i) => {\n        onChange(i, digit)\n        if (i < 5) inputRefs.current[i + 1].focus()\n      })\n    }\n  }\n\n  return (\n    <div className=\"bg-white rounded-xl border border-neutral-200 p-6\">\n      <div className=\"flex gap-3 justify-center mb-6\">\n        {otp.map((digit, index) => (\n          <input\n            key={index}\n            ref={el => inputRefs.current[index] = el}\n            type=\"text\"\n            maxLength={1}\n            value={digit}\n            onChange={(e) => handleChange(index, e.target.value)}\n            onKeyDown={(e) => handleKeyDown(index, e)}\n            onPaste={handlePaste}\n            className=\"otp-input w-12 h-14 text-center text-xl font-semibold border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent\"\n          />\n        ))}\n      </div>\n      <div className=\"text-center\">\n        <p className=\"text-sm text-neutral-500 mb-2\">Didn't receive the email code?</p>\n        <button onClick={onResend} className=\"text-sm text-neutral-900 font-medium hover:underline\">\n          Resend Email Code\n        </button>\n      </div>\n    </div>\n  )\n}","size_bytes":2130},"src/app/page.tsx":{"content":"\"use client\";\nimport { useState, useEffect } from 'react';\nimport Head from 'next/head';\nimport Header from '@/components/Customer/Header';\nimport Hero from '@/components/Customer/Hero';\nimport About from '@/components/Customer/About';\nimport Deals from '@/components/Customer/Deals';\nimport Testimonials from '@/components/Customer/Testimonials';\nimport LocationContact from '@/components/Customer/LocationContact';\nimport Footer from '@/components/Customer/Footer';\nimport CartOverlay from \"@/components/Menu/CartOverlay\";\nimport Menu from '@/components/Customer/menu';\n\nimport WhatsAppWidget from '@/components/Customer/WhatsAppWidget';\nimport { colors, iconBackgrounds } from '@/constants/colors';\n\nexport default function Home() {\n  const [isWaPanelOpen, setIsWaPanelOpen] = useState(false);\n  const [items, setItems] = useState([]);\n    const fetchItems = async () => {\n      try {\n        const res = await fetch('/api/menu-items');\n        const json = await res.json();\n        if (!res.ok || !json.success) throw new Error(json.error || 'Failed to fetch items');\n        // API returns array of items in json.data\n        setItems(json.data || []);\n      } catch (err) {\n        console.error('fetchItems error', err);\n      }\n    };\n  \n    useEffect(() => {\n      fetchItems();\n    }, []);\n  \n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        setIsWaPanelOpen(false);\n      }\n    };\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, []);\n\n  const toggleWaPanel = () => {\n    setIsWaPanelOpen(!isWaPanelOpen);\n  };\n\n  const handleOutsideClick = (e: React.MouseEvent) => {\n    if (isWaPanelOpen && !(e.target as HTMLElement).closest('#waWidget')) {\n      setIsWaPanelOpen(false);\n    }\n  };\n\n  const handleSmoothScroll = (e: React.MouseEvent, id: string) => {\n    e.preventDefault();\n    const element = document.querySelector(id);\n    if (element) {\n      element.scrollIntoView({ behavior: 'smooth', block: 'start' });\n    }\n  };\n\n  return (\n    <>\n      <Head>\n        <meta charSet=\"utf-8\" />\n        <title>Baltit Wok | Asian Fusion • Takeaway & Delivery • G-13/1 Islamabad</title>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n        <meta name=\"description\" content=\"Baltit Wok serves sizzling Asian fusion, burgers, and platters in G-13/1 Islamabad. Fast takeaway, home delivery, and great deals. Order now!\" />\n        <meta name=\"keywords\" content=\"Baltit Wok, restaurant Islamabad, Asian fusion, fast food, takeaway, delivery, burgers, rice bowls, G-13/1, deals\" />\n        <meta property=\"og:title\" content=\"Baltit Wok • Asian Fusion, Takeaway & Delivery\" />\n        <meta property=\"og:description\" content=\"Sizzling Asian flavors in the heart of Islamabad. Order takeaway or delivery today!\" />\n        <meta property=\"og:type\" content=\"website\" />\n        <meta property=\"og:locale\" content=\"en_PK\" />\n        <meta name=\"theme-color\" content=\"#E63946\" />\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossOrigin=\"anonymous\" />\n        <link href=\"https://fonts.googleapis.com/css2?family=Lato:wght@400;500;600&family=Poppins:wght@500;600;700&family=Pacifico&display=swap\" rel=\"stylesheet\" />\n      </Head>\n      <div className=\"antialiased selection:bg-black\" style={{ backgroundColor: colors.bgPrimary, color: colors.textDark, fontFamily: \"'Lato', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'\" }}>\n        <Header handleSmoothScroll={handleSmoothScroll} />\n        <main id=\"home\" className=\"pt-20 sm:pt-24\">\n          <Hero handleSmoothScroll={handleSmoothScroll} />\n          <Menu />\n          <About />\n          <Deals />\n          <Testimonials />\n          <LocationContact />\n        </main>\n        <Footer handleSmoothScroll={handleSmoothScroll} />\n        <WhatsAppWidget isWaPanelOpen={isWaPanelOpen} toggleWaPanel={toggleWaPanel} handleOutsideClick={handleOutsideClick} />\n        <CartOverlay products={items} />\n        \n      </div>\n    </>\n  );\n}","size_bytes":4162},"src/app/Checkout/page.jsx":{"content":"\"use client\"\n// app/checkout/page.jsx\nimport { useEffect, useState } from 'react'\nimport Checkout from '@/components/Checkout/Checkout'\n\nexport default function CheckoutPage() {\n  const [cart, setCart] = useState(null)\n\n  useEffect(() => {\n    try {\n      // Prefer the explicit checkoutCart set by CartOverlay.goToCheckout.\n      // Fall back to localCart if present.\n      const stored = localStorage.getItem('checkoutCart') || localStorage.getItem('localCart')\n      if (stored) {\n        const parsed = JSON.parse(stored)\n        const normalized = parsed.map((item) => ({\n          id: item.id || item.menuItemId || item._id,\n          menuItemId: item.menuItemId || item.id || item._id, // Preserve menuItemId for order creation\n          name: item.name || item.product?.name || '',\n          description: item.description || item.product?.description || '',\n          imageUrl: item.imageUrl || item.image || item.product?.image || '',\n          price: Number(item.price ?? item.product?.price ?? 0),\n          quantity: Number(item.quantity ?? 1),\n          variant: item.variant || '', // Preserve variant selection\n          selectedSides: item.selectedSides || item.selectedOptions || [], // Preserve sides selection\n        }))\n        setCart(normalized)\n        return\n      }\n\n      // No stored cart → set empty cart\n      setCart([])\n    } catch (err) {\n      console.error('Failed to read cart from localStorage', err)\n      setCart([])\n    }\n  }, [])\n\n  // Handle order placement\n  const handleOrderPlaced = (orderData) => {\n    console.log('Order placed:', orderData)\n    alert('Order successfully placed! Check console for details.')\n    // Optionally redirect or update UI here, e.g., router.push('/order-confirmation')\n  }\n\n  if (cart === null) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <p>Loading checkout...</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50\">\n      <Checkout cart={cart} onOrderPlaced={handleOrderPlaced} />\n    </div>\n  )\n}","size_bytes":2056},"src/models/Restaurant.js":{"content":"import mongoose from 'mongoose'\n\n// Branch Schema\nconst branchSchema = new mongoose.Schema({\n  name: { type: String, required: true },                  // e.g. \"Downtown\"\n  address: { type: String, required: true },\n  phone: { type: String },\n  city: { type: String, required: true },\n  coordinates: {\n    lat: { type: Number },\n    lng: { type: Number },\n  },\n  status: {\n    type: String,\n    enum: [\"Open\", \"Temporarily Closed\", \"Closed\"],\n    default: \"Open\",\n  },\n  createdAt: { type: Date, default: Date.now },\n}, { _id: false })\n\n// Main Restaurant Schema\nconst restaurantSchema = new mongoose.Schema(\n  {\n    name: { type: String, required: true },\n    logo: { type: String },\n    description: { type: String },                          // \"Brunch classics & seasonal plates.\"\n    cuisine: { type: String },                              // \"Modern American\"\n    owner: { type: String },                                // \"Alex Rivera\"\n    contactEmail: { type: String },\n    contactPhone: { type: String },\n    isLive: { type: Boolean, default: false },              // toggle for visibility\n    totalBranches: { type: Number, default: 0 },            // auto-updated\n    branches: [branchSchema],\n  },\n  { timestamps: true }\n)\n\n// Note: Categories and MenuItems are now in separate collections (Category, MenuItem)\n// Note: Users are now in separate collection (User)\n// Note: Orders are in separate collection (Order)\n\n// Auto-update totalBranches before saving\nrestaurantSchema.pre('save', function(next) {\n  this.totalBranches = this.branches ? this.branches.length : 0\n  next()\n})\n\nexport const Restaurant = mongoose.models.Restaurant || mongoose.model('Restaurant', restaurantSchema)\n\n","size_bytes":1699},"src/app/layout.tsx":{"content":"import type { Metadata } from \"next\";\nimport { Geist, Geist_Mono } from \"next/font/google\";\nimport \"./globals.css\";\n\nconst geistSans = Geist({\n  variable: \"--font-geist-sans\",\n  subsets: [\"latin\"],\n});\n\nconst geistMono = Geist_Mono({\n  variable: \"--font-geist-mono\",\n  subsets: [\"latin\"],\n});\n\nexport const metadata: Metadata = {\n  title: \"Create Next App\",\n  description: \"Generated by create next app\",\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"en\">\n      <body\n        className={`${geistSans.variable} ${geistMono.variable} antialiased`}\n      >\n        {children}\n      </body>\n    </html>\n  );\n}\n","size_bytes":689},"src/components/Menu/ProductGrid.jsx":{"content":"\"use client\";\n\nimport { useState } from \"react\";\nimport ProductCard from \"./ProductCard\";\nimport { colors } from \"@/constants/colors\";\n// import AddItemModal from \"./AddItemModal\";\n\nexport default function ProductGrid({ categories, items, setItems, sectionRefs }) {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [selectedCategory, setSelectedCategory] = useState(null);\n\n  const handleItemAdded = (newItem) => {\n    if (!newItem) return;\n    setItems((prev) => [...prev, newItem]);\n  };\n\n  return (\n    <div className=\"flex-1\">\n      {categories.map((cat) => {\n        const filtered = items.filter((item) => {\n          if (!item) return false;\n          const catField = item.category;\n          if (!catField) return false;\n          // category may be an object ({ _id }) or a string id\n          const itemCatId = typeof catField === \"string\" ? catField : (catField._id ?? catField.id);\n          return itemCatId === cat._id;\n        });\n\n        return (\n          <div\n            key={cat._id}\n            ref={(el) => (sectionRefs.current[cat._id] = el)}\n            data-category={cat._id}\n            className=\"mb-8\"\n          >\n            <h2 className=\"text-xl font-semibold mb-4\" style={{ color: colors.textDark }}>\n              {cat.name}\n            </h2>\n            <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-5\">\n              {filtered.map((item) => (\n                console.log(item),\n                <ProductCard key={item._id} product={item} />\n              ))}\n            </div>\n            <hr className=\"mt-6\" style={{ borderColor: colors.borderLight }} />\n          </div>\n        );\n      })}\n\n      {/* <AddItemModal\n        isOpen={isModalOpen}\n        onClose={() => setIsModalOpen(false)}\n        categoryId={selectedCategory}\n        onSuccess={handleItemAdded}\n      /> */}\n    </div>\n  );\n}\n","size_bytes":1863},"src/components/Menu/ProductCard.jsx":{"content":"\"use client\";\n\nimport { useState } from 'react'\nimport { colors, buttons } from \"@/constants/colors\";\nimport ProductModal from './ProductModal'\n\nexport default function ProductCard({ product }) {\n  const [showModal, setShowModal] = useState(false)\n\n  const hasVariants = product.variants && product.variants.length > 0\n  const hasSides = product.sides && product.sides.length > 0\n  const needsModal = hasVariants || hasSides\n\n  const handleAddToCart = (cartItem) => {\n    try {\n      const raw = localStorage.getItem(\"localCart\");\n      const cart = raw ? JSON.parse(raw) : [];\n      \n      // Check if item with same menuItemId, variant, and sides already exists\n      const idx = cart.findIndex((c) => {\n        const sameMenuItem = c.menuItemId === cartItem.menuItemId\n        const sameVariant = c.variant === cartItem.variant\n        const sameSides = JSON.stringify(c.selectedSides || []) === JSON.stringify(cartItem.selectedSides || [])\n        return sameMenuItem && sameVariant && sameSides\n      });\n\n      if (idx >= 0) {\n        cart[idx].quantity = Number(cart[idx].quantity || 0) + cartItem.quantity;\n      } else {\n        cart.push(cartItem);\n      }\n\n      localStorage.setItem(\"localCart\", JSON.stringify(cart));\n      // notify cart overlay / desktop button\n      window.dispatchEvent(new Event(\"cartUpdated\"));\n    } catch (err) {\n      console.error(\"Add to local cart failed\", err);\n    }\n  };\n\n  const handleAddClick = (e) => {\n    e.stopPropagation();\n    if (needsModal) {\n      setShowModal(true);\n    } else {\n      // Direct add to cart for items without variants/sides\n      handleAddToCart({\n        menuItemId: product._id,\n        name: product.name,\n        description: product.description,\n        image: product.image,\n        price: product.price || 0,\n        quantity: 1,\n        variant: '',\n        selectedSides: [],\n        product: product\n      });\n    }\n  };\n\n  return (\n    <>\n      <div\n        className=\"rounded-xl overflow-hidden cursor-pointer hover:shadow-lg transition-all duration-200 hover:-translate-y-0.5\"\n        onClick={() => setShowModal(true)}\n      >\n        <img\n          src={product.image}\n          alt={product.name}\n          className=\"w-full h-48 object-cover\"\n        />\n\n        <div className=\"p-4 border rounded-b-xl\" style={{ backgroundColor: colors.bgSec, color: colors.textDark, borderColor: colors.borderLight }}>\n          <h3 className=\"font-semibold text-lg mb-1\" style={{ color: colors.textDark }}>{product.name}</h3>\n          <p className=\"text-sm mb-3\" style={{ color: colors.textMuted }}>{product.description}</p>\n\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-xl font-semibold\" style={{ color: colors.textDark }}>Rs {product.price}</span>\n            <button\n              onClick={handleAddClick}\n              className=\"px-4 py-2 rounded-lg text-sm font-medium transition-all hover:opacity-90\"\n              style={{ backgroundColor: buttons.primary.background, color: buttons.primary.text }}\n            >\n              Add\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <ProductModal\n        product={product}\n        isOpen={showModal}\n        onClose={() => setShowModal(false)}\n        onAddToCart={handleAddToCart}\n      />\n    </>\n  );\n}","size_bytes":3314},"src/components/RestaurantProfile/ProfileCard.jsx":{"content":"'use client'\n\nimport Image from 'next/image'\nimport { Pencil, Image as ImageIcon } from 'lucide-react'\n\nexport default function ProfileCard({ restaurant, onEditProfile, onChangeLogo }) {\n  const isLive = restaurant?.isLive || false\n  const totalBranches = restaurant?.totalBranches || (restaurant?.branches?.length || 0)\n\n  return (\n    <div className=\"mb-6\">\n      {/* Header Section */}\n      <div className=\"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between mb-6\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-semibold tracking-tight text-neutral-900\">Restaurant Profile</h1>\n          <p className=\"mt-1 text-sm text-neutral-500\">Update your restaurant info and manage all locations.</p>\n        </div>\n        <div className=\"flex flex-wrap items-center gap-2\">\n          <button\n            onClick={onEditProfile}\n            className=\"inline-flex items-center gap-2 rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm font-medium text-neutral-800 hover:bg-neutral-50\"\n          >\n            <Pencil className=\"h-4 w-4\" />\n            Edit Profile\n          </button>\n          <button\n            onClick={onChangeLogo}\n            className=\"inline-flex items-center gap-2 rounded-lg bg-neutral-900 px-3 py-2 text-sm font-medium text-white hover:bg-neutral-800\"\n          >\n            <ImageIcon className=\"h-4 w-4\" />\n            Change Logo\n          </button>\n        </div>\n      </div>\n\n      {/* Cards Section - Stacked Vertically */}\n      <div className=\"grid gap-4 sm:gap-6\">\n        {/* Restaurant Card */}\n        <div className=\"rounded-xl border border-neutral-200 bg-white p-4 sm:p-5\">\n          <div className=\"flex flex-col sm:flex-row items-start gap-4\">\n            {restaurant?.logo ? (\n              <div className=\"relative h-16 w-16 rounded-lg overflow-hidden flex-shrink-0\">\n                <Image\n                  src={restaurant.logo}\n                  alt={restaurant.name || 'Restaurant Logo'}\n                  fill\n                  className=\"object-cover\"\n                  onError={(e) => {\n                    e.target.style.display = 'none'\n                    e.target.nextSibling.style.display = 'flex'\n                  }}\n                />\n                <div className=\"hidden h-16 w-16 rounded-lg bg-neutral-900 text-white items-center justify-center text-sm font-medium\">RL</div>\n              </div>\n            ) : (\n              <div className=\"h-16 w-16 rounded-lg bg-neutral-900 text-white flex items-center justify-center text-sm font-medium\">RL</div>\n            )}\n            <div className=\"flex-1 w-full\">\n              <div className=\"flex flex-wrap items-center gap-2\">\n                <h2 className=\"text-lg sm:text-xl font-semibold tracking-tight text-neutral-900\">{restaurant?.name || 'Restaurant Name'}</h2>\n                {isLive && (\n                  <span className=\"rounded-full border border-neutral-200 px-2 py-0.5 text-xs text-neutral-600\">Live</span>\n                )}\n              </div>\n              <p className=\"mt-1 text-sm text-neutral-600\">{restaurant?.description || 'No description'}</p>\n              <div className=\"mt-4 grid gap-3 grid-cols-1 sm:grid-cols-3\">\n                <div className=\"rounded-lg border border-neutral-200 p-3\">\n                  <div className=\"text-xs text-neutral-500\">Cuisine</div>\n                  <div className=\"text-sm font-medium text-neutral-900\">{restaurant?.cuisine || '—'}</div>\n                </div>\n                <div className=\"rounded-lg border border-neutral-200 p-3\">\n                  <div className=\"text-xs text-neutral-500\">Owner</div>\n                  <div className=\"text-sm font-medium text-neutral-900\">{restaurant?.owner || '—'}</div>\n                </div>\n                <div className=\"rounded-lg border border-neutral-200 p-3\">\n                  <div className=\"text-xs text-neutral-500\">Contact</div>\n                  <div className=\"text-sm font-medium text-neutral-900 truncate\">{restaurant?.contactEmail || '—'}</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Total Branches Card */}\n        <div className=\"rounded-xl border border-neutral-200 bg-white p-4 sm:p-5\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <div className=\"text-sm text-neutral-500\">Total branches</div>\n              <div className=\"mt-1 text-2xl font-semibold tracking-tight\">{totalBranches}</div>\n            </div>\n            <div className=\"rounded-lg bg-neutral-100 p-3\">\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6 text-neutral-700\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n                <path d=\"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z\"/>\n                <circle cx=\"12\" cy=\"10\" r=\"3\"/>\n              </svg>\n            </div>\n          </div>\n          <div className=\"mt-4 text-xs text-neutral-500\">Manage all locations below.</div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n","size_bytes":5061},"src/app/admin/MenuManagement/page.jsx":{"content":"import MenuManagementClient from '@/components/MenuManagement/MenuManagementClient'\n\nexport default function Page() {\n\treturn (\n\t\t<div>\n\t\t\t{/* Client component handles data fetching and interactivity */}\n\t\t\t<MenuManagementClient />\n\t\t</div>\n\t)\n}\n","size_bytes":246},"src/middleware.js":{"content":"import { NextResponse } from 'next/server'\n\n// Middleware: protect /admin routes and require a token cookie to be present.\n// Keep verification on the server (API route) because Edge runtime doesn't\n// support Node's crypto module for JWT verification.\nexport async function middleware(request) {\n  const path = request.nextUrl.pathname\n\n  // Only protect /admin routes\n  if (!path.startsWith('/admin')) {\n    return NextResponse.next()\n  }\n\n  const tokenCookie = request.cookies.get('token')\n\n  if (!tokenCookie) {\n    // Redirect to login if no token cookie is present\n    return NextResponse.redirect(new URL('/84588878l00o00g00i00n76580982', request.url))\n  }\n\n  // Token exists — allow access. Full verification should happen in server APIs.\n  return NextResponse.next()\n}","size_bytes":779},"src/components/MenuManagement/ItemCard.jsx":{"content":"    'use client'\n\nexport default function ItemCard({ item, onEdit, onView, onDelete, onToggle }) {\n  const img = item.image && item.image.trim() ? item.image : '/fallback-item.jpg';\n  return (\n    <div className=\"px-4 py-3\">\n      <div className=\"grid grid-cols-1 md:grid-cols-12 md:items-center gap-3\">\n        <div className=\"md:col-span-3\">\n          <div className=\"flex items-center gap-3 min-w-0\">\n            <img src={img} className=\"h-12 w-12 rounded-md object-cover border border-neutral-200 shrink-0\"/>\n            <div className=\"min-w-0\">\n              <div className=\"text-sm font-medium truncate\">{item.name}</div>\n              <div className=\"text-xs text-neutral-500 line-clamp-1\">{item.description || ''}</div>\n            </div>\n          </div>\n        </div>\n        <div className=\"md:col-span-2\">\n          <div className=\"inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border border-neutral-200 bg-neutral-50\">{item?.category?.name || '—'}</div>\n        </div>\n        <div className=\"md:col-span-1 text-sm\">Rs {Number(item.price || 0).toFixed(0)}</div>\n        <div className=\"md:col-span-2\">\n          <div className=\"flex items-center gap-2\">\n            <button onClick={() => onToggle?.(item)} aria-pressed={item.isAvailable} className={`relative inline-flex h-6 w-10 items-center rounded-full ${item.isAvailable ? 'bg-neutral-900' : 'bg-neutral-200'}`}>\n              <span className={`inline-block h-5 w-5 transform rounded-full bg-white shadow transition ${item.isAvailable ? 'translate-x-5' : 'translate-x-1'}`} />\n            </button>\n            <span className={`text-xs ${item.isAvailable ? 'text-green-700' : 'text-neutral-500'}`}>{item.isAvailable ? 'Available' : 'Unavailable'}</span>\n          </div>\n        </div>\n        <div className=\"md:col-span-2 text-sm text-neutral-700\">{new Date(item.createdAt).toLocaleDateString()}</div>\n        <div className=\"md:col-span-2\">\n          <div className=\"flex md:justify-end gap-1.5 flex-wrap\">\n            <button onClick={() => onView?.(item)} className=\"inline-flex items-center gap-1 text-xs px-2.5 py-1.5 rounded-md border border-neutral-200 bg-white hover:bg-neutral-50\">View</button>\n            <button onClick={() => onEdit?.(item)} className=\"inline-flex items-center gap-1 text-xs px-2.5 py-1.5 rounded-md border border-neutral-200 bg-white hover:bg-neutral-50\">Edit</button>\n            <button onClick={() => onDelete?.(item)} className=\"inline-flex items-center gap-1 text-xs px-2.5 py-1.5 rounded-md border border-red-200 text-red-700 bg-white hover:bg-red-50\">Delete</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":2657},"src/components/Checkout/OrderSuccessModal.jsx":{"content":"// components/OrderSuccessModal.jsx\n\"use client\"\n\nimport { useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { CheckCircle, Info, Map, Home } from 'lucide-react'\n\nexport default function OrderSuccessModal({ orderId, address, total, onTrack, onClose }) {\n  useEffect(() => {\n    const prev = document.body.style.overflow\n    document.body.style.overflow = 'hidden'\n    return () => {\n      document.body.style.overflow = prev\n    }\n  }, [])\n  const router = useRouter()\n\n  const handleBackHome = () => {\n    // navigate to home and call optional onClose\n    router.push('/')\n    if (onClose) onClose()\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n      {/* Outer wrapper keeps rounded corners; inner scroll area handles overflow */}\n      <div className=\"bg-white rounded-xl max-w-md w-full mx-4 overflow-hidden\">\n        <div className=\"p-6 space-y-6 max-h-[90vh] overflow-auto\">\n        <div className=\"text-center\">\n          <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n            <CheckCircle className=\"w-10 h-10 text-green-600\" />\n          </div>\n          <h2 className=\"text-2xl font-semibold tracking-tight mb-2\">Order Placed Successfully!</h2>\n          <p className=\"text-neutral-600\">Your order has been confirmed and is being prepared</p>\n        </div>\n        <div className=\"bg-white rounded-xl border border-neutral-200 p-6 space-y-4\">\n          <div className=\"flex items-center justify-between pb-4 border-b border-neutral-200\">\n            <span className=\"text-sm text-neutral-600\">Order Number</span>\n            <span className=\"font-semibold text-lg\">{orderId}</span>\n          </div>\n          <div className=\"flex items-center justify-between pb-4 border-b border-neutral-200\">\n            <span className=\"text-sm text-neutral-600\">Estimated Delivery</span>\n            <span className=\"font-semibold\">25-35 minutes</span>\n          </div>\n          <div className=\"flex items-center justify-between pb-4 border-b border-neutral-200\">\n            <span className=\"text-sm text-neutral-600\">Delivery Address</span>\n            <span className=\"font-medium text-right text-sm\">{address}</span>\n          </div>\n          <div className=\"flex items-center justify-between\">\n            <span className=\"text-sm text-neutral-600\">Total Paid</span>\n            <span className=\"font-semibold text-xl\">${total.toFixed(2)}</span>\n          </div>\n        </div>\n        <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-5 flex gap-3\">\n          <Info className=\"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5\" />\n          <div>\n            <p className=\"text-sm font-medium text-blue-900 mb-1\">Track your order</p>\n            <p className=\"text-sm text-blue-700\">We'll send you updates via SMS. You can also track your order in real-time.</p>\n          </div>\n        </div>\n        <div className=\"flex gap-3\">\n          <button\n            onClick={onTrack}\n            className=\"flex-1 py-4 bg-white border border-neutral-200 text-neutral-700 rounded-xl font-semibold hover:bg-neutral-50 transition-all flex items-center justify-center gap-2\"\n          >\n            <Map className=\"w-5 h-5\" />\n            Track Order\n          </button>\n          <button\n            onClick={handleBackHome}\n            className=\"flex-1 py-4 bg-neutral-900 text-white rounded-xl font-semibold hover:bg-neutral-800 transition-all flex items-center justify-center gap-2\"\n          >\n            <Home className=\"w-5 h-5\" />\n            Back to Home\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n  )\n}","size_bytes":3682},"src/services/api.js":{"content":"import axios from \"axios\";\n\nconst api = axios.create({\n  baseURL: \"http://localhost:5000/api/\", // backend URL\n});\n\nexport default api;\n","size_bytes":136},"src/app/Orders/page.jsx":{"content":"'use client'\n\nimport { useState, useEffect, useRef, useMemo, useCallback } from 'react'\nimport Image from 'next/image'\nimport { Search, RefreshCcw, Plus, LayoutGrid, Clock, Menu } from 'lucide-react'\nimport OrderCard from '@/components/Orders/OrderCard'\nimport { STATUS_STYLES } from '@/constants/orderStyles'\nimport { useWebSocket } from '@/hooks/useWebSocket'\nimport { useRestaurant } from '@/hooks/useRestaurant'\n\nconst STATUS_PILLS = [\n  { label: 'All', value: 'all' },\n  { label: 'Pending', value: 'pending' },\n  { label: 'Accepted', value: 'accepted' },\n  { label: 'Preparing', value: 'preparing' },\n  { label: 'Prepared', value: 'prepared' },\n  { label: 'Delivering', value: 'delivering' },\n  { label: 'Delivered', value: 'delivered' }\n]\n\nexport default function OrdersPage() {\n  const [orders, setOrders] = useState([])\n  const [loading, setLoading] = useState(true)\n  const { restaurant, loading: restaurantLoading } = useRestaurant()\n  const [activeStatus, setActiveStatus] = useState('all')\n  const [searchQuery, setSearchQuery] = useState('')\n  \n\n  const loadOrders = async () => {\n    try {\n      setLoading(true)\n      const data = await fetchOrdersRaw()\n      if (data) {\n        setOrders(data)\n        // update last ids snapshot\n        lastIdsRef.current = new Set(data.map(o => o._id))\n      }\n    } catch (error) {\n      console.error('Failed to load orders:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // low-level fetch used by polling/broadcast handlers\n  const fetchOrdersRaw = useCallback(async () => {\n    try {\n      const response = await fetch('/api/orders')\n      if (!response.ok) throw new Error('Failed to fetch orders')\n      const data = await response.json()\n      return data\n    } catch (e) {\n      console.error('fetchOrdersRaw error', e)\n      return null\n    }\n  }, [])\n\n  // Setup BroadcastChannel + polling to receive live updates from server and other tabs\n  // Tab instance id so we can ignore our own broadcasts when appropriate\n  const tabId = useMemo(() => {\n    try { return crypto.randomUUID() } catch (e) { return `${Date.now()}-${Math.random()}` }\n  }, [])\n\n  // BroadcastChannel to sync between tabs\n  const bcRef = useRef(null)\n  // Keep last known ids to detect newly added orders\n  const lastIdsRef = useRef(new Set())\n  // Poll interval ref so we can clear it\n  const pollRef = useRef(null)\n\n  // Play a short beep via WebAudio (more likely to play without being blocked)\n  const playNotificationSound = useCallback(() => {\n    try {\n      const AudioCtx = window.AudioContext || window.webkitAudioContext\n      if (!AudioCtx) return\n      const ctx = new AudioCtx()\n      const o = ctx.createOscillator()\n      const g = ctx.createGain()\n      o.type = 'sine'\n      o.frequency.value = 880\n      g.gain.value = 0.001\n      o.connect(g)\n      g.connect(ctx.destination)\n      const now = ctx.currentTime\n      g.gain.setValueAtTime(0.001, now)\n      g.gain.exponentialRampToValueAtTime(0.2, now + 0.02)\n      o.start(now)\n      g.gain.exponentialRampToValueAtTime(0.001, now + 0.35)\n      o.stop(now + 0.36)\n      // close context shortly after\n      setTimeout(() => { try { ctx.close() } catch (e) {} }, 500)\n    } catch (e) {\n      // fallback: try simple Audio with short base64 beep (optional)\n    }\n  }, [])\n  // Handle WebSocket messages\n  const handleWebSocketMessage = useCallback(async (data) => {\n    if (!data || !data.type) return\n\n    try {\n      switch (data.type) {\n        case 'order:added':\n          if (data.order) {\n            setOrders(prev => {\n              // avoid duplicates\n              if (prev.some(o => o._id === data.order._id)) return prev\n              const newOrders = [...prev, data.order]\n              lastIdsRef.current = new Set(newOrders.map(o => o._id))\n              if (activeStatus === 'all' || data.order.status === activeStatus) {\n                playNotificationSound()\n              }\n              return newOrders\n            })\n            // broadcast to other tabs\n            try { if (bcRef.current) bcRef.current.postMessage({ type: 'order:added', order: data.order, sourceTab: tabId }) } catch (e) {}\n          }\n          break\n\n        case 'order:status-changed': {\n          const { orderId, status } = data\n          setOrders(prev => {\n            const newOrders = prev.map(o => o._id === orderId ? { ...o, status } : o)\n            lastIdsRef.current = new Set(newOrders.map(o => o._id))\n            if (activeStatus === 'all' || status === activeStatus) {\n              playNotificationSound()\n            }\n            return newOrders\n          })\n          try { if (bcRef.current) bcRef.current.postMessage({ type: 'order:status-changed', orderId, status, sourceTab: tabId }) } catch (e) {}\n          break\n        }\n\n        default:\n          break\n      }\n    } catch (e) {\n      console.error('Error handling WebSocket message:', e)\n    }\n  }, [activeStatus, playNotificationSound, tabId])\n\n  // Handle messages from other tabs (via BroadcastChannel)\n  useEffect(() => {\n    try {\n      if (typeof BroadcastChannel !== 'undefined') {\n        bcRef.current = new BroadcastChannel('orders-channel')\n        bcRef.current.onmessage = (ev) => {\n          const msg = ev.data\n          if (!msg || msg.sourceTab === tabId) return // ignore our own broadcasts\n\n          switch (msg.type) {\n            case 'order:added':\n              if (msg.order) {\n                setOrders(prev => {\n                  if (prev.some(o => o._id === msg.order._id)) return prev\n                  const newOrders = [...prev, msg.order]\n                  lastIdsRef.current = new Set(newOrders.map(o => o._id))\n                  if (activeStatus === 'all' || msg.order.status === activeStatus) playNotificationSound()\n                  return newOrders\n                })\n              }\n              break\n\n            case 'order:status-changed':\n              setOrders(prev => {\n                const newOrders = prev.map(o => o._id === msg.orderId ? { ...o, status: msg.status } : o)\n                lastIdsRef.current = new Set(newOrders.map(o => o._id))\n                if (activeStatus === 'all' || msg.status === activeStatus) playNotificationSound()\n                return newOrders\n              })\n              break\n\n            default:\n              break\n          }\n        }\n      }\n    } catch (e) {\n      console.warn('BroadcastChannel not available:', e)\n    }\n\n    return () => {\n      try { if (bcRef.current) bcRef.current.close() } catch (e) {}\n      bcRef.current = null\n    }\n  }, [tabId, activeStatus, playNotificationSound])\n\n  // Initialize WebSocket connection with increased retry attempts\n  const { send } = useWebSocket(handleWebSocketMessage, {\n    onOpen: () => {\n      console.log('WebSocket connected')\n      loadOrders() // Load initial data when connected\n    },\n    onClose: () => console.log('WebSocket disconnected'),\n    onError: (error) => console.error('WebSocket error:', error),\n    autoReconnect: true,\n    maxReconnectAttempts: 20,\n    reconnectInterval: 1000\n  })\n\n  // Store send function in a ref so handleStatusChange can access latest version\n  const sendRef = useRef(send)\n  useEffect(() => {\n    sendRef.current = send\n  }, [send])\n\n  // Load initial data\n  useEffect(() => {\n    loadOrders()\n  }, [])\n\n  const handleStatusChange = async (orderId, action) => {\n    const statusMap = {\n      accept: 'accepted',\n      prepare: 'preparing',\n      prepared: 'prepared',\n      deliver: 'delivering',\n      delivered: 'delivered',\n      decline: 'declined'\n    }\n\n    try {\n      const newStatus = statusMap[action]\n      if (!newStatus) throw new Error('Invalid action')\n\n      const response = await fetch(`/api/orders`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ orderId, status: newStatus }),\n      })\n      \n      if (!response.ok) {\n        throw new Error('Failed to update order status')\n      }\n\n      // Notify server about status change via WebSocket\n      try {\n        sendRef.current({\n          type: 'order:status-changed',\n          orderId,\n          status: newStatus,\n          token: 'your-auth-token', // Replace with actual auth token\n          timestamp: Date.now()\n        })\n      } catch (e) {\n        console.error('Failed to send WebSocket message:', e)\n      }\n      // Also broadcast locally to other tabs so they update immediately\n      try {\n        if (bcRef.current) {\n          bcRef.current.postMessage({ type: 'order:status-changed', orderId, status: newStatus, sourceTab: tabId })\n        }\n      } catch (e) {\n        // ignore\n      }\n      // HTTP fallback: notify WS server via its absolute URL so it broadcasts to all connected clients\n      try {\n        const protocol = window.location.protocol === 'https:' ? 'https:' : 'http:'\n        const wsBroadcastUrl = `${protocol}//localhost:3002/internal/ws/broadcast`\n        fetch(wsBroadcastUrl, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ type: 'order:status-changed', orderId, status: newStatus, sourceTab: tabId })\n        }).then(res => {\n          if (!res.ok) console.warn('HTTP broadcast to WS server failed')\n        }).catch(err => console.warn('HTTP broadcast error', err))\n      } catch (e) {\n        console.warn('Failed to POST broadcast to WS server:', e)\n      }\n      \n      await loadOrders() // Refresh orders after update\n    } catch (error) {\n      console.error('Failed to update order status:', error)\n    }\n  }\n\n  const handleCall = (phone) => {\n    window.location.href = `tel:${phone}`\n  }\n\n  const filteredOrders = orders.filter(order => {\n    const matchesStatus = activeStatus === 'all' || order.status === activeStatus\n    const matchesSearch = searchQuery === '' || \n      order._id.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      (order.name || '').toLowerCase().includes(searchQuery.toLowerCase())\n    if (!matchesStatus || !matchesSearch) return false\n\n    // If viewing Delivered orders, only show orders from today\n    if (activeStatus === 'delivered') {\n      try {\n        const created = new Date(order.createdAt)\n        const now = new Date()\n        if (\n          created.getFullYear() !== now.getFullYear() ||\n          created.getMonth() !== now.getMonth() ||\n          created.getDate() !== now.getDate()\n        ) {\n          return false\n        }\n      } catch (e) {\n        // If createdAt is invalid, skip the order from delivered list\n        return false\n      }\n    }\n\n    return true\n  })\n\n  const getStatusCounts = () => {\n    const counts = { all: orders.length }\n    orders.forEach(order => {\n      counts[order.status] = (counts[order.status] || 0) + 1\n    })\n    return counts\n  }\n\n  const statusCounts = getStatusCounts()\n  const [showCardIcons, setShowCardIcons] = useState(true)\n\n  // Mobile menu component defined inside OrdersPage so it can access handlers\n  function MobileMenu() {\n    const [open, setOpen] = useState(false)\n    return (\n      <div className=\"relative\">\n        <button\n          aria-haspopup=\"true\"\n          aria-expanded={open}\n          onClick={() => setOpen(v => !v)}\n          className=\"inline-flex items-center gap-2 rounded-lg p-2 text-neutral-700 bg-white border border-neutral-200 hover:bg-neutral-50\"\n        >\n          <Menu className=\"w-5 h-5\" />\n        </button>\n\n        {open && (\n          <div className=\"absolute right-0 mt-2 w-44 bg-white border border-neutral-200 rounded-md shadow-lg z-50\">\n            <button\n              onClick={() => { setOpen(false); loadOrders() }}\n              className=\"w-full text-left px-3 py-2 text-sm hover:bg-neutral-50\"\n            >\n              Refresh\n            </button>\n            <button\n              onClick={() => { setOpen(false); window.location.href = '/Orders/history' }}\n              className=\"w-full text-left px-3 py-2 text-sm hover:bg-neutral-50\"\n            >\n              History\n            </button>\n            <button\n              onClick={async () => {\n                setOpen(false)\n                try {\n                  await fetch('/api/auth/logout', { method: 'POST', credentials: 'same-origin' })\n                } catch (e) {\n                  console.error('Logout request failed', e)\n                } finally {\n                  window.location.href = '/84588878l00o00g00i00n76580982'\n                }\n              }}\n              className=\"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50\"\n            >\n              Logout\n            </button>\n          </div>\n                    \n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50\">\n      <header className=\"sticky top-0 z-30 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b border-neutral-200/80\">\n        <div className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-3\">\n              {restaurant?.logo ? (\n                <div className=\"relative h-8 w-8 rounded-lg overflow-hidden flex-shrink-0\">\n                  <Image\n                    src={restaurant.logo}\n                    alt={restaurant.name || 'Restaurant Logo'}\n                    fill\n                    className=\"object-contain\"\n                    onError={(e) => {\n                      e.target.style.display = 'none'\n                      e.target.nextSibling.style.display = 'flex'\n                    }}\n                  />\n                  <div className=\"hidden h-8 w-8 rounded-lg bg-neutral-900 text-white items-center justify-center tracking-tight text-sm font-medium select-none\">OD</div>\n                </div>\n              ) : (\n                <div className=\"h-8 w-8 rounded-lg bg-neutral-900 text-white flex items-center justify-center tracking-tight text-sm font-medium select-none\">OD</div>\n              )}\n              <div className=\"flex flex-col\">\n                <h1 className=\"text-[22px] leading-6 tracking-tight font-semibold\">Order Dashboard</h1>\n                <p className=\"text-xs text-neutral-500\">Monitor, filter, and manage live orders</p>\n              </div>\n            </div>\n\n            <div className=\"hidden md:flex items-center gap-3\">\n              <button\n                onClick={loadOrders}\n                className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"\n              >\n                <RefreshCcw className=\"w-4 h-4\" />\n                Refresh\n              </button>\n\n              {/* History placeholder button - navigates to /Orders/history when route is added */}\n              <button\n                onClick={() => { window.location.href = '/Orders/history' }}\n                className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"\n              >\n                <Clock className=\"w-4 h-4\" />\n                History\n              </button>\n              <button\n                onClick={async () => {\n                  try {\n                    await fetch('/api/auth/logout', { method: 'POST', credentials: 'same-origin' })\n                  } catch (e) {\n                    console.error('Logout request failed', e)\n                  } finally {\n                    // Force navigation to login page which will require fresh auth\n                    window.location.href = '/84588878l00o00g00i00n76580982'\n                  }\n                }}\n                className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-red-700 bg-white hover:bg-red-50 border border-red-200 hover:border-red-300 transition-colors\"\n              >\n                Logout\n              </button>\n            </div>\n            <div className=\"md:hidden relative\">\n              <MobileMenu />\n            </div>            \n          </div>\n\n          <div className=\"py-3\">\n            <div className=\"flex flex-col lg:flex-row lg:items-center gap-3\">\n              <div className=\"flex-1\">\n                <label className=\"relative block\">\n                  <span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-neutral-400\">\n                    <Search className=\"w-4 h-4\" />\n                  </span>\n                  <input\n                    type=\"text\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    placeholder=\"Search by order #ID or customer name...\"\n                    className=\"block w-full rounded-lg border border-neutral-200 bg-white py-2 pl-9 pr-3 placeholder:text-neutral-400 hover:border-neutral-300 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-neutral-900/10 text-sm\"\n                  />\n                </label>\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <div className=\"flex items-center gap-2 min-w-max\">\n                  {STATUS_PILLS.map((status) => (\n                    <button\n                      key={status.value}\n                      onClick={() => setActiveStatus(status.value)}\n                      className={`inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm transition-colors ${\n                        activeStatus === status.value\n                          ? 'bg-neutral-900 text-white border border-neutral-900'\n                          : 'bg-white text-neutral-700 border border-neutral-200 hover:border-neutral-300'\n                      }`}\n                    >\n                      {status.label}\n                      <span className=\"rounded-full bg-white/20 px-1.5 py-0.5 text-xs\">\n                        {statusCounts[status.value] || 0}\n                      </span>\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6\">\n        <section className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-3 mb-6\">\n          <div className=\"rounded-xl border border-neutral-200 bg-white px-4 py-3 shadow-sm hover:shadow-md transition\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs uppercase tracking-wide text-neutral-500\">All</span>\n              <span className=\"w-4 h-4\" />\n            </div>\n            <div className=\"mt-1 text-2xl tracking-tight font-semibold\">\n              {statusCounts.all || 0}\n            </div>\n          </div>\n          {STATUS_PILLS.slice(1).map((status) => (\n            <div key={status.value} className=\"rounded-xl border border-neutral-200 bg-white px-4 py-3 shadow-sm hover:shadow-md transition\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs uppercase tracking-wide text-neutral-500\">\n                  {status.label}\n                </span>\n                <span className={`h-2 w-2 rounded-full ${\n                  STATUS_STYLES[status.value]?.dot || 'bg-neutral-400 ring-neutral-300'\n                }`} />\n              </div>\n              <div className=\"mt-1 text-2xl tracking-tight font-semibold\">\n                {statusCounts[status.value] || 0}\n              </div>\n            </div>\n          ))}\n        </section>\n\n        <section className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {loading ? (\n            <div className=\"col-span-full text-center py-12 text-neutral-500\">\n              Loading orders...\n            </div>\n          ) : filteredOrders.length === 0 ? (\n            <div className=\"col-span-full text-center py-12 text-neutral-500\">\n              No orders found\n            </div>\n          ) : (\n            filteredOrders.map((order) => (\n              <OrderCard\n                key={order._id}\n                order={order}\n                onAction={handleStatusChange}\n              />\n            ))\n          )}\n        </section>\n\n        <div className=\"mt-8 border-t border-neutral-200/80 pt-4 text-xs text-neutral-500\">\n          Tip: Use the status pills to focus on a stage, and search by #ID or name.\n        </div>\n      </main>\n    </div>\n  )\n}","size_bytes":20543},"src/app/admin/profile/page.jsx":{"content":"import RestaurantProfileClient from '@/components/RestaurantProfile/RestaurantProfileClient'\n\nexport default function ProfilePage() {\n  return (\n    <div>\n      <RestaurantProfileClient />\n    </div>\n  )\n}\n\n","size_bytes":207},"src/components/Customer/menu.jsx":{"content":"\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport ProductCard from '@/components/Menu/ProductCard';\nimport { colors, buttons } from \"@/constants/colors\";\n\nexport default function Menu() {\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    let mounted = true;\n    const fetchMenu = async () => {\n      try {\n        const res = await fetch('/api/menu');\n        const json = await res.json();\n        if (!res.ok || !json.success) throw new Error(json.error || 'Failed to fetch menu');\n        // `json.data` is expected to be array of { category, image, items }\n        const flattened = (json.data || []).flatMap((group) => {\n          const categoryName = group.category || '';\n          return (group.items || []).map((it) => ({ ...it, _categoryName: categoryName }));\n        });\n        if (mounted) setItems(flattened);\n      } catch (err) {\n        console.error('fetchMenu error', err);\n        if (mounted) setError('Failed to load menu');\n      } finally {\n        if (mounted) setLoading(false);\n      }\n    };\n\n    fetchMenu();\n    return () => { mounted = false; };\n  }, []);\n\n  // styles\n  const cardBg = \"#ffffff\"; // keep cards white for contrast\n  const accent = colors?.primary || '#1EB980';\n  const btnText = (buttons && buttons.primary && buttons.primary.text) || '#031017';\n\n  return (\n    <section className=\"px-4 sm:px-6 lg:px-8 py-8\">\n      <div className=\"mx-auto max-w-7xl\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-2xl font-semibold\" style={{ color: colors.textDark }}>Explore Menu</h3>\n          <Link href=\"/menu\" className=\"text-sm font-semibold uppercase\" style={{ color: accent }}>View All</Link>\n        </div>\n\n        {loading ? (\n          <div className=\"text-center text-neutral-400 py-12\">Loading menu…</div>\n        ) : error ? (\n          <div className=\"text-center text-red-500 py-12\">{error}</div>\n        ) : items.length === 0 ? (\n          <div className=\"text-center text-neutral-400 py-12\">No items available</div>\n        ) : (\n          <div className=\"relative\">\n            <div className=\"overflow-x-auto no-scrollbar -mx-2 px-2\">\n              <div className=\"flex gap-6\" style={{ paddingBottom: 4 }}>\n                {items.map((product) => (\n                  <div key={product._id} className=\"min-w-[220px] max-w-[260px] flex-shrink-0\">\n                    <ProductCard product={product} />\n                  </div>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </section>\n  );\n}\n","size_bytes":2708},"src/models/User.js":{"content":"import mongoose from 'mongoose'\n\nconst userSchema = new mongoose.Schema({\n  restaurantId: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Restaurant',\n    required: true,\n    index: true\n  },\n  firstName: {\n    type: String,\n    required: true\n  },\n  lastName: {\n    type: String,\n    required: true\n  },\n  email: {\n    type: String,\n    required: true,\n    index: true\n  },\n  passwordHash: {\n    type: String,\n    required: true\n  },\n  role: {\n    type: String,\n    enum: ['super_admin', 'employee', 'rider', 'waiter', 'kitchen'],\n    required: true\n  },\n  branch: {\n    type: String,\n    default: '' // Empty string for Global users, branch name for specific branch users\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  __v: {\n    type: Number,\n    select: false\n  }\n})\n\n// Compound unique index: email must be unique per restaurantId and branch\nuserSchema.index({ restaurantId: 1, email: 1, branch: 1 }, { unique: true })\n// Index for querying by branch\nuserSchema.index({ restaurantId: 1, branch: 1 })\n\nexport const User = mongoose.models.User || mongoose.model('User', userSchema)","size_bytes":1108},"src/components/Customer/Header.jsx":{"content":"\"use client\";\nimport { useState, useEffect } from 'react';\nimport { createPortal } from 'react-dom';\nimport Link from 'next/link';\nimport Image from 'next/image';\nimport { Menu, X, UtensilsCrossed, Home, MapPin, Phone, Gift, MessageCircle } from 'lucide-react';\nimport { colors } from '@/constants/colors';\nimport { useRestaurant } from '@/hooks/useRestaurant';\n\nexport default function Header({ handleSmoothScroll }) {\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n  const [isScrolled, setIsScrolled] = useState(false);\n  const [mounted, setMounted] = useState(false);\n  const { restaurant, loading } = useRestaurant();\n\n  useEffect(() => {\n    setMounted(true);\n    const handleScroll = () => {\n      setIsScrolled(window.scrollY > 8);\n    };\n    handleScroll();\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, []);\n\n  const toggleMobileMenu = () => {\n    setIsMobileMenuOpen(!isMobileMenuOpen);\n  };\n\n  return (\n    <header \n      id=\"siteHeader\" \n      className={`fixed inset-x-0 top-0 z-50 transition-all duration-300 ${isScrolled ? 'drop-shadow-lg backdrop-blur-xl' : 'backdrop-blur-sm'}`}\n      style={{ \n        backgroundColor: isScrolled ? `${colors.bgSec}ee` : `${colors.bgPrimary}dd`, \n        color: colors.textDark,\n        borderBottom: `1px solid ${isScrolled ? colors.border : colors.borderLight}`\n      }}\n    >\n      <div className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8\">\n        <nav \n          id=\"navBar\" \n          className=\"flex items-center justify-between rounded-b-2xl px-4 sm:px-6 py-2.5 transition-all duration-300\" \n          style={{ \n            background: 'transparent'\n          }}\n        >\n          <Link \n            href=\"/\" \n            className=\"group inline-flex items-center gap-2.5 transition-transform hover:scale-105\"\n          >\n            {restaurant?.logo ? (\n              <div className=\"relative h-12 w-12 sm:h-14 sm:w-14 md:h-16 md:w-16 rounded-xl overflow-hidden flex-shrink-0 shadow-lg ring-2 ring-white/10 group-hover:ring-white/20 transition-all duration-300\">\n                <Image\n                  src={restaurant.logo}\n                  alt={restaurant.name || 'Restaurant Logo'}\n                  fill\n                  className=\"object-contain p-1.5\"\n                  onError={(e) => {\n                    const img = e.target\n                    img.style.display = 'none'\n                    const fallback = img.parentElement.querySelector('.logo-fallback')\n                    if (fallback) fallback.style.display = 'flex'\n                  }}\n                />\n                <span className=\"logo-fallback hidden absolute inset-0 relative inline-flex items-center justify-center\">\n                  <UtensilsCrossed className=\"h-6 w-6 sm:h-7 sm:w-7\" style={{ color: colors.primary }} />\n                </span>\n              </div>\n            ) : (\n              <div className=\"relative h-12 w-12 sm:h-14 sm:w-14 md:h-16 md:w-16 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg ring-2 ring-white/10 group-hover:ring-white/20 transition-all duration-300\"\n                   style={{ background: `linear-gradient(135deg, ${colors.primary}22, ${colors.secondary}22)` }}>\n                <UtensilsCrossed className=\"h-6 w-6 sm:h-7 sm:w-7 md:h-8 md:w-8\" style={{ color: colors.primary }} />\n              </div>\n            )}\n            {restaurant?.name && (\n              <span className=\"hidden sm:block text-base sm:text-lg font-bold bg-gradient-to-r from-white to-white/80 bg-clip-text text-transparent\">\n                {restaurant.name}\n              </span>\n            )}\n          </Link>\n\n          <div className=\"hidden items-center gap-1 md:flex\">\n            <Link \n              href=\"#home\" \n              className=\"relative px-4 py-2 text-sm font-medium transition-all duration-200 rounded-lg hover:bg-white/5 group\" \n              style={{ color: colors.textDark }} \n              onClick={(e) => handleSmoothScroll(e, '#home')}\n              onMouseEnter={(e) => { e.target.style.color = colors.primary; }}\n              onMouseLeave={(e) => { e.target.style.color = colors.textDark; }}\n            >\n              <span className=\"relative z-10\">Home</span>\n              <span className=\"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></span>\n            </Link>\n            <Link \n              href=\"/menu\" \n              className=\"relative px-4 py-2 text-sm font-medium transition-all duration-200 rounded-lg hover:bg-white/5 group\" \n              style={{ color: colors.textDark }} \n              onMouseEnter={(e) => { e.target.style.color = colors.primary; }}\n              onMouseLeave={(e) => { e.target.style.color = colors.textDark; }}\n            >\n              <span className=\"relative z-10\">Menu</span>\n              <span className=\"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></span>\n            </Link>\n            <Link \n              href=\"/#deals\" \n              className=\"relative px-4 py-2 text-sm font-medium transition-all duration-200 rounded-lg hover:bg-white/5 group\" \n              style={{ color: colors.textDark }} \n              onMouseEnter={(e) => { e.target.style.color = colors.primary; }}\n              onMouseLeave={(e) => { e.target.style.color = colors.textDark; }}\n              onClick={(e) => handleSmoothScroll(e, '#deals')}\n            >\n              <span className=\"relative z-10\">Deals</span>\n              <span className=\"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></span>\n            </Link>\n            <Link \n              href=\"/#location\" \n              className=\"relative px-4 py-2 text-sm font-medium transition-all duration-200 rounded-lg hover:bg-white/5 group\" \n              style={{ color: colors.textDark }} \n              onMouseEnter={(e) => { e.target.style.color = colors.primary; }}\n              onMouseLeave={(e) => { e.target.style.color = colors.textDark; }}\n              onClick={(e) => handleSmoothScroll(e, '#location')}\n            >\n              <span className=\"relative z-10\">Location</span>\n              <span className=\"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></span>\n            </Link>\n            <Link \n              href=\"/#contact\" \n              className=\"relative px-4 py-2 text-sm font-medium transition-all duration-200 rounded-lg hover:bg-white/5 group\" \n              style={{ color: colors.textDark }} \n              onMouseEnter={(e) => { e.target.style.color = colors.primary; }}\n              onMouseLeave={(e) => { e.target.style.color = colors.textDark; }}\n              onClick={(e) => handleSmoothScroll(e, '#contact')}\n            >\n              <span className=\"relative z-10\">Contact</span>\n              <span className=\"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></span>\n            </Link>\n            <Link \n              href=\"/menu\" \n              className=\"ml-2 inline-flex items-center gap-2 rounded-full px-5 py-2.5 text-sm font-semibold text-white shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-xl focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-black\" \n              style={{ \n                background: `linear-gradient(135deg, ${colors.primary}, ${colors.accent})`,\n                letterSpacing: '-0.01em',\n                boxShadow: `0 4px 14px 0 ${colors.primary}40`\n              }}\n            >\n              <UtensilsCrossed className=\"h-4 w-4\" />\n              <span>View Menu</span>\n            </Link>\n          </div>\n\n          <button \n            id=\"mobileMenuBtn\" \n            aria-label=\"Open Menu\" \n            className=\"md:hidden inline-flex items-center justify-center rounded-xl border-2 px-3 py-2 transition-all duration-300 hover:scale-110 hover:shadow-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2\" \n            style={{ \n              color: colors.textDark, \n              borderColor: colors.border,\n              backgroundColor: isMobileMenuOpen ? `${colors.primary}20` : 'transparent'\n            }} \n            onClick={toggleMobileMenu}\n          >\n            {isMobileMenuOpen ? (\n              <X className=\"h-5 w-5 transition-transform duration-300 rotate-90\" style={{ color: colors.primary }} />\n            ) : (\n              <Menu className=\"h-5 w-5 transition-transform duration-300\" />\n            )}\n          </button>\n        </nav>\n      </div>\n\n      {/* Mobile Sidebar - Rendered via Portal outside header */}\n      {mounted && createPortal(\n        <>\n          {/* Mobile Sidebar Overlay */}\n          {isMobileMenuOpen && (\n            <div \n              className=\"md:hidden fixed inset-0 z-[9998] bg-black/80 backdrop-blur-sm transition-opacity duration-300\"\n              onClick={toggleMobileMenu}\n              style={{ top: '0' }}\n            />\n          )}\n\n          {/* Mobile Sidebar Drawer */}\n          <div \n            id=\"mobileDrawer\" \n            className={`md:hidden fixed inset-y-0 right-0 z-[9999] w-80 max-w-[85vw] transform transition-transform duration-300 ease-out ${\n              isMobileMenuOpen ? 'translate-x-0' : 'translate-x-full'\n            }`}\n            style={{ top: '0', backgroundColor: colors.bgPrimary, pointerEvents: isMobileMenuOpen ? 'auto' : 'none' }}\n          >\n            <div \n              className=\"h-full flex flex-col rounded-tl-3xl border-l border-t shadow-2xl overflow-hidden\" \n              style={{ \n                borderColor: colors.borderLight,\n                backgroundColor: colors.bgPrimary\n              }}\n            >\n              {/* Sidebar Header */}\n              <div className=\"px-6 py-5 border-b\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgPrimary }}>\n                <div className=\"flex items-center justify-between\">\n                  <h2 className=\"text-xl font-bold\" style={{ color: colors.textDark }}>\n                    Menu\n                  </h2>\n                  <button\n                    onClick={toggleMobileMenu}\n                    className=\"p-2 rounded-lg hover:bg-white/10 transition-colors\"\n                    aria-label=\"Close Menu\"\n                    style={{ color: colors.textDark }}\n                  >\n                    <X className=\"h-5 w-5\" style={{ color: colors.textDark }} />\n                  </button>\n                </div>\n              </div>\n\n              {/* Navigation Links */}\n              <nav className=\"flex-1 overflow-y-auto px-4 py-6 space-y-2\" style={{ backgroundColor: colors.bgPrimary }}>\n                <Link \n                  href=\"/\" \n                  className=\"flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-medium transition-all duration-200 hover:scale-[1.02] group border\" \n                  style={{ \n                    color: colors.textDark,\n                    borderColor: colors.borderLight,\n                    backgroundColor: colors.bgPrimary\n                  }} \n                  onClick={(e) => { toggleMobileMenu(); handleSmoothScroll(e, '#home'); }}\n                  onMouseEnter={(e) => { \n                    e.currentTarget.style.backgroundColor = `${colors.primary}20`; \n                    e.currentTarget.style.color = colors.primary;\n                    e.currentTarget.style.borderColor = colors.primary;\n                  }} \n                  onMouseLeave={(e) => { \n                    e.currentTarget.style.backgroundColor = colors.bgPrimary; \n                    e.currentTarget.style.color = colors.textDark;\n                    e.currentTarget.style.borderColor = colors.borderLight;\n                  }}\n                >\n                  <Home className=\"h-5 w-5 transition-transform group-hover:scale-110\" style={{ color: 'inherit' }} />\n                  <span>Home</span>\n                </Link>\n                \n                <Link \n                  href=\"/menu\" \n                  className=\"flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-medium transition-all duration-200 hover:scale-[1.02] group border\" \n                  style={{ \n                    color: colors.textDark,\n                    borderColor: colors.borderLight,\n                    backgroundColor: colors.bgPrimary\n                  }} \n                  onClick={toggleMobileMenu}\n                  onMouseEnter={(e) => { \n                    e.currentTarget.style.backgroundColor = `${colors.primary}20`; \n                    e.currentTarget.style.color = colors.primary;\n                    e.currentTarget.style.borderColor = colors.primary;\n                  }} \n                  onMouseLeave={(e) => { \n                    e.currentTarget.style.backgroundColor = colors.bgPrimary; \n                    e.currentTarget.style.color = colors.textDark;\n                    e.currentTarget.style.borderColor = colors.borderLight;\n                  }}\n                >\n                  <UtensilsCrossed className=\"h-5 w-5 transition-transform group-hover:scale-110\" style={{ color: 'inherit' }} />\n                  <span>Menu</span>\n                </Link>\n                \n                <Link \n                  href=\"#deals\" \n                  className=\"flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-medium transition-all duration-200 hover:scale-[1.02] group border\" \n                  style={{ \n                    color: colors.textDark,\n                    borderColor: colors.borderLight,\n                    backgroundColor: colors.bgPrimary\n                  }} \n                  onClick={(e) => { toggleMobileMenu(); handleSmoothScroll(e, '#deals'); }}\n                  onMouseEnter={(e) => { \n                    e.currentTarget.style.backgroundColor = `${colors.primary}20`; \n                    e.currentTarget.style.color = colors.primary;\n                    e.currentTarget.style.borderColor = colors.primary;\n                  }} \n                  onMouseLeave={(e) => { \n                    e.currentTarget.style.backgroundColor = colors.bgPrimary; \n                    e.currentTarget.style.color = colors.textDark;\n                    e.currentTarget.style.borderColor = colors.borderLight;\n                  }}\n                >\n                  <Gift className=\"h-5 w-5 transition-transform group-hover:scale-110\" style={{ color: 'inherit' }} />\n                  <span>Deals</span>\n                </Link>\n                \n                <Link \n                  href=\"#location\" \n                  className=\"flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-medium transition-all duration-200 hover:scale-[1.02] group border\" \n                  style={{ \n                    color: colors.textDark,\n                    borderColor: colors.borderLight,\n                    backgroundColor: colors.bgPrimary\n                  }} \n                  onClick={(e) => { toggleMobileMenu(); handleSmoothScroll(e, '#location'); }}\n                  onMouseEnter={(e) => { \n                    e.currentTarget.style.backgroundColor = `${colors.primary}20`; \n                    e.currentTarget.style.color = colors.primary;\n                    e.currentTarget.style.borderColor = colors.primary;\n                  }} \n                  onMouseLeave={(e) => { \n                    e.currentTarget.style.backgroundColor = colors.bgPrimary; \n                    e.currentTarget.style.color = colors.textDark;\n                    e.currentTarget.style.borderColor = colors.borderLight;\n                  }}\n                >\n                  <MapPin className=\"h-5 w-5 transition-transform group-hover:scale-110\" style={{ color: 'inherit' }} />\n                  <span>Location</span>\n                </Link>\n                \n                <Link \n                  href=\"#contact\" \n                  className=\"flex items-center gap-4 px-4 py-3.5 rounded-xl text-sm font-medium transition-all duration-200 hover:scale-[1.02] group border\" \n                  style={{ \n                    color: colors.textDark,\n                    borderColor: colors.borderLight,\n                    backgroundColor: colors.bgPrimary\n                  }} \n                  onClick={(e) => { toggleMobileMenu(); handleSmoothScroll(e, '#contact'); }}\n                  onMouseEnter={(e) => { \n                    e.currentTarget.style.backgroundColor = `${colors.primary}20`; \n                    e.currentTarget.style.color = colors.primary;\n                    e.currentTarget.style.borderColor = colors.primary;\n                  }} \n                  onMouseLeave={(e) => { \n                    e.currentTarget.style.backgroundColor = colors.bgPrimary; \n                    e.currentTarget.style.color = colors.textDark;\n                    e.currentTarget.style.borderColor = colors.borderLight;\n                  }}\n                >\n                  <Phone className=\"h-5 w-5 transition-transform group-hover:scale-110\" style={{ color: 'inherit' }} />\n                  <span>Contact</span>\n                </Link>\n              </nav>\n\n              {/* Sidebar Footer Actions */}\n              <div className=\"px-4 pb-6 pt-4 space-y-3 border-t\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgPrimary }}>\n                <Link \n                  href=\"/menu\" \n                  className=\"w-full inline-flex items-center justify-center gap-2 rounded-xl px-5 py-3.5 text-sm font-semibold text-white shadow-lg transition-all duration-300 hover:scale-105 active:scale-95\" \n                  style={{ \n                    background: `linear-gradient(135deg, ${colors.primary}, ${colors.accent})`,\n                    boxShadow: `0 4px 14px 0 ${colors.primary}40`\n                  }}\n                  onClick={toggleMobileMenu}\n                >\n                  <UtensilsCrossed className=\"h-5 w-5\" />\n                  <span>View Menu</span>\n                </Link>\n                \n                <a \n                  href=\"https://wa.me/923236300813?text=Hi%20Baltit%20Wok%2C%20I%27d%20like%20to%20order.\" \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  className=\"w-full inline-flex items-center justify-center gap-2 rounded-xl border-2 px-5 py-3.5 text-sm font-semibold transition-all duration-300 hover:scale-105 active:scale-95\" \n                  style={{ \n                    borderColor: colors.borderLight, \n                    color: colors.textDark,\n                    backgroundColor: colors.bgPrimary\n                  }}\n                  onMouseEnter={(e) => { \n                    e.currentTarget.style.borderColor = colors.primary; \n                    e.currentTarget.style.color = colors.primary;\n                    e.currentTarget.style.backgroundColor = `${colors.primary}20`;\n                  }} \n                  onMouseLeave={(e) => { \n                    e.currentTarget.style.borderColor = colors.borderLight; \n                    e.currentTarget.style.color = colors.textDark;\n                    e.currentTarget.style.backgroundColor = colors.bgPrimary;\n                  }}\n                >\n                  <MessageCircle className=\"h-5 w-5\" />\n                  <span>Order Now</span>\n                </a>\n              </div>\n            </div>\n          </div>\n        </>,\n        document.body\n      )}\n    </header>\n  );\n}","size_bytes":19810},"src/constants/colors.js":{"content":"export const colors = {\n  primary: \"#1EB980\",        // accent / action color (green)\n  secondary: \"#7C5CFF\",      // accent 2 (purple)\n  accent: \"#06D6A0\",         // supporting accent\n  textDark: \"#ffffffff\",       // primary text on dark bg\n  textMuted: \"#94A3B8\",      // secondary/muted text\n  bgPrimary: \"#000000ff\",\n  bgSec: \"#130e0eff\",      // secondary background (dark)\n  surface: \"#0F1724\",        // card / overlay surface\n  border: \"rgba(255,255,255,0.06)\",\n  borderLight: \"rgba(255,255,255,0.03)\",\n  tintPrimary: \"rgba(30,185,128,0.12)\",\n  tintSecondary: \"rgba(124,92,255,0.10)\",\n  tintAccent: \"rgba(6,214,160,0.10)\",\n};\n\nexport const buttons = {\n  primary: {\n    background: colors.primary,\n    text: \"#031017\",\n    hover: \"#5a16c7ff\",\n  },\n  secondary: {\n    background: colors.secondary,\n    text: \"#FFFFFF\",\n    hover: \"#6950E6\",\n  },\n  accent: {\n    background: colors.accent,\n    text: \"#031017\",\n    hover: \"#05C196\",\n  },\n  outline: {\n    background: \"transparent\",\n    text: colors.textDark,\n    border: colors.border,\n    hover: colors.primary,\n  },\n};\n\nexport const iconBackgrounds = {\n  primary: colors.tintPrimary,\n  secondary: colors.tintSecondary,\n  accent: colors.tintAccent,\n};\n","size_bytes":1210},"src/components/Checkout/Map.jsx":{"content":"// components/Map.jsx\n'use client'\n\nimport { useEffect, useRef } from 'react'\nimport 'leaflet/dist/leaflet.css'\n\nexport default function Map({ onLocationChange }) {\n  const mapRef = useRef(null)\n  const onLocationChangeRef = useRef(onLocationChange)\n\n  // keep latest callback without re-running the map init effect\n  useEffect(() => {\n    onLocationChangeRef.current = onLocationChange\n  }, [onLocationChange])\n\n  useEffect(() => {\n    const L = require('leaflet')\n    if (!mapRef.current) return\n\n    // Fix Leaflet's default icon URLs so the browser doesn't try to load\n    // local files like /marker-icon.png which result in 404s when using\n    // Next.js. Point to CDN-hosted images instead.\n    try {\n      delete L.Icon.Default.prototype._getIconUrl\n      L.Icon.Default.mergeOptions({\n        iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\n        iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\n        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n      })\n    } catch (err) {\n      // ignore if merge fails for any reason\n      console.warn('Could not set Leaflet icon URLs:', err)\n    }\n\n    const DEFAULT_LAT = 33.6518\n    const DEFAULT_LNG = 73.0282\n    const DEFAULT_ZOOM = 13\n\n    const map = L.map(mapRef.current).setView([DEFAULT_LAT, DEFAULT_LNG], DEFAULT_ZOOM)\n\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '© OpenStreetMap contributors'\n    }).addTo(map)\n\n    const marker = L.marker([DEFAULT_LAT, DEFAULT_LNG], { draggable: true }).addTo(map)\n\n    const reverseGeocodeAndNotify = async (lat, lng) => {\n      try {\n        const response = await fetch(\n          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`\n        )\n        const data = await response.json()\n        const address = data && data.display_name ? data.display_name : `${lat.toFixed(4)}, ${lng.toFixed(4)}`\n        if (onLocationChangeRef.current) onLocationChangeRef.current(address, { lat, lng })\n      } catch (err) {\n        console.error('Reverse geocoding failed:', err)\n        if (onLocationChangeRef.current) onLocationChangeRef.current(`${lat.toFixed(4)}, ${lng.toFixed(4)}`, { lat, lng })\n      }\n    }\n\n    marker.on('dragend', () => {\n      const pos = marker.getLatLng()\n      reverseGeocodeAndNotify(pos.lat, pos.lng)\n    })\n\n    // Try to use the user's current location if permission is granted\n    if (typeof navigator !== 'undefined' && navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          const lat = position.coords.latitude\n          const lng = position.coords.longitude\n          map.setView([lat, lng], DEFAULT_ZOOM)\n          marker.setLatLng([lat, lng])\n          reverseGeocodeAndNotify(lat, lng)\n        },\n        (err) => {\n          // User denied or other error: keep default location\n          // console.warn('Geolocation error:', err)\n        }\n      )\n    }\n\n    return () => {\n      map.remove()\n    }\n  }, [])\n\n  return <div ref={mapRef} id=\"map\" className=\"h-[300px] w-full rounded-xl mb-3\" />\n}","size_bytes":3194},"src/components/AdminDashboard/RecentOrdersTable.jsx":{"content":"'use client'\n\nfunction fmtCurrency(v) {\n  return v.toLocaleString(undefined, { style: 'currency', currency: 'PKR', maximumFractionDigits: 2 })\n}\n\nexport default function RecentOrdersTable({ orders = [], menuItems = [], loading }) {\n  // Helper function to resolve menuItemId to menu item name\n  const getMenuItemName = (menuItemId) => {\n    if (!menuItemId) return 'Unknown'\n    \n    // Normalize menuItemId to string for comparison\n    let normalizedMenuItemId = menuItemId\n    if (typeof menuItemId === 'object') {\n      if (menuItemId.$oid) {\n        normalizedMenuItemId = menuItemId.$oid\n      } else {\n        normalizedMenuItemId = menuItemId.toString?.() || String(menuItemId)\n      }\n    } else {\n      normalizedMenuItemId = String(menuItemId)\n    }\n    \n    // If it's not a 24-character hex string (ObjectId format), assume it's already a name\n    if (!normalizedMenuItemId.match(/^[0-9a-fA-F]{24}$/i)) {\n      return normalizedMenuItemId || 'Unknown'\n    }\n    \n    // Look up in menuItems array\n    const menuItem = menuItems.find(item => {\n      if (!item) return false\n      const itemId = item._id\n      if (!itemId) return false\n      \n      let normalizedItemId = itemId\n      if (typeof itemId === 'object') {\n        if (itemId.$oid) {\n          normalizedItemId = itemId.$oid\n        } else {\n          normalizedItemId = itemId.toString?.() || String(itemId)\n        }\n      } else {\n        normalizedItemId = String(itemId)\n      }\n      \n      return normalizedItemId.toLowerCase() === normalizedMenuItemId.toLowerCase()\n    })\n    \n    return menuItem?.name || 'Unknown'\n  }\n\n  if (loading) return <div className=\"p-6 text-center text-neutral-500\">Loading...</div>\n  if (!orders.length) return <div className=\"p-6 text-center text-neutral-500\">No orders</div>\n\n  return (\n    <table className=\"min-w-full text-sm\">\n      <thead className=\"bg-neutral-50\"><tr className=\"text-left text-neutral-500\"><th className=\"px-4 py-2 font-medium\">Order</th><th className=\"px-4 py-2 font-medium\">Customer</th><th className=\"px-4 py-2 font-medium\">Items</th><th className=\"px-4 py-2 font-medium\">Type</th><th className=\"px-4 py-2 font-medium\">Status</th><th className=\"px-4 py-2 text-right font-medium\">Total</th></tr></thead>\n      <tbody className=\"divide-y divide-neutral-200\">\n        {orders.slice(0,50).map(o => (\n          <tr key={o._id} className=\"hover:bg-neutral-50 transition-colors\"><td className=\"px-4 py-2\"><div className=\"flex items-center gap-2\"><span className=\"text-neutral-900 font-medium\">{o._id}</span></div><div className=\"text-xs text-neutral-500\">{new Date(o.createdAt).toLocaleString()}</div></td><td className=\"px-4 py-2\"><div className=\"flex items-center gap-2\"><div className=\"h-8 w-8 rounded-md bg-neutral-900 text-white border border-neutral-900 flex items-center justify-center text-[11px] font-medium\">{(o.name||'').split(' ').map(n=>n[0]).slice(0,2).join('')}</div><div className=\"min-w-0\"><div className=\"truncate text-neutral-900 font-medium\">{o.name}</div><div className=\"text-xs text-neutral-500 truncate\">{o.email}</div></div></div></td><td className=\"px-4 py-2\"><div className=\"text-neutral-700 truncate-w-[280px]\">{(o.items||[]).map(i=>`${getMenuItemName(i.menuItemId) || i.menuItem || i.name || 'Unknown'} x${i.quantity||1}`).join(', ')}</div></td><td className=\"px-4 py-2\"><span className={`text-xs px-2 py-1 rounded border ${o.type==='pickup' ? 'bg-neutral-100 text-neutral-900 border-neutral-300':'bg-neutral-100 text-neutral-900 border-neutral-300'}`}>{o.type}</span></td><td className=\"px-4 py-2\"><span className=\"text-xs px-2 py-1 rounded border bg-neutral-900 text-white border-neutral-900\">{o.status}</span></td><td className=\"px-4 py-2 text-right\"><span className=\"text-neutral-900 font-medium\">{fmtCurrency(o.total||0)}</span></td></tr>\n        ))}\n      </tbody>\n    </table>\n  )\n}\n\n","size_bytes":3849},"src/hooks/useWebSocket.js":{"content":"import { useEffect, useRef, useCallback, useState } from 'react'\n\n// This hook now uses a single global WebSocket instance (attached to window)\n// so HMR / Fast Refresh won't create/tear down sockets repeatedly.\n// Each hook instance registers its message/onopen/onclose handlers into\n// global Sets. When no listeners remain, the socket is closed.\nexport function useWebSocket(onMessage, options = {}) {\n  const localListenerRef = useRef(null)\n  const [isConnected, setIsConnected] = useState(false)\n\n  const {\n    autoReconnect = true,\n    reconnectInterval = 1000,\n    maxReconnectAttempts = 50,\n    onOpen,\n    onClose,\n    onError\n  } = options\n\n  // Ensure globals exist\n  if (typeof window !== 'undefined') {\n    if (!window.__REST_WS__) {\n      window.__REST_WS__ = {\n        socket: null,\n        listeners: new Set(),\n        onOpenHandlers: new Set(),\n        onCloseHandlers: new Set(),\n        onErrorHandlers: new Set(),\n        reconnectAttempts: 0,\n        reconnectTimer: null,\n        pingTimer: null,\n        connecting: false\n      }\n    }\n  }\n\n  const createGlobalSocket = useCallback(() => {\n    if (typeof window === 'undefined') return\n\n    const globalState = window.__REST_WS__\n    if (globalState.socket && (globalState.socket.readyState === WebSocket.OPEN || globalState.socket.readyState === WebSocket.CONNECTING)) {\n      return globalState.socket\n    }\n\n    if (globalState.connecting) return\n    globalState.connecting = true\n\n    try {\n      const isSecure = window.location.protocol === 'https:'\n      const protocol = isSecure ? 'wss:' : 'ws:'\n      // Use the same host and port as the main application\n      const wsUrl = `${protocol}//${window.location.host}/api/ws`\n\n      console.debug('[useWebSocket] creating global socket ->', wsUrl)\n      const ws = new WebSocket(wsUrl)\n      globalState.socket = ws\n\n      ws.onopen = (event) => {\n        globalState.connecting = false\n        globalState.reconnectAttempts = 0\n        console.info('[useWebSocket] global socket open')\n        // start keepalive ping every 25s\n        if (globalState.pingTimer) clearInterval(globalState.pingTimer)\n        globalState.pingTimer = setInterval(() => {\n          try {\n            if (globalState.socket && globalState.socket.readyState === WebSocket.OPEN) {\n              globalState.socket.send(JSON.stringify({ type: '__ping__', ts: Date.now() }))\n            }\n          } catch (e) {\n            // ignore\n          }\n        }, 25000)\n\n        globalState.onOpenHandlers.forEach(h => {\n          try { h(event) } catch (e) { console.error('onOpen handler error', e) }\n        })\n      }\n\n      ws.onmessage = (event) => {\n        let parsed = null\n        try { parsed = event.data ? JSON.parse(event.data) : null } catch (e) { console.warn('[useWebSocket] failed to parse message', e) }\n        globalState.listeners.forEach(fn => {\n          try { fn(parsed) } catch (e) { console.error('listener error', e) }\n        })\n      }\n\n      ws.onerror = (err) => {\n        console.warn('[useWebSocket] global socket error', err)\n        globalState.onErrorHandlers.forEach(h => { try { h(err) } catch (e) { /* ignore */ } })\n      }\n\n      ws.onclose = (event) => {\n        console.warn('[useWebSocket] global socket closed', { code: event.code, reason: event.reason })\n        // clear ping\n        if (globalState.pingTimer) {\n          clearInterval(globalState.pingTimer)\n          globalState.pingTimer = null\n        }\n\n        globalState.onCloseHandlers.forEach(h => { try { h(event) } catch (e) { /* ignore */ } })\n\n        // schedule reconnect if still have listeners\n        if (autoReconnect && globalState.listeners.size > 0) {\n          const attempts = Math.min(globalState.reconnectAttempts, maxReconnectAttempts)\n          const backoff = Math.min(reconnectInterval * Math.pow(2, attempts), 30000)\n          console.log(`[useWebSocket] scheduling reconnect in ${backoff}ms (attempt ${globalState.reconnectAttempts + 1})`)\n          if (globalState.reconnectTimer) clearTimeout(globalState.reconnectTimer)\n          globalState.reconnectTimer = setTimeout(() => {\n            globalState.reconnectAttempts++\n            globalState.socket = null\n            createGlobalSocket()\n          }, backoff)\n        }\n      }\n\n      return ws\n    } catch (e) {\n      console.error('[useWebSocket] failed to create socket', e)\n      const globalState = window.__REST_WS__\n      if (autoReconnect) {\n        if (globalState.reconnectTimer) clearTimeout(globalState.reconnectTimer)\n        globalState.reconnectTimer = setTimeout(() => {\n          globalState.reconnectAttempts++\n          createGlobalSocket()\n        }, reconnectInterval)\n      }\n    }\n  }, [autoReconnect, reconnectInterval, maxReconnectAttempts])\n\n  // register/unregister this hook's handlers on mount/unmount\n  useEffect(() => {\n    const globalState = typeof window !== 'undefined' ? window.__REST_WS__ : null\n    if (!globalState) return\n\n    // register message listener\n    const listener = (data) => {\n      try { if (onMessage) onMessage(data) } catch (e) { console.error('onMessage handler error', e) }\n    }\n    localListenerRef.current = listener\n    globalState.listeners.add(listener)\n\n    // register optional lifecycle handlers\n    if (onOpen) globalState.onOpenHandlers.add(onOpen)\n    if (onClose) globalState.onCloseHandlers.add(onClose)\n    if (onError) globalState.onErrorHandlers.add(onError)\n\n    // ensure socket exists\n    const ws = createGlobalSocket()\n    // update connection state based on socket immediately\n    setIsConnected(!!(ws && ws.readyState === WebSocket.OPEN))\n\n    // small safety: if socket closes quickly (HMR), we still have a persistent global instance\n\n    return () => {\n      // remove listeners/handlers\n      globalState.listeners.delete(listener)\n      if (onOpen) globalState.onOpenHandlers.delete(onOpen)\n      if (onClose) globalState.onCloseHandlers.delete(onClose)\n      if (onError) globalState.onErrorHandlers.delete(onError)\n\n      // when no listeners left, close socket after a short delay\n      if (globalState.listeners.size === 0) {\n        // give a brief chance for another hook to mount (100ms)\n        setTimeout(() => {\n          if (globalState.listeners.size === 0) {\n            try {\n              if (globalState.socket) {\n                globalState.socket.close()\n                globalState.socket = null\n              }\n            } catch (e) { /* ignore */ }\n            if (globalState.pingTimer) {\n              clearInterval(globalState.pingTimer)\n              globalState.pingTimer = null\n            }\n            if (globalState.reconnectTimer) {\n              clearTimeout(globalState.reconnectTimer)\n              globalState.reconnectTimer = null\n            }\n            globalState.reconnectAttempts = 0\n          }\n        }, 100)\n      }\n    }\n  }, [createGlobalSocket, onMessage, onOpen, onClose, onError])\n\n  const send = useCallback((data) => {\n    const globalState = typeof window !== 'undefined' ? window.__REST_WS__ : null\n    try {\n      if (globalState && globalState.socket && globalState.socket.readyState === WebSocket.OPEN) {\n        globalState.socket.send(JSON.stringify(data))\n      } else {\n        console.warn('[useWebSocket] send called but socket not open')\n      }\n    } catch (e) {\n      console.error('[useWebSocket] send error', e)\n      if (onError) onError(e)\n    }\n  }, [onError])\n\n  // expose isConnected based on global socket\n  useEffect(() => {\n    const globalState = typeof window !== 'undefined' ? window.__REST_WS__ : null\n    if (!globalState) return\n    const update = () => setIsConnected(!!(globalState.socket && globalState.socket.readyState === WebSocket.OPEN))\n    // quick check now\n    update()\n    // and whenever onOpen/onClose handlers are called they'll update local state because the hook user passed onOpen/onClose\n    const interval = setInterval(update, 1000)\n    return () => clearInterval(interval)\n  }, [])\n\n  return { send, isConnected }\n}","size_bytes":8001},"src/hooks/useRestaurant.js":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\n\nexport function useRestaurant() {\n  const [restaurant, setRestaurant] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n\n  useEffect(() => {\n    async function fetchRestaurant() {\n      try {\n        setLoading(true)\n        const response = await fetch('/api/restaurants')\n        if (response.ok) {\n          const result = await response.json()\n          if (result.success && result.data) {\n            // Ensure branches is an array\n            const restaurant = result.data\n            if (!restaurant.branches || !Array.isArray(restaurant.branches)) {\n              restaurant.branches = []\n            }\n            if (restaurant.totalBranches === undefined || restaurant.totalBranches === null) {\n              restaurant.totalBranches = restaurant.branches.length\n            }\n            setRestaurant(restaurant)\n          } else {\n            setError('Failed to load restaurant data')\n          }\n        } else {\n          const error = await response.json().catch(() => ({ error: 'Failed to fetch restaurant' }))\n          setError(error.error || 'Failed to fetch restaurant')\n        }\n      } catch (err) {\n        console.error('Error fetching restaurant:', err)\n        setError(err.message)\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    fetchRestaurant()\n  }, [])\n\n  return { restaurant, loading, error }\n}\n","size_bytes":1464},"src/app/admin/Orders/page.jsx":{"content":"\"use client\"\n\nimport { useState, useEffect, useRef, useMemo, useCallback } from 'react'\nimport Image from 'next/image'\nimport { Search, RefreshCcw, Plus, LayoutGrid, Clock, Menu, ArrowLeft } from 'lucide-react'\nimport OrderCard from '@/components/Orders/OrderCard'\nimport { STATUS_STYLES } from '@/constants/orderStyles'\nimport { useWebSocket } from '@/hooks/useWebSocket'\nimport { useRestaurant } from '@/hooks/useRestaurant'\n\nconst STATUS_PILLS = [\n  { label: 'All', value: 'all' },\n  { label: 'Pending', value: 'pending' },\n  { label: 'Accepted', value: 'accepted' },\n  { label: 'Preparing', value: 'preparing' },\n  { label: 'Prepared', value: 'prepared' },\n  { label: 'Delivering', value: 'delivering' },\n  { label: 'Delivered', value: 'delivered' }\n]\n\nexport default function OrdersPage() {\n  const [orders, setOrders] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [activeStatus, setActiveStatus] = useState('all')\n  const [searchQuery, setSearchQuery] = useState('')\n  const [menuItems, setMenuItems] = useState([])\n  const { restaurant, loading: restaurantLoading } = useRestaurant()\n  \n\n  const loadMenuItems = async () => {\n    try {\n      const response = await fetch('/api/menu-items?admin=true')\n      if (response.ok) {\n        const result = await response.json()\n        if (result.success && result.data) {\n          setMenuItems(result.data)\n          console.log('Loaded menu items:', result.data.length)\n        }\n      }\n    } catch (error) {\n      console.error('Failed to load menu items:', error)\n    }\n  }\n\n  const loadOrders = async () => {\n    try {\n      setLoading(true)\n      const data = await fetchOrdersRaw()\n      if (data) {\n        setOrders(data)\n        // update last ids snapshot\n        lastIdsRef.current = new Set(data.map(o => o._id))\n      }\n    } catch (error) {\n      console.error('Failed to load orders:', error)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // low-level fetch used by polling/broadcast handlers\n  const fetchOrdersRaw = useCallback(async () => {\n    try {\n      const response = await fetch('/api/orders')\n      if (!response.ok) throw new Error('Failed to fetch orders')\n      const data = await response.json()\n      return data\n    } catch (e) {\n      console.error('fetchOrdersRaw error', e)\n      return null\n    }\n  }, [])\n\n  // Setup BroadcastChannel + polling to receive live updates from server and other tabs\n  // Tab instance id so we can ignore our own broadcasts when appropriate\n  const tabId = useMemo(() => {\n    try { return crypto.randomUUID() } catch (e) { return `${Date.now()}-${Math.random()}` }\n  }, [])\n\n  // BroadcastChannel to sync between tabs\n  const bcRef = useRef(null)\n  // Keep last known ids to detect newly added orders\n  const lastIdsRef = useRef(new Set())\n  // Poll interval ref so we can clear it\n  const pollRef = useRef(null)\n\n  // Play a short beep via WebAudio (more likely to play without being blocked)\n  const playNotificationSound = useCallback(() => {\n    try {\n      const AudioCtx = window.AudioContext || window.webkitAudioContext\n      if (!AudioCtx) return\n      const ctx = new AudioCtx()\n      const o = ctx.createOscillator()\n      const g = ctx.createGain()\n      o.type = 'sine'\n      o.frequency.value = 880\n      g.gain.value = 0.001\n      o.connect(g)\n      g.connect(ctx.destination)\n      const now = ctx.currentTime\n      g.gain.setValueAtTime(0.001, now)\n      g.gain.exponentialRampToValueAtTime(0.2, now + 0.02)\n      o.start(now)\n      g.gain.exponentialRampToValueAtTime(0.001, now + 0.35)\n      o.stop(now + 0.36)\n      // close context shortly after\n      setTimeout(() => { try { ctx.close() } catch (e) {} }, 500)\n    } catch (e) {\n      // fallback: try simple Audio with short base64 beep (optional)\n    }\n  }, [])\n  // Handle WebSocket messages\n  const handleWebSocketMessage = useCallback(async (data) => {\n    if (!data || !data.type) return\n\n    try {\n      switch (data.type) {\n        case 'order:added':\n          if (data.order) {\n            setOrders(prev => {\n              // avoid duplicates\n              if (prev.some(o => o._id === data.order._id)) return prev\n              const newOrders = [...prev, data.order]\n              lastIdsRef.current = new Set(newOrders.map(o => o._id))\n              if (activeStatus === 'all' || data.order.status === activeStatus) {\n                playNotificationSound()\n              }\n              return newOrders\n            })\n            // broadcast to other tabs\n            try { if (bcRef.current) bcRef.current.postMessage({ type: 'order:added', order: data.order, sourceTab: tabId }) } catch (e) {}\n          }\n          break\n\n        case 'order:status-changed': {\n          const { orderId, status } = data\n          setOrders(prev => {\n            const newOrders = prev.map(o => o._id === orderId ? { ...o, status } : o)\n            lastIdsRef.current = new Set(newOrders.map(o => o._id))\n            if (activeStatus === 'all' || status === activeStatus) {\n              playNotificationSound()\n            }\n            return newOrders\n          })\n          try { if (bcRef.current) bcRef.current.postMessage({ type: 'order:status-changed', orderId, status, sourceTab: tabId }) } catch (e) {}\n          break\n        }\n\n        default:\n          break\n      }\n    } catch (e) {\n      console.error('Error handling WebSocket message:', e)\n    }\n  }, [activeStatus, playNotificationSound, tabId])\n\n  // Handle messages from other tabs (via BroadcastChannel)\n  useEffect(() => {\n    try {\n      if (typeof BroadcastChannel !== 'undefined') {\n        bcRef.current = new BroadcastChannel('orders-channel')\n        bcRef.current.onmessage = (ev) => {\n          const msg = ev.data\n          if (!msg || msg.sourceTab === tabId) return // ignore our own broadcasts\n\n          switch (msg.type) {\n            case 'order:added':\n              if (msg.order) {\n                setOrders(prev => {\n                  if (prev.some(o => o._id === msg.order._id)) return prev\n                  const newOrders = [...prev, msg.order]\n                  lastIdsRef.current = new Set(newOrders.map(o => o._id))\n                  if (activeStatus === 'all' || msg.order.status === activeStatus) playNotificationSound()\n                  return newOrders\n                })\n              }\n              break\n\n            case 'order:status-changed':\n              setOrders(prev => {\n                const newOrders = prev.map(o => o._id === msg.orderId ? { ...o, status: msg.status } : o)\n                lastIdsRef.current = new Set(newOrders.map(o => o._id))\n                if (activeStatus === 'all' || msg.status === activeStatus) playNotificationSound()\n                return newOrders\n              })\n              break\n\n            default:\n              break\n          }\n        }\n      }\n    } catch (e) {\n      console.warn('BroadcastChannel not available:', e)\n    }\n\n    return () => {\n      try { if (bcRef.current) bcRef.current.close() } catch (e) {}\n      bcRef.current = null\n    }\n  }, [tabId, activeStatus, playNotificationSound])\n\n  // Initialize WebSocket connection with increased retry attempts\n  const { send } = useWebSocket(handleWebSocketMessage, {\n    onOpen: () => {\n      console.log('WebSocket connected')\n      loadOrders() // Load initial data when connected\n    },\n    onClose: () => console.log('WebSocket disconnected'),\n    onError: (error) => console.error('WebSocket error:', error),\n    autoReconnect: true,\n    maxReconnectAttempts: 20,\n    reconnectInterval: 1000\n  })\n\n  // Store send function in a ref so handleStatusChange can access latest version\n  const sendRef = useRef(send)\n  useEffect(() => {\n    sendRef.current = send\n  }, [send])\n\n  // Load initial data\n  useEffect(() => {\n    loadOrders()\n    loadMenuItems()\n  }, [])\n\n  const handleStatusChange = async (orderId, action) => {\n    const statusMap = {\n      accept: 'accepted',\n      prepare: 'preparing',\n      prepared: 'prepared',\n      deliver: 'delivering',\n      delivered: 'delivered',\n      decline: 'declined'\n    }\n\n    try {\n      const newStatus = statusMap[action]\n      if (!newStatus) throw new Error('Invalid action')\n\n      const response = await fetch(`/api/orders`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ orderId, status: newStatus }),\n      })\n      \n      if (!response.ok) {\n        throw new Error('Failed to update order status')\n      }\n\n      // Notify server about status change via WebSocket\n      try {\n        sendRef.current({\n          type: 'order:status-changed',\n          orderId,\n          status: newStatus,\n          token: 'your-auth-token', // Replace with actual auth token\n          timestamp: Date.now()\n        })\n      } catch (e) {\n        console.error('Failed to send WebSocket message:', e)\n      }\n      // Also broadcast locally to other tabs so they update immediately\n      try {\n        if (bcRef.current) {\n          bcRef.current.postMessage({ type: 'order:status-changed', orderId, status: newStatus, sourceTab: tabId })\n        }\n      } catch (e) {\n        // ignore\n      }\n      // HTTP fallback: notify WS server via its absolute URL so it broadcasts to all connected clients\n      try {\n        const protocol = window.location.protocol === 'https:' ? 'https:' : 'http:'\n        const wsBroadcastUrl = `${protocol}//localhost:3002/internal/ws/broadcast`\n        fetch(wsBroadcastUrl, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ type: 'order:status-changed', orderId, status: newStatus, sourceTab: tabId })\n        }).then(res => {\n          if (!res.ok) console.warn('HTTP broadcast to WS server failed')\n        }).catch(err => console.warn('HTTP broadcast error', err))\n      } catch (e) {\n        console.warn('Failed to POST broadcast to WS server:', e)\n      }\n      \n      await loadOrders() // Refresh orders after update\n    } catch (error) {\n      console.error('Failed to update order status:', error)\n    }\n  }\n\n  const handleCall = (phone) => {\n    window.location.href = `tel:${phone}`\n  }\n\n  const filteredOrders = orders.filter(order => {\n    const matchesStatus = activeStatus === 'all' || order.status === activeStatus\n    const matchesSearch = searchQuery === '' || \n      order._id.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      (order.name || '').toLowerCase().includes(searchQuery.toLowerCase())\n    if (!matchesStatus || !matchesSearch) return false\n\n    // If viewing Delivered orders, only show orders from today\n    if (activeStatus === 'delivered') {\n      try {\n        const created = new Date(order.createdAt)\n        const now = new Date()\n        if (\n          created.getFullYear() !== now.getFullYear() ||\n          created.getMonth() !== now.getMonth() ||\n          created.getDate() !== now.getDate()\n        ) {\n          return false\n        }\n      } catch (e) {\n        // If createdAt is invalid, skip the order from delivered list\n        return false\n      }\n    }\n\n    return true\n  })\n\n  const getStatusCounts = () => {\n    const counts = { all: orders.length }\n    orders.forEach(order => {\n      counts[order.status] = (counts[order.status] || 0) + 1\n    })\n    return counts\n  }\n\n  const statusCounts = getStatusCounts()\n  const [showCardIcons, setShowCardIcons] = useState(true)\n\n  // Mobile menu component defined inside OrdersPage so it can access handlers\n  function MobileMenu() {\n    const [open, setOpen] = useState(false)\n    return (\n      <div className=\"relative\">\n        <button\n          aria-haspopup=\"true\"\n          aria-expanded={open}\n          onClick={() => setOpen(v => !v)}\n          className=\"inline-flex items-center gap-2 rounded-lg p-2 text-neutral-700 bg-white border border-neutral-200 hover:bg-neutral-50\"\n        >\n          <Menu className=\"w-5 h-5\" />\n        </button>\n\n        {open && (\n          <div className=\"absolute right-0 mt-2 w-44 bg-white border border-neutral-200 rounded-md shadow-lg z-50\">\n            <button\n              onClick={() => { setOpen(false); loadOrders() }}\n              className=\"w-full text-left px-3 py-2 text-sm hover:bg-neutral-50\"\n            >\n              Refresh\n            </button>\n            <button\n              onClick={() => { setOpen(false); window.location.href = '/admin/Orders/history' }}\n              className=\"w-full text-left px-3 py-2 text-sm hover:bg-neutral-50\"\n            >\n              History\n            </button>\n            <button\n              onClick={async () => {\n                setOpen(false)\n                try {\n                  await fetch('/api/auth/logout', { method: 'POST', credentials: 'same-origin' })\n                } catch (e) {\n                  console.error('Logout request failed', e)\n                } finally {\n                  window.location.href = '/84588878l00o00g00i00n76580982'\n                }\n              }}\n              className=\"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50\"\n            >\n              Logout\n            </button>\n          </div>\n                    \n        )}\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50\">\n      <header className=\"sticky top-0 z-30 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b border-neutral-200/80\">\n        <div className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-3\">\n              <button\n                onClick={() => window.location.href = '/admin'}\n                className=\"inline-flex items-center justify-center w-8 h-8 rounded-lg border border-neutral-200 bg-white hover:bg-neutral-50 transition-colors\"\n                aria-label=\"Back to admin\"\n              >\n                <ArrowLeft className=\"w-4 h-4\" />\n              </button>\n              {restaurant?.logo ? (\n                <div className=\"relative h-8 w-8 rounded-lg overflow-hidden flex-shrink-0\">\n                  <Image\n                    src={restaurant.logo}\n                    alt={restaurant.name || 'Restaurant Logo'}\n                    fill\n                    className=\"object-contain\"\n                    onError={(e) => {\n                      e.target.style.display = 'none'\n                      e.target.nextSibling.style.display = 'flex'\n                    }}\n                  />\n                  <div className=\"hidden h-8 w-8 rounded-lg bg-neutral-900 text-white items-center justify-center tracking-tight text-sm font-medium select-none\">OD</div>\n                </div>\n              ) : (\n                <div className=\"h-8 w-8 rounded-lg bg-neutral-900 text-white flex items-center justify-center tracking-tight text-sm font-medium select-none\">OD</div>\n              )}\n              <div className=\"flex flex-col\">\n                <h1 className=\"text-[22px] leading-6 tracking-tight font-semibold\">Order Dashboard</h1>\n                <p className=\"text-xs text-neutral-500\">Monitor, filter, and manage live orders</p>\n              </div>\n            </div>\n\n            <div className=\"hidden md:flex items-center gap-3\">\n              <button\n                onClick={loadOrders}\n                className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"\n              >\n                <RefreshCcw className=\"w-4 h-4\" />\n                Refresh\n              </button>\n\n              {/* History placeholder button - navigates to /admin/Orders/history when route is added */}\n              <button\n                onClick={() => { window.location.href = '/admin/Orders/history' }}\n                className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"\n              >\n                <Clock className=\"w-4 h-4\" />\n                History\n              </button>\n              <button\n                onClick={async () => {\n                  try {\n                    await fetch('/api/auth/logout', { method: 'POST', credentials: 'same-origin' })\n                  } catch (e) {\n                    console.error('Logout request failed', e)\n                  } finally {\n                    // Force navigation to login page which will require fresh auth\n                    window.location.href = '/84588878l00o00g00i00n76580982'\n                  }\n                }}\n                className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-red-700 bg-white hover:bg-red-50 border border-red-200 hover:border-red-300 transition-colors\"\n              >\n                Logout\n              </button>\n            </div>\n            <div className=\"md:hidden relative\">\n              <MobileMenu />\n            </div>            \n          </div>\n\n          <div className=\"py-3\">\n            <div className=\"flex flex-col lg:flex-row lg:items-center gap-3\">\n              <div className=\"flex-1\">\n                <label className=\"relative block\">\n                  <span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-neutral-400\">\n                    <Search className=\"w-4 h-4\" />\n                  </span>\n                  <input\n                    type=\"text\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    placeholder=\"Search by order #ID or customer name...\"\n                    className=\"block w-full rounded-lg border border-neutral-200 bg-white py-2 pl-9 pr-3 placeholder:text-neutral-400 hover:border-neutral-300 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-neutral-900/10 text-sm\"\n                  />\n                </label>\n              </div>\n\n              <div className=\"overflow-x-auto\">\n                <div className=\"flex items-center gap-2 min-w-max\">\n                  {STATUS_PILLS.map((status) => (\n                    <button\n                      key={status.value}\n                      onClick={() => setActiveStatus(status.value)}\n                      className={`inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm transition-colors ${\n                        activeStatus === status.value\n                          ? 'bg-neutral-900 text-white border border-neutral-900'\n                          : 'bg-white text-neutral-700 border border-neutral-200 hover:border-neutral-300'\n                      }`}\n                    >\n                      {status.label}\n                      <span className=\"rounded-full bg-white/20 px-1.5 py-0.5 text-xs\">\n                        {statusCounts[status.value] || 0}\n                      </span>\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6\">\n        <section className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-7 gap-3 mb-6\">\n          <div className=\"rounded-xl border border-neutral-200 bg-white px-4 py-3 shadow-sm hover:shadow-md transition\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs uppercase tracking-wide text-neutral-500\">All</span>\n              <span className=\"w-4 h-4\" />\n            </div>\n            <div className=\"mt-1 text-2xl tracking-tight font-semibold\">\n              {statusCounts.all || 0}\n            </div>\n          </div>\n          {STATUS_PILLS.slice(1).map((status) => (\n            <div key={status.value} className=\"rounded-xl border border-neutral-200 bg-white px-4 py-3 shadow-sm hover:shadow-md transition\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs uppercase tracking-wide text-neutral-500\">\n                  {status.label}\n                </span>\n                <span className={`h-2 w-2 rounded-full ${\n                  STATUS_STYLES[status.value]?.dot || 'bg-neutral-400 ring-neutral-300'\n                }`} />\n              </div>\n              <div className=\"mt-1 text-2xl tracking-tight font-semibold\">\n                {statusCounts[status.value] || 0}\n              </div>\n            </div>\n          ))}\n        </section>\n\n        <section className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {loading ? (\n            <div className=\"col-span-full text-center py-12 text-neutral-500\">\n              Loading orders...\n            </div>\n          ) : filteredOrders.length === 0 ? (\n            <div className=\"col-span-full text-center py-12 text-neutral-500\">\n              No orders found\n            </div>\n          ) : (\n            filteredOrders.map((order) => (\n              <OrderCard\n                key={order._id}\n                order={order}\n                onAction={handleStatusChange}\n                menuItems={menuItems}\n              />\n            ))\n          )}\n        </section>\n\n        <div className=\"mt-8 border-t border-neutral-200/80 pt-4 text-xs text-neutral-500\">\n          Tip: Use the status pills to focus on a stage, and search by #ID or name.\n        </div>\n      </main>\n    </div>\n  )\n}\n","size_bytes":21495},"src/app/admin/Orders/history/page.jsx":{"content":"'use client'\n\nimport { useState, useEffect, useMemo, useCallback } from 'react'\nimport Image from 'next/image'\nimport OrderCard from '@/components/Orders/OrderCard'\nimport { LayoutGrid, List as ListIcon, ChevronLeft, ChevronRight, Search, RefreshCw, Clock, LogOut, ArrowLeft } from 'lucide-react'\nimport { useRestaurant } from '@/hooks/useRestaurant'\n\nfunction formatDateLabel(start, end) {\n  const s = new Date(start)\n  const e = new Date(end)\n  return `${s.toLocaleDateString()} — ${e.toLocaleDateString()}`\n}\n\nexport default function OrdersPage() {\n  const [view, setView] = useState('grid') // 'grid' | 'list'\n  const [page, setPage] = useState(0) // 0 = most recent 30 days\n  const [orders, setOrders] = useState([])\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState(null)\n  const { restaurant, loading: restaurantLoading } = useRestaurant()\n  // Filter UI state\n  const [searchQ, setSearchQ] = useState('')\n  const [selectedStatuses, setSelectedStatuses] = useState(new Set())\n  const [dateFromInput, setDateFromInput] = useState('')\n  const [dateToInput, setDateToInput] = useState('')\n  const [amountMin, setAmountMin] = useState('')\n  const [amountMax, setAmountMax] = useState('')\n  const [sortMode, setSortMode] = useState('newest')\n  const [showMobileMenu, setShowMobileMenu] = useState(false)\n\n  const STATUS_LIST = ['all','pending','accepted','preparing','prepared','delivering','delivered','declined','paid','processing','shipped','cancelled','refunded']\n\n  // compute start/end dates for current page window (30-day windows)\n  const { startDateISO, endDateISO, label } = useMemo(() => {\n    const now = new Date()\n    // normalize to local date boundaries\n    const end = new Date(now.getFullYear(), now.getMonth(), now.getDate())\n    // subtract page*30 days to move window back\n    end.setDate(end.getDate() - (page * 30))\n    const start = new Date(end)\n    start.setDate(end.getDate() - 29) // 30-day window inclusive\n\n    // Create a YYYY-MM-DD string using local date components to avoid timezone shifts\n    const toISO = (d) => {\n      const y = d.getFullYear()\n      const m = String(d.getMonth() + 1).padStart(2, '0')\n      const day = String(d.getDate()).padStart(2, '0')\n      return `${y}-${m}-${day}`\n    }\n    return {\n      startDateISO: toISO(start),\n      endDateISO: toISO(end),\n      label: formatDateLabel(start, end)\n    }\n  }, [page])\n\n  const loadOrders = useCallback(async () => {\n    setLoading(true)\n    setError(null)\n    try {\n      const startParam = encodeURIComponent(`${startDateISO}T00:00:00`)\n      const endParam = encodeURIComponent(`${endDateISO}T23:59:59.999`)\n      const url = `/api/orders/history?startDate=${startParam}&endDate=${endParam}`\n      const res = await fetch(url)\n      if (!res.ok) throw new Error('Failed to load')\n      const data = await res.json()\n      setOrders(Array.isArray(data) ? data : [])\n    } catch (err) {\n      console.error(err)\n      setError('Failed to load orders')\n    } finally {\n      setLoading(false)\n    }\n  }, [startDateISO, endDateISO])\n\n  useEffect(() => {\n    let mounted = true\n    if (mounted) loadOrders()\n    return () => { mounted = false }\n  }, [loadOrders])\n\n  const handlePrev = () => setPage(p => p + 1)\n  const handleNext = () => setPage(p => Math.max(0, p - 1))\n\n  const onAction = async (orderId, action) => {\n    // delegate to existing API to update order status\n    try {\n      await fetch('/api/orders', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ orderId, status: action })\n      })\n      // refresh\n      await loadOrders()\n    } catch (e) {\n      console.error('Action failed', e)\n    }\n  }\n\n  const handleRefresh = () => loadOrders()\n\n  // Toggle status selection\n  const toggleStatus = (s) => {\n    setSelectedStatuses(prev => {\n      const copy = new Set(prev)\n      if (s === 'all') {\n        return new Set()\n      }\n      if (copy.has(s)) copy.delete(s)\n      else copy.add(s)\n      return copy\n    })\n  }\n\n  const resetFilters = () => {\n    setSearchQ('')\n    setSelectedStatuses(new Set())\n    setDateFromInput('')\n    setDateToInput('')\n    setAmountMin('')\n    setAmountMax('')\n    setSortMode('newest')\n  }\n\n  // Derived filtered + sorted orders\n  const filteredOrders = useMemo(() => {\n    const q = (searchQ || '').trim().toLowerCase()\n    const min = amountMin === '' ? null : Number(amountMin)\n    const max = amountMax === '' ? null : Number(amountMax)\n    const from = dateFromInput ? new Date(dateFromInput + 'T00:00:00') : null\n    const to = dateToInput ? new Date(dateToInput + 'T23:59:59.999') : null\n\n    let list = (orders || []).filter(o => {\n      // status\n      if (selectedStatuses.size > 0) {\n        if (!selectedStatuses.has((o.status || '').toLowerCase())) return false\n      }\n      // date\n      const created = o.createdAt ? new Date(o.createdAt) : null\n      if (from && created && created < from) return false\n      if (to && created && created > to) return false\n      // amount\n      const amt = Number(o.total || 0)\n      if (min !== null && amt < min) return false\n      if (max !== null && amt > max) return false\n      // search\n      if (q) {\n        const id = (o._id || '').toString().toLowerCase()\n        const name = (o.name || '').toLowerCase()\n        if (!id.includes(q) && !name.includes(q)) return false\n      }\n      return true\n    })\n\n    // sorting\n    list.sort((a, b) => {\n      switch (sortMode) {\n        case 'oldest': return new Date(a.createdAt) - new Date(b.createdAt)\n        case 'amount-high': return (b.total || 0) - (a.total || 0)\n        case 'amount-low': return (a.total || 0) - (b.total || 0)\n        case 'name-az': return (a.name || '').localeCompare(b.name || '')\n        case 'newest':\n        default:\n          return new Date(b.createdAt) - new Date(a.createdAt)\n      }\n    })\n\n    return list\n  }, [orders, searchQ, selectedStatuses, dateFromInput, dateToInput, amountMin, amountMax, sortMode])\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <header className=\"mb-4\">\n          <div className=\"mx-auto max-w-7xl px-0\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <button\n                  onClick={() => window.location.href = '/admin/Orders'}\n                  className=\"inline-flex items-center justify-center w-8 h-8 rounded-lg border border-neutral-200 bg-white hover:bg-neutral-50 transition-colors\"\n                  aria-label=\"Back to orders\"\n                >\n                  <ArrowLeft className=\"w-4 h-4\" />\n                </button>\n                {restaurant?.logo ? (\n                  <div className=\"relative h-8 w-8 rounded-lg overflow-hidden flex-shrink-0\">\n                    <Image\n                      src={restaurant.logo}\n                      alt={restaurant.name || 'Restaurant Logo'}\n                      fill\n                      className=\"object-contain\"\n                      onError={(e) => {\n                        e.target.style.display = 'none'\n                        e.target.nextSibling.style.display = 'flex'\n                      }}\n                    />\n                    <div className=\"hidden h-8 w-8 rounded-lg bg-neutral-900 text-white items-center justify-center tracking-tight text-sm font-medium select-none\">OD</div>\n                  </div>\n                ) : (\n                  <div className=\"h-8 w-8 rounded-lg bg-neutral-900 text-white flex items-center justify-center tracking-tight text-sm font-medium select-none\">OD</div>\n                )}\n                <div className=\"flex flex-col\">\n                  <h1 className=\"text-[22px] leading-6 tracking-tight font-semibold\">Order Dashboard</h1>\n                  <p className=\"text-xs text-neutral-500\">Monitor, filter, and manage live orders</p>\n                </div>\n              </div>\n\n              <div className=\"hidden md:flex items-center gap-3\">\n                <button onClick={handleRefresh} className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"><RefreshCw className=\"w-4 h-4\"/> Refresh</button>\n                <button className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"><Clock className=\"w-4 h-4\"/> History</button>\n                <button onClick={async ()=>{ try { await fetch('/api/auth/logout', {method:'POST', credentials: 'same-origin'}); } catch(e){ console.error('Logout request failed', e) } finally { window.location.href='/84588878l00o00g00i00n76580982' } }} className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-red-700 bg-white hover:bg-red-50 border border-red-200 hover:border-red-300 transition-colors\"><LogOut className=\"w-4 h-4\"/> Logout</button>\n              </div>\n\n              <div className=\"md:hidden relative\">\n                <button onClick={() => setShowMobileMenu(v => !v)} className=\"inline-flex items-center gap-2 rounded-lg p-2 text-neutral-700 bg-white border border-neutral-200 hover:bg-neutral-50\"><i className=\"w-5 h-5\">≡</i></button>\n                {showMobileMenu && (\n                  <div className=\"absolute right-0 mt-2 w-44 bg-white border border-neutral-200 rounded-md shadow-lg z-50\">\n                    <button onClick={handleRefresh} className=\"w-full text-left px-3 py-2 text-sm hover:bg-neutral-50\">Refresh</button>\n                    <button className=\"w-full text-left px-3 py-2 text-sm hover:bg-neutral-50\">History</button>\n                    <button onClick={async ()=>{ try { await fetch('/api/auth/logout', {method:'POST', credentials: 'same-origin'}); } catch(e){ console.error('Logout request failed', e) } finally { window.location.href='/84588878l00o00g00i00n76580982' } }} className=\"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50\">Logout</button>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <div className=\"py-3\">\n              <div className=\"flex flex-col lg:flex-row lg:items-center gap-3\">\n                <div className=\"flex-1\">\n                  <label className=\"relative block\">\n                    <span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-neutral-400 pointer-events-none\"><Search className=\"w-4 h-4\"/></span>\n                    <input value={searchQ} onChange={e=>setSearchQ(e.target.value)} id=\"global-search\" type=\"text\" placeholder=\"Search by order #ID or customer name...\" className=\"block w-full rounded-lg border border-neutral-200 bg-white py-2 pl-9 pr-3 placeholder:text-neutral-400 hover:border-neutral-300 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-neutral-900/10 text-sm\" />\n                  </label>\n                </div>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <section className=\"bg-white border border-neutral-200 rounded-xl p-4 sm:p-5 mb-6\">\n          <div className=\"flex flex-col gap-4\">\n            <div className=\"flex flex-col md:flex-row md:items-center gap-3 justify-between\">\n              <div className=\"inline-flex items-center gap-2\">\n                <span className=\"text-sm text-neutral-500\">View</span>\n                <div className=\"inline-flex rounded-lg border border-neutral-200 overflow-hidden\">\n                  <button onClick={()=>setView('grid')} id=\"btn-grid\" className={`px-3 py-1.5 text-sm inline-flex items-center gap-1.5 ${view==='grid' ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-700'}`}><LayoutGrid className=\"w-4 h-4\"/> Grid</button>\n                  <button onClick={()=>setView('list')} id=\"btn-list\" className={`px-3 py-1.5 text-sm inline-flex items-center gap-1.5 ${view==='list' ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-700'}`}><ListIcon className=\"w-4 h-4\"/> List</button>\n                </div>\n              </div>\n\n              <div className=\"inline-flex items-center gap-2\">\n                <span className=\"text-sm text-neutral-500\">Sort</span>\n                <label className=\"relative\">\n                  <select value={sortMode} onChange={e=>setSortMode(e.target.value)} id=\"sort-select\" className=\"appearance-none rounded-lg border border-neutral-200 bg-white px-3 py-1.5 pr-8 text-sm text-neutral-700 hover:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-neutral-900/10\">\n                    <option value=\"newest\">Newest first</option>\n                    <option value=\"oldest\">Oldest first</option>\n                    <option value=\"amount-high\">Amount: High to Low</option>\n                    <option value=\"amount-low\">Amount: Low to High</option>\n                    <option value=\"name-az\">Customer: A → Z</option>\n                  </select>\n                  <i className=\"pointer-events-none w-4 h-4 text-neutral-400 absolute right-2 top-1/2 -translate-y-1/2\">▾</i>\n                </label>\n              </div>\n\n              <div className=\"flex items-center gap-3\">\n                <div className=\"text-sm text-neutral-500\"><span id=\"results-count\" className=\"font-medium text-neutral-800\">{loading ? '...' : filteredOrders ? filteredOrders.length : 0}</span> results</div>\n                <button onClick={resetFilters} id=\"reset-filters\" className=\"inline-flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-sm text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200\">Reset</button>\n              </div>\n            </div>\n\n            <div className=\"h-px bg-neutral-200/80\"></div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-4\">\n              <div className=\"lg:col-span-5\">\n                <div className=\"text-sm text-neutral-500 mb-2\">Status</div>\n                <div className=\"flex flex-wrap gap-2\">\n                  {STATUS_LIST.map(s => (\n                    <button key={s} data-status={s} onClick={() => toggleStatus(s)} className={`status-chip text-sm ${s==='all' ? (selectedStatuses.size===0 ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-700') : (selectedStatuses.has(s) ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-700')} px-3 py-1.5 rounded-lg border border-neutral-200`}>{s.charAt(0).toUpperCase() + s.slice(1)}</button>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"lg:col-span-3\">\n                <div className=\"text-sm text-neutral-500 mb-2\">Date range</div>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <label className=\"block\"><input value={dateFromInput} onChange={e=>setDateFromInput(e.target.value)} id=\"date-from\" type=\"date\" className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-1.5 text-sm text-neutral-700\"/></label>\n                  <label className=\"block\"><input value={dateToInput} onChange={e=>setDateToInput(e.target.value)} id=\"date-to\" type=\"date\" className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-1.5 text-sm text-neutral-700\"/></label>\n                </div>\n              </div>\n\n              <div className=\"lg:col-span-4\">\n                <div className=\"text-sm text-neutral-500 mb-2\">Amount</div>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <label className=\"relative\"><span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 text-xs\">Rs</span><input value={amountMin} onChange={e=>setAmountMin(e.target.value)} id=\"amount-min\" type=\"number\" min=\"0\" step=\"0.01\" placeholder=\"Min\" className=\"w-full rounded-lg border border-neutral-200 bg-white pl-6 pr-3 py-1.5 text-sm text-neutral-700\"/></label>\n                  <label className=\"relative\"><span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 text-xs\">Rs</span><input value={amountMax} onChange={e=>setAmountMax(e.target.value)} id=\"amount-max\" type=\"number\" min=\"0\" step=\"0.01\" placeholder=\"Max\" className=\"w-full rounded-lg border border-neutral-200 bg-white pl-6 pr-3 py-1.5 text-sm text-neutral-700\"/></label>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {error && <div className=\"text-sm text-red-600 mb-4\">{error}</div>}\n\n        {/* Grid view */}\n        <div className={`${view !== 'grid' ? 'hidden' : ''} grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`}>\n          {filteredOrders.map(o => (\n            <OrderCard key={o._id} order={o} onAction={onAction} />\n          ))}\n        </div>\n\n        {/* List view */}\n        <div className={`${view !== 'list' ? 'hidden' : ''} divide-y divide-neutral-200 bg-white rounded-xl border border-neutral-200 overflow-hidden`}>\n          {/* header row */}\n          <div className=\"hidden md:grid grid-cols-12 gap-3 px-4 py-3 bg-neutral-50 text-xs text-neutral-500\">\n            <div className=\"col-span-4\">Customer</div>\n            <div className=\"col-span-2\">Status</div>\n            <div className=\"col-span-2\">Amount</div>\n            <div className=\"col-span-3\">Date</div>\n            <div className=\"col-span-1 text-right\">Action</div>\n          </div>\n\n          {filteredOrders.map(o => (\n            <div key={o._id} className=\"grid grid-cols-12 gap-3 items-center px-4 py-3\">\n              <div className=\"col-span-12 md:col-span-4\">\n                <div className=\"font-medium text-neutral-900 truncate\">{o.name || '—'}</div>\n                <div className=\"text-xs text-neutral-500\">#{o._id?.toString().slice(-8)}</div>\n                {/* linear tab showing products (collapsed by default) */}\n                <details className=\"mt-2\">\n                  <summary className=\"text-sm text-neutral-600 cursor-pointer\">Products ({(o.items || []).length})</summary>\n                  <div className=\"mt-2 text-sm text-neutral-700\">\n                    <ul className=\"list-disc pl-5\">\n                      {(o.items || []).map((it, i) => (\n                        <li key={i} className=\"truncate\">{it.name || it.menuItem || 'Unknown Item'} × {it.quantity} — Rs {Number(it.price || 0).toFixed(0)}</li>\n                      ))}\n                    </ul>\n                  </div>\n                </details>\n              </div>\n\n              <div className=\"col-span-6 md:col-span-2\">\n                <span className=\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-neutral-50 text-neutral-700 border border-neutral-200\">{(o.status || '').charAt(0).toUpperCase() + (o.status || '').slice(1)}</span>\n              </div>\n\n              <div className=\"col-span-6 md:col-span-2 font-medium text-neutral-900\">Rs {Number(o.total || 0).toFixed(0)}</div>\n\n              <div className=\"col-span-8 md:col-span-3 text-sm text-neutral-600\">{new Date(o.createdAt).toLocaleString()}</div>\n\n              <div className=\"col-span-4 md:col-span-1 flex justify-end\">\n                <button onClick={() => window.print()} className=\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-neutral-200 bg-white text-neutral-700\">Print</button>\n              </div>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"mt-6 flex items-center justify-between\">\n          <div className=\"text-sm text-neutral-500\">Showing {filteredOrders.length} orders</div>\n          <div className=\"flex items-center gap-2\">\n            <button onClick={() => { setPage(0) }} className=\"text-sm text-neutral-600 underline\">Go to most recent</button>\n            <div className=\"text-sm text-neutral-500\">Page {page + 1}</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","size_bytes":19819},"src/app/admin/page.jsx":{"content":"'use client'\n\nimport AdminDashboard from '@/components/AdminDashboard/AdminDashboard'\n\nexport default function AdminIndexPage(){\n  return <AdminDashboard />\n}\n","size_bytes":159},"src/services/db.js":{"content":"import mongoose from 'mongoose'\nimport { Restaurant } from '../models/Restaurant'\nimport { Order } from '../models/Order'\nimport { Category } from '../models/Category'\nimport { MenuItem } from '../models/MenuItem'\nimport { User } from '../models/User'\n\n// 🧩 Database Connection\nconst MONGODB_URI = process.env.MONGO_URI;\n\nif (!MONGODB_URI) {\n  throw new Error('❌ Neither MONGODB_URI nor MONGO_URI is defined in environment variables');\n}\n\n// Validate MongoDB URI format\nif (!MONGODB_URI.includes('mongodb+srv://') && !MONGODB_URI.includes('mongodb://')) {\n  throw new Error('❌ Invalid MongoDB URI format. Must start with mongodb+srv:// or mongodb://');\n}\n\n// Create a cached connection\nlet cachedConnection = null;\n\nexport async function connectToDB() {\n  try {\n    // Use cached connection if available\n    if (cachedConnection && mongoose.connection.readyState === 1) {\n      return cachedConnection;\n    }\n\n    // Reuse existing connection\n    if (mongoose.connection.readyState === 1) {\n      cachedConnection = mongoose.connection;\n      return cachedConnection;\n    }\n\n    // Establish new connection with optimized settings\n    const conn = await mongoose.connect(MONGODB_URI, {\n      dbName: 'restaurant',\n      bufferCommands: false,\n      \n      // Connection pool optimization\n      maxPoolSize: 10,\n      minPoolSize: 2,\n      \n      // Timeout optimizations\n      serverSelectionTimeoutMS: 5000,\n      socketTimeoutMS: 45000,\n      connectTimeoutMS: 10000,\n      \n      // Write/Read concerns\n      retryWrites: true,\n      retryReads: true,\n      w: 'majority',\n    });\n\n    cachedConnection = conn;\n    console.log('✅ Connected to MongoDB');\n\n    // Handle connection events\n    mongoose.connection.on('error', (err) => {\n      console.error('MongoDB connection error:', err);\n    });\n\n    mongoose.connection.on('disconnected', () => {\n      console.log('MongoDB disconnected');\n      cachedConnection = null;\n    });\n\n    return conn;\n  } catch (error) {\n    console.error('MongoDB connection error:', error);\n    cachedConnection = null;\n    throw error;\n  }\n}\n\n//\n// 🧾 RESTAURANT CRUD Functions ───────────────────────────────────────────────\n//\n\n// Get restaurant by ID\nexport async function getRestaurant(restaurantId) {\n  await connectToDB();\n  const restaurant = await Restaurant.findById(restaurantId).lean();\n  if (!restaurant) throw new Error('Restaurant not found');\n  return restaurant;\n}\n\n// Create a new restaurant\nexport async function createRestaurant(data) {\n  await connectToDB();\n  const restaurant = await Restaurant.create(data);\n  return restaurant.toObject();\n}\n\n// Update an existing restaurant\nexport async function updateRestaurant(restaurantId, data) {\n  await connectToDB();\n  \n  console.log('updateRestaurant - Restaurant ID:', restaurantId)\n  console.log('updateRestaurant - Update data keys:', Object.keys(data))\n  \n  // Filter out non-updatable fields\n  const updateData = { ...data }\n  delete updateData._id\n  delete updateData.__v\n  delete updateData.createdAt\n  delete updateData.updatedAt\n  \n  // Ensure branches is an array\n  if (updateData.branches !== undefined) {\n    if (!Array.isArray(updateData.branches)) {\n      updateData.branches = []\n    }\n    // Filter out any invalid branches\n    updateData.branches = updateData.branches.filter(branch => {\n      return branch && typeof branch === 'object' && branch.name && branch.address && branch.city\n    })\n    // Manually calculate totalBranches\n    updateData.totalBranches = updateData.branches.length\n    console.log('updateRestaurant - Branches count:', updateData.branches.length)\n  }\n  \n  // Use findById, update, then save to ensure pre-save hooks run\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  console.log('updateRestaurant - Current restaurant:', {\n    name: restaurant.name,\n    branchesCount: restaurant.branches?.length || 0\n  })\n  \n  // Update all fields\n  Object.keys(updateData).forEach(key => {\n    if (key !== '_id' && key !== '__v') {\n      restaurant[key] = updateData[key]\n    }\n  })\n  \n  console.log('updateRestaurant - Updated restaurant before save:', {\n    name: restaurant.name,\n    branchesCount: restaurant.branches?.length || 0,\n    totalBranches: restaurant.totalBranches\n  })\n  \n  // Save to trigger pre-save hook\n  await restaurant.save()\n  \n  const result = restaurant.toObject()\n  console.log('updateRestaurant - Saved restaurant:', {\n    _id: result._id,\n    name: result.name,\n    branchesCount: result.branches?.length || 0,\n    totalBranches: result.totalBranches\n  })\n  \n  return result;\n}\n\n//\n// 📋 CATEGORY Functions ──────────────────────────────────────────────────────\n//\n\n// Get all categories for a restaurant\nexport async function getCategories(restaurantId) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  const categories = await Category.find({ restaurantId }).lean();\n  \n  // Format for backward compatibility\n  return categories.map(cat => ({\n    _id: cat._id,\n    name: cat.name,\n    description: cat.description,\n    headerImage: cat.headerImage,\n    image: cat.headerImage // Alias for backward compatibility\n  }));\n}\n\n// Create a category in a restaurant\nexport async function createCategory(restaurantId, data) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Check if category already exists\n  const existingCategory = await Category.findOne({ \n    restaurantId, \n    name: data.name \n  });\n  if (existingCategory) throw new Error('Category already exists');\n  \n  // Create new category\n  const category = await Category.create({\n    restaurantId,\n    name: data.name,\n    description: data.description || '',\n    headerImage: data.headerImage || ''\n  });\n  \n  return {\n    _id: category._id,\n    name: category.name,\n    description: category.description,\n    headerImage: category.headerImage,\n    image: category.headerImage\n  };\n}\n\n// Update a category\nexport async function updateCategory(restaurantId, categoryIdOrName, updates) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Support both ObjectId and category name for backward compatibility\n  let category;\n  if (mongoose.Types.ObjectId.isValid(categoryIdOrName)) {\n    category = await Category.findOne({ _id: categoryIdOrName, restaurantId });\n  } else {\n    category = await Category.findOne({ name: categoryIdOrName, restaurantId });\n  }\n  \n  if (!category) throw new Error('Category not found');\n  \n  // Update fields\n  if (updates.name !== undefined) category.name = updates.name;\n  if (updates.description !== undefined) category.description = updates.description;\n  if (updates.headerImage !== undefined) category.headerImage = updates.headerImage;\n  \n  await category.save();\n  \n  return {\n    _id: category._id,\n    name: category.name,\n    description: category.description,\n    headerImage: category.headerImage,\n    image: category.headerImage\n  };\n}\n\n// Delete a category (with cascade delete of menuItems)\nexport async function deleteCategory(restaurantId, categoryIdOrName) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Support both ObjectId and category name for backward compatibility\n  let category;\n  if (mongoose.Types.ObjectId.isValid(categoryIdOrName)) {\n    category = await Category.findOne({ _id: categoryIdOrName, restaurantId });\n  } else {\n    category = await Category.findOne({ name: categoryIdOrName, restaurantId });\n  }\n  \n  if (!category) throw new Error('Category not found');\n  \n  const categoryId = category._id;\n  const categoryName = category.name;\n  \n  // Cascade delete: delete all menuItems in this category\n  await MenuItem.deleteMany({ categoryId });\n  \n  // Delete the category\n  await Category.deleteOne({ _id: categoryId });\n  \n  return {\n    _id: categoryId,\n    name: categoryName\n  };\n}\n\n//\n// 🍕 MENU ITEM Functions ────────────────────────────────────────────────────\n//\n\n// Get all menu items for a restaurant (with optional filters)\nexport async function getMenuItems(restaurantId, filters = {}) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Build query\n  const query = { restaurantId };\n  if (filters.isAvailable !== undefined) {\n    query.isAvailable = filters.isAvailable;\n  }\n  \n  // Get menu items with populated category\n  const items = await MenuItem.find(query)\n    .populate('categoryId', 'name headerImage')\n    .lean();\n  \n  // Format for backward compatibility\n  return items.map(item => ({\n    _id: item._id,\n    name: item.name,\n    description: item.description || '',\n    image: item.image || '',\n    price: item.price || 0,\n    isAvailable: item.isAvailable !== undefined ? item.isAvailable : true,\n    variants: item.variants || [],\n    sides: item.sides || [],\n    createdAt: item.createdAt || new Date(),\n    category: item.categoryId ? {\n      _id: item.categoryId._id,\n      name: item.categoryId.name,\n      image: item.categoryId.headerImage\n    } : null,\n    categoryName: item.categoryId ? item.categoryId.name : null,\n    categoryId: item.categoryId ? item.categoryId._id : null\n  }));\n}\n\n// Get all menu items (admin - includes unavailable)\nexport async function getAllMenuItemsAdmin(restaurantId) {\n  return getMenuItems(restaurantId, {});\n}\n\n// Get all menu items (public - only available)\nexport async function getAllMenuItems(restaurantId) {\n  return getMenuItems(restaurantId, { isAvailable: true });\n}\n\n// Get menu items by category name or ID\nexport async function getMenuByCategory(restaurantId, categoryIdOrName) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Find category by ID or name\n  let category;\n  if (mongoose.Types.ObjectId.isValid(categoryIdOrName)) {\n    category = await Category.findOne({ _id: categoryIdOrName, restaurantId });\n  } else {\n    category = await Category.findOne({ name: categoryIdOrName, restaurantId });\n  }\n  \n  if (!category) return [];\n  \n  // Get menu items for this category\n  const items = await MenuItem.find({ \n    restaurantId, \n    categoryId: category._id \n  }).populate('categoryId', 'name headerImage').lean();\n  \n  return items.map(item => ({\n    _id: item._id,\n    name: item.name || '',\n    description: item.description || '',\n    image: item.image || '',\n    price: item.price || 0,\n    isAvailable: item.isAvailable !== undefined ? item.isAvailable : true,\n    variants: item.variants || [],\n    sides: item.sides || [],\n    createdAt: item.createdAt || new Date(),\n    category: item.categoryId ? {\n      _id: item.categoryId._id,\n      name: item.categoryId.name,\n      image: item.categoryId.headerImage\n    } : null,\n    categoryName: item.categoryId ? item.categoryId.name : null\n  }));\n}\n\n// Get single menu item by ID\nexport async function getMenuItem(restaurantId, menuItemId) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  const item = await MenuItem.findOne({ \n    _id: menuItemId, \n    restaurantId \n  }).populate('categoryId', 'name headerImage').lean();\n  \n  if (!item) throw new Error('Menu item not found');\n  \n  return {\n    ...item,\n    category: item.categoryId ? {\n      _id: item.categoryId._id,\n      name: item.categoryId.name,\n      image: item.categoryId.headerImage\n    } : null,\n    categoryName: item.categoryId ? item.categoryId.name : null\n  };\n}\n\n// Create a menu item in a category\nexport async function createMenuItem(restaurantId, categoryIdOrName, data) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Find category by ID or name\n  let category;\n  if (mongoose.Types.ObjectId.isValid(categoryIdOrName)) {\n    category = await Category.findOne({ _id: categoryIdOrName, restaurantId });\n  } else {\n    category = await Category.findOne({ name: categoryIdOrName, restaurantId });\n  }\n  \n  if (!category) throw new Error('Category not found');\n  \n  // Create new menu item\n  const menuItem = await MenuItem.create({\n    restaurantId,\n    categoryId: category._id,\n    name: data.name,\n    description: data.description || '',\n    image: data.image || '',\n    price: Number(data.price || 0),\n    isAvailable: data.isAvailable !== undefined ? Boolean(data.isAvailable) : true,\n    variants: Array.isArray(data.variants) ? data.variants : [],\n    sides: Array.isArray(data.sides) ? data.sides : []\n  });\n  \n  // Populate category for response\n  await menuItem.populate('categoryId', 'name headerImage');\n  \n  return {\n    ...menuItem.toObject(),\n    category: {\n      _id: category._id,\n      name: category.name,\n      image: category.headerImage\n    },\n    categoryName: category.name\n  };\n}\n\n// Update a menu item\nexport async function updateMenuItem(restaurantId, menuItemId, updates) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Find menu item\n  const menuItem = await MenuItem.findOne({ \n    _id: menuItemId, \n    restaurantId \n  });\n  \n  if (!menuItem) throw new Error('Menu item not found');\n  \n  // Update fields\n  if (updates.name !== undefined) menuItem.name = updates.name;\n  if (updates.description !== undefined) menuItem.description = updates.description;\n  if (updates.image !== undefined) menuItem.image = updates.image;\n  if (updates.price !== undefined) menuItem.price = Number(updates.price);\n  if (updates.isAvailable !== undefined) menuItem.isAvailable = Boolean(updates.isAvailable);\n  if (updates.variants !== undefined) menuItem.variants = Array.isArray(updates.variants) ? updates.variants : [];\n  if (updates.sides !== undefined) menuItem.sides = Array.isArray(updates.sides) ? updates.sides : [];\n  \n  // Handle category change if needed\n  if (updates.categoryId || updates.categoryName) {\n    let newCategory;\n    if (updates.categoryId) {\n      newCategory = await Category.findOne({ _id: updates.categoryId, restaurantId });\n    } else if (updates.categoryName) {\n      newCategory = await Category.findOne({ name: updates.categoryName, restaurantId });\n    }\n    \n    if (!newCategory) throw new Error('New category not found');\n    menuItem.categoryId = newCategory._id;\n  }\n  \n  await menuItem.save();\n  \n  // Populate category for response\n  await menuItem.populate('categoryId', 'name headerImage');\n  const category = menuItem.categoryId;\n  \n  return {\n    ...menuItem.toObject(),\n    category: {\n      _id: category._id,\n      name: category.name,\n      image: category.headerImage\n    },\n    categoryName: category.name\n  };\n}\n\n// Delete a menu item\nexport async function deleteMenuItem(restaurantId, menuItemId) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  const menuItem = await MenuItem.findOne({ \n    _id: menuItemId, \n    restaurantId \n  });\n  \n  if (!menuItem) throw new Error('Menu item not found');\n  \n  const itemObj = menuItem.toObject();\n  await MenuItem.deleteOne({ _id: menuItemId });\n  \n  return itemObj;\n}\n\n// Get menu structure (categories with their items)\nexport async function getMenu(restaurantId) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Get all categories\n  const categories = await Category.find({ restaurantId }).lean();\n  \n  // Get all available menu items grouped by category\n  const menuItems = await MenuItem.find({ \n    restaurantId, \n    isAvailable: true \n  }).lean();\n  \n  // Group items by category\n  const itemsByCategory = {};\n  for (const item of menuItems) {\n    if (!itemsByCategory[item.categoryId.toString()]) {\n      itemsByCategory[item.categoryId.toString()] = [];\n    }\n    itemsByCategory[item.categoryId.toString()].push(item);\n  }\n  \n  // Format for backward compatibility\n  return categories.map(cat => ({\n    category: cat.name,\n    image: cat.headerImage,\n    items: itemsByCategory[cat._id.toString()] || []\n  }));\n}\n\n//\n// 🛒 ORDER Functions ────────────────────────────────────────────────────────\n//\n\n// Create an order\nexport async function createOrder(restaurantId, orderData) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Create order in Order collection\n  const orderType = orderData.type || orderData.orderType || 'delivery'\n  const branchValue = orderType === 'pickup' ? (orderData.branch || '') : ''\n  \n  // Build customer object from orderData\n  const customer = {\n    name: orderData.name || orderData.customerName || orderData.customer?.name || '',\n    phone: orderData.phone || orderData.customer?.phone || '',\n    email: orderData.email || orderData.customer?.email || '',\n    address: orderData.address || orderData.customer?.address || ''\n  };\n  \n  // Build order items with denormalized name and updated selectedSides format\n  // Fetch menu item names from MenuItem collection to ensure they're stored\n  const menuItemIds = (orderData.items || [])\n    .map(item => {\n      const id = item.menuItemId || item._id;\n      return mongoose.Types.ObjectId.isValid(id) ? new mongoose.Types.ObjectId(id) : null;\n    })\n    .filter(id => id !== null);\n\n  // Fetch menu items to get names\n  const menuItemsMap = {};\n  if (menuItemIds.length > 0) {\n    const menuItems = await MenuItem.find({\n      _id: { $in: menuItemIds },\n      restaurantId\n    }).select('_id name').lean();\n    \n    for (const menuItem of menuItems) {\n      menuItemsMap[menuItem._id.toString()] = menuItem.name;\n    }\n  }\n\n  const items = (orderData.items || []).map(item => {\n    // Get menuItemId\n    const menuItemId = mongoose.Types.ObjectId.isValid(item.menuItemId || item._id) \n      ? new mongoose.Types.ObjectId(item.menuItemId || item._id) \n      : (item.menuItemId || item._id);\n    \n    // Get menu item name from map or fallback to provided name\n    const menuItemName = menuItemsMap[menuItemId.toString()] || item.name || 'Unknown Item';\n    \n    // Transform selectedSides to new format {name, extraPrice, img}\n    const selectedSides = Array.isArray(item.selectedSides) ? item.selectedSides.map(side => ({\n      name: side.name || side.sideName || '',\n      extraPrice: side.extraPrice || 0,\n      img: side.img || side.image || ''\n    })) : [];\n    \n    return {\n      menuItemId,\n      name: menuItemName, // Ensure name is always populated\n      variant: item.variant || '',\n      price: Number(item.price || 0),\n      quantity: item.quantity || 1,\n      selectedSides\n    };\n  });\n  \n  // Create order using Mongoose model\n  const order = await Order.create({\n    restaurantId,\n    userId: orderData.userId && mongoose.Types.ObjectId.isValid(orderData.userId) \n      ? new mongoose.Types.ObjectId(orderData.userId) \n      : null,\n    customer,\n    items,\n    total: Number(orderData.total || orderData.totalAmount || 0),\n    status: orderData.status || 'pending',\n    type: orderType,\n    branch: branchValue,\n    instructions: orderData.instructions || ''\n  });\n  \n  return order.toObject();\n}\n\n// Get all orders with filters\nexport async function getOrders(restaurantId, filters = {}) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Build MongoDB query\n  const query = { restaurantId };\n  \n  // Apply filters\n  if (filters.status) {\n    query.status = filters.status;\n  }\n  if (filters.startDate || filters.endDate) {\n    query.createdAt = {};\n    if (filters.startDate) {\n      query.createdAt.$gte = new Date(filters.startDate);\n    }\n    if (filters.endDate) {\n      query.createdAt.$lte = new Date(filters.endDate);\n    }\n  }\n  \n  // Query with sorting\n  const orders = await Order.find(query)\n    .sort({ createdAt: -1 })\n    .lean();\n  \n  // Populate missing menu item names for backward compatibility\n  const menuItemIdsToFetch = [];\n  for (const order of orders) {\n    for (const item of order.items || []) {\n      if (item.menuItemId && (!item.name || item.name === '')) {\n        menuItemIdsToFetch.push(item.menuItemId);\n      }\n    }\n  }\n  \n  if (menuItemIdsToFetch.length > 0) {\n    const menuItems = await MenuItem.find({\n      _id: { $in: menuItemIdsToFetch },\n      restaurantId\n    }).select('_id name').lean();\n    \n    const menuItemsMap = {};\n    for (const menuItem of menuItems) {\n      menuItemsMap[menuItem._id.toString()] = menuItem.name;\n    }\n    \n    // Update orders with menu item names\n    for (const order of orders) {\n      for (const item of order.items || []) {\n        if (item.menuItemId && (!item.name || item.name === '')) {\n          const menuItemIdStr = item.menuItemId.toString();\n          if (menuItemsMap[menuItemIdStr]) {\n            item.name = menuItemsMap[menuItemIdStr];\n          } else {\n            item.name = 'Unknown Item'; // Fallback if menu item not found\n          }\n        }\n      }\n    }\n  }\n  \n  return orders;\n}\n\n// Alias for backward compatibility\nexport async function getAllOrders(restaurantId, filters = {}) {\n  return getOrders(restaurantId, filters);\n}\n\n// Get order by ID\nexport async function getOrderById(restaurantId, orderId) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Find order in Order collection\n  const order = await Order.findOne({ _id: orderId, restaurantId }).lean();\n  if (!order) throw new Error('Order not found');\n  \n  return order;\n}\n\n// Update order status\nexport async function updateOrderStatus(restaurantId, orderId, newStatus) {\n  await connectToDB();\n  \n  const validStatuses = ['pending', 'accepted', 'preparing', 'prepared', 'delivering', 'delivered', 'declined'];\n  if (!validStatuses.includes(newStatus)) {\n    throw new Error('Invalid status');\n  }\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Update order in Order collection\n  const order = await Order.findOneAndUpdate(\n    { _id: orderId, restaurantId },\n    { status: newStatus },\n    { new: true }\n  ).lean();\n  \n  if (!order) throw new Error('Order not found');\n  \n  return order;\n}\n\n// Get order statistics\nexport async function getOrderStats(restaurantId, timeframe = '24h') {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Calculate start date based on timeframe\n  const now = Date.now();\n  let startDate = null;\n  \n  if (timeframe === '24h') {\n    startDate = new Date(now - 24 * 60 * 60 * 1000);\n  } else if (timeframe === '7d') {\n    startDate = new Date(now - 7 * 24 * 60 * 60 * 1000);\n  } else if (timeframe === '30d') {\n    startDate = new Date(now - 30 * 24 * 60 * 60 * 1000);\n  }\n  \n  // Build query\n  const query = { restaurantId };\n  if (startDate) {\n    query.createdAt = { $gte: startDate };\n  }\n  \n  // Use aggregation pipeline for efficient stats calculation\n  const stats = await Order.aggregate([\n    { $match: query },\n    {\n      $group: {\n        _id: '$status',\n        count: { $sum: 1 },\n        totalAmount: { $sum: '$total' }\n      }\n    }\n  ]);\n  \n  // Calculate totals\n  const byStatus = {};\n  let totalOrders = 0;\n  let totalAmount = 0;\n  \n  for (const stat of stats) {\n    byStatus[stat._id] = {\n      count: stat.count,\n      amount: stat.totalAmount\n    };\n    totalOrders += stat.count;\n    totalAmount += stat.totalAmount;\n  }\n  \n  return {\n    totalOrders,\n    totalAmount,\n    byStatus\n  };\n}\n\n//\n// 👤 USER Functions ─────────────────────────────────────────────────────────\n//\n\n// Get all users for a restaurant (optionally filtered by branch)\nexport async function getUsers(restaurantId, branch = null) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Build query\n  const query = { restaurantId };\n  if (branch !== null) {\n    query.branch = branch || ''; // Empty string for Global users\n  }\n  \n  // Get users for this restaurant, optionally filtered by branch\n  const users = await User.find(query).lean();\n  \n  return users;\n}\n\n// Create a user in a restaurant (with optional branch)\nexport async function createUser(restaurantId, userData) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Check if user already exists (unique email per restaurantId and branch)\n  const existingUser = await User.findOne({ \n    email: userData.email,\n    restaurantId,\n    branch: userData.branch || '' // Empty string for Global users\n  });\n  \n  if (existingUser) throw new Error('User already exists');\n  \n  // Create new user\n  const user = await User.create({\n    restaurantId,\n    firstName: userData.firstName,\n    lastName: userData.lastName,\n    email: userData.email,\n    passwordHash: userData.passwordHash,\n    role: userData.role,\n    branch: userData.branch || '' // Empty string for Global users\n  });\n  \n  return user.toObject();\n}\n\n// Find user by email (supports both branch-specific and Global users)\nexport async function findUserByEmail(restaurantId, email, branch = null) {\n  await connectToDB();\n  \n  // Verify restaurant exists\n  const restaurant = await Restaurant.findById(restaurantId);\n  if (!restaurant) throw new Error('Restaurant not found');\n  \n  // Try to find user for this restaurant and branch (if specified)\n  let user = null;\n  \n  if (branch !== null) {\n    // Try specific branch first\n    user = await User.findOne({ \n      email, \n      restaurantId,\n      branch: branch || '' // Empty string for Global users\n    }).lean();\n  }\n  \n  // If not found, try Global users (branch = '')\n  if (!user) {\n    user = await User.findOne({ \n      email,\n      restaurantId,\n      branch: '' // Global users have empty string branch\n    }).lean();\n  }\n  \n  // If still not found and no branch specified, try any branch for this restaurant\n  if (!user && branch === null) {\n    user = await User.findOne({ \n      email,\n      restaurantId\n    }).lean();\n  }\n  \n  return user;\n}\n","size_bytes":27920},"src/components/AdminDashboard/SalesChart.jsx":{"content":"'use client'\n\nfunction fmtCurrency(v) {\n  return v.toLocaleString(undefined, { style: 'currency', currency: 'PKR', maximumFractionDigits: 2 })\n}\n\nexport default function SalesChart({ series }) {\n  const w = 720\n  const h = 240\n  const pad = 12\n  const maxV = Math.max(1, ...series.map(s => s.value))\n  const points = series.map((d, i) => {\n    const x = pad + (i / (series.length - 1 || 1)) * (w - pad * 2)\n    const y = pad + (1 - d.value / maxV) * (h - pad * 2)\n    return [x, y, d.value]\n  })\n  const linePath = points.map((p, i) => (i === 0 ? `M ${p[0]},${p[1]}` : `L ${p[0]},${p[1]}`)).join(' ')\n  const areaPath = `M ${points[0][0]},${h - pad} ` + points.map(p => `L ${p[0]},${p[1]}`).join(' ') + ` L ${points[points.length-1][0]},${h - pad} Z`\n\n  return (\n    <div style={{ width: '100%' }} className=\"h-60 w-full\">\n      <svg width=\"100%\" height=\"100%\" viewBox={`0 0 ${w} ${h}`} preserveAspectRatio=\"none\">\n        <defs>\n          <linearGradient id=\"grad2\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\n            <stop offset=\"0%\" stopColor=\"rgb(0,0,0)\" stopOpacity=\"0.15\" />\n            <stop offset=\"100%\" stopColor=\"rgb(0,0,0)\" stopOpacity=\"0\" />\n          </linearGradient>\n          <filter id=\"soft2\"><feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2\" result=\"blur\"/></filter>\n        </defs>\n        {[0,1,2,3].map(i => {\n          const y = pad + (i/3) * (h - pad*2)\n          return <line key={i} x1={pad} y1={y} x2={w-pad} y2={y} stroke=\"rgba(0,0,0,0.08)\" strokeWidth=\"1\" />\n        })}\n        <path d={areaPath} fill=\"url(#grad2)\" />\n        <path d={linePath} stroke=\"rgb(0,0,0)\" strokeWidth=\"2\" fill=\"none\" strokeLinecap=\"round\" />\n        {points.map((p, i) => (\n          <circle key={i} cx={p[0]} cy={p[1]} r=\"2.2\" fill=\"rgb(0,0,0)\" stroke=\"rgba(255,255,255,0.8)\" strokeWidth=\"0.5\">\n            <title>{fmtCurrency(p[2])}</title>\n          </circle>\n        ))}\n      </svg>\n    </div>\n  )\n}\n\n","size_bytes":1906},"src/components/MenuManagement/MenuManagementClient.jsx":{"content":"'use client'\n\nimport { useEffect, useState, useMemo } from 'react'\nimport Header from './Header'\nimport ItemCard from './ItemCard'\nimport ItemForm from './ItemForm'\nimport CategoryForm from './CategoryForm'\n\nexport default function MenuManagementClient() {\n  const [tab, setTab] = useState('items')\n  const [items, setItems] = useState([])\n  const [categories, setCategories] = useState([])\n  const [loading, setLoading] = useState(false)\n  const [showItemModal, setShowItemModal] = useState(false)\n  const [editingItem, setEditingItem] = useState(null)\n  const [showCatModal, setShowCatModal] = useState(false)\n  const [editingCat, setEditingCat] = useState(null)\n\n  const fetchData = async () => {\n    setLoading(true)\n    try {\n      const [mi, catRes] = await Promise.all([\n        fetch('/api/menu-items?admin=1').then(r=>r.json()),\n        fetch('/api/categories').then(r=>r.json())\n      ])\n      setItems(Array.isArray(mi.data) ? mi.data : [])\n      setCategories(Array.isArray(catRes.data) ? catRes.data : [])\n    } catch (e) {\n      console.error('Failed to load menu data', e)\n    } finally { setLoading(false) }\n  }\n\n  useEffect(() => { fetchData() }, [])\n\n  const handleAddItem = () => { setEditingItem(null); setShowItemModal(true) }\n  const handleEditItem = (it) => { setEditingItem(it); setShowItemModal(true) }\n  const handleViewItem = (it) => { alert(JSON.stringify(it, null, 2)) }\n\n  const handleToggle = async (it) => {\n    try {\n      const body = { _id: it._id, isAvailable: !it.isAvailable }\n      const res = await fetch('/api/menu-items', { method: 'PUT', body: JSON.stringify(body), headers: { 'Content-Type':'application/json' } })\n      const data = await res.json()\n      if (data.success) fetchData()\n    } catch (e) { console.error(e) }\n  }\n\n  const handleDelete = async (it) => {\n    if (!confirm(`Delete \"${it.name}\"? This will permanently remove the item.`)) return\n    try {\n      const res = await fetch('/api/menu-items', { method: 'DELETE', body: JSON.stringify({ _id: it._id }), headers: { 'Content-Type':'application/json' } })\n      const data = await res.json()\n      if (data.success) fetchData()\n      else alert('Delete failed: ' + (data.error || 'unknown'))\n    } catch (e) { console.error(e); alert('Delete failed') }\n  }\n\n  const saveItem = async (payload) => {\n    try {\n      const method = payload._id ? 'PUT' : 'POST'\n      const res = await fetch('/api/menu-items', { method, body: JSON.stringify(payload), headers: { 'Content-Type':'application/json' } })\n      const data = await res.json()\n      if (data.success) {\n        setShowItemModal(false)\n        fetchData()\n      } else alert('Save failed: ' + (data.error || 'unknown'))\n    } catch (e) { console.error(e); alert('Save failed') }\n  }\n\n  const saveCategory = async (payload) => {\n    try {\n      const method = payload._id ? 'PUT' : 'POST'\n      const res = await fetch('/api/categories', { method, body: JSON.stringify(payload), headers: { 'Content-Type':'application/json' } })\n      const data = await res.json()\n      if (data.success) {\n        setShowCatModal(false)\n        fetchData()\n      } else alert('Save failed: ' + (data.error || 'unknown'))\n    } catch (e) { console.error(e); alert('Save failed') }\n  }\n\n  const filteredItems = useMemo(() => items, [items])\n\n  return (\n    <div>\n      <Header />\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"inline-flex p-1 rounded-lg border border-neutral-200 bg-white\">\n            <button onClick={()=>setTab('items')} className={`px-3 py-1.5 text-sm rounded-md ${tab==='items' ? 'bg-neutral-900 text-white' : 'text-neutral-700 hover:bg-neutral-50'}`}>Menu Items</button>\n            <button onClick={()=>setTab('categories')} className={`px-3 py-1.5 text-sm rounded-md ${tab==='categories' ? 'bg-neutral-900 text-white' : 'text-neutral-700 hover:bg-neutral-50'}`}>Categories</button>\n          </div>\n          <div className=\"hidden sm:flex items-center gap-2 text-xs text-neutral-500\">Use the toggle to switch between views</div>\n        </div>\n\n        {tab === 'items' && (\n          <section className=\"mt-6 space-y-4\">\n            <div className=\"bg-white border border-neutral-200 rounded-xl p-3 sm:p-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-12 gap-3\">\n                <div className=\"md:col-span-3 relative\">\n                  <input placeholder=\"Search by name or description...\" className=\"w-full pl-3 pr-3 py-2 text-sm rounded-lg border border-neutral-200\" />\n                </div>\n                <div className=\"md:col-span-3\">\n                  <select className=\"w-full text-sm px-3 py-2 rounded-lg border border-neutral-200 bg-white\">\n                    <option value=\"\">All categories</option>\n                    {categories.map(c => <option key={c._id} value={c._id}>{c.name}</option>)}\n                  </select>\n                </div>\n                <div className=\"md:col-span-6 flex justify-end\">\n                  <button onClick={handleAddItem} className=\"inline-flex items-center gap-2 text-sm px-3 py-2 rounded-lg border border-neutral-200 bg-white\">Add Menu Item</button>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-white border border-neutral-200 rounded-xl overflow-hidden\">\n              <div className=\"hidden md:grid grid-cols-12 gap-3 px-4 py-3 text-xs text-neutral-500 bg-neutral-50 border-b border-neutral-200\">\n                <div className=\"col-span-3\">Item</div>\n                <div className=\"col-span-2\">Category</div>\n                <div className=\"col-span-1\">Price</div>\n                <div className=\"col-span-2\">Availability</div>\n                <div className=\"col-span-2\">Created</div>\n                <div className=\"col-span-2 text-right\">Actions</div>\n              </div>\n              <div>\n                {loading && <div className=\"p-4 text-sm text-neutral-500\">Loading…</div>}\n                {!loading && filteredItems.map(it => (\n                  <ItemCard key={it._id} item={it} onEdit={handleEditItem} onView={handleViewItem} onDelete={handleDelete} onToggle={handleToggle} />\n                ))}\n              </div>\n            </div>\n          </section>\n        )}\n\n        {tab === 'categories' && (\n          <section className=\"mt-6 space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-xl tracking-tight font-semibold\">Categories</h2>\n              <div>\n                <button onClick={() => { setEditingCat(null); setShowCatModal(true) }} className=\"inline-flex items-center gap-2 text-sm px-3 py-2 rounded-lg border border-neutral-200 bg-white\">Add Category</button>\n              </div>\n            </div>\n\n            <div className=\"bg-white border border-neutral-200 rounded-xl overflow-hidden\">\n              <div className=\"hidden md:grid grid-cols-12 gap-3 px-4 py-3 text-xs text-neutral-500 bg-neutral-50 border-b border-neutral-200\">\n                <div className=\"col-span-3\">Category</div>\n                <div className=\"col-span-5\">Description</div>\n                <div className=\"col-span-2\">Created</div>\n                <div className=\"col-span-2 text-right\">Actions</div>\n              </div>\n              <div>\n                {categories.map(c => (\n                  <div key={c._id} className=\"px-4 py-3 grid grid-cols-1 md:grid-cols-12 md:items-center gap-3\">\n                    <div className=\"md:col-span-3 flex items-center gap-3\">\n                      <img src={c.headerImage || '/fallback-category.jpg'} className=\"h-12 w-12 rounded-md object-cover border border-neutral-200\"/>\n                      <div>\n                        <div className=\"text-sm font-medium\">{c.name}</div>\n                        <div className=\"text-xs text-neutral-500\">ID: {String(c._id).slice(-6)}</div>\n                      </div>\n                    </div>\n                    <div className=\"md:col-span-5 text-sm text-neutral-700\">{c.description || ''}</div>\n                    <div className=\"md:col-span-2 text-sm text-neutral-700\">{new Date(c.createdAt).toLocaleDateString()}</div>\n                    <div className=\"md:col-span-2 flex md:justify-end gap-1.5\">\n                      <button onClick={() => { setEditingCat(c); setShowCatModal(true) }} className=\"inline-flex items-center gap-1 text-xs px-2.5 py-1.5 rounded-md border border-neutral-200 bg-white\">Edit</button>\n                      <button onClick={async () => {\n                        if (!confirm(`Delete category \"${c.name}\"? This will permanently remove the category and any items in it.`)) return\n                        try {\n                          const res = await fetch('/api/categories', { method: 'DELETE', body: JSON.stringify({ _id: c._id }), headers: { 'Content-Type': 'application/json' } })\n                          const data = await res.json()\n                          if (data.success) fetchData()\n                          else alert('Delete failed: ' + (data.error || 'unknown'))\n                        } catch (e) { console.error(e); alert('Delete failed') }\n                      }} className=\"inline-flex items-center gap-1 text-xs px-2.5 py-1.5 rounded-md border border-red-200 text-red-700 bg-white hover:bg-red-50\">Delete</button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </section>\n        )}\n\n      </main>\n\n      {/* Item Modal */}\n      {showItemModal && (\n        <div className=\"fixed inset-0 z-50\">\n          <div className=\"absolute inset-0 bg-black/40\"></div>\n          <div className=\"absolute inset-0 flex items-end sm:items-center justify-center p-4\">\n            <div className=\"w-full max-w-2xl bg-white border border-neutral-200 rounded-xl shadow-xl max-h-[85vh] overflow-y-auto\">\n              <div className=\"px-4 sm:px-5 py-3 border-b border-neutral-200 flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-lg tracking-tight font-semibold\">{editingItem ? 'Edit Menu Item' : 'Add Menu Item'}</h3>\n                  <p className=\"text-xs text-neutral-500\">Create or edit a menu item</p>\n                </div>\n                <button onClick={() => setShowItemModal(false)} className=\"p-2 rounded-md hover:bg-neutral-50\">✕</button>\n              </div>\n              <ItemForm initial={editingItem} categories={categories} onCancel={() => setShowItemModal(false)} onSave={saveItem} />\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Category Modal */}\n      {showCatModal && (\n        <div className=\"fixed inset-0 z-50\">\n          <div className=\"absolute inset-0 bg-black/40\"></div>\n          <div className=\"absolute inset-0 flex items-end sm:items-center justify-center p-4\">\n            <div className=\"w-full max-w-lg bg-white border border-neutral-200 rounded-xl shadow-xl max-h-[85vh] overflow-y-auto\">\n              <div className=\"px-4 sm:px-5 py-3 border-b border-neutral-200 flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-lg tracking-tight font-semibold\">{editingCat ? 'Edit Category' : 'Add Category'}</h3>\n                  <p className=\"text-xs text-neutral-500\">Create or edit a category</p>\n                </div>\n                <button onClick={() => setShowCatModal(false)} className=\"p-2 rounded-md hover:bg-neutral-50\">✕</button>\n              </div>\n              <CategoryForm initial={editingCat} onCancel={() => setShowCatModal(false)} onSave={saveCategory} />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":11697},"src/app/api/db/test/route.js":{"content":"export async function GET() {\n  try {\n    const { connectToDB } = await import('../../../../services/db');\n    await connectToDB();\n    return Response.json({ \n      success: true, \n      message: 'Database connection successful',\n      timestamp: new Date().toISOString()\n    });\n  } catch (error) {\n    console.error('Database test error:', error);\n    return Response.json({ \n      success: false, \n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 500 });\n  }\n}","size_bytes":502},"src/models/Category.js":{"content":"import mongoose from 'mongoose'\n\nconst categorySchema = new mongoose.Schema({\n  restaurantId: {\n    type: mongoose.Schema.Types.ObjectId,\n    required: true,\n    ref: 'Restaurant',\n    index: true\n  },\n  name: {\n    type: String,\n    required: true\n  },\n  description: {\n    type: String,\n    default: ''\n  },\n  headerImage: {\n    type: String,\n    default: ''\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  updatedAt: {\n    type: Date,\n    default: Date.now\n  }\n})\n\n// Indexes for efficient querying\ncategorySchema.index({ restaurantId: 1, name: 1 }) // Compound index for unique category names per restaurant\n\n// Update updatedAt before saving\ncategorySchema.pre('save', function(next) {\n  this.updatedAt = new Date()\n  next()\n})\n\nexport const Category = mongoose.models.Category || mongoose.model('Category', categorySchema)\n\n","size_bytes":847},"src/components/Checkout/Checkout.jsx":{"content":"// components/Checkout.jsx\n'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport Image from 'next/image'\nimport { ArrowLeft, ArrowRight, Check, X, ShoppingCart, MapPin, ShieldCheck, CheckCircle, Bike, ShoppingBag, Phone, Crosshair, Banknote, Mail, Info, Home, Map } from 'lucide-react'\nimport emailjs from '@emailjs/browser'\nimport CartSummary from './CartSummary'\nimport PaymentSummary from './PaymentSummary'\nimport DeliveryForm from './DeliveryForm'\nimport OTPVerification from './OTPVerification'\n\nexport default function Checkout({ cart: initialCart, user = {}, onOrderPlaced }) {\n  const [step, setStep] = useState(1)\n  const [localCart, setLocalCart] = useState(initialCart)\n  const [selectedPaymentMethod, setSelectedPaymentMethod] = useState('cash')\n  const [formData, setFormData] = useState({\n    name: user.name || '',\n    phone: user.phone || '',\n    email: user.email || '',\n    address: user.address || '',\n    apartment: '',\n    instructions: '',\n    orderType: 'delivery',\n    pickupLocation: '',\n    branch: '',\n  })\n  const [otp, setOtp] = useState(['', '', '', '', '', ''])\n  const [generatedOtp, setGeneratedOtp] = useState('')\n  const [orderData, setOrderData] = useState(null)\n  const [verificationError, setVerificationError] = useState('')\n  const router = useRouter()\n  const initialFormData = {\n    name: '',\n    phone: '',\n    email: '',\n    address: '',\n    apartment: '',\n    instructions: '',\n    orderType: 'delivery',\n    pickupLocation: '',\n    branch: '',\n  }\n\n  const clearCart = () => {\n    setLocalCart([])\n  }\n\n  const subtotal = localCart.reduce((sum, item) => sum + item.price * item.quantity, 0)\n  const deliveryFee = 5.00\n  const tax = subtotal * 0.09 // Assuming 9% tax as example\n  const total = subtotal + deliveryFee + tax\n\n  const updateQuantity = (index, delta) => {\n    const newCart = [...localCart]\n    newCart[index].quantity = Math.max(1, newCart[index].quantity + delta)\n    setLocalCart(newCart)\n  }\n\n  const handleFormChange = (key, value) => {\n    setFormData({ ...formData, [key]: value })\n  }\n\n  const handleOtpChange = (index, value) => {\n    if (value.length > 1) return\n    const newOtp = [...otp]\n    newOtp[index] = value\n    setOtp(newOtp)\n  }\n\n  const generateAndSendOTP = async () => {\n    try {\n      // Generate a random 6-digit OTP\n      const newOtp = Math.floor(100000 + Math.random() * 900000).toString()\n      setGeneratedOtp(newOtp)\n      \n      // Initialize EmailJS with your public key\n      emailjs.init(\"y3LTt-etrHp9cxK4b\") // Replace with your EmailJS public key\n      \n      // Prepare the email template parameters\n      const templateParams = {\n        email: formData.email,\n        to_name: formData.name,\n        otp: newOtp,\n      }\n      \n      // Send the email using EmailJS\n      await emailjs.send(\n        'service_pamxyy4',\n        'template_hym3a33',\n        templateParams\n      )\n      \n      // Show success message\n      alert('Verification code sent to your email!')\n    } catch (error) {\n      console.error('Failed to send email:', error)\n      alert('Failed to send verification code. Please try again.')\n    }\n  }\n\n  const goToStep = (newStep) => {\n    if (newStep > step) {\n      if (step === 2) {\n        if (!formData.name) return alert('Please enter your name')\n        if (!formData.phone) return alert('Please enter your phone number')\n        if (!formData.email) return alert('Please enter your email')\n        if (formData.orderType === 'delivery') {\n          if (!formData.address) return alert('Please enter your delivery address')\n        } else {\n          if (!formData.pickupLocation) return alert('Please select a pickup location')\n        }\n      }\n      \n      // Generate and send OTP when moving to verification step\n      if (newStep === 3) {\n        generateAndSendOTP()\n      }\n    }\n    setVerificationError('')\n    setStep(newStep)\n  }\n\n  const handlePlaceOrder = async () => {\n    const enteredOtp = otp.join('')\n    if (enteredOtp.length !== 6) {\n      setVerificationError('Please enter the complete 6-digit code')\n      return\n    }\n\n    // Verify OTP\n    if (enteredOtp !== generatedOtp) {\n      setVerificationError('Invalid verification code. Please try again.')\n      return\n    }\n\n    setVerificationError('') // Clear any previous errors\n\n    const address = formData.orderType === 'delivery'\n      ? `${formData.address}${formData.apartment ? `, ${formData.apartment}` : ''}`\n      : formData.pickupLocation\n      \n    try {\n      // Create the order object with menuItemId references\n      const payload = {\n        customerName: formData.name,\n        email: formData.email,\n        phone: formData.phone,\n        orderType: formData.orderType,\n        address: address,\n        instructions: formData.instructions,\n        branch: formData.orderType === 'pickup' ? formData.pickupLocation : '', // Include branch for pickup orders\n        items: localCart.map(item => ({\n          menuItemId: item.menuItemId || item.id || item._id, // Extract menuItemId (required)\n          quantity: item.quantity || 1,\n          variant: item.variant || '', // Selected variant name\n          price: item.price || 0, // Price per item including variant/sides\n          selectedSides: item.selectedSides || [] // Selected sides array\n        })),\n        totalAmount: total,\n        paymentMethod: selectedPaymentMethod,\n        status: 'pending'\n      }\n\n      // Send order to the backend\n      const response = await fetch('/api/orders', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload)\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to create order')\n      }\n\n      const order = await response.json()\n      \n  // Store full order and move to confirmation step (step 4)\n  setOrderData(order)\n  setStep(4)\n      \n      // Clear cart and form data\n      clearCart()\n      setFormData(initialFormData)\n      \n      // Call onOrderPlaced callback if provided\n      if (onOrderPlaced) {\n        onOrderPlaced(order)\n      }\n\n    } catch (error) {\n      console.error('Error creating order:', error)\n      setVerificationError('Failed to place order. Please try again.')\n    }\n  }\n\n  const getIndicatorClasses = (indicatorStep) => {\n    if (indicatorStep < step) return 'w-10 h-10 rounded-full bg-green-600 text-white flex items-center justify-center text-sm font-semibold mb-2 step-indicator'\n    if (indicatorStep === step) return 'w-10 h-10 rounded-full bg-neutral-900 text-white flex items-center justify-center text-sm font-semibold mb-2 step-indicator'\n    return 'w-10 h-10 rounded-full bg-neutral-200 text-neutral-400 flex items-center justify-center text-sm font-semibold mb-2 step-indicator'\n  }\n\n  const getTextClasses = (indicatorStep) => {\n    if (indicatorStep < step) return 'text-xs font-medium text-green-600'\n    if (indicatorStep === step) return 'text-xs font-medium text-neutral-900'\n    return 'text-xs font-medium text-neutral-500'\n  }\n\n  const getProgressClasses = (progressIndex) => {\n    if (progressIndex < step - 1) return 'flex-1 h-0.5 bg-green-600 -mt-6'\n    return 'flex-1 h-0.5 bg-neutral-200 -mt-6'\n  }\n\n  return (\n    <div className=\"min-h-screen pb-20 bg-neutral-50 text-neutral-900\">\n      <header className=\"bg-white border-b border-neutral-200\">\n        <div className=\"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"bg-neutral-900 text-white w-9 h-9 rounded-lg flex items-center justify-center text-sm font-semibold tracking-tight\">\n                FD\n              </div>\n              <h1 className=\"text-xl font-semibold tracking-tight\">Checkout</h1>\n            </div>\n            <button onClick={() => window.history.back()} className=\"p-2 hover:bg-neutral-100 rounded-lg transition-all\">\n              <X className=\"w-5 h-5 text-neutral-600\" />\n            </button>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"bg-white border-b border-neutral-200\">\n        <div className=\"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex flex-col items-center flex-1\">\n              <div className={getIndicatorClasses(1)}>\n                <ShoppingCart className=\"w-5 h-5\" />\n              </div>\n              <span className={getTextClasses(1)}>Order</span>\n            </div>\n            <div className={getProgressClasses(1)} />\n            <div className=\"flex flex-col items-center flex-1\">\n              <div className={getIndicatorClasses(2)}>\n                <MapPin className=\"w-5 h-5\" />\n              </div>\n              <span className={getTextClasses(2)}>Details</span>\n            </div>\n            <div className={getProgressClasses(2)} />\n            <div className=\"flex flex-col items-center flex-1\">\n              <div className={getIndicatorClasses(3)}>\n                <ShieldCheck className=\"w-5 h-5\" />\n              </div>\n              <span className={getTextClasses(3)}>Verify</span>\n            </div>\n            <div className={getProgressClasses(3)} />\n            <div className=\"flex flex-col items-center flex-1\">\n              <div className={getIndicatorClasses(4)}>\n                <CheckCircle className=\"w-5 h-5\" />\n              </div>\n              <span className={getTextClasses(4)}>Done</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <main className=\"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {step === 1 && (\n          <div className=\"space-y-6\">\n            <div>\n              <h2 className=\"text-2xl font-semibold tracking-tight mb-2\">Confirm Your Order</h2>\n              <p className=\"text-neutral-600\">Review your items before proceeding</p>\n            </div>\n            <CartSummary cart={localCart} onUpdateQuantity={updateQuantity} />\n            <PaymentSummary subtotal={subtotal} deliveryFee={deliveryFee} tax={tax} total={total} />\n            <button\n              onClick={() => goToStep(2)}\n              className=\"w-full py-4 bg-neutral-900 text-white rounded-xl font-semibold hover:bg-neutral-800 transition-all flex items-center justify-center gap-2\"\n            >\n              Continue to Details\n              <ArrowRight className=\"w-5 h-5\" />\n            </button>\n          </div>\n        )}\n\n        {step === 2 && (\n          <div className=\"space-y-6\">\n            <div>\n              <h2 className=\"text-2xl font-semibold tracking-tight mb-2\">Delivery Details</h2>\n              <p className=\"text-neutral-600\">Enter your contact and delivery address</p>\n            </div>\n            <DeliveryForm formData={formData} onChange={handleFormChange} />\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => goToStep(1)}\n                className=\"flex-1 py-4 bg-white border border-neutral-200 text-neutral-700 rounded-xl font-semibold hover:bg-neutral-50 transition-all flex items-center justify-center gap-2\"\n              >\n                <ArrowLeft className=\"w-5 h-5\" />\n                Back\n              </button>\n              <button\n                onClick={() => goToStep(3)}\n                className=\"flex-1 py-4 bg-neutral-900 text-white rounded-xl font-semibold hover:bg-neutral-800 transition-all flex items-center justify-center gap-2\"\n              >\n                Continue\n                <ArrowRight className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n        )}\n\n        {step === 3 && (\n          <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <div className=\"w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 relative\">\n                <Mail className=\"w-8 h-8 text-blue-500\" />\n              </div>\n              <h2 className=\"text-2xl font-semibold tracking-tight mb-2\">Verify via Email</h2>\n              <p className=\"text-neutral-600\">\n                Enter the 6-digit code sent to your Email at <span className=\"font-medium text-neutral-900\">{formData.email}</span>\n              </p>\n            </div>\n            <OTPVerification \n              otp={otp} \n              onChange={handleOtpChange} \n              onResend={() => {\n                generateAndSendOTP()\n                setOtp(['', '', '', '', '', ''])\n                setVerificationError('')\n              }} \n            />\n            {verificationError && (\n              <div className=\"text-red-600 text-sm text-center font-medium\">\n                {verificationError}\n              </div>\n            )}\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => goToStep(2)}\n                className=\"flex-1 py-4 bg-white border border-neutral-200 text-neutral-700 rounded-xl font-semibold hover:bg-neutral-50 transition-all flex items-center justify-center gap-2\"\n              >\n                <ArrowLeft className=\"w-5 h-5\" />\n                Back\n              </button>\n              <button\n                onClick={handlePlaceOrder}\n                // VERIFY & PLACE ORDER BUTTON\n                // Clicking this button calls `handlePlaceOrder` which performs\n                // client-side OTP length check and then sends the order to\n                // `/api/orders` (see the fetch call in `handlePlaceOrder`).\n                className=\"flex-1 py-4 bg-neutral-900 text-white rounded-xl font-semibold hover:bg-neutral-800 transition-all flex items-center justify-center gap-2\"\n              >\n                Verify & Place Order\n                <Check className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n        )}\n      </main>\n\n      \n\n        {step === 4 && orderData && (\n          <div className=\"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n            <div className=\"space-y-6\">\n            <div className=\"text-center\">\n              <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <CheckCircle className=\"w-10 h-10 text-green-600\" />\n              </div>\n              <h2 className=\"text-2xl font-semibold tracking-tight mb-2\">Order Placed Successfully!</h2>\n              <p className=\"text-neutral-600\">Your order has been confirmed and is being prepared</p>\n            </div>\n\n            <div className=\"bg-white rounded-xl border border-neutral-200 p-6 space-y-4\">\n              <div className=\"flex items-center justify-between pb-4 border-b border-neutral-200\">\n                <span className=\"text-sm text-neutral-600\">Order Number</span>\n                <span className=\"font-semibold text-lg\">{orderData._id}</span>\n              </div>\n              <div className=\"flex items-center justify-between pb-4 border-b border-neutral-200\">\n                <span className=\"text-sm text-neutral-600\">Estimated Delivery</span>\n                <span className=\"font-semibold\">25-35 minutes</span>\n              </div>\n              <div className=\"pb-4 border-b border-neutral-200\">\n                <div className=\"text-sm text-neutral-600\">Delivery Address</div>\n                <div className=\"font-medium text-sm mt-1\">{orderData.address || orderData.addressLine || ''}</div>\n              </div>\n\n              <div>\n                <div className=\"text-sm text-neutral-600 mb-2\">Items</div>\n                <ul className=\"divide-y divide-neutral-100 rounded-md overflow-hidden border border-neutral-100\">\n                  {(orderData.items || []).map((it, i) => (\n                    <li key={i} className=\"flex items-center justify-between px-4 py-3\">\n                      <div>\n                        <div className=\"font-medium\">{it.menuItem || it.name}</div>\n                        <div className=\"text-xs text-neutral-500\">Qty: {it.quantity} • Rs {Number(it.price || 0).toFixed(0)}</div>\n                      </div>\n                      <div className=\"font-medium\">Rs {Number((it.price || 0) * (it.quantity || 1)).toFixed(0)}</div>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-neutral-600\">Total Paid</span>\n                <span className=\"font-semibold text-xl\">Rs {Number(orderData.total || 0).toFixed(2)}</span>\n              </div>\n            </div>\n\n            <div className=\"bg-blue-50 border border-blue-200 rounded-xl p-5 flex gap-3\">\n              <Info className=\"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5\" />\n              <div>\n                <p className=\"text-sm font-medium text-blue-900 mb-1\">Track your order</p>\n                <p className=\"text-sm text-blue-700\">We'll send you updates via Email/SMS. You can also track your order in real-time.</p>\n              </div>\n            </div>\n\n            <div className=\"flex gap-3\">\n              <button\n                onClick={() => { router.push(`/orders/${orderData._id}`) }}\n                className=\"flex-1 py-4 bg-white border border-neutral-200 text-neutral-700 rounded-xl font-semibold hover:bg-neutral-50 transition-all flex items-center justify-center gap-2\"\n              >\n                <Map className=\"w-5 h-5\" />\n                Track Order\n              </button>\n              <button\n                onClick={() => { router.push('/'); }}\n                className=\"flex-1 py-4 bg-neutral-900 text-white rounded-xl font-semibold hover:bg-neutral-800 transition-all flex items-center justify-center gap-2\"\n              >\n                <Home className=\"w-5 h-5\" />\n                Back to Home\n              </button>\n            </div>\n            </div>\n          </div>\n        )}\n    </div>\n  )\n}","size_bytes":17887},"src/app/api/orders/route.js":{"content":"export async function GET() {\n  try {\n    const { getOrCreateDefaultRestaurant } = await import('../../../utils/getRestaurantId')\n    const { getOrders, connectToDB } = await import('../../../services/db')\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ error: 'No restaurant found. Please create a restaurant first.' }, { status: 404 })\n    }\n    \n    await connectToDB()\n    const orders = await getOrders(restaurantId)\n    \n    return Response.json(orders)\n  } catch (error) {\n    console.error('Failed to fetch orders:', error)\n    return Response.json(\n      { error: 'Failed to fetch orders' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function PUT(request) {\n  try {\n    const { getOrCreateDefaultRestaurant } = await import('../../../utils/getRestaurantId')\n    const { updateOrderStatus, connectToDB } = await import('../../../services/db')\n    \n    const { orderId, status } = await request.json()\n    if (!orderId || !status) {\n      return Response.json(\n        { error: 'Missing orderId or status' },\n        { status: 400 }\n      )\n    }\n\n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ error: 'No restaurant found. Please create a restaurant first.' }, { status: 404 })\n    }\n    \n    await connectToDB()\n    const updatedOrder = await updateOrderStatus(restaurantId, orderId, status)\n    \n    // Notify connected WebSocket clients via internal server endpoint\n    try {\n      const port = process.env.PORT || 5000;\n      const broadcastUrl = process.env.WS_BROADCAST_URL || `http://localhost:${port}/internal/ws/broadcast`;\n      await fetch(broadcastUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          type: 'order:status-changed',\n          orderId,\n          status,\n          order: updatedOrder,\n          timestamp: Date.now()\n        })\n      })\n    } catch (e) {\n      console.error('Failed to notify WS clients:', e)\n    }\n    \n    return Response.json(updatedOrder);\n  } catch (error) {\n    console.error('Failed to update order:', error);\n    return Response.json(\n      { error: 'Failed to update order' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(req) {\n  try {\n    const { getOrCreateDefaultRestaurant } = await import('../../../utils/getRestaurantId')\n    const { createOrder, connectToDB } = await import('../../../services/db')\n    \n    const body = await req.json()\n    console.log('Received order request:', body)\n\n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ error: 'No restaurant found. Please create a restaurant first.' }, { status: 404 })\n    }\n\n    // Ensure DB connection is established\n    await connectToDB()\n\n    // Delegate order creation to service\n    // Items should now have menuItemId (ObjectId) instead of menuItem (string name)\n    const orderType = (body.orderType || body.type || 'delivery')\n    const orderPayload = {\n      // Customer object will be built in createOrder from these fields\n      name: body.customerName || body.name || body.customer?.name || '',\n      phone: body.phone || body.customer?.phone || '',\n      email: body.email || body.customer?.email || '',\n      address: body.address || body.customer?.address || '',\n      customer: body.customer || undefined, // Support direct customer object\n      type: orderType,\n      branch: orderType === 'pickup' ? (body.branch || '') : '', // Location key for pickup orders\n      items: (body.items || []).map(item => ({\n        menuItemId: item.menuItemId || item._id, // Use menuItemId (ObjectId) - required\n        name: item.name || '', // Denormalized name for reference\n        quantity: item.quantity || 1,\n        variant: item.variant || '', // Variant name if applicable\n        price: item.price || 0,\n        selectedSides: Array.isArray(item.selectedSides) ? item.selectedSides : []\n      })),\n      total: body.totalAmount || body.total || 0,\n      status: body.status || 'pending',\n      instructions: body.instructions || ''\n    }\n    \n    console.log('Mapped order payload:', JSON.stringify(orderPayload, null, 2))\n    console.log('Branch value from request:', body.branch, 'Order type:', orderType)\n\n    const order = await createOrder(restaurantId, orderPayload)\n\n    // Notify all WebSocket clients about the new order via internal endpoint\n    try {\n      const port = process.env.PORT || 5000;\n      const broadcastUrl = process.env.WS_BROADCAST_URL || `http://localhost:${port}/internal/ws/broadcast`;\n      await fetch(broadcastUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          type: 'order:added',\n          orderId: order._id,\n          order: order,\n          timestamp: Date.now()\n        })\n      })\n    } catch (e) {\n      console.error('Failed to notify WS clients about new order:', e)\n    }\n\n    // Return full created order so client can confirm fields (including type)\n    return Response.json(order);\n  } catch (error) {\n    console.error('Order creation error:', error);\n    return Response.json({ success: false, error: error.message }, { status: 500 });\n  }\n}","size_bytes":5312},"src/app/Orders/history/page.jsx":{"content":"'use client'\n\nimport { useState, useEffect, useMemo, useCallback } from 'react'\nimport Image from 'next/image'\nimport OrderCard from '@/components/Orders/OrderCard'\nimport { LayoutGrid, List as ListIcon, ChevronLeft, ChevronRight, Search, RefreshCw, Clock, LogOut } from 'lucide-react'\nimport { useRestaurant } from '@/hooks/useRestaurant'\n\nfunction formatDateLabel(start, end) {\n  const s = new Date(start)\n  const e = new Date(end)\n  return `${s.toLocaleDateString()} — ${e.toLocaleDateString()}`\n}\n\nexport default function OrdersPage() {\n  const [view, setView] = useState('grid') // 'grid' | 'list'\n  const [page, setPage] = useState(0) // 0 = most recent 30 days\n  const [orders, setOrders] = useState([])\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState(null)\n  const { restaurant, loading: restaurantLoading } = useRestaurant()\n  // Filter UI state\n  const [searchQ, setSearchQ] = useState('')\n  const [selectedStatuses, setSelectedStatuses] = useState(new Set())\n  const [dateFromInput, setDateFromInput] = useState('')\n  const [dateToInput, setDateToInput] = useState('')\n  const [amountMin, setAmountMin] = useState('')\n  const [amountMax, setAmountMax] = useState('')\n  const [sortMode, setSortMode] = useState('newest')\n  const [showMobileMenu, setShowMobileMenu] = useState(false)\n\n  const STATUS_LIST = ['all','pending','accepted','preparing','prepared','delivering','delivered','declined','paid','processing','shipped','cancelled','refunded']\n\n  // compute start/end dates for current page window (30-day windows)\n  const { startDateISO, endDateISO, label } = useMemo(() => {\n    const now = new Date()\n    // normalize to local date boundaries\n    const end = new Date(now.getFullYear(), now.getMonth(), now.getDate())\n    // subtract page*30 days to move window back\n    end.setDate(end.getDate() - (page * 30))\n    const start = new Date(end)\n    start.setDate(end.getDate() - 29) // 30-day window inclusive\n\n    // Create a YYYY-MM-DD string using local date components to avoid\n    // timezone shifts caused by toISOString() converting local midnight to UTC day.\n    const toISO = (d) => {\n      const y = d.getFullYear()\n      const m = String(d.getMonth() + 1).padStart(2, '0')\n      const day = String(d.getDate()).padStart(2, '0')\n      return `${y}-${m}-${day}`\n    }\n    return {\n      startDateISO: toISO(start),\n      endDateISO: toISO(end),\n      label: formatDateLabel(start, end)\n    }\n  }, [page])\n\n  const loadOrders = useCallback(async () => {\n    setLoading(true)\n    setError(null)\n    try {\n      const startParam = encodeURIComponent(`${startDateISO}T00:00:00`)\n      const endParam = encodeURIComponent(`${endDateISO}T23:59:59.999`)\n      const url = `/api/orders/history?startDate=${startParam}&endDate=${endParam}`\n      const res = await fetch(url)\n      if (!res.ok) throw new Error('Failed to load')\n      const data = await res.json()\n      setOrders(Array.isArray(data) ? data : [])\n    } catch (err) {\n      console.error(err)\n      setError('Failed to load orders')\n    } finally {\n      setLoading(false)\n    }\n  }, [startDateISO, endDateISO])\n\n  useEffect(() => {\n    let mounted = true\n    if (mounted) loadOrders()\n    return () => { mounted = false }\n  }, [loadOrders])\n\n  const handlePrev = () => setPage(p => p + 1)\n  const handleNext = () => setPage(p => Math.max(0, p - 1))\n\n  const onAction = async (orderId, action) => {\n    // delegate to existing API to update order status\n    try {\n      await fetch('/api/orders', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ orderId, status: action })\n      })\n      // refresh\n      await loadOrders()\n    } catch (e) {\n      console.error('Action failed', e)\n    }\n  }\n\n  const handleRefresh = () => loadOrders()\n\n  // Toggle status selection\n  const toggleStatus = (s) => {\n    setSelectedStatuses(prev => {\n      const copy = new Set(prev)\n      if (s === 'all') {\n        return new Set()\n      }\n      if (copy.has(s)) copy.delete(s)\n      else copy.add(s)\n      return copy\n    })\n  }\n\n  const resetFilters = () => {\n    setSearchQ('')\n    setSelectedStatuses(new Set())\n    setDateFromInput('')\n    setDateToInput('')\n    setAmountMin('')\n    setAmountMax('')\n    setSortMode('newest')\n  }\n\n  // Derived filtered + sorted orders\n  const filteredOrders = useMemo(() => {\n    const q = (searchQ || '').trim().toLowerCase()\n    const min = amountMin === '' ? null : Number(amountMin)\n    const max = amountMax === '' ? null : Number(amountMax)\n    const from = dateFromInput ? new Date(dateFromInput + 'T00:00:00') : null\n    const to = dateToInput ? new Date(dateToInput + 'T23:59:59.999') : null\n\n    let list = (orders || []).filter(o => {\n      // status\n      if (selectedStatuses.size > 0) {\n        if (!selectedStatuses.has((o.status || '').toLowerCase())) return false\n      }\n      // date\n      const created = o.createdAt ? new Date(o.createdAt) : null\n      if (from && created && created < from) return false\n      if (to && created && created > to) return false\n      // amount\n      const amt = Number(o.total || 0)\n      if (min !== null && amt < min) return false\n      if (max !== null && amt > max) return false\n      // search\n      if (q) {\n        const id = (o._id || '').toString().toLowerCase()\n        const name = (o.name || '').toLowerCase()\n        if (!id.includes(q) && !name.includes(q)) return false\n      }\n      return true\n    })\n\n    // sorting\n    list.sort((a, b) => {\n      switch (sortMode) {\n        case 'oldest': return new Date(a.createdAt) - new Date(b.createdAt)\n        case 'amount-high': return (b.total || 0) - (a.total || 0)\n        case 'amount-low': return (a.total || 0) - (b.total || 0)\n        case 'name-az': return (a.name || '').localeCompare(b.name || '')\n        case 'newest':\n        default:\n          return new Date(b.createdAt) - new Date(a.createdAt)\n      }\n    })\n\n    return list\n  }, [orders, searchQ, selectedStatuses, dateFromInput, dateToInput, amountMin, amountMax, sortMode])\n\n  return (\n    <div className=\"min-h-screen bg-neutral-50 p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        <header className=\"mb-4\">\n          <div className=\"mx-auto max-w-7xl px-0\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                {restaurant?.logo ? (\n                  <div className=\"relative h-8 w-8 rounded-lg overflow-hidden flex-shrink-0\">\n                    <Image\n                      src={restaurant.logo}\n                      alt={restaurant.name || 'Restaurant Logo'}\n                      fill\n                      className=\"object-contain\"\n                      onError={(e) => {\n                        e.target.style.display = 'none'\n                        e.target.nextSibling.style.display = 'flex'\n                      }}\n                    />\n                    <div className=\"hidden h-8 w-8 rounded-lg bg-neutral-900 text-white items-center justify-center tracking-tight text-sm font-medium select-none\">OD</div>\n                  </div>\n                ) : (\n                  <div className=\"h-8 w-8 rounded-lg bg-neutral-900 text-white flex items-center justify-center tracking-tight text-sm font-medium select-none\">OD</div>\n                )}\n                <div className=\"flex flex-col\">\n                  <h1 className=\"text-[22px] leading-6 tracking-tight font-semibold\">Order Dashboard</h1>\n                  <p className=\"text-xs text-neutral-500\">Monitor, filter, and manage live orders</p>\n                </div>\n              </div>\n\n              <div className=\"hidden md:flex items-center gap-3\">\n                <button onClick={handleRefresh} className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"><RefreshCw className=\"w-4 h-4\"/> Refresh</button>\n                <button className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200 hover:border-neutral-300 transition-colors\"><Clock className=\"w-4 h-4\"/> History</button>\n                <button onClick={async ()=>{ try { await fetch('/api/auth/logout', {method:'POST', credentials: 'same-origin'}); } catch(e){ console.error('Logout request failed', e) } finally { window.location.href='/login' } }} className=\"inline-flex items-center gap-2 rounded-lg px-3.5 py-2 text-sm font-medium text-red-700 bg-white hover:bg-red-50 border border-red-200 hover:border-red-300 transition-colors\"><LogOut className=\"w-4 h-4\"/> Logout</button>\n              </div>\n\n              <div className=\"md:hidden relative\">\n                <button onClick={() => setShowMobileMenu(v => !v)} className=\"inline-flex items-center gap-2 rounded-lg p-2 text-neutral-700 bg-white border border-neutral-200 hover:bg-neutral-50\"><i className=\"w-5 h-5\">≡</i></button>\n                {showMobileMenu && (\n                  <div className=\"absolute right-0 mt-2 w-44 bg-white border border-neutral-200 rounded-md shadow-lg z-50\">\n                    <button onClick={handleRefresh} className=\"w-full text-left px-3 py-2 text-sm hover:bg-neutral-50\">Refresh</button>\n                    <button className=\"w-full text-left px-3 py-2 text-sm hover:bg-neutral-50\">History</button>\n                    <button onClick={async ()=>{ try { await fetch('/api/auth/logout', {method:'POST', credentials: 'same-origin'}); } catch(e){ console.error('Logout request failed', e) } finally { window.location.href='/login' } }} className=\"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50\">Logout</button>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <div className=\"py-3\">\n              <div className=\"flex flex-col lg:flex-row lg:items-center gap-3\">\n                <div className=\"flex-1\">\n                  <label className=\"relative block\">\n                    <span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-neutral-400 pointer-events-none\"><Search className=\"w-4 h-4\"/></span>\n                    <input value={searchQ} onChange={e=>setSearchQ(e.target.value)} id=\"global-search\" type=\"text\" placeholder=\"Search by order #ID or customer name...\" className=\"block w-full rounded-lg border border-neutral-200 bg-white py-2 pl-9 pr-3 placeholder:text-neutral-400 hover:border-neutral-300 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-neutral-900/10 text-sm\" />\n                  </label>\n                </div>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <section className=\"bg-white border border-neutral-200 rounded-xl p-4 sm:p-5 mb-6\">\n          <div className=\"flex flex-col gap-4\">\n            <div className=\"flex flex-col md:flex-row md:items-center gap-3 justify-between\">\n              <div className=\"inline-flex items-center gap-2\">\n                <span className=\"text-sm text-neutral-500\">View</span>\n                <div className=\"inline-flex rounded-lg border border-neutral-200 overflow-hidden\">\n                  <button onClick={()=>setView('grid')} id=\"btn-grid\" className={`px-3 py-1.5 text-sm inline-flex items-center gap-1.5 ${view==='grid' ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-700'}`}><LayoutGrid className=\"w-4 h-4\"/> Grid</button>\n                  <button onClick={()=>setView('list')} id=\"btn-list\" className={`px-3 py-1.5 text-sm inline-flex items-center gap-1.5 ${view==='list' ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-700'}`}><ListIcon className=\"w-4 h-4\"/> List</button>\n                </div>\n              </div>\n\n              <div className=\"inline-flex items-center gap-2\">\n                <span className=\"text-sm text-neutral-500\">Sort</span>\n                <label className=\"relative\">\n                  <select value={sortMode} onChange={e=>setSortMode(e.target.value)} id=\"sort-select\" className=\"appearance-none rounded-lg border border-neutral-200 bg-white px-3 py-1.5 pr-8 text-sm text-neutral-700 hover:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-neutral-900/10\">\n                    <option value=\"newest\">Newest first</option>\n                    <option value=\"oldest\">Oldest first</option>\n                    <option value=\"amount-high\">Amount: High to Low</option>\n                    <option value=\"amount-low\">Amount: Low to High</option>\n                    <option value=\"name-az\">Customer: A → Z</option>\n                  </select>\n                  <i className=\"pointer-events-none w-4 h-4 text-neutral-400 absolute right-2 top-1/2 -translate-y-1/2\">▾</i>\n                </label>\n              </div>\n\n              <div className=\"flex items-center gap-3\">\n                <div className=\"text-sm text-neutral-500\"><span id=\"results-count\" className=\"font-medium text-neutral-800\">{loading ? '...' : filteredOrders ? filteredOrders.length : 0}</span> results</div>\n                <button onClick={resetFilters} id=\"reset-filters\" className=\"inline-flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-sm text-neutral-700 bg-white hover:bg-neutral-50 border border-neutral-200\">Reset</button>\n              </div>\n            </div>\n\n            <div className=\"h-px bg-neutral-200/80\"></div>\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-4\">\n              <div className=\"lg:col-span-5\">\n                <div className=\"text-sm text-neutral-500 mb-2\">Status</div>\n                <div className=\"flex flex-wrap gap-2\">\n                  {STATUS_LIST.map(s => (\n                    <button key={s} data-status={s} onClick={() => toggleStatus(s)} className={`status-chip text-sm ${s==='all' ? (selectedStatuses.size===0 ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-700') : (selectedStatuses.has(s) ? 'bg-neutral-900 text-white' : 'bg-white text-neutral-700')} px-3 py-1.5 rounded-lg border border-neutral-200`}>{s.charAt(0).toUpperCase() + s.slice(1)}</button>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"lg:col-span-3\">\n                <div className=\"text-sm text-neutral-500 mb-2\">Date range</div>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <label className=\"block\"><input value={dateFromInput} onChange={e=>setDateFromInput(e.target.value)} id=\"date-from\" type=\"date\" className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-1.5 text-sm text-neutral-700\"/></label>\n                  <label className=\"block\"><input value={dateToInput} onChange={e=>setDateToInput(e.target.value)} id=\"date-to\" type=\"date\" className=\"w-full rounded-lg border border-neutral-200 bg-white px-3 py-1.5 text-sm text-neutral-700\"/></label>\n                </div>\n              </div>\n\n              <div className=\"lg:col-span-4\">\n                <div className=\"text-sm text-neutral-500 mb-2\">Amount</div>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  <label className=\"relative\"><span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 text-xs\">Rs</span><input value={amountMin} onChange={e=>setAmountMin(e.target.value)} id=\"amount-min\" type=\"number\" min=\"0\" step=\"0.01\" placeholder=\"Min\" className=\"w-full rounded-lg border border-neutral-200 bg-white pl-6 pr-3 py-1.5 text-sm text-neutral-700\"/></label>\n                  <label className=\"relative\"><span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400 text-xs\">Rs</span><input value={amountMax} onChange={e=>setAmountMax(e.target.value)} id=\"amount-max\" type=\"number\" min=\"0\" step=\"0.01\" placeholder=\"Max\" className=\"w-full rounded-lg border border-neutral-200 bg-white pl-6 pr-3 py-1.5 text-sm text-neutral-700\"/></label>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {error && <div className=\"text-sm text-red-600 mb-4\">{error}</div>}\n\n        {/* Grid view */}\n        <div className={`${view !== 'grid' ? 'hidden' : ''} grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4`}>\n          {filteredOrders.map(o => (\n            <OrderCard key={o._id} order={o} onAction={onAction} />\n          ))}\n        </div>\n\n        {/* List view */}\n        <div className={`${view !== 'list' ? 'hidden' : ''} divide-y divide-neutral-200 bg-white rounded-xl border border-neutral-200 overflow-hidden`}>\n          {/* header row */}\n          <div className=\"hidden md:grid grid-cols-12 gap-3 px-4 py-3 bg-neutral-50 text-xs text-neutral-500\">\n            <div className=\"col-span-4\">Customer</div>\n            <div className=\"col-span-2\">Status</div>\n            <div className=\"col-span-2\">Amount</div>\n            <div className=\"col-span-3\">Date</div>\n            <div className=\"col-span-1 text-right\">Action</div>\n          </div>\n\n          {filteredOrders.map(o => (\n            <div key={o._id} className=\"grid grid-cols-12 gap-3 items-center px-4 py-3\">\n              <div className=\"col-span-12 md:col-span-4\">\n                <div className=\"font-medium text-neutral-900 truncate\">{o.name || '—'}</div>\n                <div className=\"text-xs text-neutral-500\">#{o._id?.toString().slice(-8)}</div>\n                {/* linear tab showing products (collapsed by default) */}\n                <details className=\"mt-2\">\n                  <summary className=\"text-sm text-neutral-600 cursor-pointer\">Products ({(o.items || []).length})</summary>\n                  <div className=\"mt-2 text-sm text-neutral-700\">\n                    <ul className=\"list-disc pl-5\">\n                      {(o.items || []).map((it, i) => (\n                        <li key={i} className=\"truncate\">{it.name || it.menuItem || 'Unknown Item'} × {it.quantity} — Rs {Number(it.price || 0).toFixed(0)}</li>\n                      ))}\n                    </ul>\n                  </div>\n                </details>\n              </div>\n\n              <div className=\"col-span-6 md:col-span-2\">\n                <span className=\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-neutral-50 text-neutral-700 border border-neutral-200\">{(o.status || '').charAt(0).toUpperCase() + (o.status || '').slice(1)}</span>\n              </div>\n\n              <div className=\"col-span-6 md:col-span-2 font-medium text-neutral-900\">Rs {Number(o.total || 0).toFixed(0)}</div>\n\n              <div className=\"col-span-8 md:col-span-3 text-sm text-neutral-600\">{new Date(o.createdAt).toLocaleString()}</div>\n\n              <div className=\"col-span-4 md:col-span-1 flex justify-end\">\n                <button onClick={() => window.print()} className=\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-neutral-200 bg-white text-neutral-700\">Print</button>\n              </div>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"mt-6 flex items-center justify-between\">\n          <div className=\"text-sm text-neutral-500\">Showing {filteredOrders.length} orders</div>\n          <div className=\"flex items-center gap-2\">\n            <button onClick={() => { setPage(0) }} className=\"text-sm text-neutral-600 underline\">Go to most recent</button>\n            <div className=\"text-sm text-neutral-500\">Page {page + 1}</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}","size_bytes":19427},"src/components/RestaurantProfile/DeleteBranchModal.jsx":{"content":"'use client'\n\nimport { X, Trash2 } from 'lucide-react'\n\nexport default function DeleteBranchModal({ branchName, onConfirm, onCancel }) {\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      <div className=\"absolute inset-0 bg-black/30\" onClick={onCancel}></div>\n      <div className=\"relative z-10 w-full max-w-md rounded-xl border border-neutral-200 bg-white p-4 sm:p-5 shadow-xl\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"rounded-lg bg-red-50 p-2 text-red-600\">\n            <Trash2 className=\"h-5 w-5\" />\n          </div>\n          <div className=\"flex-1 min-w-0\">\n            <h3 className=\"text-base sm:text-lg font-semibold tracking-tight\">Delete branch</h3>\n            <p className=\"mt-1 text-sm text-neutral-600\">\n              Are you sure you want to delete <strong>{branchName}</strong>? This action cannot be undone.\n            </p>\n          </div>\n          <button className=\"rounded-md p-1 hover:bg-neutral-100\" onClick={onCancel}>\n            <X className=\"h-5 w-5\" />\n          </button>\n        </div>\n        <div className=\"mt-4 flex flex-col-reverse sm:flex-row items-stretch sm:items-center justify-end gap-2\">\n          <button\n            className=\"rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm font-medium text-neutral-800 hover:bg-neutral-50\"\n            onClick={onCancel}\n          >\n            Cancel\n          </button>\n          <button\n            className=\"rounded-lg bg-red-600 px-3 py-2 text-sm font-medium text-white hover:bg-red-700\"\n            onClick={onConfirm}\n          >\n            Delete\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n","size_bytes":1699},"src/components/MenuManagement/Header.jsx":{"content":" 'use client'\n\nimport { useRouter } from 'next/navigation'\nimport Image from 'next/image'\nimport { ArrowLeft } from 'lucide-react'\nimport { useRestaurant } from '@/hooks/useRestaurant'\n\nexport default function Header({ title = 'Menu Management', subtitle = 'Manage items, categories, and availability' }) {\n  const router = useRouter()\n  const { restaurant, loading } = useRestaurant()\n\n  async function handleLogout() {\n    try {\n      await fetch('/api/auth/logout', { method: 'POST', credentials: 'same-origin' })\n    } catch (e) {\n      console.error('Logout request failed', e)\n    } finally {\n      // ensure redirect even if fetch fails\n      try {\n        router.push('/84588878l00o00g00i00n76580982')\n      } catch (err) {\n        // fallback\n        window.location.href = '/84588878l00o00g00i00n76580982'\n      }\n    }\n  }\n  return (\n    <header className=\"bg-white border-b border-neutral-200\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <button\n            onClick={() => router.push('/admin')}\n            className=\"inline-flex items-center justify-center w-8 h-8 rounded-lg border border-neutral-200 bg-white hover:bg-neutral-50 transition-colors\"\n            type=\"button\"\n            aria-label=\"Back to admin\"\n          >\n            <ArrowLeft className=\"w-4 h-4\" />\n          </button>\n          {restaurant?.logo ? (\n            <div className=\"relative h-8 w-8 rounded-lg overflow-hidden flex-shrink-0\">\n              <Image\n                src={restaurant.logo}\n                alt={restaurant.name || 'Restaurant Logo'}\n                fill\n                className=\"object-contain\"\n                onError={(e) => {\n                  e.target.style.display = 'none'\n                  e.target.nextSibling.style.display = 'flex'\n                }}\n              />\n              <div className=\"hidden h-8 w-8 rounded-lg bg-neutral-900 text-white items-center justify-center text-xs tracking-tight font-semibold select-none\">MM</div>\n            </div>\n          ) : (\n            <div className=\"h-8 w-8 rounded-lg bg-neutral-900 text-white flex items-center justify-center text-xs tracking-tight font-semibold select-none\">MM</div>\n          )}\n          <div className=\"leading-tight\">\n            <h1 className=\"text-xl sm:text-2xl tracking-tight font-semibold\">{title}</h1>\n            <p className=\"text-xs text-neutral-500\">{subtitle}</p>\n          </div>\n        </div>\n        <div className=\"hidden md:flex items-center gap-2\">\n          <button className=\"inline-flex items-center gap-2 text-sm px-3 py-2 rounded-lg border border-neutral-200 bg-white hover:bg-neutral-50 focus:outline-none\" type=\"button\">Settings</button>\n          <button onClick={handleLogout} type=\"button\" className=\"inline-flex items-center gap-2 text-sm px-3 py-2 rounded-lg border border-red-200 bg-white text-red-600 hover:bg-red-50\">Logout</button>          \n        </div>        \n      </div>\n    </header>\n  )\n}\n","size_bytes":3048},"src/models/Order.js":{"content":"import mongoose from 'mongoose'\n\n// Customer Schema\nconst customerSchema = new mongoose.Schema({\n  name: { type: String, default: '' },\n  phone: { type: String, default: '' },\n  email: { type: String, default: '' },\n  address: { type: String, default: '' }\n}, { _id: false })\n\n// Order Item Schema\nconst orderItemSchema = new mongoose.Schema({\n  menuItemId: { type: mongoose.Schema.Types.ObjectId, required: true },\n  name: { type: String, default: '' }, // Denormalized name for reference\n  variant: { type: String, default: '' }, // Selected variant name\n  price: { type: Number, required: true }, // Price at time of order\n  quantity: { type: Number, default: 1 },\n  selectedSides: [{\n    name: String, // Changed from sideName to name\n    extraPrice: Number,\n    img: String // Optional image\n  }]\n}, { _id: false })\n\n// Order Schema (normalized collection)\nconst orderSchema = new mongoose.Schema({\n  restaurantId: { \n    type: mongoose.Schema.Types.ObjectId, \n    required: true,\n    ref: 'Restaurant',\n    index: true\n  },\n  userId: { \n    type: mongoose.Schema.Types.ObjectId, \n    ref: 'User',\n    default: null \n  },\n  customer: {\n    type: customerSchema,\n    required: true\n  },\n  items: [orderItemSchema],\n  total: { type: Number, required: true },\n  status: { \n    type: String, \n    enum: ['pending', 'accepted', 'preparing', 'prepared', 'delivering', 'delivered', 'declined'],\n    default: 'pending',\n    index: true\n  },\n  type: {\n    type: String,\n    enum: ['pickup', 'delivery', 'dinein'],\n    default: 'delivery'\n  },\n  branch: { \n    type: String, \n    default: '', // Location key (e.g., 'islamabad', 'rawalpindi') for pickup orders\n    trim: false, // Disable trim to ensure value is preserved\n    required: false // Explicitly not required\n  },\n  instructions: { type: String, default: '' },\n  createdAt: { type: Date, default: Date.now, index: true }\n}, {\n  // Ensure all fields are saved, even if they have default values\n  minimize: false\n})\n\n// Indexes for efficient querying\n// Primary query pattern: get orders by restaurant, ordered by date\norderSchema.index({ restaurantId: 1, createdAt: -1 })\n\n// Status filtering: get orders by restaurant and status\norderSchema.index({ restaurantId: 1, status: 1 })\n\n// Branch filtering: get orders by restaurant and branch/location\norderSchema.index({ restaurantId: 1, branch: 1 })\n\n// Menu item lookups: find orders containing specific menu items\norderSchema.index({ restaurantId: 1, 'items.menuItemId': 1 })\n\n// Global ordering for analytics\norderSchema.index({ createdAt: -1 })\n\n// Delete existing model if it exists to force schema recompilation with branch field\nif (mongoose.models.Order) {\n  delete mongoose.models.Order\n}\n// Only delete from modelSchemas if it exists\nif (mongoose.modelSchemas && mongoose.modelSchemas.Order) {\n  delete mongoose.modelSchemas.Order\n}\n\nexport const Order = mongoose.model('Order', orderSchema)\n","size_bytes":2904},"src/components/Customer/Testimonials.jsx":{"content":"import Image from 'next/image';\nimport { colors } from '@/constants/colors';\n\nexport default function Testimonials() {\n  return (\n    <section className=\"mx-auto mt-20 max-w-7xl px-6\">\n      <div className=\"rounded-3xl border p-6 sm:p-10\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgSec }}>\n        <h2 className=\"text-3xl sm:text-4xl tracking-tight\" style={{ fontFamily: 'Poppins', fontWeight: 600, color: colors.textDark }}>What Our Customers Say</h2>\n        <div className=\"mt-6 flex snap-x snap-mandatory gap-4 overflow-x-auto pb-4\">\n          <div className=\"min-w-[280px] snap-start rounded-2xl border p-5\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgPrimary }}>\n            <div className=\"flex items-center gap-3\">\n              <Image src=\"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop\" alt=\"Customer\" width={40} height={40} className=\"h-10 w-10 rounded-full object-cover\" />\n              <div>\n                <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>Ayesha K.</p>\n                <p className=\"text-xs\" style={{ color: colors.textMuted }}>Islamabad</p>\n              </div>\n            </div>\n            <p className=\"mt-3 text-sm\" style={{ color: colors.textDark }}>🔥 Hot and fresh! The wok rice was perfect. Will order again.</p>\n            <p className=\"mt-2 text-base\">🌟🌟🌟🌟🌟</p>\n          </div>\n          <div className=\"min-w-[280px] snap-start rounded-2xl border p-5\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgPrimary }}>\n            <div className=\"flex items-center gap-3\">\n              <Image src=\"https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?q=80&w=200&auto=format&fit=crop\" alt=\"Customer\" width={40} height={40} className=\"h-10 w-10 rounded-full object-cover\" />\n              <div>\n                <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>Hamza R.</p>\n                <p className=\"text-xs\" style={{ color: colors.textMuted }}>G-13/1</p>\n              </div>\n            </div>\n            <p className=\"mt-3 text-sm\" style={{ color: colors.textDark }}>Great burgers and super quick delivery. Family loved it.</p>\n            <p className=\"mt-2 text-base\">🌟🌟🌟🌟🌟</p>\n          </div>\n          <div className=\"min-w-[280px] snap-start rounded-2xl border p-5\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgPrimary }}>\n            <div className=\"flex items-center gap-3\">\n              <Image src=\"https://images.unsplash.com/photo-1527980965255-d3b416303d12?q=80&w=200&auto=format&fit=crop\" alt=\"Customer\" width={40} height={40} className=\"h-10 w-10 rounded-full object-cover\" />\n              <div>\n                <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>Amna S.</p>\n                <p className=\"text-xs\" style={{ color: colors.textMuted }}>H-13</p>\n              </div>\n            </div>\n            <p className=\"mt-3 text-sm\" style={{ color: colors.textDark }}>Loved the Asian fusion flavors. Highly recommended!</p>\n            <p className=\"mt-2 text-base\">🌟🌟🌟🌟🌟</p>\n          </div>\n          <div className=\"min-w-[280px] snap-start rounded-2xl border p-5\" style={{ borderColor: colors.borderLight, backgroundColor: colors.bgPrimary }}>\n            <div className=\"flex items-center gap-3\">\n              <Image src=\"https://images.unsplash.com/photo-1541534401786-2077eed87a72?q=80&w=200&auto=format&fit=crop\" alt=\"Customer\" width={40} height={40} className=\"h-10 w-10 rounded-full object-cover\" />\n              <div>\n                <p className=\"text-sm font-semibold\" style={{ color: colors.textDark }}>Daniyal M.</p>\n                <p className=\"text-xs\" style={{ color: colors.textMuted }}>G-14</p>\n              </div>\n            </div>\n            <p className=\"mt-3 text-sm\" style={{ color: colors.textDark }}>Affordable deals and generous portions. Value for money!</p>\n            <p className=\"mt-2 text-base\">🌟🌟🌟🌟🌟</p>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}","size_bytes":4149},"src/app/api/auth/login/route.js":{"content":"import { sign } from 'jsonwebtoken'\nimport { connectToDB, findUserByEmail } from '@/services/db'\nimport bcrypt from 'bcryptjs'\nimport { getOrCreateDefaultRestaurant } from '@/utils/getRestaurantId'\n\nexport async function POST(request) {\n  try {\n    const { email, password } = await request.json()\n    console.log('Login attempt for email:', email)\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return new Response(\n        JSON.stringify({ error: 'No restaurant found. Please create a restaurant first.' }),\n        { status: 404, headers: { 'Content-Type': 'application/json' } }\n      )\n    }\n    \n    await connectToDB()\n\n    // Find user in User collection (supports both branch-specific and Global users)\n    const user = await findUserByEmail(restaurantId, email)\n    console.log('Found user:', user ? { \n      _id: user._id,\n      email: user.email, \n      role: user.role,\n      restaurantId: user.restaurantId,\n      passwordHashLength: user.passwordHash?.length \n    } : 'No user found')\n    \n    if (!user) {\n      return new Response(\n        JSON.stringify({ error: 'Invalid credentials' }),\n        { status: 401, headers: { 'Content-Type': 'application/json' } }\n      )\n    }\n\n    // Verify password with bcrypt since it was hashed in Express backend\n    console.log('Attempting password verification')\n    const isValidPassword = await bcrypt.compare(password, user.passwordHash)\n    console.log('Password verification result:', isValidPassword)\n    if (!isValidPassword) {\n      return new Response(\n        JSON.stringify({ error: 'Invalid credentials' }),\n        { status: 401, headers: { 'Content-Type': 'application/json' } }\n      )\n    }\n\n    // Create token\n    // Users now have _id in separate collection\n    const token = sign(\n      { \n        userId: user._id.toString(), // Use _id as identifier\n        restaurantId: user.restaurantId ? user.restaurantId.toString() : restaurantId, // Use user's restaurantId or fallback\n        email: user.email,\n        role: user.role,\n        firstName: user.firstName,\n        lastName: user.lastName\n      },\n      process.env.JWT_SECRET,\n      { expiresIn: '1d' }\n    )\n\n    // Calculate cookie expiry\n    const cookieExpiry = new Date();\n    cookieExpiry.setDate(cookieExpiry.getDate() + 1); // 1 day from now\n\n    // Create response with cookie in header\n    const response = new Response(\n      JSON.stringify({ \n        token,\n        role: user.role,\n        firstName: user.firstName,\n        lastName: user.lastName\n      }),\n      { \n        status: 200,\n        headers: { \n          'Content-Type': 'application/json',\n          'Set-Cookie': `token=${token}; Path=/; HttpOnly; Secure=${process.env.NODE_ENV === 'production'}; SameSite=Lax; Expires=${cookieExpiry.toUTCString()}`\n        }\n      }\n    )\n\n    return response\n  } catch (error) {\n    console.error('Login error:', error)\n    return new Response(\n      JSON.stringify({ error: 'Internal server error' }),\n      { status: 500, headers: { 'Content-Type': 'application/json' } }\n    )\n  }\n}","size_bytes":3088},"src/app/menu/page.jsx":{"content":"\"use client\";\n\nimport { useEffect, useState, useRef } from \"react\";\n// Use Next.js API routes (relative fetch). Removed axios backend `api` import.\nimport ProductSidebar from \"@/components/Menu/ProductSidebar\";\nimport ProductGrid from \"@/components/Menu/ProductGrid\";\nimport CartOverlay from \"@/components/Menu/CartOverlay\";\n// import DesktopCartButton from \"@/components/Menu/DesktopCartButton\";\nimport Footer from '@/components/Customer/Footer';\nimport Header from '@/components/Customer/Header';\nimport { colors, iconBackgrounds } from '@/constants/colors';\n\nexport default function MenuPage() {\n  const [categories, setCategories] = useState([]);\n  const [items, setItems] = useState([]);\n  const [selectedCategory, setSelectedCategory] = useState(null);\n  const [error, setError] = useState(null);\n\n  const sectionRefs = useRef({});\n  const gridRef = useRef(null);\n\n  \n  // fetch categories from Next.js API\n  const fetchCategories = async () => {\n    try {\n      const res = await fetch('/api/categories');\n      const json = await res.json();\n      if (!res.ok || !json.success) throw new Error(json.error || 'Failed to fetch categories');\n      setCategories(json.data || []);\n      if ((json.data || []).length > 0) {\n        setSelectedCategory(json.data[0]._id);\n      }\n    } catch (err) {\n      console.error('fetchCategories error', err);\n      setError('Failed to load categories');\n    }\n  };\n\n  // fetch items from Next.js API\n  const fetchItems = async () => {\n    try {\n      const res = await fetch('/api/menu-items');\n      const json = await res.json();\n      if (!res.ok || !json.success) throw new Error(json.error || 'Failed to fetch items');\n      // API returns array of items in json.data\n      setItems(json.data || []);\n    } catch (err) {\n      console.error('fetchItems error', err);\n      setError('Failed to load items');\n    }\n  };\n\n  useEffect(() => {\n    fetchCategories();\n    fetchItems();\n  }, []);\n\n  // scroll tracking\n  useEffect(() => {\n    // Wait until categories and the grid container are available\n    if (!categories.length || !gridRef.current) return;\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        // Pick the intersecting entry closest to the top of the grid root.\n        const intersecting = entries.filter((e) => e.isIntersecting);\n        if (intersecting.length) {\n          let best = intersecting[0];\n          let bestDistance = Math.abs(best.boundingClientRect.top);\n          for (let i = 1; i < intersecting.length; i++) {\n            const e = intersecting[i];\n            const dist = Math.abs(e.boundingClientRect.top);\n            if (dist < bestDistance) {\n              best = e;\n              bestDistance = dist;\n            }\n          }\n          setSelectedCategory(best.target.dataset.category);\n        }\n      },\n      { root: gridRef.current, rootMargin: \"-50% 0px -40% 0px\", threshold: 0 }\n    );\n\n    categories.forEach((cat) => {\n      const el = sectionRefs.current[cat._id];\n      if (el) observer.observe(el);\n    });\n\n    return () => observer.disconnect();\n  }, [categories, gridRef]);\n\n  if (error) {\n    return <div className=\"text-red-500 font-medium p-4\">{error}</div>;\n  }\n\n  return (\n    <div style={{ backgroundColor: colors.bgPrimary, color: colors.textDark}}>\n    <Header/>\n    <div className=\"flex flex-col md:flex-row gap-5 p-5 pt-20 sm:pt-24 h-[calc(100vh-5rem)] sm:h-[calc(100vh-6rem)]\">\n      {/* Sidebar */}\n      <div className=\"md:w-52 w-full md:h-auto md:max-h-[calc(100vh-7rem)] overflow-auto no-scrollbar\">\n        <ProductSidebar\n          categories={categories}\n          selectedCategory={selectedCategory}\n          onSelect={(id) => {\n            setSelectedCategory(id);\n            sectionRefs.current[id]?.scrollIntoView({ behavior: \"smooth\" });\n          }}\n          onCategoryAdded={(newCat) => {\n            setCategories((prev) => [...prev, newCat]);\n            setSelectedCategory(newCat._id);\n          }}\n          onCategoryUpdated={(updated) => {\n            setCategories((prev) => prev.map((c) => (c._id === updated._id ? updated : c)));\n          }}\n          onCategoryDeleted={(id) => {\n            setCategories((prev) => prev.filter((c) => c._id !== id));\n            if (selectedCategory === id) {\n              setSelectedCategory((cats) => (categories.length ? categories[0]?._id : null));\n            }\n          }}\n        />\n      </div>\n\n      {/* Grid */}\n      <div ref={gridRef} className=\"flex-1 overflow-auto px-1 py-2 no-scrollbar\">\n        <ProductGrid\n          categories={categories}\n          items={items}\n          setItems={setItems}\n          sectionRefs={sectionRefs}\n        />\n      </div>\n\n      {/* Cart overlay (mobile bar + sheet). pass items so product info can be resolved */}\n      <CartOverlay products={items} style={{ backgroundColor: colors.bgPrimary, color: '#000000ff'}}/>\n\n      {/* Desktop floating cart button\n      <DesktopCartButton /> */}\n      \n      \n\n    </div>\n    <Footer/>\n    </div>\n  );\n}\n","size_bytes":5005},"src/app/api/orders/history/route.js":{"content":"export async function GET(request) {\n  try {\n    const url = new URL(request.url);\n    const startDate = url.searchParams.get('startDate');\n    const endDate = url.searchParams.get('endDate');\n    const status = url.searchParams.get('status');\n\n    // Get restaurant ID\n    const { getOrCreateDefaultRestaurant } = await import('../../../../utils/getRestaurantId');\n    const restaurantId = await getOrCreateDefaultRestaurant();\n    if (!restaurantId) {\n      return Response.json({ error: 'No restaurant found' }, { status: 404 });\n    }\n\n    // Dynamically import DB helpers to avoid bundling server-only modules\n    const { getAllOrders, connectToDB } = await import('../../../../services/db');\n    await connectToDB();\n\n    const filters = {};\n    if (startDate) filters.startDate = startDate;\n    if (endDate) filters.endDate = endDate;\n    if (status) filters.status = status;\n\n    const orders = await getAllOrders(restaurantId, filters);\n    return Response.json(orders);\n  } catch (error) {\n    console.error('Failed to fetch order history:', error);\n    return Response.json({ error: 'Failed to fetch order history' }, { status: 500 });\n  }\n}\n","size_bytes":1153},"src/utils/menuData.jsx":{"content":"export const categories = [\n  { id: 'all', label: 'All Items' },\n  { id: '68c159637c066ed9febf1044', label: 'Pasta' },\n  { id: '68c2e6c45c0584269a03cd9e', label: 'Checkin up' },\n  { id: '68c314105c0584269a03cea6', label: 'New Catagory' },\n  { id: '68de1a10f1bb59b192668a3c', label: 'Sauses' }\n];\n\nexport const menuItems = [\n  {\n    _id: '68de1bd1f1bb59b192668a65',\n    name: 'Alferado',\n    description: 'Delitiaso',\n    image: 'https://res.cloudinary.com/duugxwfu3/image/upload/v1759386571/jstfhmoxthc2r2dxyswk.png',\n    price: 12,\n    category: {\n      _id: '68c159637c066ed9febf1044',\n      name: 'Pasta',\n      description: 'Delirious Pasta',\n      createdAt: '2025-09-10T10:56:35.194Z',\n      __v: 0\n    },\n    sides: [],\n    isAvailable: true,\n    createdAt: '2025-10-02T06:29:37.363Z',\n    __v: 0\n  },\n  {\n    _id: '68de1c17f1bb59b192668a68',\n    name: 'product',\n    description: 'smsaf k sc lsc',\n    image: 'https://res.cloudinary.com/duugxwfu3/image/upload/v1759386641/kol6dn4hdoduwtjquapn.png',\n    price: 20,\n    category: {\n      _id: '68c159637c066ed9febf1044',\n      name: 'Pasta',\n      description: 'Delirious Pasta',\n      createdAt: '2025-09-10T10:56:35.194Z',\n      __v: 0\n    },\n    sides: [],\n    isAvailable: true,\n    createdAt: '2025-10-02T06:30:47.326Z',\n    __v: 0\n  },\n  {\n    _id: '68de33bbc90fa3187100c4aa',\n    name: 'New item',\n    description: 'nskfnns',\n    image: '',\n    price: 244,\n    category: {\n      _id: '68de1a10f1bb59b192668a3c',\n      name: 'Sauses',\n      description: '',\n      headerImage: '',\n      createdAt: '2025-10-02T06:22:08.494Z',\n      __v: 0\n    },\n    sides: [],\n    isAvailable: true,\n    createdAt: '2025-10-02T08:11:39.389Z',\n    __v: 0\n  },\n  {\n    _id: '68de33d7c90fa3187100c4bc',\n    name: 'Testing',\n    description: 'sfkn',\n    image: '',\n    price: 33,\n    category: {\n      _id: '68c2e6c45c0584269a03cd9e',\n      name: 'Checkin up',\n      description: 'new test',\n      headerImage: 'https://res.cloudinary.com/duugxwfu3/image/upload/v1757603520/ekajsz8k8lfdzmcg2vvz.png',\n      createdAt: '2025-09-11T15:12:04.998Z',\n      __v: 0\n    },\n    sides: [],\n    isAvailable: true,\n    createdAt: '2025-10-02T08:12:07.200Z',\n    __v: 0\n  }\n];","size_bytes":2206},"src/app/api/restaurants/route.js":{"content":"import { createRestaurant, connectToDB } from '../../../services/db'\nimport { getOrCreateDefaultRestaurant } from '../../../utils/getRestaurantId'\n\nexport async function POST(request) {\n  try {\n    const body = await request.json()\n    \n    await connectToDB()\n    \n    const restaurant = await createRestaurant({\n      name: body.name || 'My Restaurant',\n      logo: body.logo || '',\n      description: body.description || '',\n      cuisine: body.cuisine || '',\n      owner: body.owner || '',\n      contactEmail: body.contactEmail || '',\n      contactPhone: body.contactPhone || '',\n      isLive: body.isLive || false,\n      branches: body.branches || []\n    })\n    \n    return Response.json({\n      success: true,\n      data: restaurant,\n      timestamp: new Date().toISOString()\n    })\n  } catch (error) {\n    console.error('Failed to create restaurant:', error)\n    return Response.json({\n      success: false,\n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 500 })\n  }\n}\n\nexport async function GET(request) {\n  try {\n    const restaurantId = await getOrCreateDefaultRestaurant()\n    \n    const { getRestaurant } = await import('../../../services/db')\n    await connectToDB()\n    \n    const restaurant = await getRestaurant(restaurantId)\n    \n    // Ensure branches is an array and properly formatted\n    if (!restaurant.branches) {\n      restaurant.branches = []\n    }\n    if (!Array.isArray(restaurant.branches)) {\n      restaurant.branches = []\n    }\n    \n    // Ensure totalBranches matches branches length\n    restaurant.totalBranches = restaurant.branches.length || 0\n    \n    console.log('GET /api/restaurants - Returning restaurant:', {\n      _id: restaurant._id,\n      name: restaurant.name,\n      branchesCount: restaurant.branches?.length || 0,\n      totalBranches: restaurant.totalBranches\n    })\n    \n    return Response.json({\n      success: true,\n      data: restaurant,\n      timestamp: new Date().toISOString()\n    })\n  } catch (error) {\n    console.error('Failed to get restaurant:', error)\n    return Response.json({\n      success: false,\n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 500 })\n  }\n}\n\nexport async function PUT(request) {\n  try {\n    const body = await request.json()\n    console.log('PUT /api/restaurants - Request body:', JSON.stringify(body, null, 2))\n    \n    const restaurantId = await getOrCreateDefaultRestaurant()\n    console.log('PUT /api/restaurants - Restaurant ID:', restaurantId)\n    \n    const { updateRestaurant } = await import('../../../services/db')\n    await connectToDB()\n    \n    // Validate required fields\n    if (body.name && !body.name.trim()) {\n      throw new Error('Restaurant name cannot be empty')\n    }\n    \n    // Ensure branches is an array\n    if (body.branches !== undefined && !Array.isArray(body.branches)) {\n      throw new Error('Branches must be an array')\n    }\n    \n    // Validate branches if provided\n    if (body.branches && Array.isArray(body.branches)) {\n      for (let i = 0; i < body.branches.length; i++) {\n        const branch = body.branches[i]\n        if (!branch.name || !branch.name.trim()) {\n          throw new Error(`Branch ${i + 1}: name is required`)\n        }\n        if (!branch.address || !branch.address.trim()) {\n          throw new Error(`Branch ${i + 1}: address is required`)\n        }\n        if (!branch.city || !branch.city.trim()) {\n          throw new Error(`Branch ${i + 1}: city is required`)\n        }\n      }\n    }\n    \n    const updatedRestaurant = await updateRestaurant(restaurantId, body)\n    console.log('PUT /api/restaurants - Updated restaurant:', {\n      _id: updatedRestaurant._id,\n      name: updatedRestaurant.name,\n      branchesCount: updatedRestaurant.branches?.length || 0,\n      totalBranches: updatedRestaurant.totalBranches\n    })\n    \n    return Response.json({\n      success: true,\n      data: updatedRestaurant,\n      timestamp: new Date().toISOString()\n    })\n  } catch (error) {\n    console.error('Failed to update restaurant:', error)\n    console.error('Error stack:', error.stack)\n    return Response.json({\n      success: false,\n      error: error.message || 'Failed to update restaurant',\n      timestamp: new Date().toISOString()\n    }, { status: 500 })\n  }\n}\n\n","size_bytes":4283},"src/components/Menu/ProductSidebar.jsx":{"content":"\"use client\";\n\nimport { useState } from \"react\";\nimport Image from \"next/image\";\nimport { colors, buttons } from \"@/constants/colors\";\n\nexport default function ProductSidebar({\n  categories,\n  selectedCategory,\n  onSelect,\n}) {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const [editing, setEditing] = useState(null);\n\n  // You should consider fetching the user role client-side only\n  // if this component needs to be rendered without server-side user data.\n  let isAdmin = false;\n  try {\n    // Note: window is not defined during server-side rendering (SSR)\n    if (typeof window !== 'undefined') {\n      const userJson = localStorage.getItem(\"user\");\n      const user = userJson ? JSON.parse(userJson) : null;\n      isAdmin = user?.role === \"super_admin\";\n    }\n  } catch (e) {\n    isAdmin = false;\n  }\n\n  // Common styling for both mobile and desktop views\n  const categoryItemBaseClasses = \"transition-all font-medium\";\n\n  return (\n    <>\n      {/* This single container handles both views:\n        - Mobile (< 768px): flex, overflow-x-auto, whitespace-nowrap (horizontal scroll bar)\n        - Desktop (>= 768px): md:block, md:w-64 (vertical sidebar container)\n      */}\n      <div \n        className=\"flex overflow-x-auto whitespace-nowrap space-x-2 p-2 \n                   md:block md:w-64 md:space-x-0 md:p-0\"\n      >\n        {/*\n          This inner container controls the flow of the items:\n          - Mobile: Default (flex row)\n          - Desktop: md:flex-col and md:space-y-2 (vertical stack)\n        */}\n        <div className=\"md:flex md:flex-col md:space-y-2\">\n          {categories.map((cat) => {\n            const isActive = String(selectedCategory) === String(cat._id);\n            \n            // Determine styles to apply via the 'style' prop (for dynamic colors)\n            const styleProps = isActive \n              ? { \n                  backgroundColor: buttons.primary.background, \n                  color: buttons.primary.text,\n                  borderColor: buttons.primary.background\n                }\n              : {\n                  backgroundColor: colors.bgPrimary,\n                  color: colors.textDark,\n                  borderColor: colors.borderLight,\n                  borderWidth: '1px',\n                  borderStyle: 'solid'\n                };\n                \n            return (\n              <button\n                key={cat._id}\n                onClick={() => onSelect(cat._id)}\n                style={styleProps}\n                className={`${categoryItemBaseClasses} flex-shrink-0 px-4 py-2 rounded-full text-sm md:w-full md:text-left md:px-4 md:py-3 md:rounded-lg transition-all duration-200 hover:opacity-90 ${\n                  !isActive ? 'hover:bg-white/5' : ''\n                }`}\n              >\n                {cat.name}\n              </button>\n            );\n          })}\n        </div>\n      </div>\n    </>\n  );\n}","size_bytes":2896},"src/components/Menu/ProductModal.jsx":{"content":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { X, Plus, Minus, Check } from 'lucide-react'\nimport Image from 'next/image'\n\nexport default function ProductModal({ product, isOpen, onClose, onAddToCart }) {\n  const [selectedVariant, setSelectedVariant] = useState(null)\n  const [selectedSides, setSelectedSides] = useState([])\n  const [quantity, setQuantity] = useState(1)\n  const [price, setPrice] = useState(product?.price || 0)\n\n  useEffect(() => {\n    if (product) {\n      // Initialize with first variant if variants exist\n      if (product.variants && product.variants.length > 0) {\n        setSelectedVariant(product.variants[0])\n        setPrice(product.variants[0].price || product.price || 0)\n      } else {\n        setSelectedVariant(null)\n        setPrice(product.price || 0)\n      }\n      setSelectedSides([])\n      setQuantity(1)\n    }\n  }, [product])\n\n  useEffect(() => {\n    // Calculate price based on variant and sides\n    let basePrice = product?.price || 0\n    \n    if (selectedVariant) {\n      basePrice = selectedVariant.price || basePrice\n    }\n    \n    const sidesPrice = selectedSides.reduce((sum, side) => sum + (side.extraPrice || 0), 0)\n    const finalPrice = (basePrice + sidesPrice) * quantity\n    \n    setPrice(finalPrice)\n  }, [selectedVariant, selectedSides, quantity, product])\n\n  if (!isOpen || !product) return null\n\n  const hasVariants = product.variants && product.variants.length > 0\n  const hasSides = product.sides && product.sides.length > 0\n\n  const handleSideToggle = (side) => {\n    setSelectedSides(prev => {\n      const exists = prev.find(s => s.name === side.name)\n      if (exists) {\n        return prev.filter(s => s.name !== side.name)\n      } else {\n        return [...prev, side]\n      }\n    })\n  }\n\n  const handleAddToCartClick = () => {\n    if (hasVariants && !selectedVariant) {\n      return // Don't allow adding without variant\n    }\n\n    const cartItem = {\n      menuItemId: product._id,\n      name: product.name,\n      description: product.description,\n      image: product.image,\n      price: price / quantity, // Price per item\n      quantity: quantity,\n      variant: selectedVariant ? selectedVariant.variant : '',\n      selectedSides: selectedSides.map(side => ({\n        sideName: side.name,\n        optionName: side.name,\n        extraPrice: side.extraPrice || 0\n      })),\n      product: product // Store full product for reference\n    }\n\n    onAddToCart(cartItem)\n    onClose()\n  }\n\n  const basePricePerItem = selectedVariant \n    ? (selectedVariant.price || product.price || 0)\n    : (product.price || 0)\n\n  const sidesPricePerItem = selectedSides.reduce((sum, side) => sum + (side.extraPrice || 0), 0)\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4\">\n      {/* Backdrop */}\n      <div \n        className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n        onClick={onClose}\n      />\n      \n      {/* Modal Content */}\n      <div className=\"relative w-full max-w-2xl max-h-[90vh] bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col\">\n        {/* Close Button */}\n        <button\n          onClick={onClose}\n          className=\"absolute top-4 right-4 z-10 w-10 h-10 rounded-full bg-white/90 backdrop-blur-sm border border-neutral-200 flex items-center justify-center hover:bg-white transition-colors\"\n          aria-label=\"Close\"\n        >\n          <X className=\"w-5 h-5 text-neutral-700\" />\n        </button>\n\n        {/* Content - Scrollable */}\n        <div className=\"flex-1 overflow-y-auto\">\n          {/* Product Image */}\n          <div className=\"relative w-full bg-neutral-100\" style={{ minHeight: '300px', maxHeight: '400px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n            <img\n              src={product.image}\n              alt={product.name}\n              className=\"max-w-full max-h-full object-contain\"\n              style={{ maxHeight: '400px' }}\n              onError={(e) => {\n                e.target.src = 'https://placehold.co/800x400'\n              }}\n            />\n          </div>\n\n          <div className=\"p-6\">\n            <div className=\"mb-6\">\n              <h2 className=\"text-2xl font-bold text-neutral-900 mb-2\">{product.name}</h2>\n              <p className=\"text-neutral-600\">{product.description || ''}</p>\n            </div>\n\n          {/* Variants Section */}\n          {hasVariants && (\n            <div className=\"mb-6\">\n              <label className=\"text-sm font-semibold text-neutral-900 mb-3 block\">\n                Size / Variant <span className=\"text-red-500\">*</span>\n              </label>\n              <div className=\"space-y-2\">\n                {product.variants.map((variant, idx) => {\n                  const isSelected = selectedVariant?.variant === variant.variant\n                  return (\n                    <button\n                      key={idx}\n                      onClick={() => setSelectedVariant(variant)}\n                      className={`w-full p-3 rounded-lg border-2 transition-all text-left flex items-center gap-3 ${\n                        isSelected\n                          ? 'border-neutral-900 bg-neutral-50'\n                          : 'border-neutral-200 hover:border-neutral-300'\n                      }`}\n                    >\n                      <div className={`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 ${\n                        isSelected \n                          ? 'border-neutral-900 bg-neutral-900' \n                          : 'border-neutral-300'\n                      }`}>\n                        {isSelected && <Check className=\"w-3 h-3 text-white\" />}\n                      </div>\n                      {variant.img && (\n                        <div className=\"relative w-12 h-12 rounded-lg overflow-hidden bg-neutral-100 flex-shrink-0\">\n                          <Image\n                            src={variant.img}\n                            alt={variant.variant}\n                            fill\n                            className=\"object-cover\"\n                            onError={(e) => {\n                              e.target.style.display = 'none'\n                            }}\n                          />\n                        </div>\n                      )}\n                      <div className=\"flex-1 flex items-center justify-between\">\n                        <span className=\"font-medium text-neutral-900\">{variant.variant}</span>\n                        <span className=\"font-semibold text-neutral-900\">\n                          Rs {variant.price?.toFixed(0) || '0'}\n                        </span>\n                      </div>\n                    </button>\n                  )\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Sides Section */}\n          {hasSides && (\n            <div className=\"mb-6\">\n              <label className=\"text-sm font-semibold text-neutral-900 mb-3 block\">\n                Sides / Add-ons\n              </label>\n              <div className=\"space-y-2\">\n                {product.sides.map((side, idx) => {\n                  const isSelected = selectedSides.some(s => s.name === side.name)\n                  return (\n                    <button\n                      key={idx}\n                      onClick={() => handleSideToggle(side)}\n                      className={`w-full p-3 rounded-lg border-2 transition-all text-left flex items-center gap-3 ${\n                        isSelected\n                          ? 'border-neutral-900 bg-neutral-50'\n                          : 'border-neutral-200 hover:border-neutral-300'\n                      }`}\n                    >\n                      <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${\n                        isSelected \n                          ? 'border-neutral-900 bg-neutral-900' \n                          : 'border-neutral-300'\n                      }`}>\n                        {isSelected && <Check className=\"w-3 h-3 text-white\" />}\n                      </div>\n                      <div className=\"flex-1 flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          {side.img && (\n                            <div className=\"relative w-12 h-12 rounded-lg overflow-hidden bg-neutral-100 flex-shrink-0\">\n                              <Image\n                                src={side.img}\n                                alt={side.name}\n                                fill\n                                className=\"object-cover\"\n                                onError={(e) => {\n                                  e.target.style.display = 'none'\n                                }}\n                              />\n                            </div>\n                          )}\n                          <span className=\"font-medium text-neutral-900\">{side.name}</span>\n                        </div>\n                        <span className=\"font-semibold text-neutral-900\">\n                          +Rs {side.extraPrice?.toFixed(0) || '0'}\n                        </span>\n                      </div>\n                    </button>\n                  )\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Quantity Selector */}\n          <div className=\"mb-6 pb-6 border-b border-neutral-200\">\n            <label className=\"text-sm font-semibold text-neutral-900 mb-3 block\">\n              Quantity\n            </label>\n            <div className=\"flex items-center gap-4\">\n              <button\n                onClick={() => setQuantity(Math.max(1, quantity - 1))}\n                className=\"w-10 h-10 rounded-lg border-2 border-neutral-200 flex items-center justify-center hover:bg-neutral-50 transition-colors\"\n              >\n                <Minus className=\"w-4 h-4 text-neutral-700\" />\n              </button>\n              <span className=\"text-xl font-semibold text-neutral-900 w-12 text-center\">\n                {quantity}\n              </span>\n              <button\n                onClick={() => setQuantity(quantity + 1)}\n                className=\"w-10 h-10 rounded-lg border-2 border-neutral-200 flex items-center justify-center hover:bg-neutral-50 transition-colors\"\n              >\n                <Plus className=\"w-4 h-4 text-neutral-700\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Price Summary */}\n          <div className=\"space-y-2 mb-6\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"text-neutral-600\">\n                {selectedVariant ? selectedVariant.variant : 'Base'} Price\n              </span>\n              <span className=\"font-medium text-neutral-900\">\n                Rs {(basePricePerItem * quantity).toFixed(0)}\n              </span>\n            </div>\n            {selectedSides.length > 0 && (\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-neutral-600\">\n                  Sides ({selectedSides.length})\n                </span>\n                <span className=\"font-medium text-neutral-900\">\n                  +Rs {(sidesPricePerItem * quantity).toFixed(0)}\n                </span>\n              </div>\n            )}\n            <div className=\"flex items-center justify-between pt-3 border-t border-neutral-200\">\n              <span className=\"text-lg font-semibold text-neutral-900\">Total</span>\n              <span className=\"text-2xl font-bold text-neutral-900\">\n                Rs {price.toFixed(0)}\n              </span>\n            </div>\n          </div>\n          </div>\n        </div>\n\n        {/* Footer with Add to Cart Button */}\n        <div className=\"border-t border-neutral-200 p-6 bg-neutral-50\">\n          <button\n            onClick={handleAddToCartClick}\n            disabled={hasVariants && !selectedVariant}\n            className={`w-full py-4 rounded-xl font-semibold transition-all flex items-center justify-center gap-2 ${\n              hasVariants && !selectedVariant\n                ? 'bg-neutral-200 text-neutral-400 cursor-not-allowed'\n                : 'bg-neutral-900 text-white hover:bg-neutral-800'\n            }`}\n          >\n            <Plus className=\"w-5 h-5\" />\n            Add to Cart - Rs {price.toFixed(0)}\n          </button>\n          {hasVariants && !selectedVariant && (\n            <p className=\"text-xs text-red-600 text-center mt-2\">\n              Please select a variant\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n","size_bytes":12600},"src/components/AdminDashboard/AdminDashboard.jsx":{"content":" 'use client'\n\nimport React, { useEffect, useMemo, useState } from 'react'\nimport Link from 'next/link'\nimport Sidebar from './Sidebar'\nimport TopBar from './TopBar'\nimport DashboardStats from './DashboardStats'\nimport SalesChart from './SalesChart'\nimport StatusDonut from './StatusDonut'\nimport TopItems from './TopItems'\nimport RecentOrdersTable from './RecentOrdersTable'\n\nfunction getRange(tf) {\n  const now = Date.now()\n  if (tf === 'daily') return { start: now - 24 * 60 * 60 * 1000, buckets: 24, step: 60 * 60 * 1000, label: 'hour' }\n  if (tf === 'monthly') return { start: now - 30 * 24 * 60 * 60 * 1000, buckets: 30, step: 24 * 60 * 60 * 1000, label: 'day' }\n  return { start: now - 7 * 24 * 60 * 60 * 1000, buckets: 7, step: 24 * 60 * 60 * 1000, label: 'day' }\n}\n\nexport default function AdminDashboard() {\n  const [timeframe, setTimeframe] = useState('weekly')\n  const [orders, setOrders] = useState([])\n  const [menuItems, setMenuItems] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [showSidebar, setShowSidebar] = useState(false)\n  const [isDesktop, setIsDesktop] = useState(true)\n\n  useEffect(() => {\n    function check() {\n      try { setIsDesktop(window.innerWidth > 870) } catch (e) { setIsDesktop(true) }\n    }\n    check()\n    window.addEventListener('resize', check)\n    return () => window.removeEventListener('resize', check)\n  }, [])\n\n  useEffect(() => {\n    let mounted = true\n    async function load() {\n      setLoading(true)\n      try {\n        const res = await fetch('/api/orders')\n        if (!res.ok) throw new Error('Failed to fetch orders')\n        const data = await res.json()\n        if (mounted) setOrders(Array.isArray(data) ? data : [])\n      } catch (e) {\n        console.error('Failed to load orders for admin dashboard', e)\n        if (mounted) setOrders([])\n      } finally {\n        if (mounted) setLoading(false)\n      }\n    }\n    load()\n    return () => { mounted = false }\n  }, [])\n\n  useEffect(() => {\n    let mounted = true\n    async function loadMenuItems() {\n      try {\n        const res = await fetch('/api/menu-items?admin=true')\n        if (!res.ok) throw new Error('Failed to fetch menu items')\n        const data = await res.json()\n        if (mounted && data.success && data.data) {\n          setMenuItems(Array.isArray(data.data) ? data.data : [])\n        }\n      } catch (e) {\n        console.error('Failed to load menu items for admin dashboard', e)\n        if (mounted) setMenuItems([])\n      }\n    }\n    loadMenuItems()\n    return () => { mounted = false }\n  }, [])\n\n  const derived = useMemo(() => {\n    // Helper function to resolve menuItemId to menu item name\n    const getMenuItemName = (menuItemId) => {\n      if (!menuItemId) return 'Unknown'\n      \n      // Normalize menuItemId to string for comparison\n      let normalizedMenuItemId = menuItemId\n      if (typeof menuItemId === 'object') {\n        if (menuItemId.$oid) {\n          normalizedMenuItemId = menuItemId.$oid\n        } else {\n          normalizedMenuItemId = menuItemId.toString?.() || String(menuItemId)\n        }\n      } else {\n        normalizedMenuItemId = String(menuItemId)\n      }\n      \n      // If it's not a 24-character hex string (ObjectId format), assume it's already a name\n      if (!normalizedMenuItemId.match(/^[0-9a-fA-F]{24}$/i)) {\n        return normalizedMenuItemId || 'Unknown'\n      }\n      \n      // Look up in menuItems array\n      const menuItem = menuItems.find(item => {\n        if (!item) return false\n        const itemId = item._id\n        if (!itemId) return false\n        \n        let normalizedItemId = itemId\n        if (typeof itemId === 'object') {\n          if (itemId.$oid) {\n            normalizedItemId = itemId.$oid\n          } else {\n            normalizedItemId = itemId.toString?.() || String(itemId)\n          }\n        } else {\n          normalizedItemId = String(itemId)\n        }\n        \n        return normalizedItemId.toLowerCase() === normalizedMenuItemId.toLowerCase()\n      })\n      \n      return menuItem?.name || 'Unknown'\n    }\n    const { start, buckets, step, label } = getRange(timeframe)\n    const filtered = orders.filter(o => (o.createdAt ? +new Date(o.createdAt) : +o.createdAt || 0) >= start)\n\n    const series = Array.from({ length: buckets }, (_, i) => {\n      const t0 = start + i * step\n      const t1 = t0 + step\n      const bucketOrders = filtered.filter(o => {\n        const ts = o.createdAt ? +new Date(o.createdAt) : +o.createdAt || 0\n        return ts >= t0 && ts < t1\n      })\n      const value = bucketOrders.reduce((s, o) => s + (o.total || 0), 0)\n      return { t: t0, value }\n    })\n\n    const revenue = filtered.reduce((s, o) => s + (o.total || 0), 0)\n    const count = filtered.length\n    const aov = count ? revenue / count : 0\n    const deliveredRate = count ? (filtered.filter(o => o.status === 'delivered').length / count) * 100 : 0\n    // estimate profit — repository doesn't have per-item cost, so assume 30% margin\n    const estimatedProfit = revenue * 0.3\n\n    // status counts\n    const counts = filtered.reduce((acc, o) => { acc[o.status] = (acc[o.status] || 0) + 1; return acc }, {})\n\n    // top items - resolve menuItemId to actual menu item names\n    const itemsMap = new Map()\n    for (const o of filtered) {\n      for (const it of o.items || []) {\n        // Try to resolve menuItemId to name, fallback to menuItem (old format) or name\n        const menuItemName = getMenuItemName(it.menuItemId) || it.menuItem || it.name || 'Unknown'\n        const entry = itemsMap.get(menuItemName) || { qty: 0, revenue: 0 }\n        entry.qty += (it.quantity || 1)\n        entry.revenue += (it.price || 0) * (it.quantity || 1)\n        itemsMap.set(menuItemName, entry)\n      }\n    }\n    const topItems = Array.from(itemsMap.entries()).sort((a, b) => b[1].revenue - a[1].revenue).slice(0, 6)\n\n    return { series, revenue, count, aov, deliveredRate, estimatedProfit, counts, topItems }\n  }, [orders, timeframe, menuItems])\n\n  return (\n    <div id=\"app\" className=\"min-h-screen flex bg-white text-neutral-900 font-sans antialiased\">\n      {/* Sidebar */}\n  {showSidebar && !isDesktop && <div className=\"fixed inset-0 z-30 bg-black/50\" onClick={() => setShowSidebar(false)} />}\n  <Sidebar isOpen={showSidebar} isDesktop={isDesktop} onClose={() => setShowSidebar(false)} />\n\n{/* Main content area */}\n      <div className={`flex-1 flex flex-col ${isDesktop ? 'ml-72' : ''}`}>\n  <TopBar onOpenSidebar={() => setShowSidebar(true)} isDesktop={isDesktop} />\n        <main className=\"flex-1 p-4 md:p-6 bg-white\">\n          <div className=\"max-w-7xl mx-auto\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <div>\n                <h1 className=\"text-2xl sm:text-3xl font-semibold text-neutral-900\">Dashboard</h1>\n                <p className=\"text-sm text-neutral-500 mt-1\">Analytics and insights from your store</p>\n              </div>\n              <div className={`inline-flex items-center bg-white border border-neutral-200 rounded-lg p-1 shadow-sm ${isDesktop ? '' : 'w-full justify-end'}`}>\n                {['daily','weekly','monthly'].map(tf => (\n                  <button key={tf} onClick={() => setTimeframe(tf)} data-timeframe={tf} className={`px-3 py-1.5 text-sm rounded-md transition-colors ${timeframe===tf ? 'bg-neutral-900 text-white' : 'text-neutral-700 hover:bg-neutral-50'}`}>\n                    {tf[0].toUpperCase()+tf.slice(1)}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            <DashboardStats\n              revenue={derived.revenue}\n              orders={derived.count}\n              aov={derived.aov}\n              deliveredRate={derived.deliveredRate}\n              estimatedProfit={derived.estimatedProfit}\n              isDesktop={isDesktop}\n            />\n\n            <section className={isDesktop ? 'grid grid-cols-1 xl:grid-cols-12 gap-4' : 'grid grid-cols-1 gap-4'}>\n          <div className={isDesktop ? 'xl:col-span-8 rounded-xl bg-white border border-neutral-200 shadow-sm' : 'col-span-full rounded-xl bg-white border border-neutral-200 shadow-sm'}>\n                <div className=\"p-4 border-b border-neutral-200 flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-sm text-neutral-500 uppercase tracking-wide\">Revenue</div>\n                    <div className=\"text-lg font-semibold text-neutral-900\">Sales over time</div>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-xs text-neutral-500\">\n                    <span className=\"inline-flex items-center gap-1\"><span className=\"h-2 w-2 rounded-full bg-neutral-900\"></span> Revenue</span>\n                  </div>\n                </div>\n                <div className=\"p-4\">\n                  <SalesChart series={derived.series} />\n                </div>\n              </div>\n\n              <div className={isDesktop ? 'xl:col-span-4 rounded-xl bg-white border border-neutral-200 shadow-sm' : 'col-span-full rounded-xl bg-white border border-neutral-200 shadow-sm'}>\n                <div className=\"p-4 border-b border-neutral-200\">\n                  <div className=\"text-sm text-neutral-500 uppercase tracking-wide\">Fulfillment</div>\n                  <div className=\"text-lg font-semibold text-neutral-900\">Order status</div>\n                </div>\n                <div className=\"p-4\">\n                  <StatusDonut counts={derived.counts} total={derived.count || 0} />\n                </div>\n              </div>\n            </section>\n\n            <section className={isDesktop ? 'grid grid-cols-1 xl:grid-cols-12 gap-4 mt-4' : 'grid grid-cols-1 gap-4 mt-4'}>\n          <div className={isDesktop ? 'xl:col-span-4 rounded-xl bg-white border border-neutral-200 shadow-sm' : 'col-span-full rounded-xl bg-white border border-neutral-200 shadow-sm'}>\n                <div className=\"p-4 border-b border-neutral-200 flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-sm text-neutral-500 uppercase tracking-wide\">Menu Performance</div>\n                    <div className=\"text-lg font-semibold text-neutral-900\">Top items</div>\n                  </div>\n                </div>\n                <TopItems topItems={derived.topItems} />\n              </div>\n\n              <div className={isDesktop ? 'xl:col-span-8 rounded-xl bg-white border border-neutral-200 overflow-hidden shadow-sm' : 'col-span-full rounded-xl bg-white border border-neutral-200 overflow-hidden shadow-sm'}>\n                <div className=\"p-4 border-b border-neutral-200 flex items-center justify-between\">\n                  <div>\n                    <div className=\"text-sm text-neutral-500 uppercase tracking-wide\">Recent Activity</div>\n                    <div className=\"text-lg font-semibold text-neutral-900\">Latest orders</div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Link href=\"/admin/Orders\" className=\"h-9 px-3 rounded-md bg-white border border-neutral-200 text-sm flex items-center text-neutral-700 hover:bg-neutral-50 transition-colors\">Orders</Link>\n                    <Link href=\"/admin/MenuManagement\" className=\"h-9 px-3 rounded-md bg-white border border-neutral-200 text-sm flex items-center text-neutral-700 hover:bg-neutral-50 transition-colors\">Products</Link>\n                  </div>\n                </div>\n                <div className=\"overflow-auto\">\n                  <RecentOrdersTable orders={orders.slice(0, 50)} menuItems={menuItems} loading={loading} />\n                </div>\n              </div>\n            </section>\n          </div>\n        </main>\n      </div>\n    </div>\n  )\n}\n","size_bytes":11696},"replit.md":{"content":"# Restaurant Ordering System - Baltit Wok\n\n## Overview\nFull-stack Next.js restaurant ordering application with real-time order tracking via WebSocket. Features menu management, customer ordering with delivery/pickup, admin dashboard, and MongoDB database integration.\n\n## Recent Changes\n- **November 14, 2024**: Migrated from Vercel to Replit\n  - Updated server configuration to bind to 0.0.0.0:5000 for Replit compatibility\n  - Fixed WebSocket URL to use same host/port as main application\n  - Added caching to prevent duplicate restaurant creation\n  - Configured deployment settings for autoscale deployment\n  - Environment variables (MONGO_URI, JWT_SECRET) added to Replit Secrets\n\n## Project Architecture\n\n### Tech Stack\n- **Frontend**: Next.js 15.5.4, React 19, TailwindCSS 4\n- **Backend**: Next.js API Routes, Custom Node.js server with WebSocket support\n- **Database**: MongoDB (via Mongoose)\n- **Authentication**: JWT tokens with HTTP-only cookies\n- **Real-time**: WebSocket for live order updates\n\n### Key Components\n- `server.js` - Custom server combining Next.js with WebSocket server on port 5000\n- `src/app/` - Next.js App Router pages and API routes\n- `src/components/` - React components (Customer, Admin, Menu, Checkout)\n- `src/models/` - Mongoose schemas (Restaurant, Category, MenuItem, Order, User)\n- `src/services/db.js` - Database connection and CRUD operations\n- `src/hooks/useWebSocket.js` - WebSocket client hook with reconnection logic\n\n### Database Schema\n- **Restaurant**: Main restaurant profile with branches\n- **Category**: Menu categories linked to restaurant\n- **MenuItem**: Menu items with variants and sides\n- **Order**: Customer orders with items, status tracking\n- **User**: Admin users for authentication\n\n## Environment Variables\nRequired secrets (configured in Replit Secrets):\n- `MONGO_URI` - MongoDB connection string\n- `JWT_SECRET` - Secret key for JWT token signing\n\nOptional:\n- `DEFAULT_RESTAURANT_NAME` - Name for auto-created restaurant (default: \"My Restaurant\")\n- `Restaurant` - Specific restaurant ID to use\n- `WS_BROADCAST_URL` - WebSocket broadcast endpoint (default: http://127.0.0.1:5000/internal/ws/broadcast)\n\n## Running the Application\n\n### Development\n```bash\nnpm run dev\n```\nStarts custom server with Next.js and WebSocket on port 5000\n\n### Production Build\n```bash\nnpm run build\nnpm run start\n```\n\n### Database Seeding\n```bash\nnpm run seed\n```\nSeeds restaurant with sample menu data\n\n## Deployment\nConfigured for Replit Autoscale deployment:\n- Build command: `npm run build`\n- Start command: `npm run start`\n- Port: 5000 (automatically exposed)\n\n## Features\n- Customer-facing menu browsing and ordering\n- Shopping cart with variant and side selection\n- Delivery/Pickup order types with address/branch selection\n- Real-time order status updates via WebSocket\n- Admin dashboard with order management\n- Menu management (categories and items)\n- Restaurant profile and branch management\n- JWT-based admin authentication\n\n## User Preferences\nNone specified yet.\n","size_bytes":3015},"src/middleware.config.js":{"content":"export const config = {\n  matcher: [\n    '/admin/:path*',\n    '/((?!api|_next/static|_next/image|favicon.ico).*)',\n  ],\n}","size_bytes":121},"src/hooks/useCart.jsx":{"content":"","size_bytes":0},"src/hooks/useCart.js":{"content":"'use client';\n\nimport { useState, useCallback } from 'react';\n\nconst useCart = () => {\n  const [cart, setCart] = useState([]);\n\n  const addToCart = useCallback((item, quantity = 1, selectedSides = []) => {\n    setCart(currentCart => {\n      const existingItemIndex = currentCart.findIndex(\n        cartItem => \n          cartItem.id === item.id && \n          JSON.stringify(cartItem.selectedSides) === JSON.stringify(selectedSides)\n      );\n\n      if (existingItemIndex > -1) {\n        // Update existing item quantity\n        const newCart = [...currentCart];\n        newCart[existingItemIndex].quantity += quantity;\n        return newCart;\n      } else {\n        // Add new item\n        return [...currentCart, {\n          ...item,\n          quantity,\n          selectedSides,\n        }];\n      }\n    });\n  }, []);\n\n  const quickAddToCart = useCallback((item) => {\n    addToCart(item, 1, []);\n  }, [addToCart]);\n\n  const updateQuantity = useCallback((itemId, selectedSides, newQuantity) => {\n    setCart(currentCart => \n      currentCart.map(item => \n        item.id === itemId && \n        JSON.stringify(item.selectedSides) === JSON.stringify(selectedSides)\n          ? { ...item, quantity: newQuantity }\n          : item\n      ).filter(item => item.quantity > 0)\n    );\n  }, []);\n\n  const removeItem = useCallback((itemId, selectedSides) => {\n    setCart(currentCart => \n      currentCart.filter(item => \n        !(item.id === itemId && \n          JSON.stringify(item.selectedSides) === JSON.stringify(selectedSides))\n      )\n    );\n  }, []);\n\n  const clearCart = useCallback(() => {\n    setCart([]);\n  }, []);\n\n  return {\n    cart,\n    addToCart,\n    quickAddToCart,\n    updateQuantity,\n    removeItem,\n    clearCart,\n  };\n};\n\nexport { useCart };","size_bytes":1751},"src/components/Menu/DesktopCartButton.jsx":{"content":"// \"use client\";\n\n// import { useEffect, useState } from \"react\";\n// import Image from \"next/image\";\n// import api from \"@/services/api\";\n// import ShoppingCartIcon from \"@/public/shopping-cart.svg\";\n\n// export default function DesktopCartButton() {\n//   const [count, setCount] = useState(0);\n//   const [total, setTotal] = useState(0);\n\n//   const loadCart = async () => {\n//     try {\n//       const tokenNow = typeof window !== \"undefined\" ? localStorage.getItem(\"token\") : null;\n//       if (tokenNow) {\n//         const res = await api.get(\"cart\", { headers: { Authorization: `Bearer ${tokenNow}` } });\n//         const serverItems = res?.data?.items ?? res?.data?.data?.items ?? [];\n//         const itemCount = serverItems.reduce((s, it) => s + (it.quantity ?? 1), 0);\n//         const sum = serverItems.reduce((s, it) => {\n//           const price = Number(it.menuItem?.price ?? 0);\n//           return s + price * (it.quantity ?? 1);\n//         }, 0);\n//         setCount(itemCount);\n//         setTotal(sum);\n//       } else {\n//         const local = JSON.parse(localStorage.getItem(\"localCart\") || \"[]\");\n//         const itemCount = local.reduce((s, it) => s + (it.quantity ?? 1), 0);\n//         const sum = local.reduce((s, it) => s + (Number(it.product?.price ?? 0) * (it.quantity ?? 1)), 0);\n//         setCount(itemCount);\n//         setTotal(sum);\n//       }\n//     } catch (err) {\n//       console.error(\"Failed to load cart (desktop button)\", err);\n//       setCount(0);\n//       setTotal(0);\n//     }\n//   };\n\n//   useEffect(() => {\n//     loadCart();\n//     const onUpdate = () => loadCart();\n//     window.addEventListener(\"storage\", onUpdate);\n//     window.addEventListener(\"cartUpdated\", onUpdate);\n//     return () => {\n//       window.removeEventListener(\"storage\", onUpdate);\n//       window.removeEventListener(\"cartUpdated\", onUpdate);\n//     };\n//     // eslint-disable-next-line react-hooks/exhaustive-deps\n//   }, []);\n\n//   return (\n//     <button\n//       className=\"hidden md:flex items-center gap-3 fixed right-6 bottom-6 z-50 bg-white border shadow-lg rounded-full px-3 py-2 hover:shadow-2xl\"\n//       onClick={() => window.dispatchEvent(new Event(\"openCart\"))}\n//       aria-label=\"Open cart\"\n//       title=\"Open cart\"\n//     >\n//       <div className=\"relative w-8 h-8\">\n//         <Image src={ShoppingCartIcon} alt=\"Cart\" width={24} height={24} className=\"object-contain\" />\n//         {count > 0 && (\n//           <span className=\"absolute -top-2 -right-2 bg-red-600 text-white text-xs font-semibold rounded-full px-2 py-0.5\">\n//             {count}\n//           </span>\n//         )}\n//       </div>\n//       <div className=\"hidden lg:flex flex-col text-left\">\n//         <span className=\"text-sm font-medium\">Cart</span>\n//         <span className=\"text-xs text-gray-500\">Rs {total}</span>\n//       </div>\n//     </button>\n//   );\n// }","size_bytes":2882},"README.md":{"content":"This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).\n\n## Getting Started\n\nFirst, run the development server:\n\n```bash\nnpm run dev\n# or\nyarn dev\n# or\npnpm dev\n# or\nbun dev\n```\n\nOpen [http://localhost:3000](http://localhost:3000) with your browser to see the result.\n\nYou can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.\n\nThis project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.\n\n## Learn More\n\nTo learn more about Next.js, take a look at the following resources:\n\n- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.\n- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.\n\nYou can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!\n\n## Deploy on Vercel\n\nThe easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.\n\nCheck out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.\n","size_bytes":1450},"src/app/api/menu-items/by-category/route.js":{"content":"import { getMenuByCategory, connectToDB } from '../../../../services/db'\nimport { getOrCreateDefaultRestaurant } from '../../../../utils/getRestaurantId'\n\nexport async function GET(request) {\n  try {\n    const restaurantId = await getOrCreateDefaultRestaurant()\n    if (!restaurantId) {\n      return Response.json({ \n        success: false, \n        error: 'No restaurant found. Please create a restaurant first.',\n        timestamp: new Date().toISOString()\n      }, { status: 404 })\n    }\n    \n    // Get category name from the URL query params\n    const { searchParams } = new URL(request.url)\n    const category = searchParams.get('category')\n    \n    if (!category) {\n      return Response.json({ \n        success: false,\n        error: 'Category name is required',\n        timestamp: new Date().toISOString()\n      }, { status: 400 })\n    }\n\n    await connectToDB()\n    const items = await getMenuByCategory(restaurantId, category)\n    \n    return Response.json({ \n      success: true,\n      data: items,\n      timestamp: new Date().toISOString()\n    })\n  } catch (error) {\n    console.error('Menu items by category fetch error:', error)\n    return Response.json({ \n      success: false, \n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 500 })\n  }\n}","size_bytes":1294},"src/hooks/useLocalStorage.jsx":{"content":"import { useState, useEffect } from 'react';\n\nexport function useLocalStorage(key, initialValue) {\n  const [storedValue, setStoredValue] = useState(initialValue);\n  const [isClient, setIsClient] = useState(false);\n\n  useEffect(() => {\n    setIsClient(true);\n  }, []);\n\n  useEffect(() => {\n    if (!isClient) return;\n\n    try {\n      const item = window.localStorage.getItem(key);\n      if (item) {\n        setStoredValue(JSON.parse(item));\n      }\n    } catch (error) {\n      console.error(`Error loading ${key} from localStorage:`, error);\n    }\n  }, [key, isClient]);\n\n  const setValue = (value) => {\n    try {\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      setStoredValue(valueToStore);\n\n      if (isClient) {\n        window.localStorage.setItem(key, JSON.stringify(valueToStore));\n      }\n    } catch (error) {\n      console.error(`Error saving ${key} to localStorage:`, error);\n    }\n  };\n\n  return [storedValue, setValue];\n}","size_bytes":972},"src/components/AdminDashboard/StatusDonut.jsx":{"content":"'use client'\n\nexport default function StatusDonut({ counts = {}, total = 0 }) {\n  const cDelivered = counts.delivered || 0\n  const cPending = counts.pending || 0\n  const cCancelled = (counts.cancelled || 0) + (counts.refunded || 0)\n  const size = 144\n  const stroke = 12\n  const r = (size - stroke) / 2\n  const cx = size / 2\n  const cy = size / 2\n  const C = 2 * Math.PI * r\n  const totalSafe = total || 1\n  const segs = [\n    { val: cDelivered, color: 'rgb(0,0,0)' },\n    { val: cPending, color: 'rgb(115,115,115)' },\n    { val: cCancelled, color: 'rgb(163,163,163)' }\n  ]\n  let offset = 0\n  const arcs = segs.map(s => {\n    const frac = s.val / totalSafe\n    const len = C * frac\n    const dash = `${len} ${C - len}`\n    const el = `<circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"${s.color}\" stroke-width=\"${stroke}\" stroke-dasharray=\"${dash}\" stroke-dashoffset=\"${offset}\" stroke-linecap=\"round\" />`\n    offset -= len\n    return el\n  }).join('')\n\n  return (\n    <div className=\"flex items-center gap-6\">\n      <div className=\"relative h-36 w-36\" dangerouslySetInnerHTML={{ __html: `\n        <svg width=\"${size}\" height=\"${size}\" viewBox=\"0 0 ${size} ${size}\">\n          <circle cx=\"${cx}\" cy=\"${cy}\" r=\"${r}\" fill=\"none\" stroke=\"rgba(0,0,0,0.1)\" stroke-width=\"${stroke}\" />\n          ${arcs}\n          <text x=\"${cx}\" y=\"${cy-4}\" text-anchor=\"middle\" fill=\"rgb(0,0,0)\" font-size=\"16\" font-weight=\"500\">${Math.round((cDelivered/totalSafe)*100)}%</text>\n          <text x=\"${cx}\" y=\"${cy+14}\" text-anchor=\"middle\" fill=\"rgba(0,0,0,0.6)\" font-size=\"11\">Delivered</text>\n        </svg>\n      ` }} />\n      <div className=\"flex-1 grid grid-cols-2 gap-3 text-sm\">\n        <div className=\"flex items-center gap-2\"><span className=\"h-2 w-2 rounded-full bg-neutral-900\" /> <span className=\"text-neutral-700\">Delivered</span> <span className=\"ml-auto text-neutral-500\">{counts.delivered||0}</span></div>\n        <div className=\"flex items-center gap-2\"><span className=\"h-2 w-2 rounded-full bg-neutral-500\" /> <span className=\"text-neutral-700\">Pending</span> <span className=\"ml-auto text-neutral-500\">{counts.pending||0}</span></div>\n        <div className=\"flex items-center gap-2\"><span className=\"h-2 w-2 rounded-full bg-neutral-400\" /> <span className=\"text-neutral-700\">Pickup</span> <span className=\"ml-auto text-neutral-500\">{counts.pickup||0}</span></div>\n        <div className=\"flex items-center gap-2\"><span className=\"h-2 w-2 rounded-full bg-neutral-300\" /> <span className=\"text-neutral-700\">Cancelled</span> <span className=\"ml-auto text-neutral-500\">{(counts.cancelled||0)+(counts.refunded||0)}</span></div>\n      </div>\n    </div>\n  )\n}\n\n","size_bytes":2661},"src/components/AdminDashboard/TopBar.jsx":{"content":"'use client'\n\nimport { useState } from 'react'\n\nexport default function TopBar({ onOpenSidebar, isDesktop = true }) {\n  const [q, setQ] = useState('')\n\n  return (\n    <header className=\"h-16 flex items-center gap-3 px-4 md:px-6 border-b border-neutral-200 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60\">\n      {!isDesktop && (\n        <button onClick={onOpenSidebar} className=\"inline-flex items-center justify-center h-9 w-9 rounded-md hover:bg-neutral-50 text-neutral-700 transition-colors\" aria-label=\"Open sidebar\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M4 5h16\"/><path d=\"M4 12h16\"/><path d=\"M4 19h16\"/></svg>\n        </button>\n      )}\n      <div className=\"hidden md:flex items-center gap-2 text-neutral-500\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z\"/></svg>\n        <span className=\"text-sm\">Welcome back</span>\n      </div>\n\n      <div className=\"ml-auto flex items-center gap-2\">\n        <div className=\"relative hidden sm:block\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4 absolute left-2.5 top-2.5 text-neutral-400\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"m21 21-4.34-4.34\"/><circle cx=\"11\" cy=\"11\" r=\"8\"/></svg>\n          <input value={q} onChange={(e)=>setQ(e.target.value)} placeholder=\"Search orders, customers...\" className=\"pl-9 pr-3 h-9 w-64 bg-white border border-neutral-200 rounded-md text-sm placeholder:text-neutral-400 outline-none focus:border-neutral-300 focus:ring-2 focus:ring-neutral-900/10 text-neutral-700\" />\n        </div>\n\n        <button className=\"inline-flex items-center gap-2 h-9 px-3 rounded-md bg-white border border-neutral-200 hover:bg-neutral-50 hover:border-neutral-300 text-neutral-700 transition-colors\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M12 3v12\"/><path d=\"m17 8-5-5-5 5\"/><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/></svg>\n          <span className=\"text-sm\">Import</span>\n        </button>\n        <button className=\"inline-flex items-center justify-center h-9 w-9 rounded-md bg-white border border-neutral-200 hover:bg-neutral-50 hover:border-neutral-300 text-neutral-700 transition-colors\" aria-label=\"Notifications\">\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-4 w-4\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><path d=\"M10.268 21a2 2 0 0 0 3.464 0\"/><path d=\"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326\"/></svg>\n        </button>\n      </div>\n    </header>\n  )\n}\n","size_bytes":3136}},"version":2}